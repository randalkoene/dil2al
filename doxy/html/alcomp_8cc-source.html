<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>alcomp.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>alcomp.cc</h1><a href="alcomp_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// alcomp.cc</font>
00002 <font class="comment">// Randal A. Koene, 20000304</font>
00003 
00004 <font class="preprocessor">#include "<a class="code" href="dil2al_8hh.html">dil2al.hh</a>"</font>
00005 
<a name="l00006"></a><a class="code" href="alcomp_8cc.html#a3">00006</a> <font class="keywordtype">int</font> <a class="code" href="alcomp_8cc.html#a3">get_topic_keywords</a>() {
00007         <font class="keyword">const</font> <font class="keywordtype">int</font> LLEN = 10240;
00008         <font class="keywordtype">char</font> lbuf[LLEN];
00009         ifstream dilfile;
00010         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;numDILs; i++) {
00011                 dilfile.open(*(dil[i]));
00012                 <font class="keywordflow">if</font> (dilfile) {
00013                         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a46">find_line</a>(&amp;dilfile,<font class="stringliteral">"Topic Keywords"</font>,lbuf,LLEN)) {
00014                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing topic keywords in "</font> &lt;&lt; *(dil[i]) &lt;&lt; <font class="stringliteral">" in get_topic_keywords()\n"</font>;
00015                                 <font class="keywordflow">return</font> 0;
00016                         }
00017                         dilfile.close();
00018                 }
00019         }
00020         <font class="keywordflow">return</font> 1;
00021 }
00022 
<a name="l00023"></a><a class="code" href="alcomp_8cc.html#a4">00023</a> <a class="code" href="classString.html">String</a> <a class="code" href="alcomp_8cc.html#a4">generate_AL_full_entry</a>(<a class="code" href="classString.html">String</a> dilid, <font class="keywordtype">int</font> chunkfreq) {
00024         <a class="code" href="classString.html">String</a> <a class="code" href="templates_8defines_8hh.html#a11">res</a>(<font class="stringliteral">"&lt;LI&gt;&lt;A HREF=\"detailed-items-by-ID.html#"</font>+dilid+<font class="stringliteral">"\"&gt;"</font>+dilid+<font class="stringliteral">"&lt;/A&gt; ("</font>+dec(chunkfreq)+<font class="stringliteral">")\n"</font>);
00025         <font class="keywordflow">return</font> res;
00026 }
00027 
<a name="l00028"></a><a class="code" href="alcomp_8cc.html#a5">00028</a> <a class="code" href="classString.html">String</a> <a class="code" href="alcomp_8cc.html#a5">generate_AL_entry</a>(<a class="code" href="classString.html">String</a> dilid, <font class="keywordtype">bool</font> ishighestpriority = <font class="keyword">false</font>) {
00029   <font class="comment">// Note: This is currently called only when dil2al is run with the</font>
00030   <font class="comment">// command line argument -a. This function generates an entry for manual</font>
00031   <font class="comment">// modification of an AL.</font>
00032         <a class="code" href="classString.html">String</a> idstr;
00033         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(idfile,idstr)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00034         <font class="keywordtype">int</font> idindex;
00035         idindex = idstr.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;][  ]*[&lt;]A[         ]+[^&gt;]*[Nn][Aa][Mm][Ee][        ]*=[    ]*\""</font>+dilid));
00036         <font class="keywordflow">if</font> (idindex&lt;0) {
00037                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find "</font> &lt;&lt; dilid &lt;&lt; <font class="stringliteral">" in "</font> &lt;&lt; idfile &lt;&lt; <font class="stringliteral">" in generate_AL_entry()\n"</font>;
00038                 <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00039         }
00040         <a class="code" href="classString.html">String</a> topdil;
00041         topdil = idstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;][      ]*[&lt;]A[         ]+[^&gt;]*[Hh][Rr][Ee][Ff][        ]*=[    ]*\"[^\"]+"</font>+dilid),idindex+1);
00042         <font class="keywordflow">if</font> (topdil==<font class="stringliteral">""</font>) {
00043                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find full reference to "</font> &lt;&lt; dilid &lt;&lt; <font class="stringliteral">" in generate_AL_entry()\n"</font>;
00044                 <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00045         }
00046         topdil = topdil.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;][  ]*[&lt;]A[         ]+[^&gt;]*[Hh][Rr][Ee][Ff][        ]*=[    ]*\""</font>));
00047         <a class="code" href="classString.html">String</a> topdilfile = topdil;
00048         topdil = basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+topdilfile.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"#"</font>);
00049         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(topdil,idstr)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00050         idindex = idstr.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;][  ]*[&lt;]A[         ]+[^&gt;]*[Nn][Aa][Mm][Ee][        ]*=[    ]*\""</font>+dilid));
00051         <font class="keywordflow">if</font> (idindex&lt;0) {
00052                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find "</font> &lt;&lt; dilid &lt;&lt; <font class="stringliteral">" in "</font> &lt;&lt; topdil &lt;&lt; <font class="stringliteral">" in generate_AL_entry()\n"</font>;
00053                 <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00054         }
00055         idindex = idstr.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TR[^&gt;]*[&gt;]"</font>),idindex+1);
00056         <font class="keywordflow">if</font> (idindex&lt;0) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00057         idindex = idstr.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;]"</font>),idindex+1);
00058         <font class="keywordflow">if</font> (idindex&lt;0) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00059         topdil = idstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;]...[^\n]*"</font>),idindex);
00060         <font class="keywordflow">if</font> (topdil==<font class="stringliteral">""</font>) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00061         topdil = topdil.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;]"</font>));
00062         topdil.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;][^&gt;]+[&gt;]"</font>),<font class="stringliteral">""</font>);
00063         <font class="keywordflow">if</font> (topdil.<a class="code" href="classString.html#a105">length</a>()&gt;100) {
00064                 topdil = topdil.<a class="code" href="classString.html#a58">before</a>(100);
00065                 topdil = topdil.<a class="code" href="classString.html#a58">before</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[      \n.,;:]"</font>),-1);
00066                 topdil += <font class="stringliteral">"..."</font>;
00067         }
00068         idstr = <font class="stringliteral">"&lt;TR"</font>;
00069         <font class="keywordflow">if</font> (ishighestpriority) idstr += <font class="stringliteral">" BGCOLOR=\"#3F5F00\""</font>;
00070         idstr += <font class="stringliteral">"&gt;&lt;TD&gt;[&lt;A HREF=\""</font>+topdilfile+<font class="stringliteral">"\"&gt;&lt;B&gt;"</font>+dilid+<font class="stringliteral">"&lt;/B&gt;&lt;/A&gt;][&lt;A HREF=\"file:///cgi-bin/dil2al?dil2al=MEI&amp;DILID="</font>+dilid+<font class="stringliteral">"\"&gt;edit&lt;/A&gt;]\n"</font>+topdil;
00071         <font class="keywordflow">return</font> idstr;
00072 }
00073 
<a name="l00074"></a><a class="code" href="alcomp_8cc.html#a6">00074</a> <a class="code" href="classString.html">String</a> <a class="code" href="alcomp_8cc.html#a6">AL_Day_Marker</a>(<a class="code" href="classString.html">String</a> &amp; dstfile, <a class="code" href="classAL__Day.html">AL_Day</a> * ald) {
00075 <font class="comment">// Generates a table row with data about ald for inclusion in AL files</font>
00076         <font class="keywordflow">if</font> (!ald) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00077         <a class="code" href="classString.html">String</a> daytxt = <font class="stringliteral">"&lt;!-- @select_TL_DIL_refs: SKIP ROW@ --&gt;&lt;B&gt;Day "</font> + <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,ald-&gt;<a class="code" href="classAL__Day.html#a3">DayDate</a>())
00078                         + <font class="stringliteral">"&lt;/B&gt; (suggested start "</font> + <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%H:%M"</font>,ald-&gt;<a class="code" href="classAL__Day.html#a4">DayStart</a>()) + <font class="stringliteral">", limits "</font>
00079                         + <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%H:%M"</font>,ald-&gt;<a class="code" href="classAL__Day.html#a5">DayStartMin</a>()) + <font class="charliteral">'-'</font> + <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%H:%M"</font>,ald-&gt;<a class="code" href="classAL__Day.html#a6">DayMaxt</a>());
00080         <font class="keywordflow">if</font> (ald-&gt;<a class="code" href="classAL__Day.html#a2">DayType</a>()==1) daytxt += <font class="stringliteral">", worked "</font> + <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%H:%M"</font>,alworked);
00081         daytxt += <font class="stringliteral">"), "</font>; daytxt += dec(ald-&gt;<a class="code" href="classAL__Day.html#a9">Total</a>()); daytxt += <font class="stringliteral">" task chunks"</font>;
00082         <font class="keywordflow">if</font> (ald-&gt;<a class="code" href="classAL__Day.html#a7">Expanded</a>()) daytxt += <font class="stringliteral">" (expanded)"</font>;
00083         <font class="keywordflow">if</font> (ald-&gt;<a class="code" href="classAL__Day.html#a12">TD_Head</a>()) {
00084                 <a class="code" href="classString.html">String</a> relidfile(<a class="code" href="utilities_8cc.html#a30">relurl</a>(dstfile,idfile));
00085                 daytxt += <font class="stringliteral">", target dates: "</font>;
00086                 <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__TD.html">AL_TD</a>,ald-&gt;<a class="code" href="classAL__Day.html#a12">TD_Head</a>(),1) {
00087                         daytxt += <a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>((relidfile+<font class="charliteral">'#'</font>)+e-&gt;DE()-&gt;chars(),<font class="stringliteral">"DIL#"</font> + <a class="code" href="classString.html">String</a>(e-&gt;DE()-&gt;chars()));
00088                         daytxt += <font class="stringliteral">" ("</font> + <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%H:%M"</font>,e-&gt;DE()-&gt;Target_Date()) + <font class="charliteral">')'</font>;
00089                         <font class="keywordflow">if</font> (e-&gt;Next()) daytxt += <font class="stringliteral">", "</font>;
00090                 }
00091         }
00092         <font class="keywordflow">return</font> <a class="code" href="utilities_8cc.html#a64">HTML_put_table_row</a>(<a class="code" href="dil2al_8hh.html#a98">DEFAULTALDAYEMPHASIS</a>,<a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,daytxt)) + <font class="charliteral">'\n'</font>;
00093 }
00094 
<a name="l00095"></a><a class="code" href="alcomp_8cc.html#a7">00095</a> <a class="code" href="classString.html">String</a> <a class="code" href="alcomp_8cc.html#a7">AL_Passed_Target_Dates</a>(<a class="code" href="classString.html">String</a> &amp; dstfile, <a class="code" href="classAL__TD.html">AL_TD</a> * atd) {
00096 <font class="comment">// Generates a list of passed target date DIL entries</font>
00097   <font class="keywordflow">if</font> (atd) {
00098     <a class="code" href="classString.html">String</a> diltext;
00099     <a class="code" href="classString.html">String</a> passedstr(<a class="code" href="utilities_8cc.html#a71">HTML_put_form_input</a>(<font class="stringliteral">"hidden"</font>,<font class="stringliteral">"name=\"dil2al\" value=\"MEtgroup\""</font>)+<font class="stringliteral">"\n&lt;B&gt;Passed Target Dates:&lt;/B&gt;\n&lt;UL&gt;\n"</font>), relidfile(<a class="code" href="utilities_8cc.html#a30">relurl</a>(dstfile,idfile));
00100     <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__TD.html">AL_TD</a>,atd,1) {
00101       <font class="keywordflow">if</font> (e-&gt;DE()-&gt;Entry_Text()) diltext = (*e-&gt;DE()-&gt;Entry_Text());
00102       <font class="keywordflow">else</font> diltext=<font class="stringliteral">""</font>;
00103       <a class="code" href="utilities_8cc.html#a62">HTML_remove_tags</a>(diltext);
00104       <a class="code" href="utilities_8cc.html#a78">Elipsis_At</a>(diltext,30);
00105       <a class="code" href="classString.html">String</a> deidstr(e-&gt;DE()-&gt;chars());
00106       passedstr += <font class="stringliteral">"&lt;LI&gt;"</font> + <a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>((relidfile+<font class="charliteral">'#'</font>)+deidstr,<font class="stringliteral">"DIL#"</font>+ deidstr)
00107         + <font class="stringliteral">"[&lt;A HREF=\"file:///cgi-bin/dil2al?dil2al=MEI&amp;DILID="</font>+deidstr+<font class="stringliteral">"\"&gt;edit&lt;/A&gt;] ("</font>
00108         + <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,e-&gt;DE()-&gt;Target_Date()) + <font class="stringliteral">") "</font>
00109         + <a class="code" href="utilities_8cc.html#a75">HTML_put_form_checkbox</a>(<a class="code" href="classString.html">String</a>(<font class="stringliteral">"TDCHKBX"</font>)+deidstr,<font class="stringliteral">"noupdate"</font>,<font class="stringliteral">""</font>,<font class="keyword">true</font>)
00110         + <a class="code" href="utilities_8cc.html#a77">HTML_put_form_text</a>(<a class="code" href="classString.html">String</a>(<font class="stringliteral">"TD"</font>)+deidstr,12) + <font class="charliteral">' '</font> + diltext + <font class="charliteral">'\n'</font>;
00111     }
00112     passedstr += <font class="stringliteral">"&lt;/UL&gt;\n"</font>+<a class="code" href="utilities_8cc.html#a74">HTML_put_form_radio</a>(<font class="stringliteral">"TDupdate"</font>,<font class="stringliteral">"group"</font>,<font class="stringliteral">"Minimize fragmentation"</font>,<font class="keyword">true</font>)
00113       + <font class="charliteral">' '</font>+<a class="code" href="utilities_8cc.html#a74">HTML_put_form_radio</a>(<font class="stringliteral">"TDupdate"</font>,<font class="stringliteral">"direct"</font>,<font class="stringliteral">"Direct"</font>)+<font class="stringliteral">"&lt;BR&gt;\n"</font>
00114       + <a class="code" href="utilities_8cc.html#a72">HTML_put_form_submit</a>(<font class="stringliteral">"Update"</font>)+<font class="charliteral">' '</font>+<a class="code" href="utilities_8cc.html#a272">HTML_put_form_reset</a>()+<font class="stringliteral">"\n&lt;P&gt;\n"</font>;
00115     <font class="keywordflow">return</font> <a class="code" href="utilities_8cc.html#a70">HTML_put_form</a>(htmlformmethod,htmlforminterface,passedstr);
00116   } <font class="keywordflow">else</font> <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00117 }
00118 
<a name="l00119"></a><a class="code" href="classActive__List.html#a16">00119</a> <font class="keywordtype">bool</font> <a class="code" href="classActive__List.html#a16">Active_List::generate_focused_AL</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * superior, time_t algenwt) {
00120 <font class="comment">// create the focused list of DIL entries according to dep</font>
00121 <font class="comment">// if superior==NULL then a complete AL of all DIL entries was computed</font>
00122 <font class="comment">// algenwt is marked at the top of the AL to indicate the</font>
00123 <font class="comment">// time allotted per full day prior to any expansions</font>
00124         <font class="comment">// determine number of task chunks to display</font>
00125         <font class="keywordtype">long</font> deplen = <a class="code" href="classActive__List.html#n3">allength</a>;
00126         <font class="keywordflow">if</font> (alfocused&lt;deplen) deplen = alfocused;
00127         <font class="keywordflow">if</font> ((generatealmaxt==0) &amp;&amp; (deplen&gt;generatealtcs)) deplen = generatealtcs;
00128         <font class="comment">// AL superior information</font>
00129         <a class="code" href="classString.html">String</a> dstfile(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+<a class="code" href="classActive__List.html#a2">filestr</a>()+<font class="stringliteral">".html"</font>);
00130         <a class="code" href="classString.html">String</a> alstr(<a class="code" href="dil2al_8hh.html#a99">DEFAULTALFOCUSEDHEADER</a>);
00131         alstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@SUP@"</font>,<a class="code" href="classActive__List.html#a1">get_supstr</a>());
00132         alstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@GENERAL-WORK-TIME@"</font>,<a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%H:%M"</font>,algenwt));
00133         alstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@PASSED@"</font>,<a class="code" href="alcomp_8cc.html#a7">AL_Passed_Target_Dates</a>(dstfile,<a class="code" href="classActive__List.html#m1">td</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()));
00134         <font class="comment">// *** perhaps catch MAXTIME_T and interpret it as "none"</font>
00135         <font class="keywordflow">if</font> (superior) alstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@TD@"</font>,<a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,superior-&gt;<a class="code" href="classDIL__entry.html#a12">Target_Date</a>())); <font class="keywordflow">else</font> alstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@TD@"</font>,<font class="stringliteral">"none"</font>);
00136         <font class="comment">// task chunk information</font>
00137         <a class="code" href="classString.html">String</a> diltext, dilurl; <a class="code" href="classDIL__entry.html">DIL_entry</a> * de;
00138         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>(),(deplen&gt;0)) {
00139                 alstr += <a class="code" href="alcomp_8cc.html#a6">AL_Day_Marker</a>(dstfile,e);
00140                 <font class="keywordflow">for</font> (<a class="code" href="classAL__TC.html">AL_TC</a> * atc = e-&gt;tc.head(); ((atc) &amp;&amp; (deplen&gt;0)); atc = atc-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">if</font> (de = atc-&gt;<a class="code" href="classAL__TC.html#a6">Get_DE</a>()) {
00141                         <font class="keywordflow">if</font> (de-&gt;<a class="code" href="classDIL__entry.html#a16">Entry_Text</a>()) diltext = (*de-&gt;<a class="code" href="classDIL__entry.html#a16">Entry_Text</a>());
00142                         <font class="keywordflow">else</font> {
00143                                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Warning - Missing Text Content for DIL entry #"</font> &lt;&lt; de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">" in generate_focused_AL(), continuing\n"</font>;
00144                                 diltext=<font class="stringliteral">""</font>;
00145                         }
00146                         <a class="code" href="utilities_8cc.html#a62">HTML_remove_tags</a>(diltext);
00147                         <a class="code" href="utilities_8cc.html#a78">Elipsis_At</a>(diltext,100);
00148                         <font class="keywordflow">if</font> (de-&gt;<a class="code" href="classDIL__entry.html#a6">Topics</a>(0)) {
00149                                 dilurl = de-&gt;<a class="code" href="classDIL__entry.html#a6">Topics</a>(0)-&gt;<a class="code" href="classDIL__Topical__List.html#m0">dil</a>.<a class="code" href="structfiletitle__t.html#m0">file</a>+<font class="charliteral">'#'</font>+de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>();
00150                                 dilurl = <a class="code" href="utilities_8cc.html#a30">relurl</a>(dstfile,dilurl);
00151                         } <font class="keywordflow">else</font> {
00152                                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Warning - Missing URL for DIL entry #"</font> &lt;&lt; de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">" in generate_focused_AL(), continuing\n"</font>;
00153                                 dilurl=<font class="charliteral">'#'</font>+de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>();
00154                         }
00155                         diltext.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"[&lt;A HREF=\"file:///cgi-bin/dil2al?dil2al=MEI&amp;DILID="</font>+de-&gt;<a class="code" href="classDIL__ID.html#a14">str</a>()+<font class="stringliteral">"\"&gt;edit&lt;/A&gt;]\n"</font>);
00156                         <font class="keywordflow">if</font> ((e==<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) &amp;&amp; (atc==e-&gt;tc.<a class="code" href="classPLLHandle.html#a3">head</a>())) alstr += <a class="code" href="utilities_8cc.html#a64">HTML_put_table_row</a>(<a class="code" href="dil2al_8hh.html#a101">DEFAULTALFOCUSEDEMPHASIS</a>,<a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<font class="charliteral">'['</font>+<a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>(dilurl,de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>())+<font class="stringliteral">"]\n"</font>+diltext)) + <font class="charliteral">'\n'</font>;
00157                         <font class="keywordflow">else</font> alstr += <a class="code" href="utilities_8cc.html#a64">HTML_put_table_row</a>(<font class="stringliteral">""</font>,<a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<font class="charliteral">'['</font>+<a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>(dilurl,de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>())+<font class="stringliteral">"]\n"</font>+diltext)) + <font class="charliteral">'\n'</font>;
00158                         deplen--;
00159                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing DIL entry in array at day "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,e-&gt;DayDate()) &lt;&lt; <font class="stringliteral">" in generate_focused_AL(), continuing as is\n"</font>;
00160         }
00161         <a class="code" href="classString.html">String</a> altail(<a class="code" href="dil2al_8hh.html#a100">DEFAULTALFOCUSEDTAIL</a>);
00162         altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@SUP@"</font>,<a class="code" href="classActive__List.html#a1">get_supstr</a>());
00163         altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@ALFILE@"</font>,<a class="code" href="classActive__List.html#a2">filestr</a>());
00164         <font class="keywordflow">if</font> (alshowcumulativereq) altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@CUMULATIVE@"</font>,<font class="stringliteral">"&lt;LI&gt;"</font>+<a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>(<a class="code" href="classActive__List.html#a2">filestr</a>()+<font class="stringliteral">".ctr.html"</font>,<font class="stringliteral">"Active List - Cumulative Time Required"</font>)+<font class="charliteral">'\n'</font>);
00165         <font class="keywordflow">else</font> altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@CUMULATIVE@"</font>,<font class="stringliteral">""</font>);
00166         altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@ALDATE@"</font>,<a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%c"</font>));
00167         alstr += altail;
00168         <font class="keywordflow">return</font> <a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(dstfile,alstr,<font class="stringliteral">"AL Focused"</font>);
00169 }
00170 
<a name="l00171"></a><a class="code" href="classActive__List.html#a17">00171</a> <font class="keywordtype">bool</font> <a class="code" href="classActive__List.html#a17">Active_List::generate_wide_AL</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * superior) {
00172 <font class="comment">// create the wide list of DIL entries according to dep</font>
00173 <font class="comment">// if superior==NULL then a complete AL of all DIL entries was computed</font>
00174         <font class="comment">// determine number of task chunks to display</font>
00175         <font class="keywordtype">long</font> deplen = <a class="code" href="classActive__List.html#n3">allength</a>;
00176         <font class="keywordflow">if</font> (alwide&lt;deplen) deplen = alwide;
00177         <font class="keywordflow">if</font> ((generatealmaxt==0) &amp;&amp; (deplen&gt;generatealtcs)) deplen = generatealtcs;
00178         <font class="comment">// AL superior information</font>
00179         <a class="code" href="classString.html">String</a> dstfile(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+<a class="code" href="classActive__List.html#a2">filestr</a>()+<font class="stringliteral">".wide.html"</font>);
00180         <a class="code" href="classString.html">String</a> alstr(<a class="code" href="dil2al_8hh.html#a102">DEFAULTALWIDEHEADER</a>);
00181         alstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@SUP@"</font>,<a class="code" href="classActive__List.html#a1">get_supstr</a>());
00182         <font class="comment">// task chunk information</font>
00183         <a class="code" href="classString.html">String</a> diltext, dilurl; <a class="code" href="classDIL__entry.html">DIL_entry</a> * de;
00184         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>(),(deplen&gt;0)) {
00185                 alstr += <font class="stringliteral">"&lt;BR&gt;"</font> + <a class="code" href="alcomp_8cc.html#a6">AL_Day_Marker</a>(dstfile,e);
00186                 <font class="keywordflow">for</font> (<a class="code" href="classAL__TC.html">AL_TC</a> * atc = e-&gt;tc.head(); ((atc) &amp;&amp; (deplen&gt;0)); atc = atc-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">if</font> (de = atc-&gt;<a class="code" href="classAL__TC.html#a6">Get_DE</a>()) {
00187                         <font class="keywordflow">if</font> (de-&gt;<a class="code" href="classDIL__entry.html#a16">Entry_Text</a>()) diltext = (*de-&gt;<a class="code" href="classDIL__entry.html#a16">Entry_Text</a>());
00188                         <font class="keywordflow">else</font> {
00189                                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Warning - Missing Text Content for DIL entry #"</font> &lt;&lt; de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">" in generate_wide_AL(), continuing\n"</font>;
00190                                 diltext=<font class="stringliteral">""</font>;
00191                         }
00192                         <a class="code" href="utilities_8cc.html#a62">HTML_remove_tags</a>(diltext);
00193                         <a class="code" href="utilities_8cc.html#a78">Elipsis_At</a>(diltext,50);
00194                         dilurl = <a class="code" href="utilities_8cc.html#a30">relurl</a>(dstfile,idfile)+<font class="charliteral">'#'</font>+de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>();
00195                         alstr += <a class="code" href="utilities_8cc.html#a67">HTML_put_list_item</a>(<a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>(dilurl,de-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>())+<font class="charliteral">' '</font>+diltext);
00196                         deplen--;
00197                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing DIL entry in array at day "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,e-&gt;DayDate()) &lt;&lt; <font class="stringliteral">" in generate_wide_AL(), continuing as is\n"</font>;
00198         }
00199         <a class="code" href="classString.html">String</a> altail(<a class="code" href="dil2al_8hh.html#a103">DEFAULTALWIDETAIL</a>);
00200         altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@SUP@"</font>,<a class="code" href="classActive__List.html#a1">get_supstr</a>());
00201         altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@ALFILE@"</font>,<a class="code" href="classActive__List.html#a2">filestr</a>());
00202         <font class="keywordflow">if</font> (alshowcumulativereq) altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@CUMULATIVE@"</font>,<font class="stringliteral">"&lt;LI&gt;"</font>+<a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>(<a class="code" href="classActive__List.html#a2">filestr</a>()+<font class="stringliteral">".ctr.html"</font>,<font class="stringliteral">"Active List - Cumulative Time Required"</font>)+<font class="charliteral">'\n'</font>);
00203         <font class="keywordflow">else</font> altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@CUMULATIVE@"</font>,<font class="stringliteral">""</font>);
00204         altail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@ALDATE@"</font>,<a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%c"</font>));
00205         alstr += altail;
00206         <font class="keywordflow">return</font> <a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(dstfile,alstr,<font class="stringliteral">"AL Wide"</font>);
00207 }
00208 
<a name="l00209"></a><a class="code" href="alcomp_8cc.html#a8">00209</a> <font class="keywordtype">bool</font> <a class="code" href="alcomp_8cc.html#a8">update_main_ALs</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * superior) {
00210 <font class="comment">// add or modify a link to the AL referred to by superior on</font>
00211 <font class="comment">// the main page (NULL = AL created with all DIL entries)</font>
00212         <a class="code" href="classString.html">String</a> mainstr, tag, text, supstr, supfilestr;
00213         <font class="keywordflow">if</font> (superior) supstr = superior-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>(); <font class="keywordflow">else</font> supstr = <font class="stringliteral">"all"</font>;
00214         supfilestr = <a class="code" href="utilities_8cc.html#a30">relurl</a>(listfile,basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+(<font class="stringliteral">"active-list."</font>+supstr+<font class="stringliteral">".html"</font>));
00215         <font class="comment">// get main lists file</font>
00216         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(listfile,mainstr)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00217         <font class="keywordtype">int</font> mainloc = 0;
00218         <font class="comment">// locate list of ALs</font>
00219         <font class="keywordflow">do</font> <font class="keywordflow">if</font> ((mainloc=<a class="code" href="utilities_8cc.html#a59">HTML_get_name</a>(mainstr,mainloc,tag,text))&lt;0) {
00220                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find HTML anchor ``AL'' in "</font> &lt;&lt; listfile &lt;&lt; <font class="stringliteral">" in update_main_ALs()\n"</font>;
00221                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00222         } <font class="keywordflow">while</font> (tag!=<font class="stringliteral">"AL"</font>);
00223         <font class="comment">// get list of ALs</font>
00224         <font class="keywordtype">int</font> liststart;
00225         <font class="keywordflow">if</font> ((mainloc=<a class="code" href="utilities_8cc.html#a56">HTML_get_list</a>(mainstr,mainloc,tag,text,&amp;liststart))&lt;0) {
00226                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing list of ALs in "</font> &lt;&lt; listfile &lt;&lt; <font class="stringliteral">" in update_main_ALs()\n"</font>;
00227                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00228         }
00229         <font class="comment">// find list item with link to AL corresponding with superior</font>
00230         <font class="keywordtype">int</font> listloc = 0; <a class="code" href="classString.html">String</a> itemtext,hreftext;
00231         <font class="keywordflow">do</font> <font class="keywordflow">if</font> ((listloc=<a class="code" href="utilities_8cc.html#a57">HTML_get_list_item</a>(text,listloc,tag,itemtext))&gt;=0) 
00232                 <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a58">HTML_get_href</a>(itemtext,0,tag,hreftext)&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing HREF to AL in "</font> &lt;&lt; listfile &lt;&lt; <font class="stringliteral">" in update_main_ALs(), continuing\n"</font>;
00233         <font class="keywordflow">while</font> ((listloc&gt;=0) &amp;&amp; (tag!=supfilestr));
00234         <font class="keywordflow">if</font> (listloc&gt;=0) <font class="keywordflow">return</font> <font class="keyword">true</font>; <font class="comment">// link already exists</font>
00235         <font class="comment">// if new, add link to AL corresponding with superior</font>
00236         <a class="code" href="classString.html">String</a> newmainstr(mainstr.<a class="code" href="classString.html#a58">before</a>(liststart));
00237         <font class="keywordflow">if</font> (superior) {
00238                 <font class="keywordflow">if</font> (superior-&gt;<a class="code" href="classDIL__entry.html#a16">Entry_Text</a>()) {
00239                         tag = *(superior-&gt;<a class="code" href="classDIL__entry.html#a16">Entry_Text</a>());
00240                         <a class="code" href="utilities_8cc.html#a78">Elipsis_At</a>(tag,100);
00241                 } <font class="keywordflow">else</font> {
00242                         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Warning - No text content available for description of AL in update_main_ALs(), continuing as is\n"</font>;
00243                         tag = <font class="stringliteral">"(No description available.)"</font>;
00244                 }
00245         } <font class="keywordflow">else</font> tag = <font class="stringliteral">"A list of tasks created with all DIL entries."</font>;
00246         <font class="comment">// *** perhaps don't use relaxedhtml, despite possible unexpected</font>
00247         <font class="comment">//     behaviour by older function that read the main lists page</font>
00248         text += <a class="code" href="utilities_8cc.html#a67">HTML_put_list_item</a>(<a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>(supfilestr,<font class="stringliteral">"Active List: "</font>+<a class="code" href="BigString_8hh.html#a84">capitalize</a>(supstr))+<font class="stringliteral">"&lt;BR&gt;\n"</font>+tag+<font class="charliteral">'\n'</font>,<font class="keyword">true</font>)+<font class="stringliteral">"&lt;P&gt;\n"</font>;
00249         newmainstr += <a class="code" href="utilities_8cc.html#a66">HTML_put_list</a>(<font class="charliteral">'U'</font>,text) + mainstr.<a class="code" href="classString.html#a70">from</a>(mainloc);
00250         <font class="keywordflow">return</font> <a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(listfile,newmainstr,<font class="stringliteral">"Main Lists"</font>);
00251 }
00252 
00253 <font class="comment">//...add target dates to important DIL entries</font>
00254 <font class="comment">//...make more DIL entries for sub-tasks/dependencies</font>
00255 <font class="comment">//...perhaps don't put target dates at midnight</font>
00256 <font class="comment">//...note: can remove start time parameter</font>
00257 <font class="comment">//...count errors or warnings encountered</font>
00258 <font class="comment">//...clean up with HTML functions and speed up bottlenecks</font>
00259 <font class="comment">//...move gesn inline functions to headers (See C++ FAQ Lite [9.4])</font>
00260 <font class="comment">//...perhaps make it possible to pass NULL to HTML functions</font>
00261 <font class="comment">//   in order not to retrieve some of the data</font>
00262 <font class="comment">//...perhaps use the BigString readline() function for queries</font>
00263 <font class="comment">//...maybe turn algenregular, algenall and allgenhpd into seconds (time_t)</font>
00264 
00265 <font class="comment">// *** make this able to generate an AL for a specific DIL and</font>
00266 <font class="comment">// its dependencies (that DIL can be an AL Project)</font>
<a name="l00267"></a><a class="code" href="alcomp_8cc.html#a0">00267</a> <font class="preprocessor">#define AL_PREPARATION_DELAY 60</font>
<a name="l00268"></a><a class="code" href="alcomp_8cc.html#a9">00268</a> <font class="preprocessor"></font><font class="keywordtype">float</font> <a class="code" href="alcomp_8cc.html#a9">linear_distribution</a>(<font class="keywordtype">float</font> i, <font class="keywordtype">float</font> i_limit) {
00269 <font class="comment">// linearly distribute TC values (see TL#200006291007.2)</font>
00270         <font class="keywordflow">return</font> 1.0 - (0.9*i/i_limit);
00271 }
00272 
<a name="l00273"></a><a class="code" href="alcomp_8cc.html#a10">00273</a> <font class="keywordtype">long</font> * <a class="code" href="alcomp_8cc.html#a10">DIL_Required_Task_Chunks</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> ** dep, <font class="keywordtype">int</font> deplen) {
00274 <font class="comment">// returns an array with the number of task chunks</font>
00275 <font class="comment">// required to complete the DIL entries in the array</font>
00276 <font class="comment">// dep with length deplen</font>
00277   <font class="keywordtype">long</font> * req = <font class="keyword">new</font> <font class="keywordtype">long</font>[deplen];
00278   <font class="keywordtype">float</font> completion;
00279   <font class="keywordtype">long</font> c_size = ((long) timechunksize)*60;
00280   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;deplen; i++) {
00281     req[i] = dep[i]-&gt;<a class="code" href="classDIL__entry.html#a14">Time_Required</a>();
00282     completion = dep[i]-&gt;<a class="code" href="classDIL__entry.html#a15">Completion_State</a>();
00283     <font class="keywordflow">if</font> (completion&lt;0.0) completion = 1.0; <font class="comment">// negative completion values have special meaning but do imply that the task is no longer scheduled to be completed</font>
00284     <font class="keywordflow">if</font> (completion&gt;1.0) {
00285       <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Completion ratio exceeds 1.0 for DIL#"</font>;
00286       <font class="keywordflow">if</font> (calledbyforminput) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"&lt;A HREF=\""</font> &lt;&lt; idfile &lt;&lt; <font class="charliteral">'#'</font> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">"\"&gt;"</font>;
00287       <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>();
00288       <font class="keywordflow">if</font> (calledbyforminput) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"&lt;/A&gt;"</font>;
00289       <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">" in DIL_Required_Task_Chunks(), continuing\n"</font>;
00290       req[i] = 0;
00291       <font class="keywordflow">continue</font>;
00292     }
00293     completion = ceil(((<font class="keywordtype">double</font>) req[i])*(1.0-completion)); <font class="comment">// determine remaining time required</font>
00294     req[i] = (long) completion;
00295     <font class="keywordflow">if</font> (req[i] % c_size) req[i] = (req[i]/c_size) + 1;
00296     <font class="keywordflow">else</font> req[i] /= c_size;
00297   }
00298   <font class="keywordflow">return</font> req;
00299 }
00300 
<a name="l00301"></a><a class="code" href="alcomp_8cc.html#a11">00301</a> <font class="keywordtype">void</font> <a class="code" href="alcomp_8cc.html#a11">Get_Worked_Estimate</a>() {
00302 <font class="comment">// update alworked (in seconds)</font>
00303         <font class="keywordflow">if</font> (alworked&lt;0) { <font class="comment">// (alworked&gt;=0) if given on command line</font>
00304                 time_t tod;
00305                 <font class="keywordflow">switch</font> (alcurdayworkedstrategy) {
00306                         <font class="keywordflow">case</font> <a class="code" href="dil2al_8hh.html#a85">ACW_TIME</a>: <font class="comment">// estimate according to current time</font>
00307                                 tod = <a class="code" href="utilities_8cc.html#a24">time_stamp_time_of_day</a>(curtime);
00308                                 tod -= alworkdaystart;
00309                                 <font class="keywordflow">if</font> (tod&lt;0) alworked = 0; <font class="keywordflow">else</font> alworked = tod;
00310                                 <font class="keywordflow">break</font>;
00311                         <font class="keywordflow">case</font> <a class="code" href="dil2al_8hh.html#a86">ACW_TL</a>: <font class="comment">// *** obtain an estimate from task log entries</font>
00312                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: ACW_TL option not yet implemented in Get_Worked_Estimate(), setting to 0\n"</font>;
00313                                 alworked = 0;
00314                                 <font class="keywordflow">break</font>;
00315                         <font class="keywordflow">case</font> <a class="code" href="dil2al_8hh.html#a87">ACW_ASK</a>: <font class="comment">// *** ask for estimate</font>
00316                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: ACW_ASK option not yet implemented in Get_Worked_Estimate(), setting to 0\n"</font>;
00317                                 alworked = 0;
00318                                 <font class="keywordflow">break</font>;
00319                         <font class="keywordflow">default</font>: alworked = 0;
00320                 }
00321         }
00322 }
00323 
<a name="l00324"></a><a class="code" href="classAL__TC.html#a1">00324</a> <a class="code" href="classAL__TC.html#a0">AL_TC::AL_TC</a>(<font class="keywordtype">long</font> itc, <font class="keywordtype">long</font> i_limit): de(NULL) {
00325 <font class="comment">// create TC and set value</font>
00326         <a class="code" href="classAL__TC.html#n1">val</a> = <a class="code" href="alcomp_8cc.html#a9">linear_distribution</a>((<font class="keywordtype">float</font>) itc, (<font class="keywordtype">float</font>) i_limit);
00327 }
00328 
<a name="l00329"></a><a class="code" href="classAL__TC.html#a3">00329</a> <a class="code" href="classAL__TC.html">AL_TC</a> * <a class="code" href="classAL__TC.html#a3">AL_TC::next_avail_el</a>() {
00330 <font class="comment">// returns the next available task chunk</font>
00331         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__TC.html">AL_TC</a>,<font class="keyword">this</font>,1) <font class="keywordflow">if</font> (!e-&gt;Get_DE()) <font class="keywordflow">return</font> e;
00332         <font class="keywordflow">return</font> NULL;
00333 }
00334 
<a name="l00335"></a><a class="code" href="classAL__TC.html#a4">00335</a> <a class="code" href="classAL__TC.html">AL_TC</a> * <a class="code" href="classAL__TC.html#a4">AL_TC::avail_el</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> n) {
00336 <font class="comment">// returns the nth available task chunk</font>
00337         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__TC.html">AL_TC</a>,<font class="keyword">this</font>,1) <font class="keywordflow">if</font> (!e-&gt;Get_DE()) {
00338                 <font class="keywordflow">if</font> (n==0) <font class="keywordflow">return</font> e;
00339                 n--;
00340         }
00341         <font class="keywordflow">return</font> NULL;
00342 }
00343 
<a name="l00344"></a><a class="code" href="classAL__TC.html#a8">00344</a> <font class="keywordtype">long</font> <a class="code" href="classAL__TC.html#a8">AL_TC::available_before</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> n) {
00345 <font class="comment">// returns the number of task chunks available before the</font>
00346 <font class="comment">// nth task chunk (i.e. does not include the nth task chunk)</font>
00347 <font class="comment">// This is used by AL_Day::available_before().</font>
00348         <font class="keywordtype">long</font> avail = 0;
00349         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__TC.html">AL_TC</a>,<font class="keyword">this</font>,1) {
00350                 <font class="keywordflow">if</font> (n==0) <font class="keywordflow">return</font> avail;
00351                 <font class="keywordflow">if</font> (!e-&gt;Get_DE()) avail++;
00352                 n--;
00353         }
00354         <font class="keywordflow">return</font> avail;
00355 }
00356 
<a name="l00357"></a><a class="code" href="classAL__TC.html#a9">00357</a> <font class="keywordtype">float</font> <a class="code" href="classAL__TC.html#a9">AL_TC::allocate_with_value</a>(<font class="keywordtype">float</font> uval, <a class="code" href="classDIL__entry.html">DIL_entry</a> * d) {
00358 <font class="comment">// allocate a DIL entry to a task chunk according to</font>
00359 <font class="comment">// a random value</font>
00360 <font class="comment">// returns the value of the allocated task chunk</font>
00361 <font class="comment">// creates TCs if necessary</font>
00362         <font class="keyword">const</font> <font class="keywordtype">char</font> _err_msg[] = <font class="stringliteral">"dil2al: Available TC values do not add up to day value in AL_TC::allocate_with_value(), continuing\n"</font>;
00363         <font class="keywordflow">if</font> (de) {
00364                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__TC.html#a9">allocate_with_value</a>(uval,d);
00365                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; _err_msg;
00366                 <font class="keywordflow">return</font> 0.0;
00367         }
00368         <font class="keywordflow">if</font> (<a class="code" href="classAL__TC.html#n1">val</a>&lt;uval) {
00369                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__TC.html#a9">allocate_with_value</a>(uval-<a class="code" href="classAL__TC.html#n1">val</a>,d);
00370                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; _err_msg;
00371                 <font class="keywordflow">return</font> 0.0;
00372         }
00373         <a class="code" href="classAL__TC.html#n0">de</a> = d;
00374         uval = <a class="code" href="classAL__TC.html#n1">val</a>;
00375         <a class="code" href="classAL__TC.html#n1">val</a> = 0.0;
00376         <font class="keywordflow">return</font> uval;
00377 }
00378 
<a name="l00379"></a><a class="code" href="classAL__TC.html#a11">00379</a> <a class="code" href="classAL__TC.html">AL_TC</a> * <a class="code" href="classAL__TC.html#a11">AL_TC::allocate</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * d) {
00380 <font class="comment">// allocates d to the first available task chunk</font>
00381 <font class="comment">// returns the allocated task chunk</font>
00382         <font class="keywordflow">if</font> (de) {
00383                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__TC.html#a11">allocate</a>(d);
00384                 <font class="keywordflow">return</font> NULL;
00385         }
00386         <a class="code" href="classAL__TC.html#n0">de</a> = d;
00387         <a class="code" href="classAL__TC.html#n1">val</a> = 0.0;
00388         <font class="keywordflow">return</font> <font class="keyword">this</font>;
00389 }
00390 
<a name="l00391"></a><a class="code" href="classAL__Day.html#a0">00391</a> <a class="code" href="classAL__Day.html#a0">AL_Day::AL_Day</a>(time_t dd, <font class="keywordtype">int</font> typ, time_t tcsec, time_t dsmin, time_t dmaxt = <a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>):
00392                 daystartmin(dsmin), daymaxt(dmaxt), daytype(typ), avail(0), tot(0), daydate(dd),
00393                 tcseconds(tcsec), expanded(<a class="code" href="templates_8defines_8hh.html#a5">false</a>), cache_i_start(0), cache_i_limit(0), val(0.0) {
00394         <font class="keywordflow">if</font> (alworkdaystart&gt;=<a class="code" href="classAL__Day.html#n5">daystartmin</a>) <a class="code" href="classAL__Day.html#n4">daystart</a> = alworkdaystart;
00395         <font class="keywordflow">else</font> <a class="code" href="classAL__Day.html#n4">daystart</a> = <a class="code" href="classAL__Day.html#n5">daystartmin</a>;
00396 }
00397 
<a name="l00398"></a><a class="code" href="classAL__Day.html#a14">00398</a> <font class="keywordtype">long</font> <a class="code" href="classAL__Day.html#a14">AL_Day::set_avail</a>(time_t av) {
00399 <font class="comment">// attempt to make av seconds available through task chunks</font>
00400 <font class="comment">// returns the number of task chunks made available</font>
00401 <font class="comment">// the number of task chunks is limited by (daymaxt-daystartmin)</font>
00402 <font class="comment">// if av&lt;0 no task chunks will be made available</font>
00403         time_t dtmax = <a class="code" href="classAL__Day.html#n6">daymaxt</a> - <a class="code" href="classAL__Day.html#n5">daystartmin</a>;
00404 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00405 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: (DIAGNOSTICS) av = "</font> &lt;&lt; av &lt;&lt; <font class="stringliteral">", daymaxt = "</font> &lt;&lt; <a class="code" href="classAL__Day.html#n6">daymaxt</a> &lt;&lt; <font class="stringliteral">", daystartmin = "</font> &lt;&lt; <a class="code" href="classAL__Day.html#n5">daystartmin</a> &lt;&lt; <font class="stringliteral">", dtmax = "</font> &lt;&lt; dtmax &lt;&lt; <font class="charliteral">'\n'</font>;
00406 <font class="preprocessor">#endif</font>
00407 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (av&gt;0) {
00408                 <font class="keywordflow">if</font> (av&gt;dtmax) av = dtmax;
00409                 <a class="code" href="classAL__Day.html#n1">avail</a> = av/<a class="code" href="classAL__Day.html#n7">tcseconds</a>; <font class="comment">// floor, can't exceed limit</font>
00410         } <font class="keywordflow">else</font> <a class="code" href="classAL__Day.html#n1">avail</a> = 0;
00411         <a class="code" href="classAL__Day.html#n2">tot</a> = <a class="code" href="classAL__Day.html#n1">avail</a>; <font class="comment">// initialized with all TCs available</font>
00412 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00413 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: (DIAGNOSTICS) av = "</font> &lt;&lt; av &lt;&lt; <font class="stringliteral">", avail = "</font> &lt;&lt; <a class="code" href="classAL__Day.html#n1">avail</a> &lt;&lt; <font class="stringliteral">", tot = "</font> &lt;&lt; <a class="code" href="classAL__Day.html#n2">tot</a> &lt;&lt; <font class="charliteral">'\n'</font>;
00414 <font class="preprocessor">#endif</font>
00415 <font class="preprocessor"></font>        <font class="keywordflow">return</font> <a class="code" href="classAL__Day.html#n1">avail</a>;
00416 }
00417 
<a name="l00418"></a><a class="code" href="classAL__Day.html#a15">00418</a> <font class="keywordtype">long</font> <a class="code" href="classAL__Day.html#a15">AL_Day::available_before</a>(time_t td) {
00419 <font class="comment">// returns the number of task chunks available for allocation</font>
00420 <font class="comment">// prior to a target date td</font>
00421 <font class="comment">// avail, daystart, tcseconds and Next()-&gt;DayDate() must contain valid values</font>
00422 <font class="comment">// *** might be sped up by putting a for-loop into the</font>
00423 <font class="comment">//     corresponding Active_List function</font>
00424         <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#m1">td</a>&gt;=<a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a3">DayDate</a>()) <font class="keywordflow">return</font> <a class="code" href="classAL__Day.html#n1">avail</a> + <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a15">available_before</a>(<a class="code" href="classAL__Day.html#m1">td</a>); <font class="comment">// target date is within a following day</font>
00425         time_t tdiff = <a class="code" href="classAL__Day.html#m1">td</a> - (<a class="code" href="classAL__Day.html#n3">daydate</a>+<a class="code" href="classAL__Day.html#n4">daystart</a>);
00426         <font class="keywordflow">if</font> (tdiff&lt;=0) <font class="keywordflow">return</font> 0; <font class="comment">// target date is earlier than or at work start offset</font>
00427 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00428 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"@tdiff="</font> &lt;&lt; tdiff &lt;&lt; <font class="stringliteral">", tcseconds="</font> &lt;&lt; <a class="code" href="classAL__Day.html#n7">tcseconds</a> &lt;&lt; <font class="stringliteral">", tdiff/tcseconds="</font> &lt;&lt; tdiff/<a class="code" href="classAL__Day.html#n7">tcseconds</a> &lt;&lt; <font class="charliteral">'@'</font>;
00429 <font class="preprocessor">#endif</font>
00430 <font class="preprocessor"></font>        <font class="keywordtype">long</font> TCs_before = tdiff / <a class="code" href="classAL__Day.html#n7">tcseconds</a>; <font class="comment">// can't exceed target date</font>
00431         <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#a10">TC_Head</a>()) <font class="keywordflow">return</font> <a class="code" href="classAL__Day.html#a10">TC_Head</a>()-&gt;<a class="code" href="classAL__TC.html#a8">available_before</a>(TCs_before); <font class="comment">// count available TCs before target date</font>
00432         <font class="keywordflow">return</font> TCs_before;
00433 }
00434 
<a name="l00435"></a><a class="code" href="classAL__Day.html#a16">00435</a> <font class="keywordtype">int</font> <a class="code" href="classAL__Day.html#a16">AL_Day::days_to</a>(time_t td) {
00436 <font class="comment">// returns the number of days to the target date, including</font>
00437 <font class="comment">// the current day and the day containing the target date</font>
00438         <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#m1">td</a>&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a3">DayDate</a>()) <font class="keywordflow">return</font> 1 + <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a16">days_to</a>(<a class="code" href="classAL__Day.html#m1">td</a>);
00439         <font class="keywordflow">return</font> 1;
00440 }
00441 
<a name="l00442"></a><a class="code" href="classAL__Day.html#a18">00442</a> <font class="keywordtype">void</font> <a class="code" href="classAL__Day.html#a18">AL_Day::add_TCs</a>(<font class="keywordtype">long</font> tcs, TC_add_method m, time_t addborder = <a class="code" href="dil2al_8hh.html#a3">MAXTIME_T</a>) {
00443 <font class="comment">// safely add task chunks to a day</font>
00444 <font class="comment">// links new task chunks if tchead!=NULL, using TAIL_REPLACE,</font>
00445 <font class="comment">// RANDOM or BEFORE_HEAD methods, TAIL_REPLACE and RANDOM</font>
00446 <font class="comment">// methods use the addborder parameter</font>
00447 <font class="comment">// (see &lt;A HREF="al-day-expand.fig"&gt;al-day-expand.fig&lt;/A&gt;)</font>
00448 <font class="comment">// uses tchead.length() to insure that tot will</font>
00449 <font class="comment">// equal tchead.length() if tchead!=NULL</font>
00450         <a class="code" href="classAL__Day.html#n8">expanded</a> = <font class="keyword">true</font>;
00451         <a class="code" href="classAL__Day.html#n1">avail</a> += tcs;
00452         <a class="code" href="classAL__Day.html#n2">tot</a> += tcs;
00453         <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) {
00454                 <font class="keywordtype">long</font> linked = <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a6">length</a>(), tci;
00455                 tcs = <a class="code" href="classAL__Day.html#n2">tot</a> - linked; <font class="comment">// recalculated to insure at least tot TCs</font>
00456                 <font class="keywordflow">if</font> (tcs&lt;0) tcs = 0;
00457                 <font class="keywordflow">switch</font> (m) {
00458                         <font class="keywordflow">case</font> <a class="code" href="classAL__Day.html#s3s0">TAIL_REPLACE</a>:
00459                                 <font class="comment">// Place empty TCs at tail and move de pointers at chosen</font>
00460                                 <font class="comment">// random location to those TCs if de-&gt;Target_Date()&gt;addborder</font>
00461                                 <font class="keywordflow">for</font> (; tcs&gt;0; tcs--) {
00462                                         <a class="code" href="classAL__TC.html">AL_TC</a> * altc = <font class="keyword">new</font> <a class="code" href="classAL__TC.html">AL_TC</a>();
00463                                         <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a8">link_before</a>(altc); linked++;
00464                                         tci = (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>) rint(((<font class="keywordtype">float</font>) linked)*(((<font class="keywordtype">float</font>) rand()) / ((<font class="keywordtype">float</font>) RAND_MAX)));
00465                                         <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#m0">tc</a>[tci]) {
00466                                                 <a class="code" href="classDIL__entry.html">DIL_entry</a> * de = <a class="code" href="classAL__Day.html#m0">tc</a>[tci]-&gt;Get_DE();
00467                                                 <font class="keywordflow">if</font> (de) <font class="keywordflow">if</font> (de-&gt;<a class="code" href="classDIL__entry.html#a12">Target_Date</a>()&gt;addborder) altc-&gt;<a class="code" href="classAL__TC.html#a10">Set_DE</a>(tc[tci]-&gt;Set_DE(NULL));
00468                                         }
00469                                 }
00470                                 <font class="keywordflow">break</font>;
00471                         <font class="keywordflow">case</font> <a class="code" href="classAL__Day.html#s3s1">RANDOM</a>:
00472                                 <font class="comment">// Place empty TCs at head and move de pointers at chosen</font>
00473                                 <font class="comment">// random location to those TCs</font>
00474                                 <font class="keywordflow">if</font> (linked&gt;addborder) linked = (long) addborder; <font class="comment">// number of TCs prior to tdiff</font>
00475                                 <font class="keywordflow">for</font> (; tcs&gt;0; tcs--) {
00476                                         <a class="code" href="classAL__TC.html">AL_TC</a> * altc = <font class="keyword">new</font> <a class="code" href="classAL__TC.html">AL_TC</a>();
00477                                         <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a10">link_after</a>(altc); linked++;
00478                                         tci = (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>) rint(((<font class="keywordtype">float</font>) linked)*(((<font class="keywordtype">float</font>) rand()) / ((<font class="keywordtype">float</font>) RAND_MAX)));
00479                                         <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#m0">tc</a>[tci]) {
00480                                                 <a class="code" href="classDIL__entry.html">DIL_entry</a> * de = <a class="code" href="classAL__Day.html#m0">tc</a>[tci]-&gt;Get_DE();
00481                                                 <font class="keywordflow">if</font> (de) altc-&gt;<a class="code" href="classAL__TC.html#a10">Set_DE</a>(tc[tci]-&gt;Set_DE(NULL));
00482                                         }
00483                                 }
00484                                 <font class="keywordflow">break</font>;
00485                         <font class="keywordflow">case</font> <a class="code" href="classAL__Day.html#s3s2">BEFORE_HEAD</a>:
00486                                 <font class="comment">// link tcs empty TCs before head</font>
00487                                 <font class="keywordflow">for</font> (; tcs&gt;0; tcs--) <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a10">link_after</a>(<font class="keyword">new</font> <a class="code" href="classAL__TC.html">AL_TC</a>());
00488                                 <font class="keywordflow">break</font>;
00489                 }
00490         }
00491 }
00492 
00493 <font class="comment">// &lt;A NAME="AL_Day::expand"&gt;&lt;/A&gt;</font>
<a name="l00494"></a><a class="code" href="classAL__Day.html#a19">00494</a> <font class="keywordtype">long</font> <a class="code" href="classAL__Day.html#a19">AL_Day::expand</a>(<font class="keywordtype">long</font> expandn, time_t td) {
00495 <font class="comment">// expand work time by adding task chunks prior to</font>
00496 <font class="comment">// the target date td</font>
00497 <font class="comment">// returns the number of task chunks added (-1==error)</font>
00498 <font class="comment">// (see &lt;A HREF="al-day-expand.fig"&gt;al-day-expand.fig&lt;/A&gt;)</font>
00499         <font class="keywordflow">if</font> (expandn&lt;=0) <font class="keywordflow">return</font> 0;
00500         <font class="keyword">const</font> time_t tdiff(<a class="code" href="classAL__Day.html#m1">td</a> - <a class="code" href="classAL__Day.html#n3">daydate</a>); <font class="comment">// target date limit (offset in current day)</font>
00501         <font class="comment">// case: TD1 in al-day-expand.fig</font>
00502         <font class="keywordflow">if</font> (tdiff&lt;(<a class="code" href="classAL__Day.html#n5">daystartmin</a>+<a class="code" href="classAL__Day.html#n7">tcseconds</a>)) <font class="keywordflow">return</font> 0;
00503 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00504 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"E&gt;"</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,<a class="code" href="classAL__Day.html#a3">DayDate</a>()) &lt;&lt; <font class="stringliteral">": ("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="stringliteral">"), expand request = "</font> &lt;&lt; expandn &lt;&lt; <font class="charliteral">'\n'</font>;
00505 <font class="preprocessor">#endif</font>
00506 <font class="preprocessor"></font>        <font class="keywordtype">long</font> addabove = 0;
00507         time_t dayend = <a class="code" href="classAL__Day.html#n4">daystart</a>+(<a class="code" href="classAL__Day.html#n2">tot</a>*<a class="code" href="classAL__Day.html#n7">tcseconds</a>); <font class="comment">// if tot==0 dayend is current time</font>
00508         <font class="comment">// cases: TD4, TD5 and TD6 in al-day-expand.fig</font>
00509         <font class="keywordflow">if</font> (tdiff&gt;=(dayend+<a class="code" href="classAL__Day.html#n7">tcseconds</a>)) { <font class="comment">// TD beyond current end of day tasks</font>
00510                 time_t dayendmax = tdiff;
00511                 <font class="keywordflow">if</font> (tdiff&gt;<a class="code" href="classAL__Day.html#n6">daymaxt</a>) dayendmax = <a class="code" href="classAL__Day.html#n6">daymaxt</a>; <font class="comment">// day upper limit</font>
00512                 addabove = (dayendmax-dayend)/<a class="code" href="classAL__Day.html#n7">tcseconds</a>; <font class="comment">// count TCs that can be added prior to target date and daymaxt</font>
00513                 <font class="keywordflow">if</font> (addabove&gt;0) {
00514                         <font class="keywordflow">if</font> (addabove&gt;expandn) addabove = expandn; <font class="comment">// add expandn or fewer TCs above current dayend</font>
00515 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00516 <font class="preprocessor"></font>                        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Ea&gt;"</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,<a class="code" href="classAL__Day.html#a3">DayDate</a>()) &lt;&lt; <font class="stringliteral">": ("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="charliteral">')'</font>;
00517 <font class="preprocessor">#endif</font>
00518 <font class="preprocessor"></font>                        <a class="code" href="classAL__Day.html#a18">add_TCs</a>(addabove,<a class="code" href="classAL__Day.html#s3s0">TAIL_REPLACE</a>,<a class="code" href="classAL__Day.html#n3">daydate</a>+dayendmax); <font class="comment">// add empty TCs by replacing allocated TCs with target dates greater than dayendmax and moving those to the tail and update tot and avail</font>
00519                         expandn -= addabove;
00520 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00521 <font class="preprocessor"></font>                        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"-&gt;("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="stringliteral">")\n"</font>;
00522 <font class="preprocessor">#endif</font>
00523 <font class="preprocessor"></font>                        <font class="keywordflow">if</font> (expandn&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Warning - Expansion exceeded requirement in AL_Day::expand()\n"</font>;
00524                         <font class="keywordflow">if</font> (expandn&lt;=0) <font class="keywordflow">return</font> addabove;
00525                 }
00526         }
00527         <font class="comment">// case: TD3 in al-day-expand.fig</font>
00528         time_t tlowerexpand = <a class="code" href="classAL__Day.html#n4">daystart</a>;
00529         <a class="code" href="classAL__Day.html#s3">TC_add_method</a> m = <a class="code" href="classAL__Day.html#s3s1">RANDOM</a>;
00530         <font class="keywordtype">long</font> totbeforetdiff = (tdiff-<a class="code" href="classAL__Day.html#n4">daystart</a>)/<a class="code" href="classAL__Day.html#n7">tcseconds</a>;
00531         <font class="comment">// case: TD2 in al-day-expand.fig</font>
00532         <font class="keywordflow">if</font> (totbeforetdiff&lt;=0) {
00533                 tlowerexpand = tdiff;
00534                 m = <a class="code" href="classAL__Day.html#s3s2">BEFORE_HEAD</a>;
00535         }
00536         <font class="keywordflow">if</font> (totbeforetdiff&gt;<a class="code" href="classAL__Day.html#n2">tot</a>) totbeforetdiff = <a class="code" href="classAL__Day.html#n2">tot</a>;
00537         time_t newdaystart = tlowerexpand - (expandn*<a class="code" href="classAL__Day.html#n7">tcseconds</a>); <font class="comment">// attempt to add expandn TCs prior to daystart</font>
00538         <font class="keywordflow">if</font> (newdaystart&lt;<a class="code" href="classAL__Day.html#n5">daystartmin</a>) newdaystart = <a class="code" href="classAL__Day.html#n5">daystartmin</a>; <font class="comment">// daystart limit</font>
00539         <font class="keywordtype">long</font> addbelow = (tlowerexpand-newdaystart)/<a class="code" href="classAL__Day.html#n7">tcseconds</a>; <font class="comment">// count TCs to be added prior to daystart</font>
00540         <font class="keywordflow">if</font> (addbelow&gt;0) { <font class="comment">// add expandn or fewer TCs below min(daystart,TDtime)</font>
00541                 <a class="code" href="classAL__Day.html#n4">daystart</a> = newdaystart;
00542 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00543 <font class="preprocessor"></font>                <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Eab&gt;"</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,<a class="code" href="classAL__Day.html#a3">DayDate</a>()) &lt;&lt; <font class="stringliteral">": ("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="charliteral">')'</font>;
00544 <font class="preprocessor">#endif</font>
00545 <font class="preprocessor"></font>                <a class="code" href="classAL__Day.html#a18">add_TCs</a>(addbelow,m,totbeforetdiff); <font class="comment">// add empty TCs before target date and update tot and avail</font>
00546 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00547 <font class="preprocessor"></font>                <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"-&gt;("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="stringliteral">")\n"</font>;
00548 <font class="preprocessor">#endif</font>
00549 <font class="preprocessor"></font>                <font class="keywordflow">return</font> addabove+addbelow;
00550         }
00551 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00552 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Ex&gt;"</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,<a class="code" href="classAL__Day.html#a3">DayDate</a>()) &lt;&lt; <font class="stringliteral">": ("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="stringliteral">")\n"</font>;
00553 <font class="preprocessor">#endif</font>
00554 <font class="preprocessor"></font>        <font class="keywordflow">return</font> addabove;
00555 }
00556 
<a name="l00557"></a><a class="code" href="classAL__Day.html#a20">00557</a> <font class="keywordtype">float</font> <a class="code" href="classAL__Day.html#a20">AL_Day::set_TC_values</a>(<font class="keywordtype">long</font> &amp; i_start, <font class="keywordtype">long</font> i_limit) {
00558 <font class="comment">// set TC values within this day</font>
00559 <font class="comment">// returns sum of TC values</font>
00560         <font class="keywordtype">float</font> v;
00561         <a class="code" href="classAL__Day.html#n9">cache_i_start</a> = i_start;
00562         <a class="code" href="classAL__Day.html#n10">cache_i_limit</a> = i_limit;
00563         <a class="code" href="classAL__Day.html#m2">val</a> = 0.0;
00564         <font class="keywordflow">for</font> (<font class="keywordtype">long</font> i=0; i&lt;<a class="code" href="classAL__Day.html#n1">avail</a>; i++) {
00565                 <font class="keywordflow">if</font> ((i+i_start)&gt;=i_limit) v = 0.0;
00566                 <font class="keywordflow">else</font> v = <a class="code" href="alcomp_8cc.html#a9">linear_distribution</a>((<font class="keywordtype">float</font>) (i+i_start), (<font class="keywordtype">float</font>) i_limit);
00567                 <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) {
00568                         <a class="code" href="classAL__TC.html">AL_TC</a> * atc = <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__TC.html#a4">avail_el</a>(i);
00569                         <font class="keywordflow">if</font> (atc) atc-&gt;<a class="code" href="classAL__TC.html#a5">set_val</a>(v);
00570                         <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Available TC #"</font> &lt;&lt; i &lt;&lt; <font class="stringliteral">" on day "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,<a class="code" href="classAL__Day.html#n3">daydate</a>) &lt;&lt; <font class="stringliteral">" not found in AL_Day::set_TC_values(), continuing\n"</font>;
00571                 }
00572                 <font class="comment">// assignment of values to remaining TCs occurs when</font>
00573                 <font class="comment">// those TCs are created as a search enters them</font>
00574                 <a class="code" href="classAL__Day.html#m2">val</a> += v; <font class="comment">// store summed values of TCs for that day</font>
00575         }
00576         i_start += <a class="code" href="classAL__Day.html#n1">avail</a>;
00577         <font class="keywordflow">return</font> <a class="code" href="classAL__Day.html#m2">val</a>;
00578 }
00579 
<a name="l00580"></a><a class="code" href="classAL__Day.html#a17">00580</a> <font class="keywordtype">void</font> <a class="code" href="classAL__Day.html#a17">AL_Day::create_TCs</a>(<font class="keywordtype">bool</font> setvalues = <font class="keyword">false</font>) {
00581 <font class="comment">// creates TCs and sets values according to a random</font>
00582 <font class="comment">// distribution if setvalues==true, in which case it</font>
00583 <font class="comment">// requires valid cache_i_start and cache_i_limit values</font>
00584         <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) <font class="keywordflow">return</font>;
00585         <a class="code" href="classAL__TC.html">AL_TC</a> * atc;
00586         <font class="keywordflow">for</font> (<font class="keywordtype">long</font> i = 0; i&lt;<a class="code" href="classAL__Day.html#n2">tot</a>; i++) {
00587                 <font class="keywordflow">if</font> (setvalues) atc = <font class="keyword">new</font> <a class="code" href="classAL__TC.html">AL_TC</a>(i+<a class="code" href="classAL__Day.html#n9">cache_i_start</a>,<a class="code" href="classAL__Day.html#n10">cache_i_limit</a>);
00588                 <font class="keywordflow">else</font> atc = <font class="keyword">new</font> <a class="code" href="classAL__TC.html">AL_TC</a>();
00589                 <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a8">link_before</a>(atc);
00590         }
00591 }
00592 
<a name="l00593"></a><a class="code" href="classAL__Day.html#a21">00593</a> <font class="keywordtype">float</font> <a class="code" href="classAL__Day.html#a21">AL_Day::allocate_with_value</a>(<font class="keywordtype">float</font> uval, <a class="code" href="classDIL__entry.html">DIL_entry</a> * de) {
00594 <font class="comment">// allocate a DIL entry to a task chunk according to</font>
00595 <font class="comment">// a random value</font>
00596 <font class="comment">// returns the value of the allocated task chunk</font>
00597 <font class="comment">// creates TCs if necessary</font>
00598         <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#m2">val</a>&lt;uval) {
00599                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a21">allocate_with_value</a>(uval-<a class="code" href="classAL__Day.html#m2">val</a>,de);
00600                 <font class="keywordflow">return</font> 0.0; <font class="comment">// (error) no more days, value was beyond sum</font>
00601         }
00602 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00603 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"V&gt;"</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,<a class="code" href="classAL__Day.html#a3">DayDate</a>()) &lt;&lt; <font class="stringliteral">": ("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="charliteral">')'</font>;
00604 <font class="preprocessor">#endif</font>
00605 <font class="preprocessor"></font>        <a class="code" href="classAL__Day.html#a17">create_TCs</a>(<font class="keyword">true</font>); <font class="comment">// create TCs if necessary</font>
00606         <font class="keywordtype">float</font> v = <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__TC.html#a9">allocate_with_value</a>(uval,de);
00607         <font class="keywordflow">if</font> (v&gt;0.0) {
00608                 <a class="code" href="classAL__Day.html#m2">val</a> -= v;
00609                 <a class="code" href="classAL__Day.html#n1">avail</a>--;
00610         }
00611 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00612 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"-&gt;("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="stringliteral">")\n"</font>;
00613 <font class="preprocessor">#endif</font>
00614 <font class="preprocessor"></font>        <font class="keywordflow">return</font> v;
00615 }
00616 
<a name="l00617"></a><a class="code" href="classAL__Day.html#a22">00617</a> <a class="code" href="classAL__TC.html">AL_TC</a> * <a class="code" href="classAL__Day.html#a22">AL_Day::Get_Avail_TC</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> n) {
00618 <font class="comment">// returns the nth available task chunk in the AL</font>
00619 <font class="comment">// creates task chunks if necessary where tchead==NULL</font>
00620         <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#n1">avail</a>&lt;=n) {
00621                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a22">Get_Avail_TC</a>(n-<a class="code" href="classAL__Day.html#n1">avail</a>);
00622                 <font class="keywordflow">return</font> NULL;
00623         }
00624         <a class="code" href="classAL__Day.html#a17">create_TCs</a>();
00625         <font class="keywordflow">return</font> <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__TC.html#a4">avail_el</a>(n);
00626 }
00627 
<a name="l00628"></a><a class="code" href="classAL__Day.html#a23">00628</a> <a class="code" href="classAL__TC.html">AL_TC</a> * <a class="code" href="classAL__Day.html#a23">AL_Day::allocate</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * de) {
00629 <font class="comment">// allocates de to the first available task</font>
00630 <font class="comment">// chunk in this day or following days</font>
00631 <font class="comment">// returns the allocated task chunk</font>
00632 <font class="comment">// creates task chunks if necessary where tchead==NULL</font>
00633         <font class="keywordflow">if</font> (<a class="code" href="classAL__Day.html#n1">avail</a>&lt;=0) {
00634                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a23">allocate</a>(de);
00635                 <font class="keywordflow">return</font> NULL;
00636         }
00637 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00638 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"A&gt;"</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,<a class="code" href="classAL__Day.html#a3">DayDate</a>()) &lt;&lt; <font class="stringliteral">": ("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="charliteral">')'</font>;
00639 <font class="preprocessor">#endif</font>
00640 <font class="preprocessor"></font>        <a class="code" href="classAL__Day.html#a17">create_TCs</a>();
00641         <a class="code" href="classAL__TC.html">AL_TC</a> * atc = <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__TC.html#a11">allocate</a>(de);
00642         <font class="keywordflow">if</font> (atc) <a class="code" href="classAL__Day.html#n1">avail</a>--;
00643 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00644 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"-&gt;("</font> &lt;&lt; <a class="code" href="classAL__Day.html#a9">Total</a>() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; <a class="code" href="classAL__Day.html#a8">Avail</a>() &lt;&lt; <font class="stringliteral">")\n"</font>;
00645 <font class="preprocessor">#endif</font>
00646 <font class="preprocessor"></font>        <font class="keywordflow">return</font> atc;
00647 }
00648 
<a name="l00649"></a><a class="code" href="classAL__Day.html#a24">00649</a> <a class="code" href="classAL__Day.html">AL_Day</a> * <a class="code" href="classAL__Day.html#a24">AL_Day::Add_Target_Date</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * de) {
00650 <font class="comment">// Adds a target date reference to the day that contains it</font>
00651         <font class="keywordflow">if</font> (!de) <font class="keywordflow">return</font> NULL;
00652         time_t tdiff = de-&gt;<a class="code" href="classDIL__entry.html#a12">Target_Date</a>() - <a class="code" href="classAL__Day.html#n3">daydate</a>;
00653         <font class="keywordflow">if</font> (tdiff&lt;0) {
00654                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a2">Prev</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a2">Prev</a>()-&gt;<a class="code" href="classAL__Day.html#a24">Add_Target_Date</a>(de);
00655                 <font class="keywordflow">return</font> NULL;
00656         }
00657         <font class="keywordflow">if</font> (tdiff&gt;=<a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>) {
00658                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a24">Add_Target_Date</a>(de);
00659                 <font class="keywordflow">return</font> NULL;
00660         }
00661         <a class="code" href="classAL__TD.html">AL_TD</a> * atd = <font class="keyword">new</font> <a class="code" href="classAL__TD.html">AL_TD</a>(*de);
00662         <a class="code" href="classAL__Day.html#m1">td</a>.<a class="code" href="classPLLRoot.html#a8">link_before</a>(atd);
00663         <font class="keywordflow">return</font> <font class="keyword">this</font>;
00664 }
00665 
<a name="l00666"></a><a class="code" href="classAL__Day.html#a25">00666</a> <font class="keywordtype">long</font> <a class="code" href="classAL__Day.html#a25">AL_Day::remove_unused_TCs</a>() {
00667 <font class="comment">// clean up by removing unused TCs</font>
00668 <font class="comment">// returns remaining number of TCs in AL</font>
00669         <font class="keywordflow">if</font> (!<a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) { <font class="comment">// no TCs created in this day</font>
00670                 <a class="code" href="classAL__Day.html#n2">tot</a> = 0;
00671                 <a class="code" href="classAL__Day.html#n1">avail</a> = 0;
00672                 <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a25">remove_unused_TCs</a>();
00673                 <font class="keywordflow">return</font> 0;
00674         }
00675         <a class="code" href="classAL__TC.html">AL_TC</a> * rtc, * atc = <a class="code" href="classAL__Day.html#m0">tc</a>.<a class="code" href="classPLLRoot.html#a2">head</a>();
00676         <a class="code" href="classAL__Day.html#n2">tot</a> = 0; <font class="comment">// insure correct count</font>
00677         <font class="keywordflow">while</font> (atc) { <font class="comment">// remove unused TCs in this day</font>
00678                 rtc = atc;
00679                 atc = atc-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>();
00680                 <font class="keywordflow">if</font> (!rtc-&gt;<a class="code" href="classAL__TC.html#a6">Get_DE</a>()) rtc-&gt;<a class="code" href="classPLLHandle.html#a12">remove</a>();
00681                 <font class="keywordflow">else</font> <a class="code" href="classAL__Day.html#n2">tot</a>++; <font class="comment">// faster than calling tchead-&gt;length()</font>
00682         }
00683         <a class="code" href="classAL__Day.html#n1">avail</a> = 0;
00684         <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classAL__Day.html#n2">tot</a> + <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classAL__Day.html#a25">remove_unused_TCs</a>();
00685         <font class="keywordflow">return</font> <a class="code" href="classAL__Day.html#n2">tot</a>;
00686 }
00687 
<a name="l00688"></a><a class="code" href="classAL__Day.html#a27">00688</a> <font class="keywordtype">float</font> <a class="code" href="classAL__Day.html#a27">AL_Day::squared_day_distribution</a>(time_t td) {
00689 <font class="comment">// distribute values up to target date according to a squared function</font>
00690         <font class="keywordtype">float</font> sumval = 0;
00691         <font class="keywordtype">int</font> tddays = <a class="code" href="classAL__Day.html#a16">days_to</a>(<a class="code" href="classAL__Day.html#m1">td</a>);
00692         <font class="keywordtype">float</font> fdays = (float) tddays, fi = 0.0;
00693         <font class="keywordtype">long</font> i = 0;
00694         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,<font class="keyword">this</font>,(e-&gt;DayDate()&lt;<a class="code" href="classAL__Day.html#m1">td</a>)) {
00695                 e-&gt;val = 1.0 - (aldaydistslope*(fi*fi));
00696                 sumval += e-&gt;val;
00697                 i++; fi = ((float) i)/fdays;
00698         }
00699         <font class="keywordflow">return</font> sumval;
00700 }
00701 
<a name="l00702"></a><a class="code" href="classAL__Day.html#a26">00702</a> <font class="keywordtype">float</font> <a class="code" href="classAL__Day.html#a26">AL_Day::linear_day_distribution</a>(time_t td) {
00703 <font class="comment">// linearly distribute values up to target date</font>
00704         <font class="keywordtype">float</font> sumval = 0;
00705         <font class="keywordtype">int</font> tddays = <a class="code" href="classAL__Day.html#a16">days_to</a>(<a class="code" href="classAL__Day.html#m1">td</a>);
00706         <font class="keywordtype">float</font> fdays = (float) tddays;
00707         <font class="keywordtype">long</font> i = 0;
00708         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,<font class="keyword">this</font>,(e-&gt;DayDate()&lt;<a class="code" href="classAL__Day.html#m1">td</a>)) {
00709                 e-&gt;val = 1.0 - (aldaydistslope*((float) i/fdays));
00710                 sumval += e-&gt;val;
00711                 i++;
00712         }
00713         <font class="keywordflow">return</font> sumval;
00714 }
00715 
<a name="l00716"></a><a class="code" href="classActive__List.html#a4">00716</a> <a class="code" href="classAL__Day.html">AL_Day</a> * <a class="code" href="classActive__List.html#a4">Active_List::Add_Day</a>(<font class="keywordtype">int</font> typ, time_t tcsec, time_t dsmin, time_t dmaxt = <a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>) {
00717 <font class="comment">// Add a day to the AL</font>
00718         time_t dd;
00719         <font class="keywordflow">if</font> (<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a3">tail</a>()) dd = <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a3">tail</a>()-&gt;<a class="code" href="classAL__Day.html#a3">DayDate</a>() + <a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>; <font class="comment">// next day</font>
00720         <font class="keywordflow">else</font> {
00721 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00722 <font class="preprocessor"></font>                <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"curtime = "</font> &lt;&lt; curtime &lt;&lt; <font class="stringliteral">", curtime(time_t) = "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a23">time_stamp_time</a>(curtime) &lt;&lt; <font class="charliteral">'\n'</font>;
00723 <font class="preprocessor">#endif</font>
00724 <font class="preprocessor"></font>                dd = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(curtime); <font class="comment">// start with current day in calendar time</font>
00725                 typ = 1; <font class="comment">// insure start is marked</font>
00726         }
00727 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00728 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"DD: "</font> &lt;&lt; dd &lt;&lt; <font class="stringliteral">", T: "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a19">Time</a>(NULL) &lt;&lt; <font class="charliteral">'\n'</font>;
00729         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"DDS: "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,dd) &lt;&lt; <font class="stringliteral">", TS: "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,<a class="code" href="utilities_8cc.html#a19">Time</a>(NULL)) &lt;&lt; <font class="charliteral">'\n'</font>;
00730 <font class="preprocessor">#endif</font>
00731 <font class="preprocessor"></font>        <a class="code" href="classAL__Day.html">AL_Day</a> * ald = <font class="keyword">new</font> <a class="code" href="classAL__Day.html">AL_Day</a>(dd,typ,tcsec,dsmin,dmaxt);
00732         <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a8">link_before</a>(ald);
00733         <font class="keywordflow">return</font> ald;
00734 }
00735 
<a name="l00736"></a><a class="code" href="classActive__List.html#a0">00736</a> <a class="code" href="classActive__List.html#a0">Active_List::Active_List</a>(<font class="keywordtype">long</font> req[], <font class="keywordtype">long</font> deplen, <font class="keywordtype">int</font> algenwt, <a class="code" href="classDIL__entry.html">DIL_entry</a> * sup = NULL): deavail(0), superior(sup), supstr("all"), alfilestr("active-list.all") {
00737         <font class="keywordflow">if</font> (superior) {
00738                 <a class="code" href="classActive__List.html#n1">supstr</a> = <a class="code" href="classActive__List.html#n0">superior</a>-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>();
00739                 <a class="code" href="classActive__List.html#n2">alfilestr</a> = <font class="stringliteral">"active-list."</font>+<a class="code" href="classActive__List.html#n1">supstr</a>;
00740         }
00741         <a class="code" href="classActive__List.html#n3">allength</a> = <a class="code" href="classActive__List.html#b0">Initialize_AL_Length</a>(req,deplen,algenwt,sup);
00742 }
00743 
<a name="l00744"></a><a class="code" href="classActive__List.html#b0">00744</a> <font class="keywordtype">long</font> <a class="code" href="classActive__List.html#b0">Active_List::Initialize_AL_Length</a>(<font class="keywordtype">long</font> req[], <font class="keywordtype">long</font> deplen, time_t algenwt, <a class="code" href="classDIL__entry.html">DIL_entry</a> * superior = NULL) {
00745 <font class="comment">// returns the number of TCs allocated, data is initialized</font>
00746         <font class="comment">// values used on computations</font>
00747         <font class="keywordtype">long</font> tcseconds = timechunksize*60;
00748         <font class="keywordtype">float</font> c_size = (float) tcseconds;
00749         <font class="keywordtype">long</font> tcsperfullday = algenwt/tcseconds; <font class="comment">// floor</font>
00750 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00751 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"tcsperfullday="</font> &lt;&lt; tcsperfullday &lt;&lt; <font class="charliteral">'\n'</font>;
00752 <font class="preprocessor">#endif</font>
00753 <font class="preprocessor"></font>        <font class="comment">// default initializations</font>
00754         <font class="keywordtype">long</font> <a class="code" href="classActive__List.html#n3">allength</a> = generatealtcs;
00755 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00756 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"allength = "</font> &lt;&lt; <a class="code" href="classActive__List.html#n3">allength</a> &lt;&lt; <font class="charliteral">'\n'</font>;
00757 <font class="preprocessor">#endif</font>
00758 <font class="preprocessor"></font>        time_t lastdaytime = <a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>; <font class="comment">// default to full day when no generatealmaxt is specified</font>
00759         time_t allastdaylimit = -1; <font class="comment">// *** why compute this?</font>
00760         <font class="keywordtype">long</font> aldays;
00761         <font class="comment">// curtime data</font>
00762         time_t curdaystart = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(curtime);
00763         time_t curdaytime = <a class="code" href="utilities_8cc.html#a24">time_stamp_time_of_day</a>(curtime);
00764 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00765 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"curdaytime(time_t) = "</font> &lt;&lt; curdaytime &lt;&lt; <font class="charliteral">'\n'</font>;
00766 <font class="preprocessor">#endif</font>
00767 <font class="preprocessor"></font>        <font class="keywordtype">long</font> curdaytcs = (long) ceil(((<font class="keywordtype">float</font>) (algenwt-alworked))/c_size); <font class="comment">// ceiling</font>
00768         <font class="keywordtype">long</font> curdaymaxtcs = (<a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>-curdaytime)/tcseconds; <font class="comment">// floor, can't exceed limit</font>
00769         <font class="keywordflow">if</font> (curdaytcs&gt;curdaymaxtcs) curdaytcs = curdaymaxtcs;
00770 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00771 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"curdaytcs = "</font> &lt;&lt; curdaytcs &lt;&lt; <font class="charliteral">'\n'</font>;
00772 <font class="preprocessor">#endif</font>
00773 <font class="preprocessor"></font>        <font class="comment">// determine allength and aldays</font>
00774         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"AL request initiated with settings generatealtcs="</font> &lt;&lt; generatealtcs &lt;&lt; <font class="stringliteral">" and generatealmaxt="</font> &lt;&lt; generatealmaxt &lt;&lt; <font class="charliteral">'\n'</font>;
00775         <font class="keywordflow">if</font> (generatealtcs==0) {
00776                 <font class="keywordflow">if</font> (superior) { <font class="comment">// *** DIL entry specific AL</font>
00777                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: DIL entry specific AL not yet implemented in Active_List::Initialize_AL_Length()\n"</font>;
00778                 }
00779                 <font class="keywordflow">if</font> (!req) {
00780                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing required time array, req, in Active_List::Initialize_AL_Length()\n"</font>;
00781                         <font class="keywordflow">return</font> -1;
00782                 }
00783                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;deplen; i++) generatealtcs += req[i]; <font class="comment">// complete AL</font>
00784                 <a class="code" href="classActive__List.html#n3">allength</a> = generatealtcs;
00785                 aldays = (long) ceil(((<font class="keywordtype">float</font>) (<a class="code" href="classActive__List.html#n3">allength</a>-curdaytcs))/((<font class="keywordtype">float</font>) tcsperfullday)); <font class="comment">// ceiling, to include remainder</font>
00786         } <font class="keywordflow">else</font> {
00787                 <font class="keywordflow">if</font> (generatealmaxt&gt;0) { <font class="comment">// time limit requested</font>
00788                         <a class="code" href="classString.html">String</a> maxtstr = <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,generatealmaxt);
00789                         lastdaytime = <a class="code" href="utilities_8cc.html#a24">time_stamp_time_of_day</a>(maxtstr);
00790                         allastdaylimit = lastdaytime - alworkdaystart; <font class="comment">// work time on last day of AL</font>
00791                         <font class="keywordflow">if</font> (allastdaylimit&lt;0) allastdaylimit = 0;
00792                         <font class="keywordflow">if</font> (allastdaylimit&gt;algenwt) allastdaylimit = algenwt;
00793                         time_t lastdaystart = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(maxtstr);
00794                         <font class="keywordflow">if</font> (curdaystart==lastdaystart) { <font class="comment">// last day work time minus time already worked today</font>
00795                                 time_t alrem = allastdaylimit - alworked;
00796                                 <font class="keywordflow">if</font> (alrem&lt;0) <a class="code" href="classActive__List.html#n3">allength</a> = 1; <font class="comment">// this can be expanded</font>
00797                                 <font class="keywordflow">else</font> <a class="code" href="classActive__List.html#n3">allength</a> = alrem/tcseconds; <font class="comment">// floor, can't exceed limit</font>
00798                                 aldays = 0;
00799                         } <font class="keywordflow">else</font> {
00800                                 <font class="keywordtype">long</font> aldays = (lastdaystart-(curdaystart+<a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>))/<a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>; <font class="comment">// full days between current and last</font>
00801                                 <font class="keywordflow">if</font> (aldays&gt;0) <a class="code" href="classActive__List.html#n3">allength</a> += aldays*tcsperfullday; <font class="comment">// chunks in those days</font>
00802                                 <font class="keywordflow">else</font> <a class="code" href="classActive__List.html#n3">allength</a> = 0;
00803                                 <a class="code" href="classActive__List.html#n3">allength</a> += allastdaylimit/tcseconds; <font class="comment">// floor, can't exceed limit</font>
00804                                 <a class="code" href="classActive__List.html#n3">allength</a> += curdaytcs;
00805                                 aldays++; <font class="comment">// add last day for day start tags</font>
00806                         }
00807                 } <font class="keywordflow">else</font> aldays = (long) ceil(((<font class="keywordtype">float</font>) (<a class="code" href="classActive__List.html#n3">allength</a>-curdaytcs))/((<font class="keywordtype">float</font>) tcsperfullday)); <font class="comment">// ceiling, to include remainder</font>
00808         }
00809         <font class="comment">// initialize data</font>
00810 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00811 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"curdaytime (GM)    = "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%H%M"</font>,curdaytime) &lt;&lt; <font class="charliteral">'\n'</font>;
00812 <font class="preprocessor">#endif</font>
00813 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (!aldays) <a class="code" href="classActive__List.html#a4">Add_Day</a>(1,tcseconds,curdaytime,lastdaytime); <font class="comment">// current and last day</font>
00814         <font class="keywordflow">else</font> {
00815                 <a class="code" href="classActive__List.html#a4">Add_Day</a>(1,tcseconds,curdaytime); <font class="comment">// current day</font>
00816 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00817 <font class="preprocessor"></font>                <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;(aldays-1); i++) {
00818                         <a class="code" href="classAL__Day.html">AL_Day</a> * tmp = <a class="code" href="classActive__List.html#a4">Add_Day</a>(0,tcseconds,0); <font class="comment">// full days</font>
00819                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"daystartmin = "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%Y%m%d -- %H%M"</font>,tmp-&gt;<a class="code" href="classAL__Day.html#a5">DayStartMin</a>()) &lt;&lt; <font class="charliteral">'\n'</font>;
00820                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"alworkdaystart = "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%Y%m%d -- %H%M"</font>,alworkdaystart) &lt;&lt; <font class="charliteral">'\n'</font>;
00821                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"daystart = "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%Y%m%d -- %H%M"</font>,tmp-&gt;<a class="code" href="classAL__Day.html#a4">DayStart</a>()) &lt;&lt; <font class="charliteral">'\n'</font>;
00822                 }
00823 <font class="preprocessor">#else</font>
00824 <font class="preprocessor"></font>                <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;(aldays-1); i++) <a class="code" href="classActive__List.html#a4">Add_Day</a>(0,tcseconds,0); <font class="comment">// full days</font>
00825 <font class="preprocessor">#endif</font>
00826 <font class="preprocessor"></font>                <a class="code" href="classActive__List.html#a4">Add_Day</a>(2,tcseconds,0,lastdaytime); <font class="comment">// last day</font>
00827         }
00828 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00829 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"allength determined to get "</font> &lt;&lt; aldays &lt;&lt; <font class="stringliteral">" days: "</font> &lt;&lt; <a class="code" href="classActive__List.html#n3">allength</a> &lt;&lt; <font class="charliteral">'\n'</font>;
00830 <font class="preprocessor">#endif</font>
00831 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (!<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) {
00832                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No AL days generated in Active_List::Initialize_AL_Length()\n"</font>;
00833                 <font class="keywordflow">return</font> -1;
00834         }
00835 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00836 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"algenwt = "</font> &lt;&lt; algenwt &lt;&lt; <font class="stringliteral">", alworked = "</font> &lt;&lt; alworked &lt;&lt; <font class="charliteral">'\n'</font>;
00837 <font class="preprocessor">#endif</font>
00838 <font class="preprocessor"></font>        <a class="code" href="classActive__List.html#n3">allength</a> = <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__Day.html#a14">set_avail</a>(algenwt-alworked); <font class="comment">// remaining time to work on current day (prior to any expansions)</font>
00839         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>(),1) <a class="code" href="classActive__List.html#n3">allength</a> += e-&gt;set_avail(algenwt);
00840 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
00841 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"Day TCs (tot,avail): "</font>; <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>(),1) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'('</font> &lt;&lt; e-&gt;Total() &lt;&lt; <font class="charliteral">','</font> &lt;&lt; e-&gt;Avail() &lt;&lt; <font class="stringliteral">"),"</font>; <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'\n'</font>;
00842         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"sum of available TCs in allocated days: allength = "</font> &lt;&lt; <a class="code" href="classActive__List.html#n3">allength</a> &lt;&lt; <font class="charliteral">'\n'</font>;
00843 <font class="preprocessor">#endif</font>
00844 <font class="preprocessor"></font>        <font class="keywordflow">return</font> <a class="code" href="classActive__List.html#n3">allength</a>;
00845 }
00846 
<a name="l00847"></a><a class="code" href="classActive__List.html#a6">00847</a> <font class="keywordtype">long</font> <a class="code" href="classActive__List.html#a6">Active_List::expand</a>(<font class="keywordtype">long</font> expandn, time_t td) {
00848 <font class="comment">// expand work time by adding task chunks to days prior to</font>
00849 <font class="comment">// the target date td</font>
00850 <font class="comment">// returns the number of task chunks added (-1==error)</font>
00851         <font class="keywordtype">long</font> nadded = 0;
00852         <font class="keywordtype">float</font> sumval, uval;
00853         <font class="keywordflow">switch</font> (aldaydistfunc) { <font class="comment">// apply chosen AL day distribution function</font>
00854                 <font class="keywordflow">case</font> <a class="code" href="dil2al_8hh.html#a97">ALDAYDISTFUNCSQUARED</a>: <font class="keywordflow">if</font> ((sumval = <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__Day.html#a27">squared_day_distribution</a>(<a class="code" href="classActive__List.html#m1">td</a>))&lt;0) <font class="keywordflow">return</font> -1; <font class="keywordflow">break</font>;
00855                 <font class="keywordflow">default</font>: <font class="keywordflow">if</font> ((sumval = <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__Day.html#a26">linear_day_distribution</a>(<a class="code" href="classActive__List.html#m1">td</a>))&lt;0) <font class="keywordflow">return</font> -1;
00856         }
00857 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00858 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"AL: deavail ="</font> &lt;&lt; <a class="code" href="classActive__List.html#m2">deavail</a> &lt;&lt; <font class="charliteral">'\n'</font>;
00859 <font class="preprocessor">#endif</font>
00860 <font class="preprocessor"></font>        <font class="keywordflow">while</font> ((expandn&gt;nadded) &amp;&amp; (sumval&gt;FLT_EPSILON)) {
00861                 <font class="comment">// *** should this really be done randomly?</font>
00862                 uval = sumval*(((float) rand()) / ((float) RAND_MAX));
00863                 <a class="code" href="classAL__Day.html">AL_Day</a> * e;
00864                 <font class="keywordflow">for</font> (e = <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>(); (e); e = e-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">if</font> (uval&gt;e-&gt;<a class="code" href="classAL__Day.html#m2">val</a>) uval -= e-&gt;<a class="code" href="classAL__Day.html#m2">val</a>; <font class="keywordflow">else</font> <font class="keywordflow">break</font>;
00865                 <font class="keywordflow">if</font> (!e) <font class="keywordflow">break</font>; <font class="comment">// no further expansion is possible</font>
00866                 <font class="keywordflow">if</font> (e-&gt;<a class="code" href="classAL__Day.html#a19">expand</a>(1,<a class="code" href="classActive__List.html#m1">td</a>)&gt;0) nadded++;
00867                 <font class="keywordflow">else</font> { <font class="comment">// day cannot expand further</font>
00868                         sumval -= e-&gt;<a class="code" href="classAL__Day.html#m2">val</a>;
00869                         e-&gt;<a class="code" href="classAL__Day.html#m2">val</a> = 0.0;
00870                 }
00871         }
00872         <a class="code" href="classActive__List.html#n3">allength</a> += nadded; <font class="comment">// update total number of TCs in AL</font>
00873         <a class="code" href="classActive__List.html#m2">deavail</a> += nadded; <font class="comment">// update temporary value tracking available TCs</font>
00874 <font class="preprocessor">#ifdef DETAILED_AL_DIAGNOSTIC_OUTPUT</font>
00875 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"AL: deavail ="</font> &lt;&lt; <a class="code" href="classActive__List.html#m2">deavail</a> &lt;&lt; <font class="charliteral">'\n'</font>;
00876 <font class="preprocessor">#endif</font>
00877 <font class="preprocessor"></font>        <font class="keywordflow">return</font> nadded;
00878 }
00879 
<a name="l00880"></a><a class="code" href="classActive__List.html#a9">00880</a> <font class="keywordtype">float</font> <a class="code" href="classActive__List.html#a9">Active_List::set_TC_values</a>() {
00881 <font class="comment">// set TC values in AL</font>
00882 <font class="comment">// returns sum of all TC values</font>
00883 <font class="comment">// requires that al contains a valid deavail value</font>
00884         <font class="keywordflow">if</font> (<a class="code" href="classActive__List.html#m2">deavail</a>&lt;=0) <font class="keywordflow">return</font> 0.0;
00885         <font class="keywordtype">float</font> sumval = 0.0;
00886         <font class="keywordtype">long</font> i_start = 0;
00887         <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>(),1) sumval += e-&gt;set_TC_values(i_start,<a class="code" href="classActive__List.html#m2">deavail</a>);
00888         <font class="keywordflow">return</font> sumval;
00889 }
00890 
<a name="l00891"></a><a class="code" href="classActive__List.html#a10">00891</a> <font class="keywordtype">float</font> <a class="code" href="classActive__List.html#a10">Active_List::allocate_with_value</a>(<font class="keywordtype">float</font> uval, <a class="code" href="classDIL__entry.html">DIL_entry</a> * de) {
00892 <font class="comment">// allocate a DIL entry to a task chunk according to</font>
00893 <font class="comment">// a random value</font>
00894 <font class="comment">// returns the value of the allocated task chunk</font>
00895         <font class="keywordflow">if</font> (!<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) <font class="keywordflow">return</font> 0.0;
00896         <font class="keywordtype">float</font> v = <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__Day.html#a21">allocate_with_value</a>(uval,de);
00897         <font class="keywordflow">if</font> (v&gt;0.0) <a class="code" href="classActive__List.html#m2">deavail</a>--; <font class="comment">// update temporary value tracking available TCs</font>
00898         <font class="keywordflow">return</font> v;
00899 }
00900 
<a name="l00901"></a><a class="code" href="classActive__List.html#a11">00901</a> <a class="code" href="classAL__TC.html">AL_TC</a> * <a class="code" href="classActive__List.html#a11">Active_List::Get_Avail_TC</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> n) {
00902 <font class="comment">// returns the nth available task chunk in the AL</font>
00903 <font class="comment">// creates task chunks if necessary where tchead==NULL</font>
00904         <font class="keywordflow">if</font> (!<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) <font class="keywordflow">return</font> NULL;
00905         <font class="keywordflow">return</font> <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__Day.html#a22">Get_Avail_TC</a>(n);
00906 }
00907 
<a name="l00908"></a><a class="code" href="classActive__List.html#a12">00908</a> <a class="code" href="classAL__TC.html">AL_TC</a> * <a class="code" href="classActive__List.html#a12">Active_List::allocate</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * de) {
00909 <font class="comment">// allocates de to the first available task chunk in the AL</font>
00910 <font class="comment">// returns the allocated task chunk</font>
00911 <font class="comment">// creates task chunks if necessary where tchead==NULL</font>
00912         <font class="keywordflow">if</font> (!<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) <font class="keywordflow">return</font> NULL;
00913         <font class="keywordflow">return</font> <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__Day.html#a23">allocate</a>(de);
00914 }
00915 
<a name="l00916"></a><a class="code" href="classActive__List.html#a13">00916</a> <a class="code" href="classAL__Day.html">AL_Day</a> * <a class="code" href="classActive__List.html#a13">Active_List::Add_Target_Date</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * de) {
00917 <font class="comment">// Adds a target date reference to the day that contains it</font>
00918         <font class="keywordflow">if</font> (!<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) <font class="keywordflow">return</font> NULL;
00919         <font class="keywordflow">return</font> <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__Day.html#a24">Add_Target_Date</a>(de);
00920 }
00921 
<a name="l00922"></a><a class="code" href="classActive__List.html#a14">00922</a> <a class="code" href="classAL__TD.html">AL_TD</a> * <a class="code" href="classActive__List.html#a14">Active_List::Add_Passed_Target_Date</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> * de) {
00923 <font class="comment">// Adds a passed target date reference to the list</font>
00924         <font class="keywordflow">if</font> (!de) <font class="keywordflow">return</font> NULL;
00925         <a class="code" href="classAL__TD.html">AL_TD</a> * atd = <font class="keyword">new</font> <a class="code" href="classAL__TD.html">AL_TD</a>(*de);
00926         <a class="code" href="classActive__List.html#m1">td</a>.<a class="code" href="classPLLRoot.html#a8">link_before</a>(atd);
00927         <font class="keywordflow">return</font> atd;
00928 }
00929 
<a name="l00930"></a><a class="code" href="classActive__List.html#a15">00930</a> <font class="keywordtype">long</font> <a class="code" href="classActive__List.html#a15">Active_List::remove_unused_TCs</a>() {
00931 <font class="comment">// clean up by removing unused TCs</font>
00932 <font class="comment">// returns remaining number of TCs in AL</font>
00933         <font class="keywordflow">if</font> (!<a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) {
00934                 <a class="code" href="classActive__List.html#n3">allength</a> = 0;
00935                 <font class="keywordflow">return</font> 0;
00936         }
00937         <a class="code" href="classActive__List.html#n3">allength</a> = <a class="code" href="classActive__List.html#m0">al</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classAL__Day.html#a25">remove_unused_TCs</a>();
00938         <font class="keywordflow">return</font> <a class="code" href="classActive__List.html#n3">allength</a>;
00939 }
00940 
<a name="l00941"></a><a class="code" href="alcomp_8cc.html#a12">00941</a> <font class="keywordtype">void</font> <a class="code" href="alcomp_8cc.html#a12">generate_EPS_cells</a>(time_t grouptd, <a class="code" href="classString.html">String</a> &amp; cumreqstr, <a class="code" href="classString.html">String</a> &amp; rowreqstr, <font class="keywordtype">double</font> &amp; groupreq, <font class="keywordtype">double</font> cumreq, time_t t_current, <a class="code" href="classDIL__entry.html">DIL_entry</a> &amp; de) {
00942 <font class="comment">// generate HTML table cells for the EPS method date presented</font>
00943 <font class="comment">// when alshowcumulativereq==true</font>
00944 <font class="comment">// (See &lt;A HREF="../../doc/html/lists.html#gS1"&gt;Earliest Possible Scheduling (EPS)&lt;/A&gt;.)</font>
00945         <font class="keywordtype">double</font> cumreqhours = (cumreq*((double) timechunksize))/60.0;
00946         <font class="keywordtype">double</font> epsdays = floor(cumreqhours/alepshours);
00947         <font class="keywordtype">double</font> epshours = cumreqhours - (epsdays*alepshours);
00948         time_t epsdayssec = ((time_t) epsdays)*<a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>;
00949         time_t epshourssec = ((time_t) rint(epshours*60.0))*60; <font class="comment">// note: properly converts 0.33 and 0.67 hours to 20 and 40 minutes respectively</font>
00950         time_t epsgrouptd = t_current + epsdayssec + epshourssec;
00951         <a class="code" href="classString.html">String</a> epsgrouptreq = <a class="code" href="classString.html">String</a>((groupreq*((<font class="keywordtype">double</font>) timechunksize))/60.0,<font class="stringliteral">"%6.2f"</font>);
00952         String epsgrouptdstr = <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,epsgrouptd);
00953         <font class="keywordflow">if</font> (targetdatepreferences) { <font class="comment">// determine if the calculated target date should be modified according to stated preferences</font>
00954           <font class="keywordflow">if</font> (weekdayworkendpreferences) { <font class="comment">// preferred target times on specific days of the week</font>
00955             <font class="comment">//      cout &lt;&lt; epsgrouptdstr &lt;&lt; " --- ";</font>
00956             <font class="keywordtype">int</font> dayofweek = atoi((<font class="keyword">const</font> <font class="keywordtype">char</font> *) <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%w"</font>,epsgrouptd));
00957             <font class="keywordflow">if</font> (wdworkendprefs[dayofweek]&gt;=0) {
00958               <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a24">time_stamp_time_of_day</a>(epsgrouptdstr)&lt;wdworkendprefs[dayofweek]) { <font class="comment">// to preferred time</font>
00959                 epsgrouptd = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(epsgrouptdstr) + wdworkendprefs[dayofweek];
00960               } <font class="keywordflow">else</font> { <font class="comment">// set to preferred time on next day</font>
00961                 dayofweek++; <font class="keywordflow">if</font> (dayofweek&gt;6) dayofweek = 0;
00962                 <font class="keywordflow">if</font> (wdworkendprefs[dayofweek] &gt;= 0 ) epsgrouptd = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(epsgrouptdstr) + <a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a> + wdworkendprefs[dayofweek];
00963                 <font class="keywordflow">else</font> epsgrouptd = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(epsgrouptdstr) + <a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a> + alworkdaystart + (((time_t) rint(alepshours*60.0))*60);
00964               }
00965               epsgrouptdstr = <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,epsgrouptd);
00966             }
00967             <font class="comment">//      cout &lt;&lt; epsgrouptdstr &lt;&lt; '\n';</font>
00968           }
00969         }
00970         cumreqstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@GROUPTREQ@"</font>,epsgrouptreq);
00971         cumreqstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@GROUPEPSTD@"</font>,epsgrouptdstr);
00972         <font class="keywordflow">if</font> (rapidscheduleupdating &amp;&amp; (epsgrouptd&lt;=grouptd)) { <font class="comment">// option not to update target dates beyond the EPS suggested target dates</font>
00973                 cumreqstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@GROUPCHECKED@\""</font>,<font class="stringliteral">"\" checked"</font>);
00974                 rowreqstr += <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,epsgrouptreq)+
00975                            <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="utilities_8cc.html#a75">HTML_put_form_checkbox</a>(String(<font class="stringliteral">"TDCHKBX"</font>)+de.<a class="code" href="classDIL__ID.html#a15">chars</a>(),<font class="stringliteral">"noupdate"</font>,<font class="stringliteral">""</font>,<font class="keyword">true</font>)+<a class="code" href="utilities_8cc.html#a77">HTML_put_form_text</a>(String(<font class="stringliteral">"TD"</font>)+de.<a class="code" href="classDIL__ID.html#a15">chars</a>(),epsgrouptdstr,12));
00976         } <font class="keywordflow">else</font> {
00977                 cumreqstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@GROUPCHECKED@"</font>,<font class="stringliteral">""</font>);
00978                 rowreqstr += <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,epsgrouptreq)+
00979                            <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="utilities_8cc.html#a75">HTML_put_form_checkbox</a>(String(<font class="stringliteral">"TDCHKBX"</font>)+de.<a class="code" href="classDIL__ID.html#a15">chars</a>(),<font class="stringliteral">"noupdate"</font>,<font class="stringliteral">""</font>)+<a class="code" href="utilities_8cc.html#a77">HTML_put_form_text</a>(String(<font class="stringliteral">"TD"</font>)+de.<a class="code" href="classDIL__ID.html#a15">chars</a>(),epsgrouptdstr,12));
00980         }
00981         groupreq = 0.0;
00982         <font class="comment">//return epsgrouptdstr;</font>
00983 }
00984 
<a name="l00985"></a><a class="code" href="alcomp_8cc.html#a13">00985</a> <font class="keywordtype">bool</font> <a class="code" href="alcomp_8cc.html#a13">generate_AL</a>(<a class="code" href="classDIL__entry.html">DIL_entry</a> ** dep, <a class="code" href="classDIL__entry.html">DIL_entry</a> * superior = NULL) {
00986 <font class="comment">// create AL from sorted array of DIL entries</font>
00987 <font class="comment">// if superior == NULL then the AL spans all DIL categories</font>
00988 <font class="comment">// if generatealtcs == 0, a complete AL will be computed, for</font>
00989 <font class="comment">// the completion of all DIL entries that are dependencies of</font>
00990 <font class="comment">// superior</font>
00991 <font class="comment">// if generatealmaxt &gt; 0, the AL will be computed up to the</font>
00992 <font class="comment">// limit date specified</font>
00993 <font class="comment">// if generatealtcs &gt; 0, the AL will be computed for that</font>
00994 <font class="comment">// number of Task Chunks</font>
00995         <font class="comment">// check parameters</font>
00996         <font class="keywordflow">if</font> (!dep) {
00997                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing sorted DIL pointer in generate_AL()\n"</font>;
00998                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00999         }
01000         <font class="keywordflow">if</font> (!dep[0]) {
01001                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Empty DIL in generate_AL()\n"</font>;
01002                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01003         }
01004         <font class="keywordflow">if</font> (generatealtcs&lt;0) {
01005                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Invalid AL interval size ("</font> &lt;&lt; generatealtcs &lt;&lt; <font class="stringliteral">") requested in generate_AL()\n"</font>;
01006                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01007         }
01008         <font class="comment">// prepare DIL entry data</font>
01009         <font class="keywordtype">int</font> deplen = dep[0]-&gt;<a class="code" href="classPLLHandle.html#a9">fulllength</a>(); <font class="comment">// *** if you supply a custom list of sorted entries, supply the length of the list as well</font>
01010         <font class="keywordtype">long</font> * req = <a class="code" href="alcomp_8cc.html#a10">DIL_Required_Task_Chunks</a>(dep,deplen);
01011         <font class="comment">// allocate desired AL interval</font>
01012         <font class="comment">// Note: If there is ever a need for intervals beginning</font>
01013         <font class="comment">// at other times than the current time, that can be</font>
01014         <font class="comment">// accomplished easily by setting curtime to the desired</font>
01015         <font class="comment">// start of the interval.</font>
01016         time_t algenhpd = ((time_t) algenregular)*3600; <font class="comment">// seconds per day (before any expansion)</font>
01017         <font class="keywordflow">if</font> (!superior) algenhpd = ((time_t) algenall)*3600;
01018         <font class="keywordflow">else</font> { <font class="comment">// detect specific hpd for superior</font>
01019                 <font class="comment">// *** (search up or down?)</font>
01020                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Search for superior-specific hours-per-day parmameter not yet implemented in generate_AL()\n"</font>;
01021         }
01022         <a class="code" href="alcomp_8cc.html#a11">Get_Worked_Estimate</a>(); <font class="comment">// estimated time already worked on current day</font>
01023 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01024 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"alworked = "</font> &lt;&lt; alworked &lt;&lt; <font class="charliteral">'\n'</font>;
01025 <font class="preprocessor">#endif</font>
01026 <font class="preprocessor"></font><font class="preprocessor">        #define LOCAL_CLEAN_EXIT { delete[] req; return false; }</font>
01027 <font class="preprocessor"></font>        <a class="code" href="classActive__List.html">Active_List</a> al(req,deplen,algenhpd,superior);
01028 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01029 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"allength = "</font> &lt;&lt; al.<a class="code" href="classActive__List.html#a3">length</a>() &lt;&lt; <font class="charliteral">'\n'</font>;
01030 <font class="preprocessor">#endif</font>
01031 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (al.<a class="code" href="classActive__List.html#a3">length</a>()&lt;1) LOCAL_CLEAN_EXIT
01032         <font class="comment">// distribute task chunks per DIL entry with target date within AL interval</font>
01033         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Distributing task chunks per DIL entry over "</font> &lt;&lt; al.<a class="code" href="classActive__List.html#a3">length</a>() &lt;&lt; <font class="stringliteral">" AL task chunks\n"</font>;
01034         <font class="keywordtype">float</font> sumval=1.0, uval; <font class="keywordtype">double</font> cumreq = 0.0, groupreq = 0.0; <font class="keywordtype">int</font> groupnum = 0;
01035         <a class="code" href="classString.html">String</a> cumreqstr, rowreqstr, entryexcerptcell, dstfile, relidfile; time_t grouptd = -1;
01036         <font class="keywordflow">if</font> (alshowcumulativereq) { <font class="comment">// cumulative required time file header</font>
01037                 cumreqstr = <a class="code" href="dil2al_8hh.html#a104">DEFAULTALCUMULATIVEREQHEADER</a>;
01038                 cumreqstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@SUP@"</font>,al.<a class="code" href="classActive__List.html#a1">get_supstr</a>());
01039                 cumreqstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@EPSHRS@"</font>,<a class="code" href="classString.html">String</a>((<font class="keywordtype">double</font>) alepshours,<font class="stringliteral">"%5.2f"</font>));
01040                 cumreqstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@FORMMETHOD@"</font>,htmlformmethod);
01041                 cumreqstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@FORMACTION@"</font>,htmlforminterface);
01042                 dstfile = basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+al.<a class="code" href="classActive__List.html#a2">filestr</a>()+<font class="stringliteral">".ctr.html"</font>;
01043                 relidfile = <a class="code" href="utilities_8cc.html#a30">relurl</a>(dstfile,idfile);
01044         }
01045         time_t t_current = <a class="code" href="utilities_8cc.html#a19">Time</a>(NULL) + <a class="code" href="alcomp_8cc.html#a0">AL_PREPARATION_DELAY</a>; <font class="comment">// expected time upon completion of AL generation</font>
01046         time_t t_start = al.<a class="code" href="classActive__List.html#a7">AL_Head</a>()-&gt;<a class="code" href="classAL__Day.html#a3">DayDate</a>()+al.<a class="code" href="classActive__List.html#a7">AL_Head</a>()-&gt;<a class="code" href="classAL__Day.html#a4">DayStart</a>(); <font class="comment">// AL start</font>
01047         time_t t_limit = al.<a class="code" href="classActive__List.html#a8">AL_Tail</a>()-&gt;<a class="code" href="classAL__Day.html#a3">DayDate</a>()+al.<a class="code" href="classActive__List.html#a8">AL_Tail</a>()-&gt;<a class="code" href="classAL__Day.html#a6">DayMaxt</a>(); <font class="comment">// AL limit</font>
01048         srand(t_current);
01049         <font class="keywordflow">if</font> (superior) { <font class="comment">// *** DIL entry specific AL</font>
01050                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Actual dependency check for DIL entry specific AL not yet implemented in generate_AL()\n"</font>;
01051         }
01052         <font class="keywordtype">int</font> i, cnt = 0;
01053         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"DEs : "</font>; <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush(); <a class="code" href="classDIL__entry.html">DIL_entry</a> * prevde; <font class="comment">// use prevde, since dep[i-1] can point to DIL entry that does not satisfy the conditionals below</font>
01054 <font class="preprocessor">        #define GENERATE_AL_DEPLOOP_CONTINUE prevde = dep[i]; continue</font>
01055 <font class="preprocessor"></font>        <font class="keywordflow">for</font> (i=0; ((i&lt;deplen) &amp;&amp; (dep[i]-&gt;<a class="code" href="classDIL__entry.html#a12">Target_Date</a>()&lt;t_limit)); i++) <font class="keywordflow">if</font> ((req[i]&gt;0) &amp;&amp; (dep[i]-&gt;<a class="code" href="classDIL__entry.html#a19">Is_Dependency_Of</a>(superior))) { <font class="comment">// non-completed DIL entries</font>
01056 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01057 <font class="preprocessor"></font>                <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">" ("</font> &lt;&lt; req[i] &lt;&lt; <font class="stringliteral">") :\n"</font>;
01058 <font class="preprocessor">#endif</font>
01059 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (alshowcumulativereq) { <font class="comment">// compute cumulative required time</font>
01060                         <a class="code" href="classDIL__Topical__List.html">DIL_Topical_List</a> * dtl = dep[i]-&gt;<a class="code" href="classDIL__entry.html#a6">Topics</a>(0);
01061                         time_t curtd = dep[i]-&gt;Target_Date();
01062                         <font class="keywordflow">if</font> (grouptd&gt;=0) { <font class="comment">// if first row of form</font>
01063                                 <font class="keywordflow">if</font> (curtd==grouptd) rowreqstr += <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<font class="stringliteral">"@GROUPTREQ@"</font>)+<a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="utilities_8cc.html#a75">HTML_put_form_checkbox</a>(<a class="code" href="classString.html">String</a>(<font class="stringliteral">"TDCHKBX"</font>)+prevde-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>(),<font class="stringliteral">"noupdate@GROUPCHECKED@"</font>,<font class="stringliteral">""</font>)
01064                                         +<a class="code" href="utilities_8cc.html#a77">HTML_put_form_text</a>(<a class="code" href="classString.html">String</a>(<font class="stringliteral">"TD"</font>)+prevde-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>(),<font class="stringliteral">"@GROUPEPSTD@"</font>,12)); <font class="comment">// if in same group, add @place holders@ to row</font>
01065                                 <font class="keywordflow">else</font> { <font class="comment">// if not in same group complete group data up to previous entry (prevde)</font>
01066                                         <a class="code" href="alcomp_8cc.html#a12">generate_EPS_cells</a>(grouptd,cumreqstr,rowreqstr,groupreq,cumreq,t_current,*prevde);
01067                                         groupnum++;
01068                                 }
01069                                 <font class="comment">// *** optionally remove the following cell once T_{pref} is used</font>
01070                                 <font class="comment">//     to determine preferable shifts</font>
01071                                 rowreqstr += entryexcerptcell;
01072                                 cumreqstr += <a class="code" href="utilities_8cc.html#a64">HTML_put_table_row</a>(<font class="stringliteral">""</font>,rowreqstr)+<font class="charliteral">'\n'</font>;
01073                         }
01074                         grouptd = curtd;
01075                         groupreq += (double) req[i];
01076                         cumreq += (double) req[i];
01077                         rowreqstr = <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,dec(groupnum))+
01078                                           <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>((relidfile+<font class="charliteral">'#'</font>)+dep[i]-&gt;chars(),<font class="stringliteral">"DIL#"</font> + <a class="code" href="classString.html">String</a>(dep[i]-&gt;chars())))+
01079                                           <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="utilities_8cc.html#a68">HTML_put_href</a>((<a class="code" href="utilities_8cc.html#a30">relurl</a>(dstfile,dtl-&gt;<a class="code" href="classDIL__Topical__List.html#m0">dil</a>.<a class="code" href="structfiletitle__t.html#m0">file</a>)+<font class="charliteral">'#'</font>)+dep[i]-&gt;chars(),dtl-&gt;<a class="code" href="classDIL__Topical__List.html#m0">dil</a>.<a class="code" href="structfiletitle__t.html#m1">title</a>)+<font class="stringliteral">" [&lt;A HREF=\"file:///cgi-bin/dil2al?dil2al=MEI&amp;DILID="</font>+dep[i]-&gt;str()+<font class="stringliteral">"\"&gt;edit&lt;/A&gt;]"</font>)+
01080                                           <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,curtd))+
01081                                           <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="classString.html">String</a>((((<font class="keywordtype">double</font>) req[i])*((<font class="keywordtype">double</font>) timechunksize))/60.0,<font class="stringliteral">"%6.2f"</font>))+
01082                                           <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="classString.html">String</a>((cumreq*((<font class="keywordtype">double</font>) timechunksize))/60.0,<font class="stringliteral">"%6.2f"</font>));
01083                         <font class="keywordflow">if</font> (dep[i]-&gt;Entry_Text()) entryexcerptcell = (*dep[i]-&gt;Entry_Text());
01084                         <font class="keywordflow">else</font> entryexcerptcell = <font class="stringliteral">"(Missing Text Content)"</font>;
01085                         <a class="code" href="utilities_8cc.html#a62">HTML_remove_tags</a>(entryexcerptcell);
01086                         <a class="code" href="utilities_8cc.html#a78">Elipsis_At</a>(entryexcerptcell,alcumtimereqexcerptlength);
01087                         entryexcerptcell = <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,entryexcerptcell);
01088                 }
01089                 <font class="keywordflow">if</font> (dep[i]-&gt;<a class="code" href="classDIL__entry.html#a12">Target_Date</a>()&lt;t_start) { <font class="comment">// skip DIL entries with target date prior to current time</font>
01090                         al.<a class="code" href="classActive__List.html#a14">Add_Passed_Target_Date</a>(dep[i]); <font class="comment">// add to list of passed target date DIL entries</font>
01091                         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Warning - Target Date of DIL entry "</font>;
01092                         <font class="keywordflow">if</font> (calledbyforminput) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"&lt;A HREF=\""</font> &lt;&lt; idfile &lt;&lt; <font class="charliteral">'#'</font> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">"\"&gt;"</font>;
01093                         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>();
01094                         <font class="keywordflow">if</font> (calledbyforminput) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"&lt;/A&gt;"</font>;
01095                         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">" precedes current time\n"</font>;
01096                         GENERATE_AL_DEPLOOP_CONTINUE;
01097                 }
01098                 al.<a class="code" href="classActive__List.html#a13">Add_Target_Date</a>(dep[i]); <font class="comment">// add target date reference</font>
01099                 <font class="comment">// *** simplify the below by making member functions</font>
01100                 <font class="comment">//     that do things like take req[i], automatically</font>
01101                 <font class="comment">//     check if expansion is allowed, do the work, and</font>
01102                 <font class="comment">//     return the remainder for req[i]</font>
01103                 <font class="keywordtype">long</font> expandn = req[i] - al.<a class="code" href="classActive__List.html#a5">available_before</a>(dep[i]-&gt;Target_Date()); <font class="comment">// also sets al.deavail</font>
01104                 <font class="keywordflow">if</font> ((expandn&gt;0) &amp;&amp; (alautoexpand)) {
01105                         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Expanded for DIL entry #"</font> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">" ("</font> &lt;&lt; expandn &lt;&lt; <font class="stringliteral">")\n"</font>;
01106                         <font class="keywordflow">if</font> ((expandn -= al.<a class="code" href="classActive__List.html#a6">expand</a>(expandn,dep[i]-&gt;Target_Date()))!=0) {
01107                                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"DIL entry #"</font>;
01108                                 <font class="keywordflow">if</font> (calledbyforminput) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"&lt;A HREF=\""</font> &lt;&lt; idfile &lt;&lt; <font class="charliteral">'#'</font> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">"\"&gt;"</font>;
01109                                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>();
01110                                 <font class="keywordflow">if</font> (calledbyforminput) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"&lt;/A&gt;"</font>;
01111                                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">" tasks cannot be completed before "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,dep[i]-&gt;Target_Date()) &lt;&lt; <font class="stringliteral">"(required: "</font> &lt;&lt; req[i] &lt;&lt; <font class="stringliteral">", available: "</font> &lt;&lt; al.<a class="code" href="classActive__List.html#m2">deavail</a> &lt;&lt;  <font class="stringliteral">")\n"</font>;
01112                         }
01113                 }
01114                 <font class="comment">// *** currently only linear distribution function available</font>
01115                 <font class="keywordflow">if</font> ((sumval=al.<a class="code" href="classActive__List.html#a9">set_TC_values</a>())&gt;0.0) {
01116                         <font class="comment">// randomly allocate TCs for this DIL entry</font>
01117                         <font class="keywordflow">while</font> ((req[i]&gt;0) &amp;&amp; (al.<a class="code" href="classActive__List.html#m2">deavail</a>&gt;0)) {
01118                                 uval = sumval*(((float) rand()) / ((float) RAND_MAX));
01119                                 uval = al.<a class="code" href="classActive__List.html#a10">allocate_with_value</a>(uval,dep[i]);
01120                                 <font class="keywordflow">if</font> (uval&gt;0.0) {
01121                                         sumval -= uval;
01122                                         req[i]--;
01123 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01124 <font class="preprocessor"></font>                                        <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,al.<a class="code" href="classActive__List.html#a7">AL_Head</a>(),1) {
01125                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'|'</font>;
01126                                                 <font class="keywordflow">if</font> (e-&gt;TC_Head()) { 
01127                                                         <font class="keywordflow">for</font> (<a class="code" href="classAL__TC.html">AL_TC</a> * etc = e-&gt;TC_Head(); (etc); etc = etc-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>())
01128                                                                 <font class="keywordflow">if</font> (etc-&gt;<a class="code" href="classAL__TC.html#a6">Get_DE</a>()) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'x'</font>; <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'_'</font>;
01129                                                 }
01130                                         }
01131                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'\n'</font>;
01132 <font class="preprocessor">#endif</font>
01133 <font class="preprocessor"></font>                                }
01134                         }
01135                 } <font class="keywordflow">else</font> {
01136                         <font class="keywordflow">if</font> (sumval==0.0) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"No task chunks available for DIL entry #"</font> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">" before target date "</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d%H%M"</font>,dep[i]-&gt;Target_Date()) &lt;&lt; <font class="stringliteral">"(required: "</font> &lt;&lt; req[i] &lt;&lt; <font class="stringliteral">", available: "</font> &lt;&lt; al.<a class="code" href="classActive__List.html#m2">deavail</a> &lt;&lt;  <font class="stringliteral">")\n"</font>;
01137                         <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Negative sum of values for DIL entry #"</font> &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="stringliteral">" in generate_AL(), continuing\n"</font>;
01138                 }
01139                 prevde = dep[i];
01140                 cnt++;
01141 <font class="preprocessor">#ifdef DEBUG</font>
01142 <font class="preprocessor"></font>                <font class="keywordflow">if</font> ((i%10)==0) { VOUT &lt;&lt; '&gt;'; <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush(); }
01143 <font class="preprocessor">#endif</font>
01144 <font class="preprocessor"></font>        }
01145         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Scheduled DIL entries with target date in requested range: "</font> &lt;&lt; cnt &lt;&lt; <font class="charliteral">'\n'</font>;
01146         <font class="keywordflow">if</font> (alshowcumulativereq) { <font class="comment">// cumulative required time file tail</font>
01147                 <a class="code" href="classString.html">String</a> cumreqtail(<a class="code" href="dil2al_8hh.html#a105">DEFAULTALCUMULATIVEREQTAIL</a>);
01148                 cumreqtail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@SUP@"</font>,al.<a class="code" href="classActive__List.html#a1">get_supstr</a>());
01149                 cumreqtail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@ALFILE@"</font>,al.<a class="code" href="classActive__List.html#a2">filestr</a>());
01150                 cumreqtail.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@ALDATE@"</font>,<a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%c"</font>));
01151                 <a class="code" href="alcomp_8cc.html#a12">generate_EPS_cells</a>(grouptd,cumreqstr,rowreqstr,groupreq,cumreq,t_current,*prevde); <font class="comment">// final call to complete grouop data for all entries</font>
01152                 rowreqstr += entryexcerptcell;
01153                 cumreqstr += <a class="code" href="utilities_8cc.html#a64">HTML_put_table_row</a>(<font class="stringliteral">""</font>,rowreqstr)+<font class="charliteral">'\n'</font> + cumreqtail;
01154                 <a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(dstfile,cumreqstr,<font class="stringliteral">"AL Cumulative Time Required"</font>);
01155         }
01156 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01157 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"*\n"</font>;
01158 <font class="preprocessor">#endif</font>
01159 <font class="preprocessor"></font>        <font class="comment">// randomly pick tasks that could not be allocated entirely before their target dates</font>
01160         <a class="code" href="classAL__TC.html">AL_TC</a> * atc = al.<a class="code" href="classActive__List.html#a11">Get_Avail_TC</a>(0);
01161         <font class="keywordtype">int</font> j, k = 1; cnt = 0;
01162         <font class="keywordflow">while</font> (k&gt;=0) {
01163                 <font class="comment">// random DIL entry</font>
01164                 j = (int) (((float) i)*((float) rand()) / ((float) RAND_MAX));
01165                 <font class="keywordflow">if</font> (j&gt;=i) j=i-1;
01166                 <font class="keywordflow">if</font> (j&lt;0) <font class="keywordflow">break</font>; <font class="comment">// i==0</font>
01167                 <font class="comment">// find nearest DIL entry requiring task chunks</font>
01168                 <font class="comment">// Note: current order of search gives partially</font>
01169                 <font class="comment">// allocated DIL entries priority over DIL entries</font>
01170                 <font class="comment">// with target dates prior to current time</font>
01171                 <font class="keywordflow">for</font> (k = j; ((k&lt;i) &amp;&amp; (req[k]&lt;=0)); k++);
01172                 <font class="keywordflow">if</font> (k&gt;=i) <font class="keywordflow">for</font> (k = (j-1); ((k&gt;=0) &amp;&amp; (req[k]&lt;=0)); k--);
01173                 <font class="comment">// allocate earliest available task chunk in AL</font>
01174                 <font class="keywordflow">if</font> (k&gt;=0) {
01175                         <font class="keywordflow">if</font> (al.<a class="code" href="classActive__List.html#a12">allocate</a>(dep[k])) {
01176                                 req[k]--;
01177 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01178 <font class="preprocessor"></font>                                <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,al.<a class="code" href="classActive__List.html#a7">AL_Head</a>(),1) {
01179                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'|'</font>;
01180                                         <font class="keywordflow">if</font> (e-&gt;TC_Head()) { 
01181                                                 <font class="keywordflow">for</font> (<a class="code" href="classAL__TC.html">AL_TC</a> * etc = e-&gt;TC_Head(); (etc); etc = etc-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>())
01182                                                         <font class="keywordflow">if</font> (etc-&gt;<a class="code" href="classAL__TC.html#a6">Get_DE</a>()) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'x'</font>; <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'_'</font>;
01183                                         }
01184                                 }
01185                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'\n'</font>;
01186 <font class="preprocessor">#endif</font>
01187 <font class="preprocessor"></font>                        } <font class="keywordflow">else</font> <font class="keywordflow">break</font>;
01188                 }
01189 <font class="preprocessor">#ifdef DEBUG</font>
01190 <font class="preprocessor"></font>                <font class="keywordflow">if</font> ((cnt%10)==0) { <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="charliteral">'+'</font>; <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush(); }
01191 <font class="preprocessor">#endif</font>
01192 <font class="preprocessor"></font>                cnt++;
01193         }
01194         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Scheduled tasks that could not be completed before target dates: "</font> &lt;&lt; cnt &lt;&lt; <font class="charliteral">'\n'</font>;
01195 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01196 <font class="preprocessor"></font>        <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"*\n"</font>;
01197 <font class="preprocessor">#endif</font>
01198 <font class="preprocessor"></font>        <font class="comment">// randomly pick tasks that have target dates exceeding the AL interval</font>
01199         <font class="keywordtype">int</font> remlen = deplen - i;
01200         k = 0; cnt = 0;
01201         <font class="keywordflow">while</font> (k&lt;deplen) {
01202                 <font class="comment">// random DIL entry</font>
01203                 j = (int) (((float) remlen)*((float) rand()) / ((float) RAND_MAX));
01204                 <font class="keywordflow">if</font> (j&gt;=remlen) j=remlen-1;
01205                 <font class="keywordflow">if</font> (j&lt;0) <font class="keywordflow">break</font>;
01206                 j += i;
01207                 <font class="comment">// find nearest DIL entry requiring task chunks</font>
01208                 <font class="keywordflow">for</font> (k = j; ((k&gt;=i) &amp;&amp; (req[k]&lt;=0)); k--);
01209                 <font class="keywordflow">if</font> (k&lt;i) <font class="keywordflow">for</font> (k = (j+1); ((k&lt;deplen) &amp;&amp; (req[k]&lt;=0)); k++);
01210                 <font class="comment">// allocate earliest available task chunk in AL</font>
01211                 <font class="keywordflow">if</font> (k&lt;deplen) {
01212                         <font class="keywordflow">if</font> (al.<a class="code" href="classActive__List.html#a12">allocate</a>(dep[k])) {
01213                                 req[k]--;
01214 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01215 <font class="preprocessor"></font>                                <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,al.<a class="code" href="classActive__List.html#a7">AL_Head</a>(),1) {
01216                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'|'</font>;
01217                                         <font class="keywordflow">if</font> (e-&gt;TC_Head()) { 
01218                                                 <font class="keywordflow">for</font> (<a class="code" href="classAL__TC.html">AL_TC</a> * etc = e-&gt;TC_Head(); (etc); etc = etc-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>())
01219                                                         <font class="keywordflow">if</font> (etc-&gt;<a class="code" href="classAL__TC.html#a6">Get_DE</a>()) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'x'</font>; <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'_'</font>;
01220                                         }
01221                                 }
01222                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="charliteral">'\n'</font>;
01223 <font class="preprocessor">#endif</font>
01224 <font class="preprocessor"></font>                        } <font class="keywordflow">else</font> <font class="keywordflow">break</font>;
01225                 }
01226 <font class="preprocessor">#ifdef DEBUG</font>
01227 <font class="preprocessor"></font>                <font class="keywordflow">if</font> ((cnt%10)==0) { <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="charliteral">'"'</font>; <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush(); }
01228 <font class="preprocessor">#endif</font>
01229 <font class="preprocessor"></font>        }
01230         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Scheduled tasks for DIL entries with target dates beyond requested range: "</font> &lt;&lt; cnt &lt;&lt; <font class="charliteral">'\n'</font>;
01231         <font class="comment">// clean up by removing unused TCs</font>
01232 <font class="preprocessor">#ifdef DIAGNOSTIC_OUTPUT</font>
01233 <font class="preprocessor"></font>        <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classAL__Day.html">AL_Day</a>,al.<a class="code" href="classActive__List.html#a7">AL_Head</a>(),1) <font class="keywordflow">for</font> (<a class="code" href="classAL__TC.html">AL_TC</a> * etc = e-&gt;TC_Head(); (etc); etc=etc-&gt;<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">if</font> (!etc-&gt;<a class="code" href="classAL__TC.html#a6">Get_DE</a>()) cerr &lt;&lt; <font class="charliteral">'?'</font>; cerr &lt;&lt; <font class="charliteral">'\n'</font>;
01234 <font class="preprocessor">#endif</font>
01235 <font class="preprocessor"></font>        al.<a class="code" href="classActive__List.html#a15">remove_unused_TCs</a>();
01236         <font class="comment">// create visible AL</font>
01237         <font class="keywordflow">if</font> (!al.<a class="code" href="classActive__List.html#a16">generate_focused_AL</a>(superior,algenhpd)) LOCAL_CLEAN_EXIT
01238         <font class="keywordflow">if</font> (!al.<a class="code" href="classActive__List.html#a17">generate_wide_AL</a>(superior)) LOCAL_CLEAN_EXIT
01239         <font class="comment">// update DIL, AL, TL main page</font>
01240         <font class="keywordflow">if</font> (!<a class="code" href="alcomp_8cc.html#a8">update_main_ALs</a>(superior)) LOCAL_CLEAN_EXIT
01241         <font class="comment">// clean up</font>
01242         <font class="keyword">delete</font>[] req;
01243         <font class="keywordflow">return</font> <font class="keyword">true</font>;
01244 }
01245 
<a name="l01246"></a><a class="code" href="alcomp_8cc.html#a14">01246</a> <font class="keywordtype">int</font> <a class="code" href="alcomp_8cc.html#a14">get_AL_entry</a>(<a class="code" href="classString.html">String</a> &amp; alstr, <font class="keywordtype">int</font> alpos, <a class="code" href="classString.html">String</a> &amp; rowcontent, <font class="keywordtype">int</font> &amp; rowstart, <font class="keywordtype">int</font> &amp; rowend) {
01247 <font class="comment">// gets an entry from an AL table and returns whether that row</font>
01248 <font class="comment">// is a Day (0) or a TC (1), returns -1 if row cannot be obtained</font>
01249         <a class="code" href="classString.html">String</a> params, cellcontent;
01250         <font class="keywordflow">if</font> ((rowend=<a class="code" href="utilities_8cc.html#a55">HTML_get_table_row</a>(alstr,alpos,params,rowcontent,&amp;rowstart))&lt;0) <font class="keywordflow">return</font> -1;
01251         <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a54">HTML_get_table_cell</a>(rowcontent,0,params,cellcontent)&lt;0) <font class="keywordflow">return</font> -1;
01252         <font class="keywordflow">if</font> (cellcontent.<a class="code" href="classString.html#a32">contains</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[      ]+@select_TL_DIL_refs:[         ]+SKIP ROW@[    ]+--[&gt;][^(]*Day"</font>))) <font class="keywordflow">return</font> 0;
01253         <font class="keywordflow">return</font> 1;
01254 }
01255 
<a name="l01256"></a><a class="code" href="alcomp_8cc.html#a15">01256</a> <font class="keywordtype">bool</font> <a class="code" href="alcomp_8cc.html#a15">remove_AL_TC</a>(<a class="code" href="classString.html">String</a> alref, <a class="code" href="classString.html">String</a> dilid) {
01257 <font class="comment">// removes the top task chunk if it has DIL entry ID dilid</font>
01258 <font class="comment">// from the AL indicated by alref and updates the suggested</font>
01259 <font class="comment">// start time of that AL day according to the assumed time</font>
01260 <font class="comment">// taken to do the task chunk (desynchronization is noticed</font>
01261 <font class="comment">// and taken care of in select_TL_DIL_refs())</font>
01262 <font class="comment">// day rows at the top of the AL that are not followed by task</font>
01263 <font class="comment">// rows are removed</font>
01264 <font class="comment">// returns false if dilid did not match the DIL entry ID of</font>
01265 <font class="comment">// the top task chunk, or if the visible focused AL became</font>
01266 <font class="comment">// empty</font>
01267         <a class="code" href="classString.html">String</a> alstr, newalstr;
01268         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(alref,alstr)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
01269         newalstr.<a class="code" href="classString.html#a107">alloc</a>(alstr.<a class="code" href="classString.html#a105">length</a>());
01270         <font class="comment">// get day row and remove empty days at top of AL</font>
01271         <font class="comment">// and find top TC to compare with dilid</font>
01272         <a class="code" href="classStringList.html">StringList</a> alentries; <font class="keywordtype">int</font> numentries = 0, alpos = 0, tcsfound = 0, tcentries[2], rowstart, rowend;
01273         <font class="keywordflow">while</font> (tcsfound&lt;2) {
01274                 <font class="keywordflow">switch</font> (<a class="code" href="alcomp_8cc.html#a14">get_AL_entry</a>(alstr,alpos,alentries[numentries],rowstart,rowend)) {
01275                         <font class="keywordflow">case</font> -1:
01276                                 <font class="comment">// *** could detect from numentries and tcsfound</font>
01277                                 <font class="comment">//     to give a different VOUT message if the</font>
01278                                 <font class="comment">//     visible AL portion contained no more TCs</font>
01279                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"Missing data in AL "</font> &lt;&lt; alref &lt;&lt; <font class="stringliteral">" after position "</font> &lt;&lt; alpos &lt;&lt; <font class="stringliteral">" in remove_AL_TC()"</font>;
01280                                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01281                                 <font class="keywordflow">break</font>;
01282                         <font class="keywordflow">case</font> 0: <font class="keywordflow">break</font>;
01283                         <font class="keywordflow">case</font> 1:
01284                                 <font class="keywordflow">if</font> (numentries==0) {
01285                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"TC without preceding Day ID in "</font> &lt;&lt; alref &lt;&lt; <font class="stringliteral">" after position "</font> &lt;&lt; alpos &lt;&lt; <font class="stringliteral">" in remove_AL_TC()"</font>;
01286                                         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01287                                 }
01288                                 <font class="keywordflow">if</font> (tcsfound==0) {
01289                                         <a class="code" href="classString.html">String</a> alhrefurl, alhreftext;
01290                                         <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a58">HTML_get_href</a>(alentries[numentries],0,alhrefurl,alhreftext)&lt;0) {
01291                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"Missing DIL ID reference in "</font> &lt;&lt; alref &lt;&lt; <font class="stringliteral">" after position "</font> &lt;&lt; alpos &lt;&lt; <font class="stringliteral">" in remove_AL_TC()"</font>;
01292                                                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01293                                         }
01294                                         <font class="keywordflow">if</font> (alhreftext!=dilid) { <font class="comment">// different task</font>
01295                                                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Top of AL "</font> &lt;&lt; alref &lt;&lt; <font class="stringliteral">" does not match DIL entry "</font> &lt;&lt; dilid &lt;&lt; <font class="charliteral">'\n'</font>;
01296                                                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01297                                         }
01298                                 }
01299                                 tcentries[tcsfound] = numentries;
01300                                 tcsfound++;
01301                                 <font class="keywordflow">break</font>;
01302                 }
01303                 <font class="keywordflow">if</font> (alpos==0) newalstr = alstr.<a class="code" href="classString.html#a51">at</a>(0,rowstart); <font class="comment">// copy head of AL</font>
01304                 numentries++; alpos = rowend;
01305         }
01306         <font class="keywordflow">if</font> (tcentries[1]==(tcentries[0]+1)) { <font class="comment">// next TC on same day, modify daystart</font>
01307                 <a class="code" href="classBigRegex.html">BigRegex</a> rds(<font class="stringliteral">"(suggested start[         ]+\\([0-9][0-9]:[0-9][0-9]\\)"</font>);
01308                 <font class="keywordtype">int</font> didx = tcentries[0]-1, dstimepos;
01309                 <font class="keywordflow">if</font> ((dstimepos=alentries[didx].index(rds))&lt;0) {
01310                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"Missing suggested start in AL "</font> &lt;&lt; alref &lt;&lt; <font class="stringliteral">" at row "</font> &lt;&lt; didx &lt;&lt; <font class="stringliteral">" in remove_AL_TC()\n"</font>;
01311                         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01312                 }
01313                 <a class="code" href="classString.html">String</a> daystartstr = alentries[didx].at(rds.<a class="code" href="classBigRegex.html#a5">subpos</a>(1),rds.<a class="code" href="classBigRegex.html#a6">sublen</a>(1));
01314                 daystartstr.<a class="code" href="classString.html#a83">del</a>(<font class="charliteral">':'</font>);
01315                 time_t tds = <a class="code" href="utilities_8cc.html#a24">time_stamp_time_of_day</a>(daystartstr) + ((time_t) (timechunksize*60));
01316                 <font class="keywordflow">if</font> (tds&gt;=<a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>) {
01317                         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Updated suggested start time exceeds length of day, limiting to 23:59\n"</font>;
01318                         tds = <a class="code" href="dil2al_8hh.html#a4">SECONDSPERDAY</a>-1;
01319                 }
01320                 daystartstr = <a class="code" href="utilities_8cc.html#a21">time_stamp_GM</a>(<font class="stringliteral">"%H:%M"</font>,tds);
01321                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i&lt;5; i++) alentries[didx][rds.<a class="code" href="classBigRegex.html#a5">subpos</a>(1)+i] = daystartstr[i];
01322         }
01323         <font class="comment">// determine day before second TC and write it</font>
01324         <font class="keywordtype">int</font> didx = tcentries[1]-1;
01325         <font class="keywordflow">if</font> (didx==tcentries[0]) didx--;
01326         newalstr += <a class="code" href="utilities_8cc.html#a64">HTML_put_table_row</a>(<a class="code" href="dil2al_8hh.html#a98">DEFAULTALDAYEMPHASIS</a>,alentries[didx]) + <font class="charliteral">'\n'</font>;
01327         <font class="comment">// write second TC with top TC colors</font>
01328         newalstr += <a class="code" href="utilities_8cc.html#a64">HTML_put_table_row</a>(<a class="code" href="dil2al_8hh.html#a101">DEFAULTALFOCUSEDEMPHASIS</a>,alentries[tcentries[1]]) + <font class="charliteral">'\n'</font>;
01329         <font class="comment">// copy remainder of AL</font>
01330         newalstr += alstr.<a class="code" href="classString.html#a51">at</a>(alpos,alstr.<a class="code" href="classString.html#a105">length</a>()-alpos);
01331         <font class="keywordflow">return</font> <a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(alref,newalstr,<font class="stringliteral">"AL"</font>);
01332 }
01333 
<a name="l01334"></a><a class="code" href="alcomp_8cc.html#a16">01334</a> <font class="keywordtype">bool</font> <a class="code" href="alcomp_8cc.html#a16">update_DIL_to_AL</a>() {
01335 <font class="comment">// generate an updated AL from the DIL hierarchy</font>
01336 <font class="comment">// uses generatealmaxt and generatealtcs</font>
01337         <font class="comment">/*</font>
01338 <font class="comment">        When computing priorities, also parse for ALs and refresh AL parameters</font>
01339 <font class="comment">        for all detail items if prefixed with E (``automatic estimate'').</font>
01340 <font class="comment">        */</font>
01341         <font class="comment">// *** can make this first part prepare in the background</font>
01342         <font class="comment">//     before a TC is completed</font>
01343         <a class="code" href="classDetailed__Items__List.html">Detailed_Items_List</a> dilist;
01344         <a class="code" href="classDIL__entry.html">DIL_entry</a> ** dep = dilist.<a class="code" href="classDetailed__Items__List.html#a4">Sort_by_Target_Date</a>(<font class="keyword">true</font>);
01345 <font class="preprocessor">#ifdef DEBUG</font>
01346 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (dep) {
01347                 <font class="keywordtype">int</font> entrynum = dep[0]-&gt;<a class="code" href="classPLLHandle.html#a9">fulllength</a>();
01348                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i&lt;entrynum; i++) cerr &lt;&lt; dep[i]-&gt;<a class="code" href="classDIL__ID.html#a15">chars</a>() &lt;&lt; <font class="charliteral">'\n'</font>;
01349         }
01350 <font class="preprocessor">#endif</font>
01351 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (!<a class="code" href="alcomp_8cc.html#a13">generate_AL</a>(dep)) {
01352                 <font class="keyword">delete</font>[] dep;
01353                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01354         }
01355         <font class="keyword">delete</font>[] dep; <font class="comment">// may not be necessary here</font>
01356         <font class="keywordflow">return</font> <font class="keyword">true</font>;
01357 }
01358 
<a name="l01359"></a><a class="code" href="alcomp_8cc.html#a17">01359</a> <font class="keywordtype">bool</font> <a class="code" href="alcomp_8cc.html#a17">refresh_quick_load_cache</a>() {
01360   <font class="keywordflow">if</font> (!usequickloadcache) {
01361     <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: The usequickloadcache flag is not set in refresh_quick_load_cache()\n"</font>;
01362     <font class="keywordflow">return</font> <font class="keyword">false</font>;
01363   }
01364   <a class="code" href="classDetailed__Items__List.html">Detailed_Items_List</a> dilist;
01365   <font class="keywordflow">if</font> (dilist.<a class="code" href="classDetailed__Items__List.html#a2">Get_All_DIL_ID_File_Parameters</a>()&lt;0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
01366   <font class="keywordflow">if</font> (dilist.<a class="code" href="classDetailed__Items__List.html#a3">Get_All_Topical_DIL_Parameters</a>(<font class="keyword">true</font>)&lt;0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
01367   <font class="keywordflow">return</font> <font class="keyword">true</font>;
01368 }
</pre></div><hr><address align="right"><small>Generated on Mon Sep 13 14:53:08 2004 for dil2al by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
