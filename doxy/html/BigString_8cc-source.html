<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BigString.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>BigString.cc</h1><a href="BigString_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* </font>
00002 <font class="comment">Copyright (C) 1988 Free Software Foundation</font>
00003 <font class="comment">    written by Doug Lea (dl@rocky.oswego.edu)</font>
00004 <font class="comment"></font>
00005 <font class="comment">Modified by Randal A. Koene, 20000224</font>
00006 <font class="comment">    allocation types modified to enable big strings</font>
00007 <font class="comment">    added substring replacement capability to gsub (as in sed s</font><font class="comment">/// command), 20000321</font>
00008 <font class="comment"></font>
00009 This file is part of the GNU C++ Library.  This library is free
00010 software; you can redistribute it and/or modify it under the terms of
00011 the GNU Library General Public License as published by the Free
00012 Software Foundation; either version 2 of the License, or (at your
00013 option) any later version.  This library is distributed in the hope
00014 that it will be useful, but WITHOUT ANY WARRANTY; without even the
00015 implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
00016 PURPOSE.  See the GNU Library General Public License for more details.
00017 You should have received a copy of the GNU Library General Public
00018 License along with this library; if not, write to the Free Software
00019 Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
00020 */
00021 
00022 <font class="comment">/* </font>
00023 <font class="comment">  String class implementation</font>
00024 <font class="comment"> */</font>
00025 
00026 <font class="preprocessor">#ifdef __GNUG__</font>
00027 <font class="preprocessor"></font><font class="preprocessor">#pragma implementation</font>
00028 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00029 <font class="preprocessor"></font><font class="preprocessor">#include &lt;limits.h&gt;</font>
00030 <font class="preprocessor">#include "<a class="code" href="BigString_8hh.html">BigString.hh</a>"</font>
00031 <font class="preprocessor">#include &lt;new.h&gt;</font>
00032 <font class="preprocessor">#include &lt;ctype.h&gt;</font>
00033 <font class="preprocessor">#undef OK</font>
00034 <font class="preprocessor"></font>
00035 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00036 <font class="preprocessor"></font>        <font class="keywordtype">bool</font> globaldebugop = <font class="keyword">false</font>;
00037 <font class="preprocessor">#endif</font>
00038 <font class="preprocessor"></font>
<a name="l00039"></a><a class="code" href="classString.html#a109">00039</a> <font class="keywordtype">void</font> <a class="code" href="classString.html#a109">String::error</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* msg)<font class="keyword"> const</font>
00040 <font class="keyword"></font>{
00041 cerr &lt;&lt; <font class="stringliteral">"Error in String: "</font> &lt;&lt; msg &lt;&lt; <font class="charliteral">'\n'</font>;
00042 <font class="comment">//  (*lib_error_handler)("String", msg);</font>
00043 }
00044 
<a name="l00045"></a><a class="code" href="classString.html#a103">00045</a> <a class="code" href="classString.html#a103">String::operator const char*</a>()<font class="keyword"> const</font>
00046 <font class="keyword"></font>{ 
00047   <font class="keywordflow">return</font> (<font class="keyword">const</font> <font class="keywordtype">char</font>*)<a class="code" href="classString.html#a104">chars</a>();
00048 }
00049 
00050 <font class="comment">//  globals</font>
00051 
00052 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00053 <font class="preprocessor"></font><a class="code" href="structStrRep.html">StrRep</a>  <a class="code" href="BigString_8cc.html#a6">_nilStrRep</a> = { 0, 1, { 0 }, 0 }; <font class="comment">// nil strings point here</font>
00054 <font class="preprocessor">#else</font>
<a name="l00055"></a><a class="code" href="BigString_8cc.html#a6">00055</a> <font class="preprocessor"></font><a class="code" href="structStrRep.html">StrRep</a>  _nilStrRep = { 0, 1, { 0 } }; <font class="comment">// nil strings point here</font>
00056 <font class="preprocessor">#endif</font>
<a name="l00057"></a><a class="code" href="BigString_8cc.html#a7">00057</a> <font class="preprocessor"></font><a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a7">_nilString</a>;               <font class="comment">// nil SubStrings point here</font>
00058 
00059 
00060 
00061 
00062 <font class="comment">/*</font>
00063 <font class="comment"> the following inline fcts are specially designed to work</font>
00064 <font class="comment"> in support of String classes, and are not meant as generic replacements</font>
00065 <font class="comment"> for libc "str" functions.</font>
00066 <font class="comment"></font>
00067 <font class="comment"> inline copy fcts -  I like left-to-right from-&gt;to arguments.</font>
00068 <font class="comment"> all versions assume that `to' argument is non-null</font>
00069 <font class="comment"></font>
00070 <font class="comment"> These are worth doing inline, rather than through calls because,</font>
00071 <font class="comment"> via procedural integration, adjacent copy calls can be smushed</font>
00072 <font class="comment"> together by the optimizer.</font>
00073 <font class="comment">*/</font>
00074 
00075 <font class="comment">// copy n bytes</font>
00076 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">void</font> ncopy(<font class="keyword">const</font> <font class="keywordtype">char</font>* from, <font class="keywordtype">char</font>* to, <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> n)
00077 {
00078   <font class="keywordflow">if</font> (from != to) <font class="keywordflow">while</font> (--n &gt;= 0) *to++ = *from++;
00079 }
00080 
00081 <font class="comment">// copy n bytes, null-terminate</font>
00082 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">void</font> ncopy0(<font class="keyword">const</font> <font class="keywordtype">char</font>* from, <font class="keywordtype">char</font>* to, <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> n)
00083 {
00084   <font class="keywordflow">if</font> (from != to) 
00085   {
00086     <font class="keywordflow">while</font> (--n &gt;= 0) *to++ = *from++;
00087     *to = 0;
00088   }
00089   <font class="keywordflow">else</font>
00090     to[n] = 0;
00091 }
00092 
00093 <font class="preprocessor">#ifdef BIGSTRING_ISTREAM_INITIALIZATION</font>
00094 <font class="preprocessor"></font><font class="comment">// copy n bytes from an istream, null-terminate</font>
00095 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">void</font> ncopy0_istream(istream &amp; from, <font class="keywordtype">char</font>* to, <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> n)
00096 {
00097         from.read(to,n);
00098         to[from.gcount()]=<font class="charliteral">'\0'</font>;
00099         <font class="keywordflow">if</font> (from.gcount()!=n) cerr &lt;&lt; <font class="stringliteral">"Warning: characters read ("</font> &lt;&lt; from.gcount() &lt;&lt; <font class="stringliteral">") does not equal expected size ("</font> &lt;&lt; n &lt;&lt; <font class="stringliteral">")\n"</font>;
00100 }
00101 <font class="preprocessor">#endif</font>
00102 <font class="preprocessor"></font>
00103 <font class="comment">// copy until null</font>
00104 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">void</font> scopy(<font class="keyword">const</font> <font class="keywordtype">char</font>* from, <font class="keywordtype">char</font>* to)
00105 {
00106   <font class="keywordflow">if</font> (from != 0) <font class="keywordflow">while</font>((*to++ = *from++) != 0);
00107 }
00108 
00109 <font class="comment">// copy right-to-left</font>
00110 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">void</font> revcopy(<font class="keyword">const</font> <font class="keywordtype">char</font>* from, <font class="keywordtype">char</font>* to, <a class="code" href="BigString_8hh.html#a11">_BIGSTRING_REVERSE</a> n)
00111 {
00112   <font class="keywordflow">if</font> (from != 0) <font class="keywordflow">while</font> (--n &gt;= 0) *to-- = *from--;
00113 }
00114 
00115 
00116 <font class="keyword">inline</font> <font class="keyword">static</font> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> slen(<font class="keyword">const</font> <font class="keywordtype">char</font>* t) <font class="comment">// inline  strlen</font>
00117 {
00118   <font class="keywordflow">if</font> (t == 0)
00119     <font class="keywordflow">return</font> 0;
00120   <font class="keywordflow">else</font>
00121   {
00122     <font class="keyword">const</font> <font class="keywordtype">char</font>* a = t;
00123     <font class="keywordflow">while</font> (*a++ != 0);
00124     <font class="keywordflow">return</font> a - 1 - t;
00125   }
00126 }
00127 
00128 <font class="comment">// minimum &amp; maximum representable rep size</font>
00129 
<a name="l00130"></a><a class="code" href="BigString_8cc.html#a0">00130</a> <font class="preprocessor">#define MAXStrRep_SIZE   ((1 &lt;&lt; (sizeof(_BIGSTRING_ALLOC) * CHAR_BIT - 1)) - 1)</font>
<a name="l00131"></a><a class="code" href="BigString_8cc.html#a1">00131</a> <font class="preprocessor"></font><font class="preprocessor">#define MINStrRep_SIZE   16</font>
00132 <font class="preprocessor"></font>
00133 <font class="preprocessor">#ifndef MALLOC_MIN_OVERHEAD</font>
<a name="l00134"></a><a class="code" href="BigString_8cc.html#a2">00134</a> <font class="preprocessor"></font><font class="preprocessor">#define MALLOC_MIN_OVERHEAD  4</font>
00135 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00136 <font class="preprocessor"></font>
00137 <font class="comment">// The basic allocation primitive:</font>
00138 <font class="comment">// Always round request to something close to a power of two.</font>
00139 <font class="comment">// This ensures a bit of padding, which often means that</font>
00140 <font class="comment">// concatenations don't have to realloc. Plus it tends to</font>
00141 <font class="comment">// be faster when lots of Strings are created and discarded,</font>
00142 <font class="comment">// since just about any version of malloc (op new()) will</font>
00143 <font class="comment">// be faster when it can reuse identically-sized chunks</font>
00144 
00145 <font class="keyword">inline</font> <font class="keyword">static</font> <a class="code" href="structStrRep.html">StrRep</a>* Snew(<a class="code" href="BigString_8hh.html#a7">_BIGSTRING_ALLOC</a> newsiz)
00146 {
00147   <a class="code" href="BigString_8hh.html#a12">_BIGSTRING_ALLOCMANIP</a> siz = <font class="keyword">sizeof</font>(StrRep) + newsiz + <a class="code" href="BigString_8cc.html#a2">MALLOC_MIN_OVERHEAD</a>;
00148   <a class="code" href="BigString_8hh.html#a12">_BIGSTRING_ALLOCMANIP</a> allocsiz = <a class="code" href="BigString_8cc.html#a1">MINStrRep_SIZE</a>;
00149   <font class="keywordflow">while</font> (allocsiz &lt; siz) allocsiz &lt;&lt;= 1;
00150   allocsiz -= <a class="code" href="BigString_8cc.html#a2">MALLOC_MIN_OVERHEAD</a>;
00151   <font class="keywordflow">if</font> (allocsiz &gt;= <a class="code" href="BigString_8cc.html#a0">MAXStrRep_SIZE</a>)
00152         cerr &lt;&lt; <font class="stringliteral">"Error in String: Requested length out of range"</font> &lt;&lt; <font class="charliteral">'\n'</font>;
00153 <font class="comment">//    (*lib_error_handler)("String", "Requested length out of range");</font>
00154     
00155   <a class="code" href="structStrRep.html">StrRep</a>* rep = <font class="keyword">new</font> (operator new (allocsiz)) <a class="code" href="structStrRep.html">StrRep</a>;
00156   rep-&gt;<a class="code" href="structStrRep.html#m1">sz</a> = allocsiz - <font class="keyword">sizeof</font>(StrRep);
00157 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00158 <font class="preprocessor"></font>        rep-&gt;debugop = <font class="keyword">false</font>;
00159 <font class="preprocessor">#endif</font>
00160 <font class="preprocessor"></font>  <font class="keywordflow">return</font> rep;
00161 }
00162 
00163 <font class="comment">// Do-something-while-allocating routines.</font>
00164 
00165 <font class="comment">// We live with two ways to signify empty Sreps: either the</font>
00166 <font class="comment">// null pointer (0) or a pointer to the nilStrRep.</font>
00167 
00168 <font class="comment">// We always signify unknown source lengths (usually when fed a char*)</font>
00169 <font class="comment">// via len == -1, in which case it is computed.</font>
00170 
00171 <font class="comment">// allocate, copying src if nonull</font>
00172 
<a name="l00173"></a><a class="code" href="BigString_8cc.html#a15">00173</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a15">Salloc</a>(<a class="code" href="structStrRep.html">StrRep</a>* old, <font class="keyword">const</font> <font class="keywordtype">char</font>* src, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> srclen, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newlen)
00174 {
00175 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00176 <font class="preprocessor"></font><font class="comment">//bool _debugop;</font>
00177 <font class="comment">//if (old) _debugop = old-&gt;debugop; else _debugop = true;</font>
00178 <font class="comment">//if (old) old-&gt;debugop = false;</font>
00179 <font class="preprocessor">#endif</font>
00180 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (old == &amp;_nilStrRep) old = 0;
00181   <font class="keywordflow">if</font> (srclen &lt; 0) srclen = slen(src);
00182   <font class="keywordflow">if</font> (newlen &lt; srclen) newlen = srclen;
00183 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00184 <font class="preprocessor"></font><font class="comment">//if (_debugop) cerr &lt;&lt; "[Salloc] srclen = " &lt;&lt; srclen &lt;&lt; ", newlen = " &lt;&lt; newlen &lt;&lt; '\n';</font>
00185 <font class="keywordflow">if</font> (globaldebugop) cerr &lt;&lt; <font class="stringliteral">"[Salloc] srclen = "</font> &lt;&lt; srclen &lt;&lt; <font class="stringliteral">", newlen = "</font> &lt;&lt; newlen &lt;&lt; <font class="charliteral">'\n'</font>;
00186 <font class="preprocessor">#endif</font>
00187 <font class="preprocessor"></font>  <a class="code" href="structStrRep.html">StrRep</a>* rep;
00188   <font class="keywordflow">if</font> (old == 0 || newlen &gt; old-&gt;<a class="code" href="structStrRep.html#m1">sz</a>)
00189     rep = Snew(newlen);
00190   <font class="keywordflow">else</font>
00191     rep = old;
00192 
00193   rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = newlen;
00194   ncopy0(src, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, srclen);
00195 
00196   <font class="keywordflow">if</font> (old != rep &amp;&amp; old != 0) <font class="keyword">delete</font> old;
00197 
00198 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00199 <font class="preprocessor"></font><font class="comment">//rep-&gt;debugop = _debugop;</font>
00200 <font class="preprocessor">#endif</font>
00201 <font class="preprocessor"></font>  <font class="keywordflow">return</font> rep;
00202 }
00203 
00204 <font class="preprocessor">#ifdef BIGSTRING_ISTREAM_INITIALIZATION</font>
00205 <font class="preprocessor"></font><font class="comment">// allocate from an istream</font>
00206 
<a name="l00207"></a><a class="code" href="BigString_8cc.html#a16">00207</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a16">Salloc_istream</a>(<a class="code" href="structStrRep.html">StrRep</a>* old, istream &amp; src, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> srclen, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newlen)
00208 {
00209         <font class="keywordflow">if</font> (!src) <font class="keywordflow">return</font> old;
00210         <font class="keywordflow">if</font> (old == &amp;_nilStrRep) old = 0;
00211         <font class="keywordflow">if</font> (srclen &lt; 0) {
00212                 src.seekg(0,ios::end);
00213                 srclen = src.tellg();
00214                 src.seekg(0);
00215         }
00216         <font class="keywordflow">if</font> (newlen &lt; srclen) newlen = srclen;
00217         <a class="code" href="structStrRep.html">StrRep</a>* rep;
00218         <font class="keywordflow">if</font> (old == 0 || newlen &gt; old-&gt;<a class="code" href="structStrRep.html#m1">sz</a>) rep = Snew(newlen);
00219         <font class="keywordflow">else</font> rep = old;
00220         rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = newlen;
00221         ncopy0_istream(src, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, srclen);
00222         <font class="keywordflow">if</font> (old != rep &amp;&amp; old != 0) <font class="keyword">delete</font> old;
00223         <font class="keywordflow">return</font> rep;
00224 }
00225 <font class="preprocessor">#endif</font>
00226 <font class="preprocessor"></font>
00227 <font class="comment">// reallocate: Given the initial allocation scheme, it will</font>
00228 <font class="comment">// generally be faster in the long run to get new space &amp; copy</font>
00229 <font class="comment">// than to call realloc</font>
00230 
00231 <font class="keyword">static</font> <a class="code" href="structStrRep.html">StrRep</a>*
00232 Sresize(<a class="code" href="structStrRep.html">StrRep</a>* old, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newlen)
00233 {
00234   <font class="keywordflow">if</font> (old == &amp;_nilStrRep) old = 0;
00235   <a class="code" href="structStrRep.html">StrRep</a>* rep;
00236   <font class="keywordflow">if</font> (old == 0)
00237     rep = Snew(newlen);
00238   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (newlen &gt; old-&gt;<a class="code" href="structStrRep.html#m1">sz</a>)
00239   {
00240     rep = Snew(newlen);
00241     ncopy0(old-&gt;<a class="code" href="structStrRep.html#m2">s</a>, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, old-&gt;<a class="code" href="structStrRep.html#m0">len</a>);
00242     <font class="keyword">delete</font> old;
00243   }
00244   <font class="keywordflow">else</font>
00245     rep = old;
00246 
00247   rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = newlen;
00248 
00249   <font class="keywordflow">return</font> rep;
00250 }
00251 
00252 <font class="keywordtype">void</font>
<a name="l00253"></a><a class="code" href="classString.html#a107">00253</a> <a class="code" href="classString.html#a107">String::alloc</a> (<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newsize)
00254 {
00255   <a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> old_len = <a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
00256   <a class="code" href="classString.html#n0">rep</a> = Sresize(<a class="code" href="classString.html#n0">rep</a>, newsize);
00257   <a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m0">len</a> = old_len;
00258 }
00259 
00260 <font class="comment">// like allocate, but we know that src is a StrRep</font>
00261 
<a name="l00262"></a><a class="code" href="BigString_8cc.html#a18">00262</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a18">Scopy</a>(<a class="code" href="structStrRep.html">StrRep</a>* old, <font class="keyword">const</font> <a class="code" href="structStrRep.html">StrRep</a>* s)
00263 {
00264   <font class="keywordflow">if</font> (old == &amp;_nilStrRep) old = 0;
00265   <font class="keywordflow">if</font> (s == &amp;_nilStrRep) s = 0;
00266   <font class="keywordflow">if</font> (old == s) 
00267     <font class="keywordflow">return</font> (old == 0)? &amp;_nilStrRep : old;
00268   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s == 0)
00269   {
00270     old-&gt;<a class="code" href="structStrRep.html#m2">s</a>[0] = 0;
00271     old-&gt;<a class="code" href="structStrRep.html#m0">len</a> = 0;
00272     <font class="keywordflow">return</font> old;
00273   }
00274   <font class="keywordflow">else</font> 
00275   {
00276     <a class="code" href="structStrRep.html">StrRep</a>* rep;
00277     <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newlen = s-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
00278     <font class="keywordflow">if</font> (old == 0 || newlen &gt; old-&gt;<a class="code" href="structStrRep.html#m1">sz</a>)
00279     {
00280       <font class="keywordflow">if</font> (old != 0) <font class="keyword">delete</font> old;
00281       rep = Snew(newlen);
00282     }
00283     <font class="keywordflow">else</font>
00284       rep = old;
00285     rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = newlen;
00286     ncopy0(s-&gt;<a class="code" href="structStrRep.html#m2">s</a>, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, newlen);
00287     <font class="keywordflow">return</font> rep;
00288   }
00289 }
00290 
00291 <font class="comment">// allocate &amp; concatenate</font>
00292 
<a name="l00293"></a><a class="code" href="BigString_8cc.html#a19">00293</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a20">Scat</a>(<a class="code" href="structStrRep.html">StrRep</a>* old, <font class="keyword">const</font> <font class="keywordtype">char</font>* s, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> srclen, <font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen)
00294 {
00295   <font class="keywordflow">if</font> (old == &amp;_nilStrRep) old = 0;
00296   <font class="keywordflow">if</font> (srclen &lt; 0) srclen = slen(s);
00297   <font class="keywordflow">if</font> (tlen &lt; 0) tlen = slen(t);
00298   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newlen = srclen + tlen;
00299   <a class="code" href="structStrRep.html">StrRep</a>* rep;
00300 
00301   <font class="keywordflow">if</font> (old == 0 || newlen &gt; old-&gt;<a class="code" href="structStrRep.html#m1">sz</a> || 
00302       (t &gt;= old-&gt;<a class="code" href="structStrRep.html#m2">s</a> &amp;&amp; t &lt; &amp;(old-&gt;<a class="code" href="structStrRep.html#m2">s</a>[old-&gt;<a class="code" href="structStrRep.html#m0">len</a>]))) <font class="comment">// beware of aliasing</font>
00303     rep = Snew(newlen);
00304   <font class="keywordflow">else</font>
00305     rep = old;
00306 
00307   rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = newlen;
00308 
00309   ncopy(s, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, srclen);
00310   ncopy0(t, &amp;(rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[srclen]), tlen);
00311 
00312   <font class="keywordflow">if</font> (old != rep &amp;&amp; old != 0) <font class="keyword">delete</font> old;
00313 
00314   <font class="keywordflow">return</font> rep;
00315 }
00316 
00317 <font class="preprocessor">#ifdef BIGSTRING_ISTREAM_INITIALIZE</font>
00318 <font class="preprocessor"></font><font class="comment">// allocate &amp; concatenate</font>
00319 
00320 <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8hh.html#a26">Scat_istream</a>(<a class="code" href="structStrRep.html">StrRep</a>* old, <font class="keyword">const</font> <font class="keywordtype">char</font>* s, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> srclen, istream &amp; t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen)
00321 {
00322         <font class="keywordflow">if</font> (!t) <font class="keywordflow">return</font> old;
00323         <font class="keywordflow">if</font> (old == &amp;_nilStrRep) old = 0;
00324         <font class="keywordflow">if</font> (srclen &lt; 0) srclen = slen(s);
00325         <font class="keywordflow">if</font> (tlen &lt; 0) {
00326                 t.seekg(0,ios::end);
00327                 tlen = t.tellg();
00328                 t.seekg(0);
00329         }
00330         <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newlen = srclen + tlen;
00331         <a class="code" href="structStrRep.html">StrRep</a>* rep;
00332         <font class="keywordflow">if</font> (old == 0 || newlen &gt; old-&gt;<a class="code" href="structStrRep.html#m1">sz</a>) rep = Snew(newlen);
00333         <font class="keywordflow">else</font> rep = old;
00334         rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = newlen;
00335         ncopy(s, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, srclen);
00336         ncopy0_istream(t, &amp;(rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[srclen]), tlen);
00337         <font class="keywordflow">if</font> (old != rep &amp;&amp; old != 0) <font class="keyword">delete</font> old;
00338         <font class="keywordflow">return</font> rep;
00339 }
00340 <font class="preprocessor">#endif</font>
00341 <font class="preprocessor"></font>
00342 <font class="comment">// double-concatenate</font>
00343 
<a name="l00344"></a><a class="code" href="BigString_8cc.html#a20">00344</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a20">Scat</a>(<a class="code" href="structStrRep.html">StrRep</a>* old, <font class="keyword">const</font> <font class="keywordtype">char</font>* s, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> srclen, <font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen,
00345              <font class="keyword">const</font> <font class="keywordtype">char</font>* u, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> ulen)
00346 {
00347   <font class="keywordflow">if</font> (old == &amp;_nilStrRep) old = 0;
00348   <font class="keywordflow">if</font> (srclen &lt; 0) srclen = slen(s);
00349   <font class="keywordflow">if</font> (tlen &lt; 0) tlen = slen(t);
00350   <font class="keywordflow">if</font> (ulen &lt; 0) ulen = slen(u);
00351   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newlen = srclen + tlen + ulen;
00352   <a class="code" href="structStrRep.html">StrRep</a>* rep;
00353   <font class="keywordflow">if</font> (old == 0 || newlen &gt; old-&gt;<a class="code" href="structStrRep.html#m1">sz</a> || 
00354       (t &gt;= old-&gt;<a class="code" href="structStrRep.html#m2">s</a> &amp;&amp; t &lt; &amp;(old-&gt;<a class="code" href="structStrRep.html#m2">s</a>[old-&gt;<a class="code" href="structStrRep.html#m0">len</a>])) ||
00355       (u &gt;= old-&gt;<a class="code" href="structStrRep.html#m2">s</a> &amp;&amp; u &lt; &amp;(old-&gt;<a class="code" href="structStrRep.html#m2">s</a>[old-&gt;<a class="code" href="structStrRep.html#m0">len</a>])))
00356     rep = Snew(newlen);
00357   <font class="keywordflow">else</font>
00358     rep = old;
00359 
00360   rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = newlen;
00361 
00362   ncopy(s, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, srclen);
00363   ncopy(t, &amp;(rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[srclen]), tlen);
00364   ncopy0(u, &amp;(rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[srclen+tlen]), ulen);
00365 
00366   <font class="keywordflow">if</font> (old != rep &amp;&amp; old != 0) <font class="keyword">delete</font> old;
00367 
00368   <font class="keywordflow">return</font> rep;
00369 }
00370 
00371 <font class="comment">// like cat, but we know that new stuff goes in the front of existing rep</font>
00372 
<a name="l00373"></a><a class="code" href="BigString_8cc.html#a21">00373</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a21">Sprepend</a>(<a class="code" href="structStrRep.html">StrRep</a>* old, <font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen)
00374 {
00375   <font class="keywordtype">char</font>* s;
00376   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> srclen;
00377   <font class="keywordflow">if</font> (old == &amp;_nilStrRep || old == 0)
00378   {
00379     s = 0; old = 0; srclen = 0;
00380   }
00381   <font class="keywordflow">else</font>
00382   {
00383     s = old-&gt;<a class="code" href="structStrRep.html#m2">s</a>; srclen = old-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
00384   }
00385   <font class="keywordflow">if</font> (tlen &lt; 0) tlen = slen(t);
00386   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> newlen = srclen + tlen;
00387   <a class="code" href="structStrRep.html">StrRep</a>* rep;
00388   <font class="keywordflow">if</font> (old == 0 || newlen &gt; old-&gt;<a class="code" href="structStrRep.html#m1">sz</a> || 
00389       (t &gt;= old-&gt;<a class="code" href="structStrRep.html#m2">s</a> &amp;&amp; t &lt; &amp;(old-&gt;<a class="code" href="structStrRep.html#m2">s</a>[old-&gt;<a class="code" href="structStrRep.html#m0">len</a>])))
00390     rep = Snew(newlen);
00391   <font class="keywordflow">else</font>
00392     rep = old;
00393 
00394   rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = newlen;
00395 
00396   revcopy(&amp;(s[srclen]), &amp;(rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[newlen]), srclen+1);
00397   ncopy(t, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, tlen);
00398 
00399   <font class="keywordflow">if</font> (old != rep &amp;&amp; old != 0) <font class="keyword">delete</font> old;
00400 
00401   <font class="keywordflow">return</font> rep;
00402 }
00403 
00404 
00405 <font class="comment">// string compare: first argument is known to be non-null</font>
00406 
00407 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">int</font> scmp(<font class="keyword">const</font> <font class="keywordtype">char</font>* a, <font class="keyword">const</font> <font class="keywordtype">char</font>* b)
00408 {
00409   <font class="keywordflow">if</font> (b == 0)
00410     <font class="keywordflow">return</font> *a != 0;
00411   <font class="keywordflow">else</font>
00412   {
00413     <font class="keywordtype">int</font> diff = 0;
00414     <font class="keywordflow">while</font> ((diff = *a - *b++) == 0 &amp;&amp; *a++ != 0);
00415     <font class="keywordflow">return</font> diff;
00416   }
00417 }
00418 
00419 
00420 <font class="keyword">inline</font> <font class="keyword">static</font> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> ncmp(<font class="keyword">const</font> <font class="keywordtype">char</font>* a, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> al, <font class="keyword">const</font> <font class="keywordtype">char</font>* b,<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> bl)
00421 {
00422   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n = (al &lt;= bl)? al : bl;
00423   <font class="keywordtype">int</font> diff;
00424   <font class="keywordflow">while</font> (n-- &gt; 0) <font class="keywordflow">if</font> ((diff = *a++ - *b++) != 0) <font class="keywordflow">return</font> diff;
00425   <font class="keywordflow">return</font> al - bl;
00426 }
00427 
<a name="l00428"></a><a class="code" href="BigString_8cc.html#a24">00428</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a24">fcompare</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y)
00429 {
00430   <font class="keyword">const</font> <font class="keywordtype">char</font>* a = x.<a class="code" href="classString.html#a104">chars</a>();
00431   <font class="keyword">const</font> <font class="keywordtype">char</font>* b = y.<a class="code" href="classString.html#a104">chars</a>();
00432   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> al = x.<a class="code" href="classString.html#a105">length</a>();
00433   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> bl = y.<a class="code" href="classString.html#a105">length</a>();
00434   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n = (al &lt;= bl)? al : bl;
00435   <font class="keywordtype">int</font> diff = 0;
00436   <font class="keywordflow">while</font> (n-- &gt; 0)
00437   {
00438     <font class="keywordtype">char</font> ac = *a++;
00439     <font class="keywordtype">char</font> bc = *b++;
00440     <font class="keywordflow">if</font> ((diff = ac - bc) != 0)
00441     {
00442       <font class="keywordflow">if</font> (ac &gt;= <font class="charliteral">'a'</font> &amp;&amp; ac &lt;= <font class="charliteral">'z'</font>)
00443         ac = ac - <font class="charliteral">'a'</font> + <font class="charliteral">'A'</font>;
00444       <font class="keywordflow">if</font> (bc &gt;= <font class="charliteral">'a'</font> &amp;&amp; bc &lt;= <font class="charliteral">'z'</font>)
00445         bc = bc - <font class="charliteral">'a'</font> + <font class="charliteral">'A'</font>;
00446       <font class="keywordflow">if</font> ((diff = ac - bc) != 0)
00447         <font class="keywordflow">return</font> diff;
00448     }
00449   }
00450   <font class="keywordflow">return</font> al - bl;
00451 }
00452 
00453 <font class="comment">// these are not inline, but pull in the above inlines, so are </font>
00454 <font class="comment">// pretty fast</font>
00455 
<a name="l00456"></a><a class="code" href="BigString_8cc.html#a25">00456</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a30">compare</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; x, <font class="keyword">const</font> <font class="keywordtype">char</font>* b)
00457 {
00458   <font class="keywordflow">return</font> scmp(x.<a class="code" href="classString.html#a104">chars</a>(), b);
00459 }
00460 
<a name="l00461"></a><a class="code" href="BigString_8cc.html#a26">00461</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a30">compare</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y)
00462 {
00463   <font class="keywordflow">return</font> scmp(x.<a class="code" href="classString.html#a104">chars</a>(), y.<a class="code" href="classString.html#a104">chars</a>());
00464 }
00465 
<a name="l00466"></a><a class="code" href="BigString_8cc.html#a27">00466</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a30">compare</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y)
00467 {
00468   <font class="keywordflow">return</font> ncmp(x.<a class="code" href="classString.html#a104">chars</a>(), x.<a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>());
00469 }
00470 
<a name="l00471"></a><a class="code" href="BigString_8cc.html#a28">00471</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a30">compare</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y)
00472 {
00473   <font class="keywordflow">return</font> ncmp(x.<a class="code" href="classSubString.html#a13">chars</a>(), x.<a class="code" href="classSubString.html#a11">length</a>(), y.<a class="code" href="classString.html#a104">chars</a>(), y.<a class="code" href="classString.html#a105">length</a>());
00474 }
00475 
<a name="l00476"></a><a class="code" href="BigString_8cc.html#a29">00476</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a30">compare</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y)
00477 {
00478   <font class="keywordflow">return</font> ncmp(x.<a class="code" href="classSubString.html#a13">chars</a>(), x.<a class="code" href="classSubString.html#a11">length</a>(), y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>());
00479 }
00480 
<a name="l00481"></a><a class="code" href="BigString_8cc.html#a30">00481</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a30">compare</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; x, <font class="keyword">const</font> <font class="keywordtype">char</font>* b)
00482 {
00483   <font class="keywordflow">if</font> (b == 0)
00484     <font class="keywordflow">return</font> x.<a class="code" href="classSubString.html#a11">length</a>();
00485   <font class="keywordflow">else</font>
00486   {
00487     <font class="keyword">const</font> <font class="keywordtype">char</font>* a = x.<a class="code" href="classSubString.html#a13">chars</a>();
00488     <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n = x.<a class="code" href="classSubString.html#a11">length</a>();
00489     <font class="keywordtype">int</font> diff;
00490     <font class="keywordflow">while</font> (n-- &gt; 0) <font class="keywordflow">if</font> ((diff = *a++ - *b++) != 0) <font class="keywordflow">return</font> diff;
00491     <font class="keywordflow">return</font> (*b == 0) ? 0 : -1;
00492   }
00493 }
00494 
00495 <font class="comment">/*</font>
00496 <font class="comment"> index fcts</font>
00497 <font class="comment">*/</font>
00498 
<a name="l00499"></a><a class="code" href="classString.html#b1">00499</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#b0">String::search</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> start, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> sl, <font class="keywordtype">char</font> c)<font class="keyword"> const</font>
00500 <font class="keyword"></font>{
00501   <font class="keyword">const</font> <font class="keywordtype">char</font>* s = <a class="code" href="classString.html#a104">chars</a>();
00502   <font class="keywordflow">if</font> (sl &gt; 0)
00503   {
00504     <font class="keywordflow">if</font> (start &gt;= 0)
00505     {
00506       <font class="keyword">const</font> <font class="keywordtype">char</font>* a = &amp;(s[start]);
00507       <font class="keyword">const</font> <font class="keywordtype">char</font>* lasta = &amp;(s[sl]);
00508       <font class="keywordflow">while</font> (a &lt; lasta) <font class="keywordflow">if</font> (*a++ == c) <font class="keywordflow">return</font> --a - s;
00509     }
00510     <font class="keywordflow">else</font>
00511     {
00512       <font class="keyword">const</font> <font class="keywordtype">char</font>* a = &amp;(s[sl + start + 1]);
00513       <font class="keywordflow">while</font> (--a &gt;= s) <font class="keywordflow">if</font> (*a == c) <font class="keywordflow">return</font> a - s;
00514     }
00515   }
00516   <font class="keywordflow">return</font> -1;
00517 }
00518 
<a name="l00519"></a><a class="code" href="classString.html#b0">00519</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#b0">String::search</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> start, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> sl, <font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tl)<font class="keyword"> const</font>
00520 <font class="keyword"></font>{
00521   <font class="keyword">const</font> <font class="keywordtype">char</font>* s = <a class="code" href="classString.html#a104">chars</a>();
00522   <font class="keywordflow">if</font> (tl &lt; 0) tl = slen(t);
00523   <font class="keywordflow">if</font> (sl &gt; 0 &amp;&amp; tl &gt; 0)
00524   {
00525     <font class="keywordflow">if</font> (start &gt;= 0)
00526     {
00527       <font class="keyword">const</font> <font class="keywordtype">char</font>* lasts = &amp;(s[sl - tl]);
00528       <font class="keyword">const</font> <font class="keywordtype">char</font>* lastt = &amp;(t[tl]);
00529       <font class="keyword">const</font> <font class="keywordtype">char</font>* p = &amp;(s[start]);
00530 
00531       <font class="keywordflow">while</font> (p &lt;= lasts)
00532       {
00533         <font class="keyword">const</font> <font class="keywordtype">char</font>* x = p++;
00534         <font class="keyword">const</font> <font class="keywordtype">char</font>* y = t;
00535         <font class="keywordflow">while</font> (*x++ == *y++) <font class="keywordflow">if</font> (y &gt;= lastt) <font class="keywordflow">return</font> --p - s;
00536       }
00537     }
00538     <font class="keywordflow">else</font>
00539     {
00540       <font class="keyword">const</font> <font class="keywordtype">char</font>* firsts = &amp;(s[tl - 1]);
00541       <font class="keyword">const</font> <font class="keywordtype">char</font>* lastt =  &amp;(t[tl - 1]);
00542       <font class="keyword">const</font> <font class="keywordtype">char</font>* p = &amp;(s[sl + start + 1]); 
00543 
00544       <font class="keywordflow">while</font> (--p &gt;= firsts)
00545       {
00546         <font class="keyword">const</font> <font class="keywordtype">char</font>* x = p;
00547         <font class="keyword">const</font> <font class="keywordtype">char</font>* y = lastt;
00548         <font class="keywordflow">while</font> (*x-- == *y--) <font class="keywordflow">if</font> (y &lt; t) <font class="keywordflow">return</font> ++x - s;
00549       }
00550     }
00551   }
00552   <font class="keywordflow">return</font> -1;
00553 }
00554 
<a name="l00555"></a><a class="code" href="classString.html#b2">00555</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#b2">String::match</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> start, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> sl, <font class="keywordtype">int</font> exact, <font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tl)<font class="keyword"> const</font>
00556 <font class="keyword"></font>{
00557   <font class="keywordflow">if</font> (tl &lt; 0) tl = slen(t);
00558 
00559   <font class="keywordflow">if</font> (start &lt; 0)
00560   {
00561     start = sl + start - tl + 1;
00562     <font class="keywordflow">if</font> (start &lt; 0 || (exact &amp;&amp; start != 0))
00563       <font class="keywordflow">return</font> -1;
00564   }
00565   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (exact &amp;&amp; sl - start != tl)
00566     <font class="keywordflow">return</font> -1;
00567 
00568   <font class="keywordflow">if</font> (sl == 0 || tl == 0 || sl - start &lt; tl || start &gt;= sl)
00569     <font class="keywordflow">return</font> -1;
00570 
00571   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n = tl;
00572   <font class="keyword">const</font> <font class="keywordtype">char</font>* s = &amp;(rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[start]);
00573   <font class="keywordflow">while</font> (--n &gt;= 0) <font class="keywordflow">if</font> (*s++ != *t++) <font class="keywordflow">return</font> -1;
00574   <font class="keywordflow">return</font> tl;
00575 }
00576 
<a name="l00577"></a><a class="code" href="classSubString.html#b0">00577</a> <font class="keywordtype">void</font> <a class="code" href="classSubString.html#b0">SubString::assign</a>(<font class="keyword">const</font> <a class="code" href="structStrRep.html">StrRep</a>* ysrc, <font class="keyword">const</font> <font class="keywordtype">char</font>* ys, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> ylen)
00578 { <font class="comment">// INVOLVED in lfstr.at(...) = ...</font>
00579   <font class="keywordflow">if</font> (&amp;<a class="code" href="classSubString.html#n0">S</a> == &amp;_nilString) <font class="keywordflow">return</font>;
00580 
00581   <font class="keywordflow">if</font> (ylen &lt; 0) ylen = slen(ys);
00582   <a class="code" href="structStrRep.html">StrRep</a>* targ = <a class="code" href="classSubString.html#n0">S</a>.<a class="code" href="classString.html#n0">rep</a>;
00583   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> sl = targ-&gt;<a class="code" href="structStrRep.html#m0">len</a> - <a class="code" href="classSubString.html#n2">len</a> + ylen;
00584 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00585 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (ysrc-&gt;debugop) cerr &lt;&lt; <font class="stringliteral">"Target String length = "</font> &lt;&lt; targ-&gt;<a class="code" href="structStrRep.html#m0">len</a> &lt;&lt; <font class="stringliteral">", Substring length = "</font> &lt;&lt; <a class="code" href="classSubString.html#n2">len</a> &lt;&lt; <font class="stringliteral">", assigned length = "</font> &lt;&lt; ylen &lt;&lt; <font class="stringliteral">", sl = "</font> &lt;&lt; sl &lt;&lt; <font class="charliteral">'\n'</font>;
00586 <font class="preprocessor">#endif</font>
00587 <font class="preprocessor"></font>
00588   <font class="keywordflow">if</font> (ysrc == targ || sl &gt;= targ-&gt;<a class="code" href="structStrRep.html#m1">sz</a>)
00589   {
00590 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00591 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (ysrc-&gt;debugop) cerr &lt;&lt; <font class="stringliteral">"Assigning new String chunk.\n"</font>;
00592 <font class="preprocessor">#endif</font>
00593 <font class="preprocessor"></font>    <a class="code" href="structStrRep.html">StrRep</a>* oldtarg = targ;
00594     targ = Sresize(0, sl);
00595     ncopy(oldtarg-&gt;<a class="code" href="structStrRep.html#m2">s</a>, targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>, <a class="code" href="classSubString.html#n1">pos</a>);
00596     ncopy(ys, &amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[<a class="code" href="classSubString.html#n1">pos</a>]), ylen);
00597     scopy(&amp;(oldtarg-&gt;<a class="code" href="structStrRep.html#m2">s</a>[<a class="code" href="classSubString.html#n1">pos</a> + <a class="code" href="classSubString.html#n2">len</a>]), &amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[<a class="code" href="classSubString.html#n1">pos</a> + ylen]));
00598     <font class="keyword">delete</font> oldtarg;
00599   }
00600   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="classSubString.html#n2">len</a> == ylen)
00601 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00602 <font class="preprocessor"></font>        {
00603                 <font class="keywordflow">if</font> (ysrc-&gt;debugop) cerr &lt;&lt; <font class="stringliteral">"Replacing with equal length.\n"</font>;
00604 <font class="preprocessor">#endif</font>
00605 <font class="preprocessor"></font>    ncopy(ys, &amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[<a class="code" href="classSubString.html#n1">pos</a>]), <a class="code" href="classSubString.html#n2">len</a>);
00606 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00607 <font class="preprocessor"></font>        }
00608 <font class="preprocessor">#endif</font>
00609 <font class="preprocessor"></font>  <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ylen &lt; <a class="code" href="classSubString.html#n2">len</a>)
00610   {
00611 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00612 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (ysrc-&gt;debugop) cerr &lt;&lt; <font class="stringliteral">"New substring is shorter.\n"</font>;
00613 <font class="preprocessor">#endif</font>
00614 <font class="preprocessor"></font>    ncopy(ys, &amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[<a class="code" href="classSubString.html#n1">pos</a>]), ylen);
00615     scopy(&amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[<a class="code" href="classSubString.html#n1">pos</a> + <a class="code" href="classSubString.html#n2">len</a>]), &amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[<a class="code" href="classSubString.html#n1">pos</a> + ylen]));
00616   }
00617   <font class="keywordflow">else</font>
00618   {
00619 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00620 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (ysrc-&gt;debugop) cerr &lt;&lt; <font class="stringliteral">"New substring is longer, in same chunk.\n"</font>;
00621 <font class="preprocessor">#endif</font>
00622 <font class="preprocessor"></font>    revcopy(&amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[targ-&gt;<a class="code" href="structStrRep.html#m0">len</a>]), &amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[sl]), targ-&gt;<a class="code" href="structStrRep.html#m0">len</a>-<a class="code" href="classSubString.html#n1">pos</a>-<a class="code" href="classSubString.html#n2">len</a> +1);
00623     ncopy(ys, &amp;(targ-&gt;<a class="code" href="structStrRep.html#m2">s</a>[<a class="code" href="classSubString.html#n1">pos</a>]), ylen);
00624   }
00625 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00626 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (ysrc-&gt;debugop) cerr &lt;&lt; <font class="stringliteral">"New string length = "</font> &lt;&lt; sl &lt;&lt; <font class="charliteral">'\n'</font>;
00627 <font class="preprocessor">#endif</font>
00628 <font class="preprocessor"></font>  targ-&gt;<a class="code" href="structStrRep.html#m0">len</a> = sl;
00629   <a class="code" href="classSubString.html#n0">S</a>.<a class="code" href="classString.html#n0">rep</a> = targ;
00630 }
00631 
00632 
00633 
00634 <font class="comment">/*</font>
00635 <font class="comment"> * substitution</font>
00636 <font class="comment"> */</font>
00637 
00638 
<a name="l00639"></a><a class="code" href="classString.html#b3">00639</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#b3">String::_gsub</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* pat, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pl, <font class="keyword">const</font> <font class="keywordtype">char</font>* r, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> rl)
00640 {
00641   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> nmatches = 0;
00642   <font class="keywordflow">if</font> (pl &lt; 0) pl = slen(pat);
00643   <font class="keywordflow">if</font> (rl &lt; 0) rl = slen(r);
00644   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> sl = <a class="code" href="classString.html#a105">length</a>();
00645   <font class="keywordflow">if</font> (sl &lt;= 0 || pl &lt;= 0 || sl &lt; pl)
00646     <font class="keywordflow">return</font> nmatches;
00647   
00648   <font class="keyword">const</font> <font class="keywordtype">char</font>* s = <a class="code" href="classString.html#a104">chars</a>();
00649 
00650   <font class="comment">// prepare to make new rep</font>
00651   <a class="code" href="structStrRep.html">StrRep</a>* nrep = 0;
00652   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> nsz = 0;
00653   <font class="keywordtype">char</font>* x = 0;
00654 
00655   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> si = 0;
00656   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> xi = 0;
00657   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> remaining = sl;
00658 
00659   <font class="keywordflow">while</font> (remaining &gt;= pl)
00660   {
00661     <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pos = <a class="code" href="classString.html#b0">search</a>(si, sl, pat, pl);
00662     <font class="keywordflow">if</font> (pos &lt; 0)
00663       <font class="keywordflow">break</font>;
00664     <font class="keywordflow">else</font>
00665     {
00666       ++nmatches;
00667       <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> mustfit = xi + remaining + rl - pl;
00668       <font class="keywordflow">if</font> (mustfit &gt;= nsz)
00669       {
00670         <font class="keywordflow">if</font> (nrep != 0) nrep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = xi;
00671         nrep = Sresize(nrep, mustfit);
00672         nsz = nrep-&gt;<a class="code" href="structStrRep.html#m1">sz</a>;
00673         x = nrep-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
00674       }
00675       pos -= si;
00676       ncopy(&amp;(s[si]), &amp;(x[xi]), pos);
00677       ncopy(r, &amp;(x[xi + pos]), rl);
00678       si += pos + pl;
00679       remaining -= pos + pl;
00680       xi += pos + rl;
00681     }
00682   }
00683 
00684   <font class="keywordflow">if</font> (nrep == 0)
00685   {
00686     <font class="keywordflow">if</font> (nmatches == 0)
00687       <font class="keywordflow">return</font> nmatches;
00688     <font class="keywordflow">else</font>
00689       nrep = Sresize(nrep, xi+remaining);
00690   }
00691 
00692   ncopy0(&amp;(s[si]), &amp;(x[xi]), remaining);
00693   nrep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = xi + remaining;
00694 
00695   <font class="keywordflow">if</font> (nrep-&gt;<a class="code" href="structStrRep.html#m0">len</a> &lt;= rep-&gt;<a class="code" href="structStrRep.html#m1">sz</a>)   <font class="comment">// fit back in if possible</font>
00696   {
00697     rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = nrep-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
00698     ncopy0(nrep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, rep-&gt;<a class="code" href="structStrRep.html#m0">len</a>);
00699     <font class="keyword">delete</font>(nrep);
00700   }
00701   <font class="keywordflow">else</font>
00702   {
00703     <font class="keyword">delete</font>(rep);
00704     rep = nrep;
00705   }
00706   <font class="keywordflow">return</font> nmatches;
00707 }
00708 
<a name="l00709"></a><a class="code" href="classString.html#b4">00709</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#b3">String::_gsub</a>(<font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a>&amp; pat, <font class="keyword">const</font> <font class="keywordtype">char</font>* r, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> rl, <font class="keywordtype">char</font> substrs = <font class="charliteral">'\0'</font>) { 
00710 <font class="comment">// when substrs is not '\0', substring identifiers</font>
00711 <font class="comment">// 'substrs'1,'substrs'2, etc. can be used in the replace string</font>
00712   <font class="keywordtype">char</font> * rloc;
00713   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> nsubstrs = 0, *substrrl, subrl = 0;
00714   <font class="keywordtype">int</font> * substrid;
00715   <font class="keywordtype">char</font> ** substridx;
00716   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> nmatches = 0;
00717   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> sl = <a class="code" href="classString.html#a105">length</a>();
00718   <font class="keywordflow">if</font> (sl &lt;= 0)
00719     <font class="keywordflow">return</font> nmatches;
00720 
00721   <font class="keywordflow">if</font> (rl &lt; 0) rl = slen(r);
00722   <font class="keywordflow">if</font> (substrs!=<font class="charliteral">'\0'</font>) {
00723                 <font class="comment">// (* could increase array lengths, since the number</font>
00724                 <font class="comment">// of times a subexpression can occur in the replacement</font>
00725                 <font class="comment">// string is not dependent on the maximum number of</font>
00726                 <font class="comment">// subexpressions)</font>
00727                 substridx = <font class="keyword">new</font> (<font class="keywordtype">char</font> *)[<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>];
00728                 substrrl = <font class="keyword">new</font> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a>[<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>];
00729                 substrid = <font class="keyword">new</font> <font class="keywordtype">int</font>[<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>]; <font class="comment">// we don't use substrid[0]</font>
00730                 <font class="comment">// copy replacement string</font>
00731                 rloc = <font class="keyword">new</font> <font class="keywordtype">char</font>[rl+1];
00732                 ncopy(r,rloc,rl+1);
00733                 <font class="comment">// create substrings and store indices</font>
00734                 substridx[0] = rloc;
00735                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;rl; i++) <font class="keywordflow">if</font> ((rloc[i]==substrs) &amp;&amp; (nsubstrs&lt;(<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>-1))) {
00736                         <font class="keywordtype">long</font> a = strtol(&amp;rloc[i+1],&amp;(substridx[nsubstrs+1]),10);
00737                         <font class="keywordflow">if</font> ((a&gt;=0) &amp;&amp; (a&lt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>)) {
00738                                 rloc[i] = <font class="charliteral">'\0'</font>;
00739                                 substrrl[nsubstrs] = (_BIGSTRING_SIZE) (&amp;(rloc[i]) - substridx[nsubstrs]);
00740                                 subrl += substrrl[nsubstrs];
00741                                 nsubstrs++;
00742                                 substrid[nsubstrs] = a;
00743                         } <font class="keywordflow">else</font> rloc[i] = r[i];
00744                 } <font class="keywordflow">else</font> rloc[i] = r[i];
00745                 substrrl[nsubstrs] = (_BIGSTRING_SIZE) (&amp;(rloc[rl]) - substridx[nsubstrs]);
00746                 subrl += substrrl[nsubstrs];
00747   }
00748   <font class="keyword">const</font> <font class="keywordtype">char</font>* s = <a class="code" href="classString.html#a104">chars</a>();
00749 
00750   <a class="code" href="structStrRep.html">StrRep</a>* nrep = 0;
00751   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> nsz = 0;
00752 
00753   <font class="keywordtype">char</font>* x = 0;
00754 
00755   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> si = 0;
00756   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> xi = 0;
00757   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> remaining = sl;
00758   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a>  pos, pl = 0;   <font class="comment">// how long is a regular expression?</font>
00759   <font class="keywordtype">int</font> start, <a class="code" href="classString.html#a105">length</a>;
00760 
00761   <font class="keywordflow">while</font> (remaining &gt; 0)
00762   {
00763     pos = pat.<a class="code" href="classBigRegex.html#a3">search</a>(s, sl, pl, si); <font class="comment">// unlike string search, the pos returned here is absolute</font>
00764     <font class="keywordflow">if</font> (pos &lt; 0 || pl &lt;= 0)
00765       <font class="keywordflow">break</font>;    <font class="comment">// done if not found</font>
00766     <font class="keywordflow">else</font>
00767     {   <font class="comment">// found match</font>
00768       ++nmatches;
00769          <font class="keywordflow">if</font> (substrs!=<font class="charliteral">'\0'</font>) { <font class="comment">// rl depends on matched substring sizes</font>
00770                 rl = subrl;
00771                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=1; i&lt;=nsubstrs; i++) <font class="keywordflow">if</font> (pat.<a class="code" href="classBigRegex.html#a4">match_info</a>(start,<a class="code" href="classString.html#a105">length</a>,substrid[i])) rl += <a class="code" href="classString.html#a105">length</a>;
00772          }
00773       <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> mustfit = xi + remaining + rl - pl;
00774       <font class="keywordflow">if</font> (mustfit &gt;= nsz)
00775       { <font class="comment">// resize destination if necessary</font>
00776         <font class="keywordflow">if</font> (nrep != 0) nrep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = xi;
00777         nrep = Sresize(nrep, mustfit);
00778         x = nrep-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
00779         nsz = nrep-&gt;<a class="code" href="structStrRep.html#m1">sz</a>;
00780       }
00781       pos -= si;        <font class="comment">// length to copy before match</font>
00782       ncopy(&amp;(s[si]), &amp;(x[xi]), pos);   <font class="comment">// copy unmatched part</font>
00783       si += pos + pl;   <font class="comment">// advance source index</font>
00784       remaining -= pos + pl;    <font class="comment">// subtract amount searched and matched</font>
00785          xi += pos;     <font class="comment">// advance destination index</font>
00786          <font class="keywordflow">if</font> (substrs==<font class="charliteral">'\0'</font>) {
00787                 ncopy(r, &amp;(x[xi]), rl); <font class="comment">// paste replacement string</font>
00788                 xi += rl;       <font class="comment">// advance destination index</font>
00789         } <font class="keywordflow">else</font> {
00790                 ncopy(substridx[0], &amp;(x[xi]), substrrl[0]); xi += substrrl[0];
00791                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=1; i&lt;=nsubstrs; i++) {
00792                         <font class="keywordflow">if</font> (pat.<a class="code" href="classBigRegex.html#a4">match_info</a>(start,<a class="code" href="classString.html#a105">length</a>,substrid[i])) {
00793                                 ncopy(&amp;(s[start]),&amp;(x[xi]),<a class="code" href="classString.html#a105">length</a>);
00794                                 xi += <a class="code" href="classString.html#a105">length</a>;
00795                         }
00796                         ncopy(substridx[i],&amp;(x[xi]), substrrl[i]); xi += substrrl[i];
00797                 }
00798          }
00799     }
00800   }
00801 
00802   <font class="keywordflow">if</font> (substrs!=<font class="charliteral">'\0'</font>) {
00803         <font class="keyword">delete</font>[] substridx;
00804         <font class="keyword">delete</font>[] substrrl;
00805         <font class="keyword">delete</font>[] substrid;
00806         <font class="keyword">delete</font>[] rloc;
00807   }
00808 
00809   <font class="keywordflow">if</font> (nrep == 0)
00810   {
00811     <font class="keywordflow">if</font> (nmatches == 0)
00812       <font class="keywordflow">return</font> nmatches;
00813     <font class="keywordflow">else</font>
00814       nrep = Sresize(nrep, xi+remaining); <font class="comment">// allocate to fit remaining</font>
00815   }
00816 
00817   ncopy0(&amp;(s[si]), &amp;(x[xi]), remaining);        <font class="comment">// copy remainder of source</font>
00818   nrep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = xi + remaining;
00819 
00820 <font class="preprocessor">#ifndef BIGSTRING_MAXIMIZE_SPEED</font>
00821 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (nrep-&gt;<a class="code" href="structStrRep.html#m0">len</a> &lt;= rep-&gt;<a class="code" href="structStrRep.html#m1">sz</a>)
00822   {
00823     rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = nrep-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
00824     ncopy0(nrep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>, rep-&gt;<a class="code" href="structStrRep.html#m0">len</a>);
00825     <font class="keyword">delete</font>(nrep);
00826   }
00827   <font class="keywordflow">else</font>
00828   {
00829 <font class="preprocessor">#endif</font>
00830 <font class="preprocessor"></font>    <font class="keyword">delete</font>(rep);
00831     rep = nrep;
00832 <font class="preprocessor">#ifndef BIGSTRING_MAXIMIZE_SPEED</font>
00833 <font class="preprocessor"></font>  }
00834 <font class="preprocessor">#endif</font>
00835 <font class="preprocessor"></font>  <font class="keywordflow">return</font> nmatches;
00836 }
00837 
00838 
00839 <font class="comment">/*</font>
00840 <font class="comment"> * deletion</font>
00841 <font class="comment"> */</font>
00842 
<a name="l00843"></a><a class="code" href="classString.html#a83">00843</a> <font class="keywordtype">void</font> <a class="code" href="classString.html#a83">String::del</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pos, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> len)
00844 {
00845   <font class="keywordflow">if</font> (pos &lt; 0 || len &lt;= 0 || (unsigned)(pos + len) &gt; <a class="code" href="classString.html#a105">length</a>()) <font class="keywordflow">return</font>;
00846   <a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> nlen = <a class="code" href="classString.html#a105">length</a>() - len;
00847   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = pos + len;
00848   ncopy0(&amp;(rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[first]), &amp;(rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[pos]), <a class="code" href="classString.html#a105">length</a>() - first);
00849   rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> = nlen;
00850 }
00851 
<a name="l00852"></a><a class="code" href="classString.html#a88">00852</a> <font class="keywordtype">void</font> <a class="code" href="classString.html#a83">String::del</a>(<font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a>&amp; r, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00853 {
00854   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> mlen;
00855   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = r.<a class="code" href="classBigRegex.html#a3">search</a>(<a class="code" href="classString.html#a104">chars</a>(), <a class="code" href="classString.html#a105">length</a>(), mlen, startpos);
00856   <a class="code" href="classString.html#a83">del</a>(first, mlen);
00857 }
00858 
<a name="l00859"></a><a class="code" href="classString.html#a86">00859</a> <font class="keywordtype">void</font> <a class="code" href="classString.html#a83">String::del</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00860 {
00861   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen = slen(t);
00862   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> p = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), t, tlen);
00863   <a class="code" href="classString.html#a83">del</a>(p, tlen);
00864 }
00865 
<a name="l00866"></a><a class="code" href="classString.html#a84">00866</a> <font class="keywordtype">void</font> <a class="code" href="classString.html#a83">String::del</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00867 {
00868   <a class="code" href="classString.html#a83">del</a>(<a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classString.html#a104">chars</a>(), y.<a class="code" href="classString.html#a105">length</a>()), y.<a class="code" href="classString.html#a105">length</a>());
00869 }
00870 
<a name="l00871"></a><a class="code" href="classString.html#a85">00871</a> <font class="keywordtype">void</font> <a class="code" href="classString.html#a83">String::del</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00872 {
00873   <a class="code" href="classString.html#a83">del</a>(<a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>()), y.<a class="code" href="classSubString.html#a11">length</a>());
00874 }
00875 
<a name="l00876"></a><a class="code" href="classString.html#a87">00876</a> <font class="keywordtype">void</font> <a class="code" href="classString.html#a83">String::del</a>(<font class="keywordtype">char</font> c, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00877 {
00878   <a class="code" href="classString.html#a83">del</a>(<a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), c), 1);
00879 }
00880 
00881 <font class="comment">/*</font>
00882 <font class="comment"> * substring extraction</font>
00883 <font class="comment"> */</font>
00884 
00885 
<a name="l00886"></a><a class="code" href="classString.html#a51">00886</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a51">String::at</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> len)
00887 {
00888   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, len);
00889 }
00890 
<a name="l00891"></a><a class="code" href="classString.html#a52">00891</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a52">String::operator() </a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> len)
00892 {
00893   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, len);
00894 }
00895 
<a name="l00896"></a><a class="code" href="classString.html#a58">00896</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a58">String::before</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pos)
00897 {
00898   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, pos);
00899 }
00900 
<a name="l00901"></a><a class="code" href="classString.html#a64">00901</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a64">String::through</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pos)
00902 {
00903   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, pos+1);
00904 }
00905 
<a name="l00906"></a><a class="code" href="classString.html#a76">00906</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a76">String::after</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pos)
00907 {
00908   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(pos + 1, <a class="code" href="classString.html#a105">length</a>() - (pos + 1));
00909 }
00910 
<a name="l00911"></a><a class="code" href="classString.html#a70">00911</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a70">String::from</a>(<a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pos)
00912 {
00913   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(pos, <a class="code" href="classString.html#a105">length</a>() - pos);
00914 }
00915 
<a name="l00916"></a><a class="code" href="classString.html#a53">00916</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a51">String::at</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00917 {
00918   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classString.html#a104">chars</a>(), y.<a class="code" href="classString.html#a105">length</a>());
00919   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first,  y.<a class="code" href="classString.html#a105">length</a>());
00920 }
00921 
<a name="l00922"></a><a class="code" href="classString.html#a54">00922</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a51">String::at</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00923 {
00924   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>());
00925   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, y.<a class="code" href="classSubString.html#a11">length</a>());
00926 }
00927 
<a name="l00928"></a><a class="code" href="classString.html#a57">00928</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a51">String::at</a>(<font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a>&amp; r, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00929 {
00930   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> mlen;
00931   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = r.<a class="code" href="classBigRegex.html#a3">search</a>(<a class="code" href="classString.html#a104">chars</a>(), <a class="code" href="classString.html#a105">length</a>(), mlen, startpos);
00932   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, mlen); <font class="comment">// INVOLVED in lfstr.at(...) = ...</font>
00933 }
00934 
<a name="l00935"></a><a class="code" href="classString.html#a55">00935</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a51">String::at</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00936 {
00937   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen = slen(t);
00938   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), t, tlen);
00939   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, tlen);
00940 }
00941 
<a name="l00942"></a><a class="code" href="classString.html#a56">00942</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a51">String::at</a>(<font class="keywordtype">char</font> c, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00943 {
00944   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), c);
00945   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, 1);
00946 }
00947 
<a name="l00948"></a><a class="code" href="classString.html#a59">00948</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a58">String::before</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00949 {
00950   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> last = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classString.html#a104">chars</a>(), y.<a class="code" href="classString.html#a105">length</a>());
00951   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, last);
00952 }
00953 
<a name="l00954"></a><a class="code" href="classString.html#a60">00954</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a58">String::before</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00955 {
00956   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> last = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>());
00957   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, last);
00958 }
00959 
<a name="l00960"></a><a class="code" href="classString.html#a63">00960</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a58">String::before</a>(<font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a>&amp; r, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00961 {
00962   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> mlen;
00963   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = r.<a class="code" href="classBigRegex.html#a3">search</a>(<a class="code" href="classString.html#a104">chars</a>(), <a class="code" href="classString.html#a105">length</a>(), mlen, startpos);
00964   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, first);
00965 }
00966 
<a name="l00967"></a><a class="code" href="classString.html#a62">00967</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a58">String::before</a>(<font class="keywordtype">char</font> c, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00968 {
00969   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> last = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), c);
00970   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, last);
00971 }
00972 
<a name="l00973"></a><a class="code" href="classString.html#a61">00973</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a58">String::before</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00974 {
00975   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen = slen(t);
00976   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> last = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), t, tlen);
00977   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, last);
00978 }
00979 
<a name="l00980"></a><a class="code" href="classString.html#a65">00980</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a64">String::through</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00981 {
00982   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> last = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classString.html#a104">chars</a>(), y.<a class="code" href="classString.html#a105">length</a>());
00983   <font class="keywordflow">if</font> (last &gt;= 0) last += y.<a class="code" href="classString.html#a105">length</a>();
00984   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, last);
00985 }
00986 
<a name="l00987"></a><a class="code" href="classString.html#a66">00987</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a64">String::through</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00988 {
00989   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> last = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>());
00990   <font class="keywordflow">if</font> (last &gt;= 0) last += y.<a class="code" href="classSubString.html#a11">length</a>();
00991   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, last);
00992 }
00993 
<a name="l00994"></a><a class="code" href="classString.html#a69">00994</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a64">String::through</a>(<font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a>&amp; r, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
00995 {
00996   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> mlen;
00997   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = r.<a class="code" href="classBigRegex.html#a3">search</a>(<a class="code" href="classString.html#a104">chars</a>(), <a class="code" href="classString.html#a105">length</a>(), mlen, startpos);
00998   <font class="keywordflow">if</font> (first &gt;= 0) first += mlen;
00999   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, first);
01000 }
01001 
<a name="l01002"></a><a class="code" href="classString.html#a68">01002</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a64">String::through</a>(<font class="keywordtype">char</font> c, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01003 {
01004   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> last = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), c);
01005   <font class="keywordflow">if</font> (last &gt;= 0) last += 1;
01006   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, last);
01007 }
01008 
<a name="l01009"></a><a class="code" href="classString.html#a67">01009</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a64">String::through</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01010 {
01011   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen = slen(t);
01012   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> last = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), t, tlen);
01013   <font class="keywordflow">if</font> (last &gt;= 0) last += tlen;
01014   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(0, last);
01015 }
01016 
<a name="l01017"></a><a class="code" href="classString.html#a77">01017</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a76">String::after</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01018 {
01019   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classString.html#a104">chars</a>(), y.<a class="code" href="classString.html#a105">length</a>());
01020   <font class="keywordflow">if</font> (first &gt;= 0) first += y.<a class="code" href="classString.html#a105">length</a>();
01021   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01022 }
01023 
<a name="l01024"></a><a class="code" href="classString.html#a78">01024</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a76">String::after</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01025 {
01026   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>());
01027   <font class="keywordflow">if</font> (first &gt;= 0) first += y.<a class="code" href="classSubString.html#a11">length</a>();
01028   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01029 }
01030 
<a name="l01031"></a><a class="code" href="classString.html#a80">01031</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a76">String::after</a>(<font class="keywordtype">char</font> c, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01032 {
01033   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), c);
01034   <font class="keywordflow">if</font> (first &gt;= 0) first += 1;
01035   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01036 }
01037 
<a name="l01038"></a><a class="code" href="classString.html#a81">01038</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a76">String::after</a>(<font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a>&amp; r, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01039 {
01040   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> mlen;
01041   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = r.<a class="code" href="classBigRegex.html#a3">search</a>(<a class="code" href="classString.html#a104">chars</a>(), <a class="code" href="classString.html#a105">length</a>(), mlen, startpos);
01042   <font class="keywordflow">if</font> (first &gt;= 0) first += mlen;
01043   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01044 }
01045 
<a name="l01046"></a><a class="code" href="classString.html#a79">01046</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a76">String::after</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01047 {
01048   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen = slen(t);
01049   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), t, tlen);
01050   <font class="keywordflow">if</font> (first &gt;= 0) first += tlen;
01051   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01052 }
01053 
<a name="l01054"></a><a class="code" href="classString.html#a71">01054</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a70">String::from</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01055 {
01056   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classString.html#a104">chars</a>(), y.<a class="code" href="classString.html#a105">length</a>());
01057   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01058 }
01059 
<a name="l01060"></a><a class="code" href="classString.html#a72">01060</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a70">String::from</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01061 {
01062   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>());
01063   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01064 }
01065 
<a name="l01066"></a><a class="code" href="classString.html#a75">01066</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a70">String::from</a>(<font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a>&amp; r, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01067 {
01068   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> mlen;
01069   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = r.<a class="code" href="classBigRegex.html#a3">search</a>(<a class="code" href="classString.html#a104">chars</a>(), <a class="code" href="classString.html#a105">length</a>(), mlen, startpos);
01070   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01071 }
01072 
<a name="l01073"></a><a class="code" href="classString.html#a74">01073</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a70">String::from</a>(<font class="keywordtype">char</font> c, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01074 {
01075   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), c);
01076   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01077 }
01078 
<a name="l01079"></a><a class="code" href="classString.html#a73">01079</a> <a class="code" href="classSubString.html">SubString</a> <a class="code" href="classString.html#a70">String::from</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* t, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01080 {
01081   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> tlen = slen(t);
01082   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> first = <a class="code" href="classString.html#b0">search</a>(startpos, <a class="code" href="classString.html#a105">length</a>(), t, tlen);
01083   <font class="keywordflow">return</font> <a class="code" href="classString.html#b5">_substr</a>(first, <a class="code" href="classString.html#a105">length</a>() - first);
01084 }
01085 
<a name="l01086"></a><a class="code" href="classString.html#a82">01086</a> <a class="code" href="classString.html">String</a> <a class="code" href="classString.html#a82">String::sub</a>(<font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> &amp; r, <font class="keywordtype">int</font> nth) {
01087         <font class="keywordtype">int</font> s,l;
01088         <font class="keywordflow">if</font> (!r.<a class="code" href="classBigRegex.html#a4">match_info</a>(s,l,nth)) <font class="keywordflow">return</font> <a class="code" href="classString.html#a0">String</a>(<font class="stringliteral">""</font>);
01089         <font class="keywordflow">return</font> <a class="code" href="classString.html#a0">String</a>(<a class="code" href="classString.html#b5">_substr</a>(s,l));
01090 }
01091 
01092 
01093 <font class="comment">/*</font>
01094 <font class="comment"> * split/join</font>
01095 <font class="comment"> */</font>
01096 
01097 
<a name="l01098"></a><a class="code" href="BigString_8cc.html#a31">01098</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a32">split</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; src, <a class="code" href="classString.html">String</a> results[], <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; sep)
01099 {
01100   <a class="code" href="classString.html">String</a> x = src;
01101   <font class="keyword">const</font> <font class="keywordtype">char</font>* s = x.<a class="code" href="classString.html#a104">chars</a>();
01102   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> sl = x.<a class="code" href="classString.html#a105">length</a>();
01103   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> i = 0;
01104   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pos = 0;
01105   <font class="keywordflow">while</font> (i &lt; n &amp;&amp; pos &lt; sl)
01106   {
01107     <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> p = x.<a class="code" href="classString.html#b0">search</a>(pos, sl, sep.<a class="code" href="classString.html#a104">chars</a>(), sep.<a class="code" href="classString.html#a105">length</a>());
01108     <font class="keywordflow">if</font> (p &lt; 0)
01109       p = sl;
01110     results[i].<a class="code" href="classString.html#n0">rep</a> = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(results[i].rep, &amp;(s[pos]), p - pos, p - pos);
01111     i++;
01112     pos = p + sep.<a class="code" href="classString.html#a105">length</a>();
01113   }
01114   <font class="keywordflow">return</font> i;
01115 }
01116 
<a name="l01117"></a><a class="code" href="BigString_8cc.html#a32">01117</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a32">split</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; src, <a class="code" href="classString.html">String</a> results[], <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n, <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a>&amp; r)
01118 {
01119   <a class="code" href="classString.html">String</a> x = src;
01120   <font class="keyword">const</font> <font class="keywordtype">char</font>* s = x.<a class="code" href="classString.html#a104">chars</a>();
01121   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> sl = x.<a class="code" href="classString.html#a105">length</a>();
01122   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> i = 0;
01123   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> pos = 0;
01124   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> p, matchlen;
01125   <font class="keywordflow">while</font> (i &lt; n &amp;&amp; pos &lt; sl)
01126   {
01127     p = r.<a class="code" href="classBigRegex.html#a3">search</a>(s, sl, matchlen, pos);
01128     <font class="keywordflow">if</font> (p &lt; 0)
01129       p = sl;
01130     results[i].<a class="code" href="classString.html#n0">rep</a> = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(results[i].rep, &amp;(s[pos]), p - pos, p - pos);
01131     i++;
01132     pos = p + matchlen;
01133   }
01134   <font class="keywordflow">return</font> i;
01135 }
01136 
01137 
01138 <font class="preprocessor">#if defined(__GNUG__) &amp;&amp; !defined(_G_NO_NRV)</font>
01139 <font class="preprocessor"></font><font class="preprocessor">#define RETURN(r) return</font>
01140 <font class="preprocessor"></font><font class="preprocessor">#define RETURNS(r) return r;</font>
01141 <font class="preprocessor"></font><font class="preprocessor">#define RETURN_OBJECT(TYPE, NAME) </font><font class="comment">/* nothing */</font>
01142 <font class="preprocessor">#else </font><font class="comment">/* _G_NO_NRV */</font>
<a name="l01143"></a><a class="code" href="BigString_8cc.html#a3">01143</a> <font class="preprocessor">#define RETURN(r) return r</font>
<a name="l01144"></a><a class="code" href="BigString_8cc.html#a4">01144</a> <font class="preprocessor"></font><font class="preprocessor">#define RETURNS(r) </font><font class="comment">/* nothing */</font>
<a name="l01145"></a><a class="code" href="BigString_8cc.html#a5">01145</a> <font class="preprocessor">#define RETURN_OBJECT(TYPE, NAME) TYPE NAME;</font>
01146 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
01147 <font class="preprocessor"></font>
<a name="l01148"></a><a class="code" href="BigString_8cc.html#a33">01148</a> <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a33">join</a>(<a class="code" href="classString.html">String</a> src[], <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; separator) <a class="code" href="BigString_8cc.html#a4">RETURNS</a>(x)
01149 {
01150   <a class="code" href="BigString_8cc.html#a5">RETURN_OBJECT</a>(<a class="code" href="classString.html">String</a>,x)
01151   <a class="code" href="classString.html">String</a> sep = separator;
01152   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> xlen = 0;
01153   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> i;
01154   <font class="keywordflow">for</font> (i = 0; i &lt; n; ++i)
01155     xlen += src[i].length();
01156   xlen += (n - 1) * sep.<a class="code" href="classString.html#a105">length</a>();
01157 
01158   x.rep = Sresize (x.rep, xlen);
01159 
01160   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> j = 0;
01161   
01162   <font class="keywordflow">for</font> (i = 0; i &lt; n - 1; ++i)
01163   {
01164     ncopy(src[i].chars(), &amp;(x.rep-&gt;s[j]), src[i].length());
01165     j += src[i].length();
01166     ncopy(sep.<a class="code" href="classString.html#a104">chars</a>(), &amp;(x.rep-&gt;s[j]), sep.<a class="code" href="classString.html#a105">length</a>());
01167     j += sep.<a class="code" href="classString.html#a105">length</a>();
01168   }
01169   ncopy0(src[i].chars(), &amp;(x.rep-&gt;s[j]), src[i].length());
01170   <a class="code" href="BigString_8cc.html#a3">RETURN</a>(x);
01171 }
01172   
01173 <font class="comment">/*</font>
01174 <font class="comment"> misc</font>
01175 <font class="comment">*/</font>
01176 
01177     
<a name="l01178"></a><a class="code" href="BigString_8cc.html#a34">01178</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a34">Sreverse</a>(<font class="keyword">const</font> <a class="code" href="structStrRep.html">StrRep</a>* src, <a class="code" href="structStrRep.html">StrRep</a>* dest)
01179 {
01180   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n = src-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
01181   <font class="keywordflow">if</font> (src != dest)
01182     dest = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(dest, src-&gt;<a class="code" href="structStrRep.html#m2">s</a>, n, n);
01183   <font class="keywordflow">if</font> (n &gt; 0)
01184   {
01185     <font class="keywordtype">char</font>* a = dest-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
01186     <font class="keywordtype">char</font>* b = &amp;(a[n - 1]);
01187     <font class="keywordflow">while</font> (a &lt; b)
01188     {
01189       <font class="keywordtype">char</font> t = *a;
01190       *a++ = *b;
01191       *b-- = t;
01192     }
01193   }
01194   <font class="keywordflow">return</font> dest;
01195 }
01196 
01197 
<a name="l01198"></a><a class="code" href="BigString_8cc.html#a35">01198</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a35">Supcase</a>(<font class="keyword">const</font> <a class="code" href="structStrRep.html">StrRep</a>* src, <a class="code" href="structStrRep.html">StrRep</a>* dest)
01199 {
01200   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n = src-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
01201   <font class="keywordflow">if</font> (src != dest) dest = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(dest, src-&gt;<a class="code" href="structStrRep.html#m2">s</a>, n, n);
01202   <font class="keywordtype">char</font>* p = dest-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
01203   <font class="keywordtype">char</font>* e = &amp;(p[n]);
01204   <font class="keywordflow">for</font> (; p &lt; e; ++p) <font class="keywordflow">if</font> (islower(*p)) *p = toupper(*p);
01205   <font class="keywordflow">return</font> dest;
01206 }
01207 
<a name="l01208"></a><a class="code" href="BigString_8cc.html#a36">01208</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a36">Sdowncase</a>(<font class="keyword">const</font> <a class="code" href="structStrRep.html">StrRep</a>* src, <a class="code" href="structStrRep.html">StrRep</a>* dest)
01209 {
01210   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n = src-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
01211   <font class="keywordflow">if</font> (src != dest) dest = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(dest, src-&gt;<a class="code" href="structStrRep.html#m2">s</a>, n, n);
01212   <font class="keywordtype">char</font>* p = dest-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
01213   <font class="keywordtype">char</font>* e = &amp;(p[n]);
01214   <font class="keywordflow">for</font> (; p &lt; e; ++p) <font class="keywordflow">if</font> (isupper(*p)) *p = tolower(*p);
01215   <font class="keywordflow">return</font> dest;
01216 }
01217 
<a name="l01218"></a><a class="code" href="BigString_8cc.html#a37">01218</a> <a class="code" href="structStrRep.html">StrRep</a>* <a class="code" href="BigString_8cc.html#a37">Scapitalize</a>(<font class="keyword">const</font> <a class="code" href="structStrRep.html">StrRep</a>* src, <a class="code" href="structStrRep.html">StrRep</a>* dest)
01219 {
01220   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n = src-&gt;<a class="code" href="structStrRep.html#m0">len</a>;
01221   <font class="keywordflow">if</font> (src != dest) dest = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(dest, src-&gt;<a class="code" href="structStrRep.html#m2">s</a>, n, n);
01222 
01223   <font class="keywordtype">char</font>* p = dest-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
01224   <font class="keywordtype">char</font>* e = &amp;(p[n]);
01225   <font class="keywordflow">for</font> (; p &lt; e; ++p)
01226   {
01227     <font class="keywordtype">int</font> at_word;
01228     <font class="keywordflow">if</font> (at_word = islower(*p))
01229       *p = toupper(*p);
01230     <font class="keywordflow">else</font> 
01231       at_word = isupper(*p) || isdigit(*p);
01232 
01233     <font class="keywordflow">if</font> (at_word)
01234     {
01235       <font class="keywordflow">while</font> (++p &lt; e)
01236       {
01237         <font class="keywordflow">if</font> (isupper(*p))
01238           *p = tolower(*p);
01239         <font class="comment">/* A '\'' does not break a word, so that "Nathan's" stays</font>
01240 <font class="comment">           "Nathan's" rather than turning into "Nathan'S". */</font>
01241         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!islower(*p) &amp;&amp; !isdigit(*p) &amp;&amp; (*p != <font class="charliteral">'\''</font>))
01242           <font class="keywordflow">break</font>;
01243       }
01244     }
01245   }
01246   <font class="keywordflow">return</font> dest;
01247 }
01248 
01249 <font class="preprocessor">#if defined(__GNUG__) &amp;&amp; !defined(_G_NO_NRV)</font>
01250 <font class="preprocessor"></font>
01251 <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a39">replicate</a>(<font class="keywordtype">char</font> c, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n) <font class="keywordflow">return</font> w;
01252 {
01253   w.<a class="code" href="classString.html#n0">rep</a> = Sresize(w.<a class="code" href="classString.html#n0">rep</a>, n);
01254   <font class="keywordtype">char</font>* p = w.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
01255   <font class="keywordflow">while</font> (n-- &gt; 0) *p++ = c;
01256   *p = 0;
01257 }
01258 
01259 <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a39">replicate</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n) <font class="keywordflow">return</font> w
01260 {
01261   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> len = y.length();
01262   w.<a class="code" href="classString.html#n0">rep</a> = Sresize(w.<a class="code" href="classString.html#n0">rep</a>, n * len);
01263   <font class="keywordtype">char</font>* p = w.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
01264   <font class="keywordflow">while</font> (n-- &gt; 0)
01265   {
01266     ncopy(y.chars(), p, len);
01267     p += len;
01268   }
01269   *p = 0;
01270 }
01271 
01272 <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a40">common_prefix</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos) <font class="keywordflow">return</font> r;
01273 {
01274   <font class="keyword">const</font> <font class="keywordtype">char</font>* xchars = x.<a class="code" href="classString.html#a104">chars</a>();
01275   <font class="keyword">const</font> <font class="keywordtype">char</font>* ychars = y.chars();
01276   <font class="keyword">const</font> <font class="keywordtype">char</font>* xs = &amp;(xchars[startpos]);
01277   <font class="keyword">const</font> <font class="keywordtype">char</font>* ss = xs;
01278   <font class="keyword">const</font> <font class="keywordtype">char</font>* topx = &amp;(xchars[x.length()]);
01279   <font class="keyword">const</font> <font class="keywordtype">char</font>* ys = &amp;(ychars[startpos]);
01280   <font class="keyword">const</font> <font class="keywordtype">char</font>* topy = &amp;(ychars[y.length()]);
01281   <a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> l;
01282   <font class="keywordflow">for</font> (l = 0; xs &lt; topx &amp;&amp; ys &lt; topy &amp;&amp; *xs++ == *ys++; ++l);
01283   r.<a class="code" href="classString.html#n0">rep</a> = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(r.<a class="code" href="classString.html#n0">rep</a>, ss, l, l);
01284 }
01285 
01286 <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a41">common_suffix</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos) <font class="keywordflow">return</font> r;
01287 {
01288   <font class="keyword">const</font> <font class="keywordtype">char</font>* xchars = x.<a class="code" href="classString.html#a104">chars</a>();
01289   <font class="keyword">const</font> <font class="keywordtype">char</font>* ychars = y.chars();
01290   <font class="keyword">const</font> <font class="keywordtype">char</font>* xs = &amp;(xchars[x.length() + startpos]);
01291   <font class="keyword">const</font> <font class="keywordtype">char</font>* botx = xchars;
01292   <font class="keyword">const</font> <font class="keywordtype">char</font>* ys = &amp;(ychars[y.length() + startpos]);
01293   <font class="keyword">const</font> <font class="keywordtype">char</font>* boty = ychars;
01294   <a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> l;
01295   <font class="keywordflow">for</font> (l = 0; xs &gt;= botx &amp;&amp; ys &gt;= boty &amp;&amp; *xs == *ys ; --xs, --ys, ++l);
01296   r.<a class="code" href="classString.html#n0">rep</a> = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(r.<a class="code" href="classString.html#n0">rep</a>, ++xs, l, l);
01297 }
01298 
01299 <font class="preprocessor">#else</font>
01300 <font class="preprocessor"></font>
<a name="l01301"></a><a class="code" href="BigString_8cc.html#a38">01301</a> <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a39">replicate</a>(<font class="keywordtype">char</font> c, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n)
01302 {
01303   <a class="code" href="classString.html">String</a> w;
01304   w.<a class="code" href="classString.html#n0">rep</a> = Sresize(w.<a class="code" href="classString.html#n0">rep</a>, n);
01305   <font class="keywordtype">char</font>* p = w.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
01306   <font class="keywordflow">while</font> (n-- &gt; 0) *p++ = c;
01307   *p = 0;
01308   <font class="keywordflow">return</font> w;
01309 }
01310 
<a name="l01311"></a><a class="code" href="BigString_8cc.html#a39">01311</a> <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a39">replicate</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> n)
01312 {
01313   <a class="code" href="classString.html">String</a> w;
01314   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> len = y.<a class="code" href="classString.html#a105">length</a>();
01315   w.<a class="code" href="classString.html#n0">rep</a> = Sresize(w.<a class="code" href="classString.html#n0">rep</a>, n * len);
01316   <font class="keywordtype">char</font>* p = w.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m2">s</a>;
01317   <font class="keywordflow">while</font> (n-- &gt; 0)
01318   {
01319     ncopy(y.<a class="code" href="classString.html#a104">chars</a>(), p, len);
01320     p += len;
01321   }
01322   *p = 0;
01323   <font class="keywordflow">return</font> w;
01324 }
01325 
<a name="l01326"></a><a class="code" href="BigString_8cc.html#a40">01326</a> <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a40">common_prefix</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos)
01327 {
01328   <a class="code" href="classString.html">String</a> r;
01329   <font class="keyword">const</font> <font class="keywordtype">char</font>* xchars = x.<a class="code" href="classString.html#a104">chars</a>();
01330   <font class="keyword">const</font> <font class="keywordtype">char</font>* ychars = y.<a class="code" href="classString.html#a104">chars</a>();
01331   <font class="keyword">const</font> <font class="keywordtype">char</font>* xs = &amp;(xchars[startpos]);
01332   <font class="keyword">const</font> <font class="keywordtype">char</font>* ss = xs;
01333   <font class="keyword">const</font> <font class="keywordtype">char</font>* topx = &amp;(xchars[x.<a class="code" href="classString.html#a105">length</a>()]);
01334   <font class="keyword">const</font> <font class="keywordtype">char</font>* ys = &amp;(ychars[startpos]);
01335   <font class="keyword">const</font> <font class="keywordtype">char</font>* topy = &amp;(ychars[y.<a class="code" href="classString.html#a105">length</a>()]);
01336   <a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> l;
01337   <font class="keywordflow">for</font> (l = 0; xs &lt; topx &amp;&amp; ys &lt; topy &amp;&amp; *xs++ == *ys++; ++l);
01338   r.<a class="code" href="classString.html#n0">rep</a> = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(r.<a class="code" href="classString.html#n0">rep</a>, ss, l, l);
01339   <font class="keywordflow">return</font> r;
01340 }
01341 
<a name="l01342"></a><a class="code" href="BigString_8cc.html#a41">01342</a> <a class="code" href="classString.html">String</a> <a class="code" href="BigString_8cc.html#a41">common_suffix</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; x, <font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y, <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> startpos) 
01343 {
01344   <a class="code" href="classString.html">String</a> r;
01345   <font class="keyword">const</font> <font class="keywordtype">char</font>* xchars = x.<a class="code" href="classString.html#a104">chars</a>();
01346   <font class="keyword">const</font> <font class="keywordtype">char</font>* ychars = y.<a class="code" href="classString.html#a104">chars</a>();
01347   <font class="keyword">const</font> <font class="keywordtype">char</font>* xs = &amp;(xchars[x.<a class="code" href="classString.html#a105">length</a>() + startpos]);
01348   <font class="keyword">const</font> <font class="keywordtype">char</font>* botx = xchars;
01349   <font class="keyword">const</font> <font class="keywordtype">char</font>* ys = &amp;(ychars[y.<a class="code" href="classString.html#a105">length</a>() + startpos]);
01350   <font class="keyword">const</font> <font class="keywordtype">char</font>* boty = ychars;
01351   <a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> l;
01352   <font class="keywordflow">for</font> (l = 0; xs &gt;= botx &amp;&amp; ys &gt;= boty &amp;&amp; *xs == *ys ; --xs, --ys, ++l);
01353   r.<a class="code" href="classString.html#n0">rep</a> = <a class="code" href="BigString_8cc.html#a15">Salloc</a>(r.<a class="code" href="classString.html#n0">rep</a>, ++xs, l, l);
01354   <font class="keywordflow">return</font> r;
01355 }
01356 
01357 <font class="preprocessor">#endif</font>
01358 <font class="preprocessor"></font>
01359 <font class="comment">// IO</font>
01360 
<a name="l01361"></a><a class="code" href="BigString_8cc.html#a42">01361</a> istream&amp; <a class="code" href="BigString_8cc.html#a42">operator&gt;&gt;</a>(istream&amp; s, <a class="code" href="classString.html">String</a>&amp; x)
01362 {
01363   <font class="keywordflow">if</font> (!s.ipfx(0) || (!(s.flags() &amp; ios::skipws) &amp;&amp; !ws(s)))
01364   {
01365     s.clear(ios::failbit|s.rdstate()); <font class="comment">// Redundant if using GNU iostreams.</font>
01366     <font class="keywordflow">return</font> s;
01367   }
01368   <font class="keywordtype">int</font> ch;
01369   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> i = 0;
01370   x.<a class="code" href="classString.html#n0">rep</a> = Sresize(x.<a class="code" href="classString.html#n0">rep</a>, 20);
01371   <font class="keyword">register</font> streambuf *sb = s.rdbuf();
01372   <font class="keywordflow">while</font> ((ch = sb-&gt;sbumpc()) != EOF)
01373   {
01374     <font class="keywordflow">if</font> (isspace(ch))
01375       <font class="keywordflow">break</font>;
01376     <font class="keywordflow">if</font> (i &gt;= x.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m1">sz</a> - 1)
01377       x.<a class="code" href="classString.html#n0">rep</a> = Sresize(x.<a class="code" href="classString.html#n0">rep</a>, i+1);
01378     x.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m2">s</a>[i++] = ch;
01379   }
01380   x.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m2">s</a>[i] = 0;
01381   x.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m0">len</a> = i;
01382   <font class="keywordtype">int</font> new_state = s.rdstate();
01383   <font class="keywordflow">if</font> (i == 0) new_state |= ios::failbit;
01384   <font class="keywordflow">if</font> (ch == EOF) new_state |= ios::eofbit;
01385   s.clear(new_state);
01386   <font class="keywordflow">return</font> s;
01387 }
01388 
<a name="l01389"></a><a class="code" href="BigString_8cc.html#a43">01389</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="BigString_8cc.html#a43">readline</a>(istream&amp; s, <a class="code" href="classString.html">String</a>&amp; x, <font class="keywordtype">char</font> terminator, <font class="keywordtype">int</font> discard)
01390 {
01391   <font class="keywordflow">if</font> (!s.ipfx(0))
01392     <font class="keywordflow">return</font> 0;
01393   <font class="keywordtype">int</font> ch;
01394   <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> i = 0;
01395   x.<a class="code" href="classString.html#n0">rep</a> = Sresize(x.<a class="code" href="classString.html#n0">rep</a>, 80);
01396   <font class="keyword">register</font> streambuf *sb = s.rdbuf();
01397   <font class="keywordflow">while</font> ((ch = sb-&gt;sbumpc()) != EOF)
01398   {
01399     <font class="keywordflow">if</font> (ch != terminator || !discard)
01400     {
01401       <font class="keywordflow">if</font> (i &gt;= x.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m1">sz</a> - 1)
01402         x.<a class="code" href="classString.html#n0">rep</a> = Sresize(x.<a class="code" href="classString.html#n0">rep</a>, i+1);
01403       x.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m2">s</a>[i++] = ch;
01404     }
01405     <font class="keywordflow">if</font> (ch == terminator)
01406       <font class="keywordflow">break</font>;
01407   }
01408   x.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m2">s</a>[i] = 0;
01409   x.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m0">len</a> = i;
01410   <font class="keywordflow">if</font> (ch == EOF) s.clear(ios::eofbit|s.rdstate());
01411   <font class="keywordflow">return</font> i;
01412 }
01413 
01414 
<a name="l01415"></a><a class="code" href="BigString_8cc.html#a44">01415</a> ostream&amp; <a class="code" href="BigString_8hh.html#a85">operator&lt;&lt;</a>(ostream&amp; s, <font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; x)
01416 { 
01417   <font class="keyword">const</font> <font class="keywordtype">char</font>* a = x.<a class="code" href="classSubString.html#a13">chars</a>();
01418   <font class="keyword">const</font> <font class="keywordtype">char</font>* lasta = &amp;(a[x.<a class="code" href="classSubString.html#a11">length</a>()]);
01419   <font class="keywordflow">while</font> (a &lt; lasta)
01420     s.put(*a++);
01421   <font class="keywordflow">return</font>(s);
01422 }
01423 
01424 <font class="comment">// from John.Willis@FAS.RI.CMU.EDU</font>
01425 
<a name="l01426"></a><a class="code" href="classString.html#a49">01426</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#a47">String::freq</a>(<font class="keyword">const</font> <a class="code" href="classSubString.html">SubString</a>&amp; y)<font class="keyword"> const</font>
01427 <font class="keyword"></font>{
01428   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> found = 0;
01429   <font class="keywordflow">for</font> (<a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> i = 0; i &lt; <a class="code" href="classString.html#a105">length</a>(); i++) 
01430     <font class="keywordflow">if</font> (<a class="code" href="classString.html#b2">match</a>(i,<a class="code" href="classString.html#a105">length</a>(),0,y.<a class="code" href="classSubString.html#a13">chars</a>(), y.<a class="code" href="classSubString.html#a11">length</a>())&gt;= 0) found++;
01431   <font class="keywordflow">return</font>(found);
01432 }
01433 
<a name="l01434"></a><a class="code" href="classString.html#a48">01434</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#a47">String::freq</a>(<font class="keyword">const</font> <a class="code" href="classString.html">String</a>&amp; y)<font class="keyword"> const</font>
01435 <font class="keyword"></font>{
01436   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> found = 0;
01437   <font class="keywordflow">for</font> (<a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> i = 0; i &lt; <a class="code" href="classString.html#a105">length</a>(); i++) 
01438     <font class="keywordflow">if</font> (<a class="code" href="classString.html#b2">match</a>(i,<a class="code" href="classString.html#a105">length</a>(),0,y.<a class="code" href="classString.html#a104">chars</a>(),y.<a class="code" href="classString.html#a105">length</a>()) &gt;= 0) found++;
01439   <font class="keywordflow">return</font>(found);
01440 }
01441 
<a name="l01442"></a><a class="code" href="classString.html#a50">01442</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#a47">String::freq</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* t)<font class="keyword"> const</font>
01443 <font class="keyword"></font>{
01444   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> found = 0;
01445   <font class="keywordflow">for</font> (<a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> i = 0; i &lt; <a class="code" href="classString.html#a105">length</a>(); i++) 
01446     <font class="keywordflow">if</font> (<a class="code" href="classString.html#b2">match</a>(i,<a class="code" href="classString.html#a105">length</a>(),0,t) &gt;= 0) found++;
01447   <font class="keywordflow">return</font>(found);
01448 }
01449 
<a name="l01450"></a><a class="code" href="classString.html#a47">01450</a> <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> <a class="code" href="classString.html#a47">String::freq</a>(<font class="keywordtype">char</font> c)<font class="keyword"> const</font>
01451 <font class="keyword"></font>{
01452   <a class="code" href="BigString_8hh.html#a9">_BIGSTRING_SIZE</a> found = 0;
01453   <font class="keywordflow">for</font> (<a class="code" href="BigString_8hh.html#a8">_BIGSTRING_LENGTH</a> i = 0; i &lt; <a class="code" href="classString.html#a105">length</a>(); i++) 
01454     <font class="keywordflow">if</font> (<a class="code" href="classString.html#b2">match</a>(i,<a class="code" href="classString.html#a105">length</a>(),0,&amp;c,1) &gt;= 0) found++;
01455   <font class="keywordflow">return</font>(found);
01456 }
01457 
01458 
<a name="l01459"></a><a class="code" href="classString.html#a110">01459</a> <font class="keywordtype">int</font> <a class="code" href="classString.html#a110">String::OK</a>()<font class="keyword"> const</font>
01460 <font class="keyword"></font>{
01461   <font class="keywordflow">if</font> (rep == 0             <font class="comment">// don't have a rep</font>
01462     || rep-&gt;<a class="code" href="structStrRep.html#m0">len</a> &gt; rep-&gt;<a class="code" href="structStrRep.html#m1">sz</a>     <font class="comment">// string oustide bounds</font>
01463     || rep-&gt;<a class="code" href="structStrRep.html#m2">s</a>[rep-&gt;<a class="code" href="structStrRep.html#m0">len</a>] != 0)   <font class="comment">// not null-terminated</font>
01464       <a class="code" href="classString.html#a109">error</a>(<font class="stringliteral">"invariant failure"</font>);
01465   <font class="keywordflow">return</font> 1;
01466 }
01467 
<a name="l01468"></a><a class="code" href="classSubString.html#a14">01468</a> <font class="keywordtype">int</font> <a class="code" href="classSubString.html#a14">SubString::OK</a>()<font class="keyword"> const</font>
01469 <font class="keyword"></font>{
01470   <font class="keywordtype">int</font> v = <a class="code" href="classSubString.html#n0">S</a> != (<font class="keyword">const</font> <font class="keywordtype">char</font>*)0; <font class="comment">// have a String;</font>
01471   v &amp;= <a class="code" href="classSubString.html#n0">S</a>.<a class="code" href="classString.html#a110">OK</a>();                 <font class="comment">// that is legal</font>
01472   v &amp;= <a class="code" href="classSubString.html#n1">pos</a> + <a class="code" href="classSubString.html#n2">len</a> &gt;= <a class="code" href="classSubString.html#n0">S</a>.<a class="code" href="classString.html#n0">rep</a>-&gt;<a class="code" href="structStrRep.html#m0">len</a>;<font class="comment">// pos and len within bounds</font>
01473   <font class="keywordflow">if</font> (!v) <a class="code" href="classSubString.html#n0">S</a>.<a class="code" href="classString.html#a109">error</a>(<font class="stringliteral">"SubString invariant failure"</font>);
01474   <font class="keywordflow">return</font> v;
01475 }
01476 
</pre></div><hr><address align="right"><small>Generated on Mon Sep 13 14:53:09 2004 for dil2al by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
