<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>tlfilter.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>tlfilter.cc</h1><a href="tlfilter_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// tlfilter.cc</font>
00002 <font class="comment">// Randal A. Koene, 20000304</font>
00003 
00004 <font class="preprocessor">#include "<a class="code" href="dil2al_8hh.html">dil2al.hh</a>"</font>
00005 
<a name="l00006"></a><a class="code" href="tlfilter_8cc.html#a0">00006</a> <font class="keywordtype">bool</font> <a class="code" href="tlfilter_8cc.html#a342">filter_TL_by_AL</a>() {
00007 }
00008 
<a name="l00009"></a><a class="code" href="tlfilter_8cc.html#a1">00009</a> <font class="keywordtype">bool</font> <a class="code" href="tlfilter_8cc.html#a343">generate_TL_keyword_index</a>() {
00010 <font class="comment">// keywords can be created with a special tag that you insert anywhere</font>
00011 <font class="comment">// in a task log entry, or anywhere in HTML or TeX documents or source code or</font>
00012 <font class="comment">// plain text, plus in the dil2al configuration file</font>
00013 }
00014 
<a name="l00015"></a><a class="code" href="tlfilter_8cc.html#a2">00015</a> <font class="keywordtype">bool</font> <a class="code" href="tlfilter_8cc.html#a2">search_TL</a>(<a class="code" href="classString.html">String</a> searchstr) {
00016 <font class="comment">// searchstr is a regexp</font>
00017 }
00018 
<a name="l00019"></a><a class="code" href="tlfilter_8cc.html#a3">00019</a> <font class="keywordtype">bool</font> <a class="code" href="tlfilter_8cc.html#a3">extract_paper_novelties</a>(<a class="code" href="classString.html">String</a> fname, <a class="code" href="classString.html">String</a> paperplanurl, ostream &amp; ostr) {
00020 <font class="comment">// searches a document for &lt;A NAME="NOVELTY-some-id"&gt;[&lt;B&gt;N&lt;/B&gt;]&lt;/A&gt;/&lt;!-- @NOVELTY-some-id@ --&gt;</font>
00021 <font class="comment">// tags and returns the items between the tags</font>
00022         <a class="code" href="classString.html">String</a> fcont;
00023         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(fname,fcont)) {
00024                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read file "</font> &lt;&lt; fname &lt;&lt; <font class="stringliteral">" in extract_paper_novelties()\n"</font>;
00025                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00026         }
00027         <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> i=-1;
00028         <font class="keywordflow">while</font> ((i=fcont.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[   ]+[Nn][Aa][Mm][Ee][     ]*=[    ]*\"NOVELTY-[^\"]*\"[&gt;]"</font>),i+1))&gt;=0) {
00029                 <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> ii = fcont.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"\"&gt;"</font>,i); <font class="comment">// find end of ID</font>
00030                 <font class="keywordflow">if</font> (ii&gt;=0) {
00031                         <a class="code" href="classString.html">String</a> nid;
00032                         nid = fcont.<a class="code" href="classString.html#a51">at</a>(i,ii-i);
00033                         nid = nid.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"\""</font>,-1);
00034                         ii = fcont.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;/A&gt;"</font>,ii); <font class="comment">// find start of content</font>
00035                         <font class="keywordflow">if</font> (ii&gt;=0) {
00036                                 <a class="code" href="classBigRegex.html">BigRegex</a> en(<font class="stringliteral">"[&lt;]!--[    ]+@"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(nid)+<font class="stringliteral">"@[    ]+\\([^&gt;]*\\)--[&gt;]"</font>);
00037                                 <a class="code" href="BigString_8hh.html#a10">_BIGSTRING_ITERATOR</a> iii = fcont.<a class="code" href="classString.html#a26">index</a>(en,ii); <font class="comment">// get end marker</font>
00038                                 <font class="keywordflow">if</font> (iii&gt;=0) {
00039                                         <a class="code" href="classString.html">String</a> cstr, istr, lstr, sstr;
00040                                         <font class="keywordflow">if</font> (en.<a class="code" href="classBigRegex.html#a6">sublen</a>(1)&gt;0) { <font class="comment">// extract possible qualifying and quantifying information</font>
00041                                                 <a class="code" href="classString.html">String</a> qqinfo = fcont.<a class="code" href="classString.html#a51">at</a>(en.<a class="code" href="classBigRegex.html#a5">subpos</a>(1),en.<a class="code" href="classBigRegex.html#a6">sublen</a>(1));
00042                                                 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> qqi(<font class="stringliteral">"@CONTEXT:[  ]*\\([^@]*\\)@[         ]*@IMP:[        ]*\\([^@]*\\)@[         ]*@LEN:[        ]*\\([^@]*\\)@[         ]*@SECTION:[    ]*\\([^@]*\\)@"</font>);
00043                                                 <font class="keywordflow">if</font> (qqinfo.<a class="code" href="classString.html#a26">index</a>(qqi)&gt;=0) {
00044                                                         cstr = qqinfo.<a class="code" href="classString.html#a51">at</a>(qqi.<a class="code" href="classBigRegex.html#a5">subpos</a>(1),qqi.<a class="code" href="classBigRegex.html#a6">sublen</a>(1));
00045                                                         istr = qqinfo.<a class="code" href="classString.html#a51">at</a>(qqi.<a class="code" href="classBigRegex.html#a5">subpos</a>(2),qqi.<a class="code" href="classBigRegex.html#a6">sublen</a>(2));
00046                                                         lstr = qqinfo.<a class="code" href="classString.html#a51">at</a>(qqi.<a class="code" href="classBigRegex.html#a5">subpos</a>(3),qqi.<a class="code" href="classBigRegex.html#a6">sublen</a>(3));
00047                                                         sstr = qqinfo.<a class="code" href="classString.html#a51">at</a>(qqi.<a class="code" href="classBigRegex.html#a5">subpos</a>(4),qqi.<a class="code" href="classBigRegex.html#a6">sublen</a>(4));
00048                                                 }
00049                                         }
00050                                         <a class="code" href="classString.html">String</a> ncont;
00051                                         ncont = fcont.<a class="code" href="classString.html#a51">at</a>(ii+4,iii-(ii+4)); <font class="comment">// get content</font>
00052                                         ncont.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;][^&gt;]*[&gt;]"</font>),<font class="stringliteral">""</font>); <font class="comment">// clean up content</font>
00053                                         <a class="code" href="classString.html">String</a> fshortname = fname.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"/"</font>,-1);
00054                                         <font class="keywordflow">if</font> (fshortname == <font class="stringliteral">""</font>) fshortname = fname;
00055                                         ostr &lt;&lt; <font class="stringliteral">"&lt;LI&gt;"</font> &lt;&lt; ncont &lt;&lt; <font class="stringliteral">" [&lt;A HREF=\""</font> &lt;&lt; <a class="code" href="utilities_8cc.html#a30">relurl</a>(paperplanurl,fname) &lt;&lt; <font class="charliteral">'#'</font> &lt;&lt; nid &lt;&lt; <font class="stringliteral">"\"&gt;"</font> &lt;&lt; fshortname &lt;&lt; <font class="charliteral">'#'</font> &lt;&lt; nid &lt;&lt; <font class="stringliteral">"&lt;/A&gt;]&lt;BR&gt;\n"</font>; <font class="comment">// return content</font>
00056 <font class="comment">//*** selection criteria suggestions can be automatically generated (see DIL#20000310091924.1)</font>
00057                                         ostr &lt;&lt; <font class="stringliteral">"(&lt;B&gt;Context&lt;/B&gt;: "</font> &lt;&lt; cstr &lt;&lt; <font class="stringliteral">", &lt;B&gt;Importance&lt;/B&gt;: "</font> &lt;&lt; istr &lt;&lt; <font class="stringliteral">", &lt;B&gt;Length&lt;/B&gt;: "</font> &lt;&lt; lstr &lt;&lt; <font class="stringliteral">", &lt;B&gt;Section&lt;/B&gt;: "</font> &lt;&lt; sstr &lt;&lt; <font class="stringliteral">")\n"</font>; <font class="comment">// add selection criteria</font>
00058                                 }
00059                         }
00060                 }
00061         } <font class="comment">// else may already have HREF reference to paper in which it is included</font>
00062         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00063 }
00064 
<a name="l00065"></a><a class="code" href="tlfilter_8cc.html#a4">00065</a> <font class="keywordtype">bool</font> <a class="code" href="tlfilter_8cc.html#a4">cmdline_extract_paper_novelties</a>(<a class="code" href="classString.html">String</a> filepaper) {
00066 <font class="comment">// Commandline interface to the extraction of NOVELTY tagged items</font>
00067         <font class="keywordtype">bool</font> <a class="code" href="templates_8defines_8hh.html#a11">res</a>;
00068         <a class="code" href="classString.html">String</a> fname, paperplanurl;
00069         fname = filepaper.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"+"</font>);
00070         <font class="keywordflow">if</font> (fname == <font class="stringliteral">""</font>) {
00071                 fname = filepaper;
00072                 paperplanurl = homedir+<font class="stringliteral">"doc/tex/somepaper/somepaper.html"</font>; <font class="comment">// dummy URL</font>
00073                 <a class="code" href="templates_8defines_8hh.html#a11">res</a> = <a class="code" href="tlfilter_8cc.html#a3">extract_paper_novelties</a>(fname,paperplanurl,cout);
00074         } <font class="keywordflow">else</font> {
00075                 paperplanurl = filepaper.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"+"</font>);
00076                 <font class="keywordflow">if</font> (paperplanurl == <font class="stringliteral">""</font>) {
00077                         paperplanurl = homedir+<font class="stringliteral">"doc/tex/somepaper/somepaper.html"</font>; <font class="comment">// dummy URL</font>
00078                         <a class="code" href="templates_8defines_8hh.html#a11">res</a> = <a class="code" href="tlfilter_8cc.html#a3">extract_paper_novelties</a>(fname,paperplanurl,cout);
00079                 } <font class="keywordflow">else</font> {
00080                         <font class="keywordflow">if</font> (paperplanurl[0]!=<font class="charliteral">'/'</font>) paperplanurl.<a class="code" href="classString.html#a22">prepend</a>(homedir);
00081                         ofstream ostr(paperplanurl+<font class="stringliteral">".new"</font>);
00082                         <font class="keywordflow">if</font> (!ostr) {
00083                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to create "</font> &lt;&lt; paperplanurl &lt;&lt; <font class="stringliteral">".new in cmdline_extract_paper_novelties()\n"</font>;
00084                                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00085                         }
00086                         ifstream istr(paperplanurl);
00087                         <font class="keywordtype">bool</font> isnew = (!istr);
00088                         <font class="keywordflow">if</font> (!isnew) ostr &lt;&lt; istr.rdbuf(); <font class="comment">// copy existing content (without regard to a possible &lt;/BODY&gt; tag)</font>
00089                         istr.close();
00090                         <a class="code" href="templates_8defines_8hh.html#a11">res</a> = <a class="code" href="tlfilter_8cc.html#a3">extract_paper_novelties</a>(fname,paperplanurl,ostr);
00091                         ostr.close();
00092                         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a36">backup_and_rename</a>(paperplanurl,<font class="stringliteral">"Paper Plan"</font>,isnew)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00093                 }
00094         }
00095         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00096 }
</pre></div><hr><address align="right"><small>Generated on Mon Sep 13 14:53:11 2004 for dil2al by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
