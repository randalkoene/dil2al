<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>tladmin.cc File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>tladmin.cc File Reference</h1><code>#include "<a class="el" href="dil2al_8hh-source.html">dil2al.hh</a>"</code><br>

<p>
<a href="tladmin_8cc-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a0">get_TL_head</a> ()</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a1">max_chunk_entry</a> (<a class="el" href="classString.html">String</a> &amp;tlchunk)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a2">generate_TL_chunk_header</a> (<a class="el" href="classString.html">String</a> nametag, <a class="el" href="classString.html">String</a> newalref, <a class="el" href="classString.html">String</a> altitle, <a class="el" href="classString.html">String</a> alhead, <a class="el" href="classString.html">String</a> newdilref, <a class="el" href="classString.html">String</a> diltitle, <a class="el" href="classString.html">String</a> dilhead, int generateparts=0)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a3">generate_TL_entry_header</a> (<a class="el" href="classString.html">String</a> nametag, <a class="el" href="classString.html">String</a> newalref, <a class="el" href="classString.html">String</a> altitle, <a class="el" href="classString.html">String</a> alhead, <a class="el" href="classString.html">String</a> newdilref, <a class="el" href="classString.html">String</a> diltitle, <a class="el" href="classString.html">String</a> dilhead)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a4">get_most_recent_TC_AL</a> (<a class="el" href="classString.html">String</a> &amp;tl)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a5">get_most_recent_TC_DE</a> (<a class="el" href="classString.html">String</a> &amp;tl)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a6">stop_TL_chunk</a> (<a class="el" href="classString.html">String</a> &amp;tl)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a7">select_TL_DIL_refs</a> (<a class="el" href="classString.html">String</a> &amp;tl, bool newchunk, <a class="el" href="classString.html">String</a> newalref)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a8">select_TL_AL_refs</a> (<a class="el" href="classString.html">String</a> &amp;tl, bool newchunk, <a class="el" href="classString.html">String</a> newdilref)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a9">add_TL_chunk_or_entry</a> (<a class="el" href="classString.html">String</a> &amp;tl, <a class="el" href="classString.html">String</a> &amp;notestr, bool newchunk, <a class="el" href="classString.html">String</a> chunkid, int &amp;tlinsertloc)</td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a10">add_TL_section</a> (<a class="el" href="classString.html">String</a> &amp;tl)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a11">locate_most_recent_TL_chunk</a> (<a class="el" href="classString.html">String</a> &amp;tl, int seekfrom, <a class="el" href="classString.html">String</a> *chunkid)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="tladmin_8cc.html#a12">decide_add_TL_chunk</a> (<a class="el" href="classString.html">String</a> &amp;tl, int &amp;tlinsertloc, bool comparetimes, bool createifgreater=<a class="el" href="templates_8defines_8hh.html#a9">true</a>)</td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a9" doxytag="tladmin.cc::add_TL_chunk_or_entry"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> add_TL_chunk_or_entry </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>notestr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newchunk</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>chunkid</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tlinsertloc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00485">485</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00906">String::after</a>(), <a class="el" href="BigString_8cc-source.html#l00886">String::at</a>(), <a class="el" href="BigString_8cc-source.html#l00896">String::before</a>(), <a class="el" href="BigString_8hh-source.html#l01126">String::contains</a>(), <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="BigString_8cc-source.html#l00911">String::from</a>(), <a class="el" href="tladmin_8cc-source.html#l00052">generate_TL_chunk_header</a>(), <a class="el" href="tladmin_8cc-source.html#l00073">generate_TL_entry_header</a>(), <a class="el" href="tladmin_8cc-source.html#l00006">get_TL_head</a>(), <a class="el" href="BigString_8hh-source.html#l01234">String::gsub</a>(), <a class="el" href="BigString_8hh-source.html#l01093">String::index</a>(), <a class="el" href="BigString_8hh-source.html#l00493">String::length</a>(), <a class="el" href="tladmin_8cc-source.html#l00028">max_chunk_entry</a>(), <a class="el" href="BigString_8hh-source.html#l00849">String::prepend</a>(), <a class="el" href="utilities_8cc-source.html#l02074">read_file_into_String</a>(), <a class="el" href="dil2al_8hh-source.html#l01180">RELLISTSDIR</a>, <a class="el" href="utilities_8cc-source.html#l01814">RX_Search_Safe</a>(), <a class="el" href="tladmin_8cc-source.html#l00359">select_TL_AL_refs</a>(), <a class="el" href="tladmin_8cc-source.html#l00161">select_TL_DIL_refs</a>(), <a class="el" href="tladmin_8cc-source.html#l00117">stop_TL_chunk</a>(), and <a class="el" href="utilities_8cc-source.html#l02116">write_file_from_String</a>().
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00971">decide_add_TL_chunk</a>(), and <a class="el" href="note_8cc-source.html#l00080">process_note_TL</a>().
<p>
<div class="fragment"><pre>00485                                                                                                                {
00486 <font class="comment">// Add a new chunk or a new entry to the Task Log</font>
00487 <font class="comment">// tlinsertloc is used when adding an entry, while it</font>
00488 <font class="comment">// is set here when adding a chunk</font>
00489         <a class="code" href="classString.html">String</a> nametag;
00490         <font class="keywordtype">int</font> chunkendindex; <font class="comment">// used to find NAME tag and for entry insertion</font>
00491         <font class="keywordflow">if</font> (!newchunk) {
00492                 <font class="comment">// determine entry NAME tag</font>
00493                 nametag = chunkid;
00494                 chunkendindex = tl.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[      ]*chunk End[    ]*--[&gt;]"</font>),tlinsertloc);
00495                 <font class="keywordflow">if</font> (chunkendindex&gt;=0) {
00496                         <a class="code" href="classString.html">String</a> tlchunk = tl.<a class="code" href="classString.html#a51">at</a>(tlinsertloc,chunkendindex-tlinsertloc);
00497                         nametag = nametag + <font class="stringliteral">"."</font> + dec(<a class="code" href="tladmin_8cc.html#a1">max_chunk_entry</a>(tlchunk)+1);
00498                 } <font class="keywordflow">else</font> {
00499                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find Task Log chunk end in add_TL_chunk_or_entry()\n"</font>;
00500                         <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00501                 }
00502         } <font class="keywordflow">else</font> {
00503                 nametag = curtime; <font class="comment">// new NAME tag for new chunk</font>
00504                 <font class="comment">// if a current chunk is active, mark its completion time</font>
00505                 <a class="code" href="tladmin_8cc.html#a6">stop_TL_chunk</a>(tl); <font class="comment">// can close previous task chunk and update AL and completion ratios</font>
00506         }
00507 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00508 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">"chunkid nametag: "</font> &lt;&lt; nametag &lt;&lt; <font class="charliteral">'\n'</font>;
00509 <font class="preprocessor">#endif</font>
00510 <font class="preprocessor"></font>        <font class="comment">// obtain DIL reference ID or identifying comment and AL reference ID</font>
00511         <a class="code" href="classString.html">String</a> newdilref,newalref,alhead,dilhead,altitle,diltitle;
00512 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00513 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'+'</font>;
00514 <font class="preprocessor">#endif</font>
00515 <font class="preprocessor"></font>        <font class="keywordflow">while</font> ((newdilref==<font class="stringliteral">"*"</font>) || (newdilref==<font class="stringliteral">""</font>)) {
00516 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00517 <font class="preprocessor"></font>                cout &lt;&lt; <font class="charliteral">'x'</font>;
00518 <font class="preprocessor">#endif</font>
00519 <font class="preprocessor"></font>                <font class="keywordflow">if</font> ((newdilref=<a class="code" href="tladmin_8cc.html#a7">select_TL_DIL_refs</a>(tl,newchunk,newalref))==<font class="stringliteral">""</font>) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00520 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00521 <font class="preprocessor"></font>                cout &lt;&lt; <font class="charliteral">'x'</font>;
00522 <font class="preprocessor">#endif</font>
00523 <font class="preprocessor"></font>                <font class="keywordflow">if</font> ((newalref==<font class="stringliteral">""</font>) || (newdilref==<font class="stringliteral">"*"</font>)) <font class="keywordflow">if</font> ((newalref=<a class="code" href="tladmin_8cc.html#a8">select_TL_AL_refs</a>(tl,newchunk,newdilref))==<font class="stringliteral">""</font>) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00524 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00525 <font class="preprocessor"></font>                cout &lt;&lt; <font class="charliteral">'x'</font>;
00526 <font class="preprocessor">#endif</font>
00527 <font class="preprocessor"></font>        }
00528 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00529 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">"newdilref: "</font> &lt;&lt; newdilref &lt;&lt; <font class="stringliteral">"\nnewalref: "</font> &lt;&lt; newalref &lt;&lt; <font class="charliteral">'\n'</font>;
00530 <font class="preprocessor">#endif</font>
00531 <font class="preprocessor"></font>        <a class="code" href="classString.html">String</a> lfstr, lfrx;
00532 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00533 <font class="preprocessor"></font>        <font class="comment">//lfstr.debug_on();</font>
00534         globaldebugop=<font class="keyword">true</font>;
00535 <font class="preprocessor">#endif</font>
00536 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (newalref[0]!=<font class="charliteral">'*'</font>) {
00537                 <font class="comment">// find previous AL reference with the same ID</font>
00538                 <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(listfile,lfstr)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00539                 <font class="comment">// AL head and title in lists file</font>
00540 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00541 <font class="preprocessor"></font>                globaldebugop=<font class="keyword">false</font>;
00542                 <font class="comment">//lfstr.debug_off();</font>
00543                 cout &lt;&lt; <font class="stringliteral">"[Freshly read] lfstr.length()="</font> &lt;&lt; lfstr.<a class="code" href="classString.html#a105">length</a>() &lt;&lt; <font class="charliteral">'\n'</font>;
00544 <font class="preprocessor">#endif</font>
00545 <font class="preprocessor"></font><font class="preprocessor">#ifdef DEBUGTIER1</font>
00546 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"."</font>;
00547 <font class="preprocessor">#endif</font>
00548 <font class="preprocessor"></font>                lfrx = <font class="stringliteral">"[&lt;]LI[&gt;][       ]*[&lt;]A[         ][^&gt;]*[Hh][Rr][Ee][Ff][         ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+newalref)+<font class="stringliteral">"\"[^\n]*"</font>;
00549                 altitle = lfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(lfrx));
00550 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00551 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"[After reading into alhead] lfstr.length()="</font> &lt;&lt; lfstr.<a class="code" href="classString.html#a105">length</a>() &lt;&lt; <font class="charliteral">'\n'</font>;
00552 <font class="preprocessor">#endif</font>
00553 <font class="preprocessor"></font>                alhead = altitle.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"([^)]*AL head"</font>));
00554                 altitle.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[         ]*([^)]*AL head.*"</font>));
00555                 altitle.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;][^&gt;]*[&gt;]"</font>),<font class="stringliteral">""</font>);
00556                 <font class="keywordflow">if</font> (alhead!=<font class="stringliteral">""</font>) {
00557 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00558 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"."</font>;
00559 <font class="preprocessor">#endif</font>
00560 <font class="preprocessor"></font>                        alhead.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"([^,]*,[   ]*[&lt;]A [^&gt;]*[Hh][Rr][Ee][Ff][   ]*=[    ]*\""</font>));
00561                         <font class="keywordflow">if</font> (alhead[0]!=<font class="charliteral">'/'</font>) {
00562                                 <font class="keywordflow">if</font> (alhead.<a class="code" href="classString.html#a32">contains</a>(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>,0)) alhead.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00563                                 <font class="keywordflow">else</font> alhead.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"../"</font>);
00564                         }
00565                         alhead = alhead.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"\""</font>);
00566                         alhead.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="tladmin_8cc.html#a316">get_TL_head</a>());
00567                 }
00568 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00569 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"altitle: "</font> &lt;&lt; altitle &lt;&lt; <font class="stringliteral">"\nalhead: "</font> &lt;&lt; alhead &lt;&lt; <font class="charliteral">'\n'</font>;
00570 <font class="preprocessor">#endif</font>
00571 <font class="preprocessor"></font>        }
00572         <a class="code" href="classString.html">String</a> dfstr, dlrx;
00573         <font class="keywordflow">if</font> (newdilref[0]!=<font class="charliteral">'*'</font>) {
00574                 <font class="comment">// find previous DIL reference with the same ID or identifying comment</font>
00575                 <font class="keywordflow">if</font> (newdilref[0]==<font class="charliteral">'!'</font>) { <font class="comment">// non-DIL identifying comment</font>
00576                         <font class="keywordtype">int</font> dilheadindex;
00577                         <font class="keywordflow">if</font> ((dilheadindex = tl.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"Context[         ]*--[&gt;][        ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"!"</font>))+<font class="stringliteral">"[^(]*([^/]*/next"</font>),-1))&gt;=0) {
00578                                 dilhead = tl.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"Begin[        ]*--&gt;[^\n]*[&lt;]A[        ]+[^&gt;]*[Nn][Aa][Mm][Ee][        ]*=[    ]*\"[^\"]+"</font>),dilheadindex-tl.<a class="code" href="classString.html#a105">length</a>());
00579                                 <font class="keywordflow">if</font> (dilhead!=<font class="stringliteral">""</font>) {
00580                                         dilhead = dilhead.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"\""</font>,-1);
00581                                         dilhead.<a class="code" href="classString.html#a22">prepend</a>(<font class="charliteral">'#'</font>);
00582 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00583 <font class="preprocessor"></font>                                        cout &lt;&lt; <font class="stringliteral">"diltitle: "</font> &lt;&lt; diltitle &lt;&lt; <font class="stringliteral">"\ndilhead: "</font> &lt;&lt; dilhead &lt;&lt; <font class="charliteral">'\n'</font>;
00584 <font class="preprocessor">#endif</font>
00585 <font class="preprocessor"></font>                                } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Context error, no matching Begin in add_TL_chunk_or_entry(), continuing\n"</font>;
00586                         } <font class="keywordflow">else</font> {
00587                                 <font class="comment">// search for Context in previous TL sections</font>
00588                                 <a class="code" href="classString.html">String</a> prevtlfile = tl.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]/H1[&gt;]\n+[&lt;]TABLE.*[&gt;][  ]*previous[     ]+TL[   ]+section"</font>));
00589                                 <font class="keywordflow">if</font> (prevtlfile!=<font class="stringliteral">""</font>) {
00590                                         prevtlfile = prevtlfile.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[   ]+[Hh][Rr][Ee][Ff]=\""</font>));
00591                                         prevtlfile = basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+prevtlfile.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"\""</font>);
00592                                         <font class="keywordflow">while</font> (prevtlfile!=<font class="stringliteral">""</font>) {
00593                                                 <a class="code" href="classString.html">String</a> prevtl;
00594                                                 <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(prevtlfile,prevtl)) {
00595                                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Continuing without non-DIL identifying comment previous dilhead\n"</font>;
00596                                                         <font class="keywordflow">break</font>;
00597                                                 }
00598                                                 <font class="keywordflow">if</font> ((dilheadindex = prevtl.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"Context[     ]*--[&gt;][        ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"!"</font>))+<font class="stringliteral">"[^(]*([^/]*/next"</font>),-1))&gt;=0) {
00599                                                         dilhead = prevtl.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"Begin[    ]*--&gt;[^\n]*[&lt;]A[        ]+[^&gt;]*[Nn][Aa][Mm][Ee][        ]*=[    ]*\"[^\"]+"</font>),dilheadindex-tl.<a class="code" href="classString.html#a105">length</a>());
00600                                                         <font class="keywordflow">if</font> (dilhead!=<font class="stringliteral">""</font>) {
00601                                                                 dilhead = dilhead.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"\""</font>,-1);
00602                                                                 dilhead.<a class="code" href="classString.html#a22">prepend</a>(<font class="charliteral">'#'</font>);
00603 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00604 <font class="preprocessor"></font>                                                                cout &lt;&lt; <font class="stringliteral">"diltitle: "</font> &lt;&lt; diltitle &lt;&lt; <font class="stringliteral">"\ndilhead: "</font> &lt;&lt; dilhead &lt;&lt; <font class="charliteral">'\n'</font>;
00605 <font class="preprocessor">#endif</font>
00606 <font class="preprocessor"></font>                                                                <font class="keywordflow">break</font>;
00607                                                         } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Context error, no matching Begin in add_TL_chunk_or_entry(), continuing\n"</font>;
00608                                                 }
00609                                                 prevtlfile = prevtl.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]/H1[&gt;]\n+[&lt;]TABLE.*[&gt;][     ]*previous[     ]+TL[   ]+section"</font>));
00610                                                 <font class="keywordflow">if</font> (prevtlfile!=<font class="stringliteral">""</font>) {
00611                                                         prevtlfile = prevtlfile.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[   ]+[Hh][Rr][Ee][Ff]=\""</font>));
00612                                                         prevtlfile = basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+prevtlfile.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"\""</font>);
00613                                                 }
00614                                         }
00615                                 }
00616                         }
00617                 } <font class="keywordflow">else</font> { <font class="comment">// DIL reference ID</font>
00618                         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+newdilref.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"#"</font>),dfstr)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00619                         <font class="comment">// DIL title in newdilref file</font>
00620                         diltitle = dfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TITLE[&gt;][^&lt;]*[&lt;]/TITLE[&gt;]"</font>));
00621                         diltitle.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"&lt;TITLE&gt;"</font>);
00622                         diltitle.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"&lt;/TITLE&gt;"</font>);
00623                         <font class="comment">// DIL head in newdilref file</font>
00624                         dlrx = <font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;][&lt;]A [^&gt;]*[Nn][Aa][Mm][Ee][        ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"#"</font>))+<font class="stringliteral">"\"[^\n]*([^)]*head"</font>;
00625                         dilhead = dfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(dlrx));
00626                         <font class="keywordflow">if</font> (dilhead!=<font class="stringliteral">""</font>) {
00627                                 dilhead.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;][&lt;]A [^&gt;]*[Nn][Aa][Mm][Ee][  ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"#"</font>))+<font class="stringliteral">"\"[^\n]*([^,]*,[    ]*[&lt;]A [^&gt;]*[Hh][Rr][Ee][Ff][   ]*=[    ]*\""</font>));
00628                                 dilhead = dilhead.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"\""</font>);
00629                                 dilhead.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="tladmin_8cc.html#a316">get_TL_head</a>());
00630                         }
00631 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00632 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"diltitle: "</font> &lt;&lt; diltitle &lt;&lt; <font class="stringliteral">"\ndilhead: "</font> &lt;&lt; dilhead &lt;&lt; <font class="charliteral">'\n'</font>;
00633 <font class="preprocessor">#endif</font>
00634 <font class="preprocessor"></font>                }
00635         }
00636         <font class="comment">// prepend newalref, newdilref, alhead, dilhead, altitle and diltitle information to note</font>
00637         <a class="code" href="classString.html">String</a> notepre;
00638         <font class="keywordflow">if</font> (newchunk) {
00639                 notepre = <a class="code" href="tladmin_8cc.html#a2">generate_TL_chunk_header</a>(nametag, newalref, altitle, alhead, newdilref, diltitle, dilhead);
00640                 <font class="comment">// find new chunk insertion location (becomes tlinsertloc for entry also)</font>
00641                 <font class="keywordflow">if</font> ((tlinsertloc=tl.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[     ]+section End[  ]+--&gt;"</font>)))&lt;0) {
00642                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find section End in "</font> &lt;&lt; taskloghead &lt;&lt; <font class="stringliteral">"in add_TL_chunk_or_entry()\n"</font>;
00643                         <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00644                 }
00645         } <font class="keywordflow">else</font> {
00646                 notepre = <a class="code" href="tladmin_8cc.html#a3">generate_TL_entry_header</a>(nametag, newalref, altitle, alhead, newdilref, diltitle, dilhead);
00647                 <font class="comment">// reposition at End of chunk for insertion of TL entry</font>
00648                 tlinsertloc=chunkendindex;
00649         }
00650         <font class="comment">// insert note and store if operations on tl are complete</font>
00651         <a class="code" href="classString.html">String</a> tltail = tl.<a class="code" href="classString.html#a70">from</a>(tlinsertloc);
00652         <font class="keywordflow">if</font> (newchunk) tl = tl.<a class="code" href="classString.html#a58">before</a>(tlinsertloc) + notepre + tltail;
00653         <font class="keywordflow">else</font> tl = tl.<a class="code" href="classString.html#a58">before</a>(tlinsertloc) + notepre + notestr + <font class="stringliteral">"&lt;P&gt;\n\n"</font> + tltail;
00654         <a class="code" href="tladmin_8cc.html#a316">get_TL_head</a>();
00655         <a class="code" href="classString.html">String</a> tlheadfile=taskloghead.after(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00656         <a class="code" href="classString.html">String</a> alheadfile=alhead.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"#"</font>); <font class="keywordflow">if</font> ((alhead!=<font class="stringliteral">""</font>) &amp;&amp; (alheadfile==<font class="stringliteral">""</font>)) alheadfile = tlheadfile;
00657         <a class="code" href="classString.html">String</a> dilheadfile=dilhead.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"#"</font>); <font class="keywordflow">if</font> ((dilhead!=<font class="stringliteral">""</font>) &amp;&amp; (dilheadfile==<font class="stringliteral">""</font>)) dilheadfile = tlheadfile;
00658 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00659 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">"tlheadfile = "</font> &lt;&lt; tlheadfile &lt;&lt; <font class="stringliteral">"\nalheadfile = "</font> &lt;&lt; alheadfile &lt;&lt; <font class="stringliteral">"\ndilheadfile = "</font> &lt;&lt; dilheadfile &lt;&lt; <font class="charliteral">'\n'</font>;
00660 <font class="preprocessor">#endif</font>
00661 <font class="preprocessor"></font>        <font class="keywordflow">if</font> ((tlheadfile!=alheadfile) &amp;&amp; (tlheadfile!=dilheadfile)) {
00662                 <font class="comment">// store updated Task Log</font>
00663                 <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(taskloghead,tl,<font class="stringliteral">"Task Log"</font>)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00664         }
00665         <a class="code" href="classString.html">String</a> tlp;
00666         <font class="keywordflow">if</font> (alhead!=<font class="stringliteral">""</font>) {
00667                 <font class="comment">// modify ``next'' in previous AL head</font>
00668                 <a class="code" href="classString.html">String</a> newalnext, altlfile = basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+alheadfile;
00669 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00670 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"D1,"</font>; cout.flush();
00671 <font class="preprocessor">#endif</font>
00672 <font class="preprocessor"></font><font class="comment">//*** This is not very optimized, requiring some copying</font>
00673 <font class="comment">//*** of long Strings. This is due to a ``bug'' in the</font>
00674 <font class="comment">//*** String class, which caused modifications via a</font>
00675 <font class="comment">//*** pointer tlp-&gt;at.() or reference tlp.at() to add</font>
00676 <font class="comment">//*** several characters of junk at the end of the</font>
00677 <font class="comment">//*** string. Note that we cannot simply overwrite tl</font>
00678 <font class="comment">//*** here as it may be needed below.</font>
00679                 <font class="keywordflow">if</font> (tlheadfile==alheadfile) {
00680 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00681 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"D2,"</font>; cout.flush();
00682 <font class="preprocessor">#endif</font>
00683 <font class="preprocessor"></font>                        tlp = tl;
00684 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00685 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"D3,"</font>; cout.flush();
00686 <font class="preprocessor">#endif</font>
00687 <font class="preprocessor"></font>                        newalnext = <font class="charliteral">'#'</font>+nametag;
00688 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00689 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"D4,"</font>; cout.flush();
00690 <font class="preprocessor">#endif</font>
00691 <font class="preprocessor"></font>                } <font class="keywordflow">else</font> {
00692                         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(altlfile,tlp)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00693                         newalnext = tlheadfile+<font class="charliteral">'#'</font>+nametag;
00694                 }
00695                 <a class="code" href="classBigRegex.html">BigRegex</a> alindexrx(<font class="stringliteral">"\\(chunk\\|entry\\)[        ]+Begin[        ]+--[&gt;][^\n]*[&lt;]A[      ][^&gt;]*[Nn][Aa][Mm][Ee][         ]*=[    ]*\""</font>+alhead.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"#"</font>)+<font class="charliteral">'"'</font>);
00696 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00697 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"D5,"</font>; cout.flush();
00698 <font class="preprocessor">#endif</font>
00699 <font class="preprocessor"></font><font class="comment">//*** could make this a forward search by continuing to</font>
00700 <font class="comment">//*** search until -1 is returned</font>
00701 <font class="comment">//*** NOT NECESSARY WITH NON-PARANOID OR FASTER BACKWARD SEARCH METHOD</font>
00702                 <font class="keywordtype">int</font> alnextindex=tlp.<a class="code" href="classString.html#a26">index</a>(alindexrx,-1);
00703 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00704 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"alnextindex = "</font> &lt;&lt; alnextindex &lt;&lt; <font class="charliteral">'\n'</font>;
00705                 cout &lt;&lt; <font class="stringliteral">"E,"</font>; cout.flush();
00706 <font class="preprocessor">#endif</font>
00707 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (alnextindex&lt;0) {
00708                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find previous AL head in "</font> &lt;&lt; alheadfile &lt;&lt; <font class="stringliteral">" in add_TL_chunk_or_entry()\n"</font>;
00709                         <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00710                 }
00711 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00712 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"E0,"</font>; cout.flush();
00713 <font class="preprocessor">#endif</font>
00714 <font class="preprocessor"></font>                <a class="code" href="classString.html">String</a> alnext;
00715 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00716 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"E0.5,"</font>; cout.flush();
00717 <font class="preprocessor">#endif</font>
00718 <font class="preprocessor"></font>                <a class="code" href="classBigRegex.html">BigRegex</a> alnextrx(<font class="stringliteral">"AL[  ]+--[&gt;][^\n]*\""</font>+newalref+<font class="stringliteral">"\"[^(]*([^)]*/next"</font>);
00719 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00720 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"E0.75,"</font>; cout.flush();
00721 <font class="preprocessor">#endif</font>
00722 <font class="preprocessor"></font>                alnext=tlp.<a class="code" href="classString.html#a51">at</a>(alnextrx,alnextindex);
00723 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00724 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"alnext =  "</font> &lt;&lt; alnext &lt;&lt; <font class="stringliteral">"\nE1,"</font>; cout.flush();                
00725 <font class="preprocessor">#endif</font>
00726 <font class="preprocessor"></font>                alnext = alnext.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"next"</font>,-1) + <font class="stringliteral">"&lt;A HREF=\""</font>+newalnext+<font class="stringliteral">"\"&gt;next&lt;/A&gt;"</font>;
00727                 <font class="comment">//alnext.at("next",-1)="&lt;A HREF=\""+newalnext+"\"&gt;next&lt;/A&gt;";</font>
00728 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00729 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"alnext =  "</font> &lt;&lt; alnext &lt;&lt; <font class="stringliteral">"\nE2,"</font>; cout.flush();                
00730 <font class="preprocessor">#endif</font>
00731 <font class="preprocessor"></font>                <a class="code" href="classString.html">String</a> ttmp = tlp.<a class="code" href="classString.html#a58">before</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"AL[  ]+--[&gt;][^\n]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newalref)+<font class="stringliteral">"\"[^(]*([^)]*/next"</font>),alnextindex);
00732 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00733 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"E3,"</font>; cout.flush();            
00734 <font class="preprocessor">#endif</font>
00735 <font class="preprocessor"></font>                ttmp += alnext;
00736 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00737 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"E4,"</font>; cout.flush();            
00738 <font class="preprocessor">#endif</font>
00739 <font class="preprocessor"></font>                ttmp += tlp.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"AL[         ]+--[&gt;][^\n]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newalref)+<font class="stringliteral">"\"[^(]*([^)]*/next"</font>),alnextindex);
00740 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00741 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"E5,"</font>; cout.flush();            
00742 <font class="preprocessor">#endif</font>
00743 <font class="preprocessor"></font>                tlp = ttmp;
00744 <font class="comment">//*** THIS WORKED... SO IT IS OBVIOUSLY DANGEROUS TO USE THE SUBSTRING REPLACEMENT</font>
00745 <font class="comment">//*** METHOD FOR INSERTION, BUT THE ABOVE IS OF COURSE VERY NON-OPTIMAL!</font>
00746 <font class="comment">//              tlp.at(BigRegex("AL[    ]+--[&gt;][^\n]*\""+newalref+"\"[^(]*([^)]*/next"),alnextindex)=alnext;</font>
00747 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00748 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"F,"</font>; cout.flush();
00749 <font class="preprocessor">#endif</font>
00750 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (alheadfile!=dilheadfile) {
00751                         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(altlfile,tlp,<font class="stringliteral">"AL head Task Log"</font>)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00752                 }
00753         }
00754 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00755 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">"G,"</font>; cout.flush();
00756 <font class="preprocessor">#endif</font>
00757 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (dilhead!=<font class="stringliteral">""</font>) {
00758 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00759 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"H,"</font>; cout.flush();
00760 <font class="preprocessor">#endif</font>
00761 <font class="preprocessor"></font>                <font class="comment">// modify ``next'' in previous DIL head</font>
00762                 <a class="code" href="classString.html">String</a> newdilnext, diltlfile = basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+dilheadfile;
00763                 <font class="keywordflow">if</font> (dilheadfile==tlheadfile) newdilnext = <font class="charliteral">'#'</font>+nametag;
00764                 <font class="keywordflow">else</font> newdilnext = tlheadfile+<font class="charliteral">'#'</font>+nametag;
00765                 <font class="keywordflow">if</font> (alheadfile!=dilheadfile) {
00766                         <font class="keywordflow">if</font> (tlheadfile==dilheadfile) tlp = tl;
00767                         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(diltlfile,tlp)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00768                 }
00769 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00770 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"H1,"</font>; cout.flush();
00771 <font class="preprocessor">#endif</font>
00772 <font class="preprocessor"></font>                <a class="code" href="classString.html">String</a> dilnext;
00773 <font class="comment">//*** could make this a forward search by continuing to</font>
00774 <font class="comment">//*** search until -1 is returned</font>
00775 <font class="comment">//*** NOT NECESSARY WITH NON-PARANOID OR FASTER BACKWARD SEARCH METHOD</font>
00776                 <font class="keywordtype">int</font> dilnextindex=tlp.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\(chunk\\|entry\\)[       ]+Begin[        ]+--[&gt;][^\n]*[&lt;]A[      ][^&gt;]*[Nn][Aa][Mm][Ee][         ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(dilhead.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"#"</font>)+<font class="charliteral">'"'</font>)),-1);
00777                 <font class="keywordflow">if</font> (dilnextindex&lt;0) {
00778                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find previous DIL head in "</font> &lt;&lt; dilheadfile &lt;&lt; <font class="stringliteral">" in add_TL_chunk_or_entry()\n"</font>;
00779                         <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00780                 }
00781 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00782 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"H2,"</font>; cout.flush();
00783 <font class="preprocessor">#endif</font>
00784 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (newdilref[0]==<font class="charliteral">'!'</font>) {
00785 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00786 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"H3,"</font>; cout.flush();
00787 <font class="preprocessor">#endif</font>
00788 <font class="preprocessor"></font>                        dilnext=tlp.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"Context[       ]+--[&gt;][        ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"!"</font>))+<font class="stringliteral">"[^(]*([^)]*/next"</font>),dilnextindex);
00789                         dilnext.<a class="code" href="classString.html#a51">at</a>(<font class="stringliteral">"next"</font>,-1)=<font class="stringliteral">"&lt;A HREF=\""</font>+newdilnext+<font class="stringliteral">"\"&gt;next&lt;/A&gt;"</font>;
00790                         tlp.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"Context[       ]+--[&gt;][        ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"!"</font>))+<font class="stringliteral">"[^(]*([^)]*/next"</font>),dilnextindex)=dilnext;
00791                 } <font class="keywordflow">else</font> {
00792 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00793 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"H4,"</font>; cout.flush();
00794 <font class="preprocessor">#endif</font>
00795 <font class="preprocessor"></font>                        dilnext=tlp.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"Context[       ]+--[&gt;][^\n]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref)+<font class="stringliteral">"\"[^(]*([^)]*/next"</font>),dilnextindex);
00796                         dilnext.<a class="code" href="classString.html#a51">at</a>(<font class="stringliteral">"next"</font>,-1)=<font class="stringliteral">"&lt;A HREF=\""</font>+newdilnext+<font class="stringliteral">"\"&gt;next&lt;/A&gt;"</font>;
00797                         tlp.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"Context[       ]+--[&gt;][^\n]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref)+<font class="stringliteral">"\"[^(]*([^)]*/next"</font>),dilnextindex)=dilnext;
00798                 }
00799                 <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(diltlfile,tlp,<font class="stringliteral">"Context head Task Log"</font>)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00800 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00801 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"H5,"</font>; cout.flush();
00802 <font class="preprocessor">#endif</font>
00803 <font class="preprocessor"></font>        }
00804         <font class="keywordflow">if</font> (newalref[0]!=<font class="charliteral">'*'</font>) {
00805 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00806 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"I,"</font>;
00807 <font class="preprocessor">#endif</font>
00808 <font class="preprocessor"></font>                <font class="comment">// update AL head in listfile</font>
00809                 <font class="keywordflow">if</font> (alhead!=<font class="stringliteral">""</font>) {
00810 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00811 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",J"</font>; cout.flush();
00812 <font class="preprocessor">#endif</font>
00813 <font class="preprocessor"></font>                        <a class="code" href="classString.html">String</a> newalnext = lfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(lfrx));
00814 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00815 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"[After reading into newalnext] lfstr.length()="</font> &lt;&lt; lfstr.<a class="code" href="classString.html#a105">length</a>() &lt;&lt; <font class="charliteral">'\n'</font>;
00816 <font class="preprocessor">#endif</font>
00817 <font class="preprocessor"></font><font class="preprocessor">#ifdef DEBUGTIER2</font>
00818 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",J1"</font>; cout.flush();
00819 <font class="preprocessor">#endif</font>
00820 <font class="preprocessor"></font>                        newalnext.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[Hh][Rr][Ee][Ff][        ]*=[    ]*\"[^\"]+\""</font>),-1) = <font class="stringliteral">"HREF=\""</font>+(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+tlheadfile)+<font class="charliteral">'#'</font>+nametag+<font class="stringliteral">"\""</font>;
00821 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00822 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",J2"</font>; cout.flush();
00823 <font class="preprocessor">#endif</font>
00824 <font class="preprocessor"></font><font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00825 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"lfstr.length()="</font> &lt;&lt; lfstr.<a class="code" href="classString.html#a105">length</a>() &lt;&lt; <font class="charliteral">'\n'</font>;
00826                         newalnext.debug_on();
00827 <font class="preprocessor">#endif</font>
00828 <font class="preprocessor"></font>                        lfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(lfrx)) = newalnext;
00829 <font class="preprocessor">#ifdef DEBUG_BIGSTRING</font>
00830 <font class="preprocessor"></font>                        newalnext.debug_off();
00831                         cout &lt;&lt; <font class="stringliteral">"lfstr.length()="</font> &lt;&lt; lfstr.<a class="code" href="classString.html#a105">length</a>() &lt;&lt; <font class="charliteral">'\n'</font>;
00832 <font class="preprocessor">#endif</font>
00833 <font class="preprocessor"></font>                } <font class="keywordflow">else</font> {
00834 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00835 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",JJ"</font>; cout.flush();
00836 <font class="preprocessor">#endif</font>
00837 <font class="preprocessor"></font>                        <a class="code" href="classString.html">String</a> newalnext = lfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]LI[&gt;][         ]*[&lt;]A[         ][^&gt;]*[Hh][Rr][Ee][Ff][         ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+newalref)+<font class="stringliteral">"\"[^\n]*"</font>));
00838 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00839 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",JJ1"</font>; cout.flush();
00840 <font class="preprocessor">#endif</font>
00841 <font class="preprocessor"></font>                        newalnext.<a class="code" href="classString.html#a51">at</a>(<font class="stringliteral">"&lt;BR&gt;"</font>,-1) = <font class="stringliteral">" (&lt;A HREF=\""</font>+(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+tlheadfile)+<font class="charliteral">'#'</font>+nametag+<font class="stringliteral">"\"&gt;AL tail&lt;/A&gt;,&lt;A HREF=\""</font>+(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+tlheadfile)+(<font class="charliteral">'#'</font>+nametag)+<font class="stringliteral">"\"&gt;AL head&lt;/A&gt;)&lt;BR&gt;"</font>;
00842 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00843 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",JJ2"</font>; cout.flush();
00844 <font class="preprocessor">#endif</font>
00845 <font class="preprocessor"></font>                        lfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]LI[&gt;][    ]*[&lt;]A[         ][^&gt;]*[Hh][Rr][Ee][Ff][         ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+newalref)+<font class="stringliteral">"\"[^\n]*"</font>)) = newalnext;
00846                 }
00847                 <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(listfile,lfstr,<font class="stringliteral">"Main Lists"</font>)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00848         }
00849 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00850 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">",K"</font>;
00851 <font class="preprocessor">#endif</font>
00852 <font class="preprocessor"></font>        <font class="keywordflow">if</font> ((newdilref[0]!=<font class="charliteral">'*'</font>) &amp;&amp; (newdilref[0]!=<font class="charliteral">'!'</font>)) {
00853 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00854 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">",L"</font>;
00855 <font class="preprocessor">#endif</font>
00856 <font class="preprocessor"></font>                <font class="comment">// update DIL head in DIL file</font>
00857                 <font class="keywordflow">if</font> (dilhead!=<font class="stringliteral">""</font>) {
00858                         <a class="code" href="classString.html">String</a> newdilnext = dfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(dlrx)); 
00859 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00860 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",L1"</font>;
00861 <font class="preprocessor">#endif</font>
00862 <font class="preprocessor"></font>                        newdilnext.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[Hh][Rr][Ee][Ff][       ]*=[    ]*\"[^\"]+\""</font>),-1) = <font class="stringliteral">"HREF=\""</font>+tlheadfile+<font class="charliteral">'#'</font>+nametag+<font class="stringliteral">"\""</font>;
00863 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00864 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",L2"</font>;
00865 <font class="preprocessor">#endif</font>
00866 <font class="preprocessor"></font>                        dfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(dlrx)) = newdilnext;
00867                 } <font class="keywordflow">else</font> {
00868 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00869 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",M"</font>;
00870 <font class="preprocessor">#endif</font>
00871 <font class="preprocessor"></font>                        <a class="code" href="classString.html">String</a> newdilnext = dfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;][&lt;]A [^&gt;]*[Nn][Aa][Mm][Ee][         ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"#"</font>))+<font class="stringliteral">"\"[^\n]*"</font>));
00872 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00873 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",M1"</font>;
00874 <font class="preprocessor">#endif</font>
00875 <font class="preprocessor"></font>                        newdilnext += <font class="stringliteral">" (&lt;A HREF=\""</font>+tlheadfile+<font class="charliteral">'#'</font>+nametag+<font class="stringliteral">"\"&gt;tail&lt;/A&gt;,&lt;A HREF=\""</font>+tlheadfile+<font class="charliteral">'#'</font>+nametag+<font class="stringliteral">"\"&gt;head&lt;/A&gt;)&lt;BR&gt;"</font>;
00876 <font class="preprocessor">#ifdef DEBUGTIER2</font>
00877 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">",M2"</font>;
00878 <font class="preprocessor">#endif</font>
00879 <font class="preprocessor"></font>                        dfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD[^&gt;]*[&gt;][&lt;]A [^&gt;]*[Nn][Aa][Mm][Ee][     ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"#"</font>))+<font class="stringliteral">"\"[^\n]*"</font>)) = newdilnext;
00880                 }
00881                 <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+newdilref.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"#"</font>),dfstr,<font class="stringliteral">"DIL"</font>)) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00882         }
00883 <font class="preprocessor">#ifdef DEBUGTIER1</font>
00884 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">",N\n"</font>;
00885 <font class="preprocessor">#endif</font>
00886 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (newchunk) chunkcreated = <font class="keyword">true</font>; <font class="comment">// update process variable</font>
00887         <font class="keywordflow">return</font> nametag;
00888 }
</pre></div>    </td>
  </tr>
</table>
<a name="a10" doxytag="tladmin.cc::add_TL_section"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> bool add_TL_section </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>tl</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00890">890</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00886">String::at</a>(), <a class="el" href="BigString_8cc-source.html#l00896">String::before</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="tladmin_8cc-source.html#l00006">get_TL_head</a>(), <a class="el" href="BigString_8hh-source.html#l01093">String::index</a>(), <a class="el" href="utilities_8cc-source.html#l02074">read_file_into_String</a>(), <a class="el" href="dil2al_8hh-source.html#l01180">RELLISTSDIR</a>, <a class="el" href="tladmin_8cc-source.html#l00117">stop_TL_chunk</a>(), and <a class="el" href="utilities_8cc-source.html#l02116">write_file_from_String</a>().
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00971">decide_add_TL_chunk</a>().
<p>
<div class="fragment"><pre>00890                                  {
00891 <font class="comment">// Add a new section to the Task Log</font>
00892 <font class="comment">// Note: modifies current Task Log head file, tl, taskloghead,</font>
00893 <font class="comment">//       Main List File (listfile), Task Log symbolic link (tasklog);</font>
00894 <font class="comment">//       update in-memory copies and any variables that reference specific</font>
00895 <font class="comment">//       items or locations in the modified variables and files if necessary</font>
00896         <font class="comment">// close any currently active TL chunk</font>
00897         <a class="code" href="tladmin_8cc.html#a6">stop_TL_chunk</a>(tl);
00898         <font class="comment">// initialize new TL section</font>
00899         <a class="code" href="tladmin_8cc.html#a316">get_TL_head</a>();
00900         <a class="code" href="classString.html">String</a> curtlid = taskloghead.after(<font class="stringliteral">"task-log."</font>);
00901         curtlid = curtlid.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">".html"</font>);
00902         <font class="keywordflow">if</font> (curtlid==curdate) {
00903                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Cannot create Task Log section with same ID as current Task Log head\n"</font>;
00904                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00905         }
00906         <a class="code" href="classString.html">String</a> newreltlhead = <font class="stringliteral">"task-log."</font>+curdate+<font class="stringliteral">".html"</font>;
00907         <a class="code" href="classString.html">String</a> newtlsection = <font class="stringliteral">"&lt;HTML&gt;\n&lt;HEAD&gt;&lt;TITLE&gt;Task Log ("</font>+curdate+<font class="stringliteral">")&lt;/TITLE&gt;\n&lt;/HEAD&gt;\n&lt;BODY BGCOLOR=\"#000000\" TEXT=\"#FFDF00\" LINK=\"#AFAFFF\" VLINK=\"#7F7FFF\"&gt;\n&lt;H1&gt;&lt;FONT COLOR=\"#00FF00\"&gt;Task Log ("</font>
00908                                         + curdate + <font class="stringliteral">")&lt;/FONT&gt;&lt;/H1&gt;\n\n&lt;TABLE WIDTH=\"100%\" CELLPADDING=3 BGCOLOR=\"#007F00\"&gt;&lt;TR&gt;&lt;TD WIDTH=\"30%\" ALIGN=CENTER&gt;&lt;A HREF=\"task-log."</font>
00909                                         + curtlid + <font class="stringliteral">".html\"&gt;&lt;FONT COLOR=\"#FFFFFF\"&gt;previous TL section ("</font>+curtlid+<font class="stringliteral">")&lt;/FONT&gt;&lt;/A&gt;&lt;TD WIDTH=\"40%\" BGCOLOR=\"#005F00\"&gt;&amp;nbsp;&lt;TD WIDTH=\"30%\" ALIGN=CENTER&gt;&lt;FONT COLOR=\"#FFFFFF\"&gt;(no next TL section)&lt;/FONT&gt;&lt;/TABLE&gt;\n\n"</font>
00910                                         + <font class="stringliteral">"&lt;P&gt;\n&lt;LI&gt;&lt;A HREF=\"../lists.html#AL\"&gt;Project Active Lists&lt;/A&gt;\n"</font>
00911                                         + <font class="stringliteral">"&lt;LI&gt;&lt;A HREF=\"../lists.html#DIL\"&gt;Topical Detailed Items Lists&lt;/A&gt;\n"</font>
00912                                         + <font class="stringliteral">"&lt;LI&gt;&lt;A HREF=\"detailed-items-by-ID.html\"&gt;Detailed Items by ID&lt;/A&gt;\n"</font>
00913                                         + <font class="stringliteral">"&lt;LI&gt;&lt;A HREF=\"../work-log.html\"&gt;Work Log&lt;/A&gt;\n&lt;P&gt;\n&lt;HR&gt;\n&lt;P&gt;\n"</font>
00914                                         + <font class="stringliteral">"&lt;!-- section Begin --&gt;&lt;TABLE WIDTH=\"100%\" CELLPADDING=3 BGCOLOR=\"#3F3F3F\"&gt;\n\n"</font>
00915                                         + <font class="stringliteral">"&lt;!-- section End --&gt;&lt;/TABLE&gt;\n\n&lt;P&gt;\n&lt;HR&gt;\n"</font>
00916                                         + <font class="stringliteral">"~/doc/&lt;A HREF=\"../maincont.html\"&gt;html&lt;/A&gt;/&lt;A HREF=\"../lists.html\"&gt;lists&lt;/A&gt;/"</font>+newreltlhead+<font class="stringliteral">"\n\n&lt;/BODY&gt;\n"</font>;
00917         <a class="code" href="classString.html">String</a> newtaskloghead = basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+newreltlhead;
00918         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(newtaskloghead,newtlsection,<font class="stringliteral">"New Task Log section"</font>,<font class="keyword">true</font>)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00919         <font class="comment">// update next TL section reference in tl and store current Task Log</font>
00920         tl.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]FONT[        ]+COLOR[        ]*=[    ]*\"#FFFFFF\"[&gt;][       ]*([    ]*no next TL section[   ]*)[    ]*[&lt;]/FONT[&gt;][&lt;]/TABLE[&gt;]"</font>)) = <font class="stringliteral">"&lt;A HREF=\""</font>+newreltlhead+<font class="stringliteral">"\"&gt;&lt;FONT COLOR=\"#FFFFFF\"&gt;next TL section ("</font>+curdate+<font class="stringliteral">")&lt;/FONT&gt;&lt;/A&gt;&lt;/TABLE&gt;"</font>;
00921         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(taskloghead,tl,<font class="stringliteral">"Task Log"</font>)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00922         <font class="comment">// update list of Task Log sections in listfile</font>
00923         <a class="code" href="classString.html">String</a> lfstr;
00924         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(listfile,lfstr)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00925         <font class="keywordtype">int</font> lftlindex = lfstr.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;A NAME=\"TL\"&gt;"</font>);
00926         <font class="keywordflow">if</font> (lftlindex&gt;=0) <font class="keywordflow">if</font> ((lftlindex=lfstr.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;/OL&gt;"</font>,lftlindex))&gt;=0) lfstr.<a class="code" href="classString.html#a51">at</a>(lftlindex,1) = <font class="stringliteral">"&lt;LI&gt;&lt;A HREF=\""</font>+(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+newreltlhead)+<font class="stringliteral">"\"&gt;Task Log: section initiation date mark "</font>+curdate+<font class="stringliteral">"&lt;/A&gt;\n&lt;"</font>;
00927         <font class="keywordflow">if</font> (lftlindex&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to update Task Log sections list in "</font> &lt;&lt; listfile &lt;&lt; <font class="stringliteral">" in add_TL_section(), continuing as is\n"</font>;
00928         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(listfile,lfstr,<font class="stringliteral">"Main List"</font>)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00929         <font class="comment">// update Task Log symbolic link in tasklog</font>
00930         <font class="keywordflow">if</font> (unlink(tasklog)&lt;0) {
00931                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to remove Task Log symbolic link "</font> &lt;&lt; tasklog &lt;&lt; <font class="stringliteral">" to task-log."</font> &lt;&lt; curtlid &lt;&lt; <font class="stringliteral">".html in add_TL_section()\n"</font>;
00932                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00933         }
00934         <font class="keywordflow">if</font> (symlink(newreltlhead,tasklog)&lt;0) {
00935                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to create Task Log symbolic link "</font> &lt;&lt; tasklog &lt;&lt; <font class="stringliteral">" to "</font> &lt;&lt; newreltlhead &lt;&lt; <font class="stringliteral">" in add_TL_section()\n"</font>;
00936                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00937         }
00938         <font class="comment">// set variables to new Task Log section</font>
00939         tl = newtlsection;
00940         taskloghead = newtaskloghead;
00941         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00942 }
</pre></div>    </td>
  </tr>
</table>
<a name="a12" doxytag="tladmin.cc::decide_add_TL_chunk"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> decide_add_TL_chunk </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tlinsertloc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>comparetimes</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>createifgreater</em> = <a class="el" href="templates_8defines_8hh.html#a9">true</a></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00971">971</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="tladmin_8cc-source.html#l00485">add_TL_chunk_or_entry</a>(), <a class="el" href="tladmin_8cc-source.html#l00890">add_TL_section</a>(), <a class="el" href="dil2al_8hh-source.html#l01245">ANSI_BOLD_OFF</a>, <a class="el" href="dil2al_8hh-source.html#l01244">ANSI_BOLD_ON</a>, <a class="el" href="utilities_8cc-source.html#l01809">BigRegex_freq</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="tladmin_8cc-source.html#l00944">locate_most_recent_TL_chunk</a>(), <a class="el" href="dil2al_8hh-source.html#l01226">TCS_ASK</a>, <a class="el" href="dil2al_8hh-source.html#l01224">TCS_CURRENT</a>, <a class="el" href="dil2al_8hh-source.html#l01225">TCS_NEW</a>, <a class="el" href="utilities_8cc-source.html#l01889">time_stamp_diff</a>(), <a class="el" href="dil2al_8hh-source.html#l01230">TSS_ASK</a>, and <a class="el" href="dil2al_8hh-source.html#l01229">TSS_NEW</a>.
<p>
Referenced by <a class="el" href="controller_8cc-source.html#l00006">chunk_controller</a>(), and <a class="el" href="note_8cc-source.html#l00080">process_note_TL</a>().
<p>
<div class="fragment"><pre>00971                                                                                                            {
00972 <font class="comment">// Add a Task Log chunk based on strategies and time since creation</font>
00973 <font class="comment">// of most recent chunk</font>
00974 <font class="comment">// time-based decisions can be either</font>
00975 <font class="comment">// create-if-greater-than-chunksize-plus-slack or</font>
00976 <font class="comment">// create-unless-smaller-than-chunksize</font>
00977 <font class="comment">// initialize tlinsertloc with -1 to search from end of Task Log</font>
00978 <font class="comment">// tlinsertloc is updated for use when adding entry to Task Log</font>
00979 <font class="comment">// returns chunkid</font>
00980         <font class="comment">// find most recent TL chunk (immediately preceding @INSERT-TL-NOTE@ if present)</font>
00981         <font class="keyword">const</font> <font class="keywordtype">int</font> LLEN = 10240;
00982         <font class="keywordtype">char</font> lbuf[LLEN];
00983         <a class="code" href="classString.html">String</a> chunkid; <font class="keywordtype">bool</font> newchunk = !createifgreater;
00984         <font class="keywordflow">if</font> ((tlinsertloc = <a class="code" href="tladmin_8cc.html#a11">locate_most_recent_TL_chunk</a>(tl,tlinsertloc,&amp;chunkid))&lt;0) <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00985         <font class="keywordflow">if</font> (chunkid==<font class="stringliteral">""</font>) newchunk=<font class="keyword">true</font>;
00986         <font class="keywordflow">else</font> {
00987                 <font class="comment">// compare chunk time stamp with curtime</font>
00988 <font class="preprocessor">#ifdef DEBUG</font>
00989 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"decision chunkid = "</font> &lt;&lt; chunkid &lt;&lt; <font class="stringliteral">"\ncurtime = "</font> &lt;&lt; curtime &lt;&lt; <font class="charliteral">'\n'</font>;
00990 <font class="preprocessor">#endif</font>
00991 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (createifgreater) {
00992                         <font class="comment">// test if curtime &gt; chunk_creation_time+timechunksize+timechunkslack</font>
00993                         <font class="keywordflow">if</font> ((comparetimes) &amp;&amp; ((<a class="code" href="utilities_8cc.html#a26">time_stamp_diff</a>(chunkid,curtime)/60)&gt;(timechunksize+timechunkslack))) {
00994                                 <font class="keywordflow">if</font> (timechunkoverstrategy==<a class="code" href="dil2al_8hh.html#a77">TCS_NEW</a>) newchunk=<font class="keyword">true</font>;
00995                                 <font class="keywordflow">else</font> <font class="keywordflow">if</font> (timechunkoverstrategy==<a class="code" href="dil2al_8hh.html#a78">TCS_ASK</a>) {
00996                                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a91">ANSI_BOLD_ON</a>; <font class="comment">// bold on</font>
00997                                         cout &lt;&lt; <font class="stringliteral">"\nDifference between time stamp of current Task Log chunk and current time is\ngreater than "</font> &lt;&lt; (timechunksize+timechunkslack) &lt;&lt; <font class="stringliteral">" minutes. Create new Task Log chunk? (y/N) "</font>;
00998                                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a92">ANSI_BOLD_OFF</a>; <font class="comment">// bold off</font>
00999                                         cin.getline(lbuf,LLEN);
01000                                         <font class="keywordflow">if</font> ((lbuf[0]==<font class="charliteral">'y'</font>) || (lbuf[0]==<font class="charliteral">'Y'</font>)) newchunk=<font class="keyword">true</font>;
01001                                 }
01002                         }
01003                 } <font class="keywordflow">else</font> {
01004                         <font class="comment">// test if curtime == chunk_creation_time, e.g. created during make_note() opportunity in chunk_controller()</font>
01005                         <font class="keywordflow">if</font> (chunkid==curtime) newchunk=<font class="keyword">false</font>;
01006                         <font class="keywordflow">else</font> {
01007                                 <font class="comment">// test if curtime &lt; chunk_creation_time+timechunksize</font>
01008                                 <font class="keywordflow">if</font> ((comparetimes) &amp;&amp; ((<a class="code" href="utilities_8cc.html#a26">time_stamp_diff</a>(chunkid,curtime)/60)&lt;timechunksize)) {
01009                                         <font class="keywordflow">if</font> (timechunkunderstrategy==<a class="code" href="dil2al_8hh.html#a76">TCS_CURRENT</a>) newchunk=<font class="keyword">false</font>;
01010                                         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (timechunkunderstrategy==<a class="code" href="dil2al_8hh.html#a78">TCS_ASK</a>) {
01011                                                 <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a91">ANSI_BOLD_ON</a>; <font class="comment">// bold on</font>
01012                                                 cout &lt;&lt; <font class="stringliteral">"\nDifference between time stamp of current Task Log chunk and current time is\nless than "</font> &lt;&lt; timechunksize &lt;&lt; <font class="stringliteral">" minutes. Create new Task Log chunk anyway? (y/N) "</font>;
01013                                                 <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a92">ANSI_BOLD_OFF</a>; <font class="comment">// bold off</font>
01014                                                 cin.getline(lbuf,LLEN);
01015                                                 <font class="keywordflow">if</font> ((lbuf[0]!=<font class="charliteral">'y'</font>) &amp;&amp; (lbuf[0]!=<font class="charliteral">'Y'</font>)) newchunk=<font class="keyword">false</font>;
01016                                         }
01017                                 }
01018                         }
01019                 }
01020         }
01021         <font class="keywordflow">if</font> (newchunk) {
01022                 <font class="keywordtype">bool</font> newsection = <font class="keyword">false</font>;
01023                 <font class="comment">// if TL contains more than sectionsize chunks consider starting a new section</font>
01024                 <font class="keywordtype">int</font> numchunks = <a class="code" href="utilities_8cc.html#a17">BigRegex_freq</a>(tl,<font class="stringliteral">"[&lt;]!--[       ]+chunk Begin[  ]+--[&gt;]"</font>);
01025                 <font class="keywordflow">if</font> (numchunks&gt;=sectionsize) {
01026                         <font class="keywordflow">if</font> (sectionstrategy==<a class="code" href="dil2al_8hh.html#a80">TSS_NEW</a>) newsection = <font class="keyword">true</font>;
01027                         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sectionstrategy==<a class="code" href="dil2al_8hh.html#a81">TSS_ASK</a>) {
01028                                 <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a91">ANSI_BOLD_ON</a>; <font class="comment">// bold on</font>
01029                                 cout &lt;&lt; <font class="stringliteral">"\nThere are "</font> &lt;&lt; numchunks &lt;&lt; <font class="stringliteral">" chunks in this Task Log section. Create new section? (y/N) "</font>;
01030                                 <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a92">ANSI_BOLD_OFF</a>; <font class="comment">// bold off</font>
01031                                 cin.getline(lbuf,LLEN);
01032                                 <font class="keywordflow">if</font> ((lbuf[0]==<font class="charliteral">'y'</font>) || (lbuf[0]==<font class="charliteral">'Y'</font>)) newsection=<font class="keyword">true</font>;
01033                         }
01034                 }
01035                 <font class="keywordflow">if</font> (newsection) {
01036                         <font class="comment">// add a new section to the Task Log</font>
01037                         <font class="keywordflow">if</font> (!<a class="code" href="tladmin_8cc.html#a10">add_TL_section</a>(tl)) {
01038                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to add new Task Log section in decide_add_TL_chunk()\n"</font>;
01039                                 <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
01040                         }
01041                 }
01042                 <font class="comment">// add a new chunk to the Task Log</font>
01043                 <font class="keywordflow">if</font> ((chunkid = <a class="code" href="tladmin_8cc.html#a9">add_TL_chunk_or_entry</a>(tl,chunkid,<font class="keyword">true</font>,chunkid,tlinsertloc))==<font class="stringliteral">""</font>) {
01044                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to add new Task Log chunk in decide_add_TL_chunk()\n"</font>;
01045                         <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
01046                 }
01047         }
01048         <font class="keywordflow">return</font> chunkid;
01049 }
</pre></div>    </td>
  </tr>
</table>
<a name="a2" doxytag="tladmin.cc::generate_TL_chunk_header"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> generate_TL_chunk_header </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>nametag</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newalref</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>altitle</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>alhead</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newdilref</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>diltitle</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>dilhead</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>generateparts</em> = 0</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00052">52</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00906">String::after</a>().
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00485">add_TL_chunk_or_entry</a>(), and <a class="el" href="utilities_8cc-source.html#l02358">initialize_new_DIL_TL</a>().
<p>
<div class="fragment"><pre>00052                                                                                                                                                                           {
00053 <font class="comment">// generatparts = 0 both parts, -1 begin part, 1 end part</font>
00054 <font class="preprocessor">#ifdef DEBUG</font>
00055 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">"Generating TL chunk header with tag = "</font> &lt;&lt; nametag &lt;&lt; <font class="stringliteral">", AL = "</font> &lt;&lt; newalref &lt;&lt; <font class="stringliteral">", DIL entry = "</font> &lt;&lt; newdilref &lt;&lt; <font class="charliteral">'\n'</font>;
00056 <font class="preprocessor">#endif</font>
00057 <font class="preprocessor"></font>        <a class="code" href="classString.html">String</a> chunkheader;
00058         <font class="keywordflow">if</font> (generateparts&lt;=0) {
00059                 chunkheader = <font class="stringliteral">"&lt;!-- chunk Begin --&gt;&lt;TR&gt;&lt;TD&gt;&lt;FONT COLOR=\"#FFFFFF\"&gt;&lt;A NAME=\""</font>+nametag+<font class="stringliteral">"\"&gt;&lt;B&gt;"</font>+nametag+<font class="stringliteral">"&lt;/B&gt;&lt;/A&gt;\n&lt;!-- chunk AL --&gt;&lt;A HREF=\""</font>+newalref+<font class="stringliteral">"\"&gt;"</font>+altitle+<font class="stringliteral">"&lt;/A&gt; ("</font>;
00060                 <font class="keywordflow">if</font> (alhead!=<font class="stringliteral">""</font>) chunkheader += <font class="stringliteral">"&lt;A HREF=\""</font>+alhead+<font class="stringliteral">"\"&gt;previous&lt;/A&gt;/next)\n&lt;!-- chunk Context --&gt;"</font>;
00061                 <font class="keywordflow">else</font> chunkheader += <font class="stringliteral">"previous/next)\n&lt;!-- chunk Context --&gt;"</font>;
00062                 <font class="keywordflow">if</font> (newdilref[0]==<font class="charliteral">'!'</font>) chunkheader += newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"!"</font>)+<font class="stringliteral">" ("</font>;
00063                 <font class="keywordflow">else</font> chunkheader += <font class="stringliteral">"&lt;A HREF=\""</font>+newdilref+<font class="stringliteral">"\"&gt;"</font>+diltitle+<font class="stringliteral">" "</font>+newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"#"</font>)+<font class="stringliteral">"&lt;/A&gt; ("</font>;
00064                 <font class="keywordflow">if</font> (dilhead!=<font class="stringliteral">""</font>) chunkheader +=  <font class="stringliteral">"&lt;A HREF=\""</font>+dilhead+<font class="stringliteral">"\"&gt;previous&lt;/A&gt;/next)&lt;/FONT&gt;\n&lt;P&gt;\n\n"</font>;
00065                 <font class="keywordflow">else</font> chunkheader += <font class="stringliteral">"previous/next)&lt;/FONT&gt;\n&lt;P&gt;\n\n"</font>;
00066         }
00067         <font class="keywordflow">if</font> (generateparts&gt;=0) {
00068                 chunkheader += <font class="stringliteral">"&lt;!-- chunk End --&gt;&lt;/TD&gt;&lt;/TR&gt;\n\n"</font>;
00069         }
00070         <font class="keywordflow">return</font> chunkheader;             
00071 }
</pre></div>    </td>
  </tr>
</table>
<a name="a3" doxytag="tladmin.cc::generate_TL_entry_header"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> generate_TL_entry_header </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>nametag</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newalref</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>altitle</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>alhead</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newdilref</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>diltitle</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>dilhead</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00073">73</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00906">String::after</a>().
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00485">add_TL_chunk_or_entry</a>(), and <a class="el" href="utilities_8cc-source.html#l02358">initialize_new_DIL_TL</a>().
<p>
<div class="fragment"><pre>00073                                                                                                                                                    {
00074         <a class="code" href="classString.html">String</a> entryheader;
00075         entryheader = <font class="stringliteral">"&lt;!-- entry Begin --&gt;&lt;FONT COLOR=\"#FFFFFF\"&gt;[&lt;A NAME=\""</font>+nametag+<font class="stringliteral">"\"&gt;&lt;B&gt;"</font>+nametag.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"."</font>)+<font class="stringliteral">"&lt;/B&gt;&lt;/A&gt;"</font>;
00076         <font class="keywordflow">if</font> ((newalref[0]!=<font class="charliteral">'*'</font>) || (newdilref[0]!=<font class="charliteral">'*'</font>)) {
00077                 entryheader += <font class="stringliteral">" -\n&lt;!-- entry AL --&gt;"</font>;
00078                 <font class="keywordflow">if</font> (newalref[0]!=<font class="charliteral">'*'</font>) {
00079                         entryheader += <font class="stringliteral">"&lt;A HREF=\""</font>+newalref+<font class="stringliteral">"\"&gt;"</font>+altitle+<font class="stringliteral">"&lt;/A&gt; ("</font>;
00080                         <font class="keywordflow">if</font> (alhead!=<font class="stringliteral">""</font>) entryheader += <font class="stringliteral">"&lt;A HREF=\""</font>+alhead+<font class="stringliteral">"\"&gt;previous&lt;/A&gt;/next)\n&lt;!-- entry Context --&gt;"</font>;
00081                         <font class="keywordflow">else</font> entryheader += <font class="stringliteral">"previous/next)\n&lt;!-- entry Context --&gt;"</font>;
00082                 } <font class="keywordflow">else</font> entryheader += <font class="stringliteral">"\n&lt;!-- entry Context --&gt;"</font>;
00083                 <font class="keywordflow">if</font> (newdilref[0]!=<font class="charliteral">'*'</font>) {
00084                         <font class="keywordflow">if</font> (newdilref[0]==<font class="charliteral">'!'</font>) entryheader += newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"!"</font>)+<font class="stringliteral">" ("</font>;
00085                         <font class="keywordflow">else</font> entryheader += <font class="stringliteral">"&lt;A HREF=\""</font>+newdilref+<font class="stringliteral">"\"&gt;"</font>+diltitle+<font class="stringliteral">" "</font>+newdilref.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"#"</font>)+<font class="stringliteral">"&lt;/A&gt; ("</font>;
00086                         <font class="keywordflow">if</font> (dilhead!=<font class="stringliteral">""</font>) entryheader +=  <font class="stringliteral">"&lt;A HREF=\""</font>+dilhead+<font class="stringliteral">"\"&gt;previous&lt;/A&gt;/next)]&lt;/FONT&gt;\n&lt;BR&gt;\n"</font>;
00087                         <font class="keywordflow">else</font> entryheader += <font class="stringliteral">"previous/next)]&lt;/FONT&gt;\n&lt;BR&gt;\n"</font>;
00088                 } <font class="keywordflow">else</font> entryheader += <font class="stringliteral">"]&lt;/FONT&gt;\n&lt;BR&gt;\n"</font>;
00089         } <font class="keywordflow">else</font> entryheader += <font class="stringliteral">"]&lt;/FONT&gt;\n"</font>; <font class="comment">//*** add "&lt;BR&gt;\n" here?</font>
00090         <font class="keywordflow">return</font> entryheader;
00091 }
</pre></div>    </td>
  </tr>
</table>
<a name="a4" doxytag="tladmin.cc::get_most_recent_TC_AL"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> get_most_recent_TC_AL </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>tl</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00096">96</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00886">String::at</a>(), <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="BigString_8hh-source.html#l00849">String::prepend</a>(), and <a class="el" href="dil2al_8hh-source.html#l01180">RELLISTSDIR</a>.
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00359">select_TL_AL_refs</a>(), <a class="el" href="tladmin_8cc-source.html#l00161">select_TL_DIL_refs</a>(), and <a class="el" href="tladmin_8cc-source.html#l00117">stop_TL_chunk</a>().
<p>
<div class="fragment"><pre>00096                                           {
00097 <font class="comment">// returns the AL reference of the most recent task chunk</font>
00098         <a class="code" href="classString.html">String</a> curAL;
00099         curAL = tl.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!-- chunk AL [^(]*"</font>),-1);
00100         curAL.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!-- chunk AL --&gt;[^\"]*\""</font>));
00101         curAL.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\".*"</font>));
00102         curAL.<a class="code" href="classString.html#a22">prepend</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00103         <font class="keywordflow">return</font> curAL;
00104 }
</pre></div>    </td>
  </tr>
</table>
<a name="a5" doxytag="tladmin.cc::get_most_recent_TC_DE"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> get_most_recent_TC_DE </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>tl</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00106">106</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00886">String::at</a>(), <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), and <a class="el" href="BigString_8hh-source.html#l01234">String::gsub</a>().
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00161">select_TL_DIL_refs</a>(), and <a class="el" href="tladmin_8cc-source.html#l00117">stop_TL_chunk</a>().
<p>
<div class="fragment"><pre>00106                                           {
00107 <font class="comment">// returns the DIL entry reference of the most recent task chunk</font>
00108         <a class="code" href="classString.html">String</a> curDE;
00109         curDE = tl.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!-- chunk Context --[&gt;][^\n][^(]*("</font>),-1);
00110         curDE.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!-- chunk Context --[&gt;]"</font>));
00111         curDE.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A [^&gt;]*[Hh][Rr][Ee][Ff][         ]*=[^\"]*\""</font>));
00112         curDE.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"\"&gt;"</font>,<font class="stringliteral">":"</font>);
00113         curDE.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([&lt;][^&gt;]*[&gt;]\\)?[         ]*("</font>));
00114         <font class="keywordflow">return</font> curDE;
00115 }
</pre></div>    </td>
  </tr>
</table>
<a name="a0" doxytag="tladmin.cc::get_TL_head"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> get_TL_head </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00006">6</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="templates_8defines_8hh-source.html#l00277">res</a>, and <a class="el" href="dil2al_8hh-source.html#l01407">VOUT</a>.
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00485">add_TL_chunk_or_entry</a>(), <a class="el" href="tladmin_8cc-source.html#l00890">add_TL_section</a>(), <a class="el" href="controller_8cc-source.html#l00006">chunk_controller</a>(), <a class="el" href="note_8cc-source.html#l00384">make_note</a>(), and <a class="el" href="note_8cc-source.html#l00330">process_note</a>().
<p>
<div class="fragment"><pre>00006                      {
00007 <font class="comment">// resolves the TL symbolic link to the TL head file</font>
00008         <font class="keywordflow">if</font> (taskloghead!=<font class="stringliteral">""</font>) <font class="keywordflow">return</font> taskloghead;
00009         <font class="keyword">const</font> <font class="keywordtype">int</font> LLEN = 10240;
00010         <font class="keywordtype">char</font> lbuf[LLEN];
00011         <font class="keywordtype">int</font> <a class="code" href="templates_8defines_8hh.html#a11">res</a>;
00012         <font class="keywordflow">if</font> ((<a class="code" href="templates_8defines_8hh.html#a11">res</a>=readlink(tasklog,lbuf,LLEN))&lt;0) {
00013                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read Task Log symbolic link\n"</font> &lt;&lt; tasklog &lt;&lt; <font class="stringliteral">" in get_TL_head()\n"</font>;
00014                 <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00015         } <font class="keywordflow">else</font> {
00016                 lbuf[<a class="code" href="templates_8defines_8hh.html#a11">res</a>]=<font class="charliteral">'\0'</font>;
00017                 <font class="keywordflow">if</font> (lbuf[0]==<font class="charliteral">'/'</font>) taskloghead=lbuf;
00018                 <font class="keywordflow">else</font> {
00019                         taskloghead = tasklog;
00020                         taskloghead.gsub(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[^/]*$"</font>),<font class="stringliteral">""</font>);
00021                         taskloghead += lbuf;
00022                 }
00023                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Task Log symbolic link resolved to "</font> &lt;&lt; taskloghead &lt;&lt; <font class="charliteral">'\n'</font>;
00024                 <font class="keywordflow">return</font> taskloghead;
00025         }
00026 }
</pre></div>    </td>
  </tr>
</table>
<a name="a11" doxytag="tladmin.cc::locate_most_recent_TL_chunk"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int locate_most_recent_TL_chunk </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>seekfrom</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>chunkid</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00944">944</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00886">String::at</a>(), <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, and <a class="el" href="BigString_8hh-source.html#l01093">String::index</a>().
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00971">decide_add_TL_chunk</a>(), and <a class="el" href="tladmin_8cc-source.html#l00117">stop_TL_chunk</a>().
<p>
<div class="fragment"><pre>00944                                                                              {
00945 <font class="comment">// seeks from seekfrom through the task log to find the</font>
00946 <font class="comment">// most recent chunk, set seekfrom==-1 to search backwards</font>
00947 <font class="comment">// from the end of the task log</font>
00948 <font class="comment">// returns the starting location of the most recent chunk or the</font>
00949 <font class="comment">// beginning of the section (-1 == not found)</font>
00950 <font class="comment">// if chunkid!=NULL sets (*chunkid) to the chunk ID or to "" if</font>
00951 <font class="comment">// the beginning of the section is returned</font>
00952 <font class="comment">// requires a valid task log section in tl</font>
00953         <font class="keywordtype">int</font> tlinsertloc;
00954         <font class="keywordflow">if</font> ((tlinsertloc = tl.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[   ]+chunk Begin[  ]+--[&gt;]"</font>),seekfrom))&lt;0) {
00955                 <font class="keywordflow">if</font> (chunkid) (*chunkid) = <font class="stringliteral">""</font>; <font class="comment">// no chunks in TL</font>
00956                 <font class="keywordflow">if</font> ((tlinsertloc = tl.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[   ]+section Begin[        ]+--[&gt;]"</font>)))&lt;0) {
00957                         <font class="comment">// TL section not properly formatted</font>
00958                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Section Begin not found in "</font> &lt;&lt; taskloghead &lt;&lt; <font class="stringliteral">" in locate_most_recent_TL_chunk()\n"</font>;
00959                         <font class="keywordflow">return</font> -1;
00960                 } 
00961                 <font class="keywordflow">return</font> tlinsertloc;
00962         }
00963         <font class="keywordflow">if</font> (chunkid) {
00964                 <font class="comment">// get chunk time stamp at tlinsertloc</font>
00965                 (*chunkid) = tl.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TR[&gt;][&lt;]TD[&gt;][&lt;][^&gt;]*=[^&gt;]*[&gt;][&lt;]A[     ]+[Nn][Aa][Mm][Ee][     ]*=[    ]*\"[0-9]+"</font>),tlinsertloc);
00966                 chunkid-&gt;<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TR[&gt;][&lt;]TD[&gt;][&lt;][^&gt;]*=[^&gt;]*[&gt;][&lt;]A[   ]+[Nn][Aa][Mm][Ee][     ]*=[    ]*\""</font>));
00967         }
00968         <font class="keywordflow">return</font> tlinsertloc;
00969 }
</pre></div>    </td>
  </tr>
</table>
<a name="a1" doxytag="tladmin.cc::max_chunk_entry"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int max_chunk_entry </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>tlchunk</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00028">28</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00906">String::after</a>(), <a class="el" href="BigString_8cc-source.html#l00896">String::before</a>(), <a class="el" href="BigString_8hh-source.html#l01093">String::index</a>(), and <a class="el" href="BigString_8hh-source.html#l01192">String::matches</a>().
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00485">add_TL_chunk_or_entry</a>().
<p>
<div class="fragment"><pre>00028                                       {
00029 <font class="comment">// searches for the largest entry number in a Task Log chunk</font>
00030 <font class="comment">// returns 0 if there are no entries</font>
00031 <font class="comment">// note that this works even if the entries are not in order or entry numbers are missing</font>
00032 <font class="preprocessor">#ifdef DEBUG</font>
00033 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">"TLCHUNK:\n"</font> &lt;&lt; tlchunk &lt;&lt; <font class="charliteral">'\n'</font>;
00034 <font class="preprocessor">#endif</font>
00035 <font class="preprocessor"></font>        <font class="keywordtype">int</font> maxentry = 0, entryindex = -1;
00036         <font class="keywordflow">while</font> ((entryindex = tlchunk.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[    ]*entry Begin[  ]*--[&gt;]"</font>),entryindex+1))&gt;=0) {
00037                 <a class="code" href="classString.html">String</a> entryid = tlchunk.<a class="code" href="classString.html#a58">before</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[     ]*[&lt;]/B[&gt;]"</font>),entryindex);
00038                 entryid = entryid.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"&lt;B&gt;"</font>,-1);
00039                 <font class="keywordtype">int</font> entryidnum;
00040                 <font class="keywordflow">if</font> (entryid.<a class="code" href="classString.html#a42">matches</a>(BRXint)) entryidnum = atoi((<font class="keyword">const</font> <font class="keywordtype">char</font> *) entryid);
00041 <font class="preprocessor">#ifdef DEBUG</font>
00042 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"entryid = "</font> &lt;&lt; entryid &lt;&lt; <font class="stringliteral">"\nentryidnum = "</font> &lt;&lt; entryidnum &lt;&lt; <font class="charliteral">'\n'</font>;
00043 <font class="preprocessor">#endif</font>
00044 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (entryidnum&gt;maxentry) maxentry = entryidnum;
00045         }
00046 <font class="preprocessor">#ifdef DEBUG</font>
00047 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">"maxentry = "</font> &lt;&lt; maxentry &lt;&lt; <font class="charliteral">'\n'</font>;
00048 <font class="preprocessor">#endif</font>
00049 <font class="preprocessor"></font>        <font class="keywordflow">return</font> maxentry;
00050 }
</pre></div>    </td>
  </tr>
</table>
<a name="a8" doxytag="tladmin.cc::select_TL_AL_refs"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> select_TL_AL_refs </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newchunk</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newdilref</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00359">359</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00906">String::after</a>(), <a class="el" href="dil2al_8hh-source.html#l01245">ANSI_BOLD_OFF</a>, <a class="el" href="dil2al_8hh-source.html#l01244">ANSI_BOLD_ON</a>, <a class="el" href="dil2al_8hh-source.html#l01247">ANSI_UNDERLINE_OFF</a>, <a class="el" href="dil2al_8hh-source.html#l01246">ANSI_UNDERLINE_ON</a>, <a class="el" href="BigString_8cc-source.html#l00896">String::before</a>(), <a class="el" href="BigString_8hh-source.html#l01126">String::contains</a>(), <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="utilities_8cc-source.html#l02285">find_in_line</a>(), <a class="el" href="utilities_8cc-source.html#l02217">find_line</a>(), <a class="el" href="tladmin_8cc-source.html#l00096">get_most_recent_TC_AL</a>(), <a class="el" href="BigString_8hh-source.html#l01234">String::gsub</a>(), <a class="el" href="BigString_8hh-source.html#l01192">String::matches</a>(), <a class="el" href="BigString_8hh-source.html#l00849">String::prepend</a>(), and <a class="el" href="dil2al_8hh-source.html#l01180">RELLISTSDIR</a>.
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00485">add_TL_chunk_or_entry</a>().
<p>
<div class="fragment"><pre>00359                                                                        {
00360 <font class="comment">// select AL reference for new TL chunk or entry</font>
00361 <font class="comment">// tl should provide a pointer to a String containing</font>
00362 <font class="comment">// the most recent section of the Task Log</font>
00363 <font class="comment">// newchunk indicates if a new chunk or a new entry is being prepared</font>
00364 <font class="comment">// if newdilref=="*" then possibly choose a new AL</font>
00365 <font class="comment">// return value "*&lt;AL-ref&gt;"=same as chunk, ""=error</font>
00366 <font class="comment">// default is current AL</font>
00367         <font class="keyword">const</font> <font class="keywordtype">int</font> LLEN = 10240;
00368         <font class="keywordtype">char</font> lbuf[LLEN];
00369         <a class="code" href="classStringList.html">StringList</a> aloptions;
00370         <font class="keywordtype">int</font> numaloptions = 0;
00371         <font class="comment">// AL should default either to current, or to that associated with DIL</font>
00372         <font class="comment">// alternatives can be read from list.html</font>
00373         <font class="comment">// obtain current AL from TL</font>
00374         <a class="code" href="classString.html">String</a> curAL = <a class="code" href="tladmin_8cc.html#a4">get_most_recent_TC_AL</a>(tl);
00375 <font class="comment">//*** could insure that if newdilref!="*" the default</font>
00376 <font class="comment">//*** Active List returned is curAL if the DIL is in it,</font>
00377 <font class="comment">//*** otherwise the primary one the DIL in newdilref is in</font>
00378         <font class="keywordflow">if</font> ((askALDILref) &amp;&amp; (newdilref==<font class="stringliteral">"*"</font>)) {
00379                 <font class="comment">// some options from listfile</font>
00380                 ifstream alf(listfile);
00381                 <font class="keywordflow">if</font> (!alf) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read "</font> &lt;&lt; listfile &lt;&lt; <font class="stringliteral">" in select_TL_AL_refs(), continuing\n"</font>;
00382                 <font class="keywordflow">else</font> {
00383                         <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a46">find_line</a>(&amp;alf,<font class="stringliteral">"[&lt;]A[       ][^&gt;]*[Nn][Aa][Mm][Ee][         ]*=[    ]*\"AL\""</font>,lbuf,LLEN)) {
00384                                 <a class="code" href="classString.html">String</a> alid[2];
00385                                 <font class="keywordflow">while</font> (<a class="code" href="utilities_8cc.html#a48">find_in_line</a>(&amp;alf,<font class="stringliteral">"[&lt;]LI[&gt;][&lt;]A[         ][^&gt;]*[Hh][Rr][Ee][Ff][         ]*=[    ]*\"(.+)[&lt;][/]A[&gt;]"</font>,2,alid,<font class="stringliteral">"[&lt;][/]UL[&gt;]"</font>,lbuf,LLEN)==1) {
00386                                         alid[1].<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"\"&gt;"</font>,<font class="stringliteral">":"</font>);
00387                                         alid[1].<a class="code" href="classString.html#a83">del</a>(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00388                                         <font class="keywordflow">if</font> (!curAL.<a class="code" href="classString.html#a32">contains</a>(alid[1].before(<font class="stringliteral">":"</font>))) {
00389                                                 aloptions[numaloptions] = alid[1];
00390                                                 numaloptions++;
00391                                         }
00392                                 }
00393                         } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No AL references in "</font> &lt;&lt; listfile &lt;&lt; <font class="stringliteral">" in select_TL_AL_refs(), continuing\n"</font>;
00394                         alf.close();
00395                 }
00396                 <font class="comment">// can enter AL ids directly, or quick-chooser choice from priority list</font>
00397                 <a class="code" href="classString.html">String</a> affiliation = <font class="stringliteral">""</font>;
00398                 <font class="keywordflow">while</font> (affiliation==<font class="stringliteral">""</font>) {
00399                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a93">ANSI_UNDERLINE_ON</a>; <font class="comment">// underline on</font>
00400                         <font class="keywordflow">if</font> (newchunk) cout &lt;&lt; <font class="stringliteral">"\nChunk "</font>; <font class="keywordflow">else</font> cout &lt;&lt; <font class="stringliteral">"\nEntry "</font>;
00401                         cout &lt;&lt; <font class="stringliteral">"AL reference ID\n"</font>;
00402                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a94">ANSI_UNDERLINE_OFF</a>; <font class="comment">// underline off</font>
00403                         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;numaloptions; i++) cout &lt;&lt; i &lt;&lt; <font class="stringliteral">". "</font> &lt;&lt; aloptions[i] &lt;&lt; <font class="charliteral">'\n'</font>;
00404                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a91">ANSI_BOLD_ON</a>; <font class="comment">// bold on</font>
00405                         cout &lt;&lt; <font class="stringliteral">"\"\"="</font> &lt;&lt; curAL.<a class="code" href="classString.html#a76">after</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>) &lt;&lt; <font class="stringliteral">" DEFAULT,\n\"?\"=browse (e.g. use S to save file info to ~/tmp/dilref for dil2al),\n\"?&amp;\"=fork browser: "</font>;
00406                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a92">ANSI_BOLD_OFF</a>; <font class="comment">// bold off</font>
00407                         cin.getline(lbuf,LLEN);
00408                         <font class="keywordflow">if</font> (lbuf[0]!=<font class="charliteral">'\0'</font>) {
00409                                 affiliation = lbuf;
00410                                 <font class="keywordflow">if</font> (affiliation.<a class="code" href="classString.html#a42">matches</a>(BRXint)) { <font class="comment">// quick-select menu item</font>
00411                                         <font class="keywordtype">int</font> q = atoi((<font class="keyword">const</font> <font class="keywordtype">char</font> *) affiliation);
00412                                         <font class="keywordflow">if</font> ((q&gt;=0) &amp;&amp; (q&lt;numaloptions)) affiliation = aloptions[q].before(<font class="stringliteral">":"</font>);
00413                                         <font class="keywordflow">else</font> {
00414                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Selection "</font> &lt;&lt; q &lt;&lt; <font class="stringliteral">" is not a predefined AL reference option\n"</font>;
00415                                                 affiliation = <font class="stringliteral">""</font>;
00416                                         }
00417                                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (affiliation==<font class="stringliteral">"?"</font>) {
00418                                         <font class="keywordflow">if</font> (system(browser+<font class="stringliteral">" "</font>+listfile)&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to browse in select_TL_AL_refs(), continuing\n"</font>;
00419                                         affiliation = <font class="stringliteral">""</font>;
00420                                         ifstream drf(dilref);
00421                                         <font class="keywordflow">if</font> (drf) {
00422                                                 <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a46">find_line</a>(&amp;drf,<font class="stringliteral">"Current URL"</font>,lbuf,LLEN)) {
00423                                                         <a class="code" href="classString.html">String</a> urlline = lbuf;
00424                                                         drf.getline(lbuf,LLEN);
00425                                                         <font class="keywordflow">if</font> (lbuf[0]==<font class="charliteral">' '</font>) urlline += lbuf;
00426                                                         urlline.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"Current URL"</font>);
00427                                                         urlline.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"file://"</font>);
00428                                                         urlline.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">" "</font>,<font class="stringliteral">""</font>);
00429                                                         urlline.<a class="code" href="classString.html#a83">del</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00430                                                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a91">ANSI_BOLD_ON</a>; <font class="comment">// bold on</font>
00431                                                         cout &lt;&lt; <font class="stringliteral">"Take `"</font> &lt;&lt; urlline &lt;&lt; <font class="stringliteral">"' as AL reference ID? (y/N)"</font>;
00432                                                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a92">ANSI_BOLD_OFF</a>; <font class="comment">// bold off</font>
00433                                                         cin.getline(lbuf,LLEN);
00434                                                         <font class="keywordflow">if</font> ((lbuf[0]==<font class="charliteral">'y'</font>) || (lbuf[0]==<font class="charliteral">'Y'</font>)) affiliation = urlline;
00435                                                 }
00436                                                 drf.close();
00437                                                 unlink(dilref);
00438                                         }
00439                                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (affiliation==<font class="stringliteral">"?&amp;"</font>) {
00440                                         <font class="keywordflow">if</font> (system(<font class="stringliteral">"rxvt -e "</font>+browser+<font class="stringliteral">" "</font>+curAL+<font class="stringliteral">" &amp;"</font>)&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to spawn a browser in select_TL_AL_refs(), continuing\n"</font>;
00441                                         affiliation = <font class="stringliteral">""</font>;
00442                                 } <font class="keywordflow">else</font> { <font class="comment">// verify that string is AL ID</font>
00443                                         alf.open(listfile);
00444                                         <font class="keywordflow">if</font> (!alf) {
00445                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read "</font> &lt;&lt; listfile &lt;&lt; <font class="stringliteral">" in select_TL_AL_ref()\n"</font>;
00446                                                 <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00447                                         }
00448 <font class="preprocessor">#ifdef DEBUG</font>
00449 <font class="preprocessor"></font>                                        cout &lt;&lt; <font class="stringliteral">"seeking "</font> &lt;&lt; affiliation &lt;&lt; <font class="charliteral">'\n'</font>;
00450 <font class="preprocessor">#endif</font>
00451 <font class="preprocessor"></font>                                        <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a46">find_line</a>(&amp;alf,<font class="stringliteral">"[&lt;]A[       ][^&gt;]*[Nn][Aa][Mm][Ee][         ]*=[    ]*\"AL\""</font>,lbuf,LLEN)) {
00452                                                 affiliation.<a class="code" href="classString.html#a22">prepend</a>(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00453                                                 affiliation.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"[&lt;]LI[&gt;][&lt;]A[      ][^&gt;]*[Hh][Rr][Ee][Ff][         ]*=[    ]*\""</font>);
00454                                                 <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a46">find_line</a>(&amp;alf,affiliation,lbuf,LLEN)) {
00455                                                         affiliation = lbuf;
00456                                                         affiliation = affiliation.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[Hh][Rr][Ee][Ff][     ]*=[    ]*\""</font>));
00457                                                         affiliation = affiliation.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00458                                                         affiliation = affiliation.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"\"&gt;"</font>);
00459 <font class="preprocessor">#ifdef DEBUG</font>
00460 <font class="preprocessor"></font>                                                        cout &lt;&lt; <font class="stringliteral">"exists: "</font> &lt;&lt; affiliation &lt;&lt; <font class="charliteral">'\n'</font>;
00461 <font class="preprocessor">#endif</font>
00462 <font class="preprocessor"></font>                                                } <font class="keywordflow">else</font> {
00463                                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: AL reference "</font> &lt;&lt; affiliation &lt;&lt; <font class="stringliteral">" not found in "</font> &lt;&lt; listfile &lt;&lt; <font class="charliteral">'\n'</font>;
00464                                                         affiliation = <font class="stringliteral">""</font>;
00465                                                 }
00466                                         } <font class="keywordflow">else</font> {
00467                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No AL references found in "</font> &lt;&lt; listfile &lt;&lt; <font class="stringliteral">" in select_TL_AL_ref()\n"</font>;
00468                                                 <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00469                                         }
00470                                         alf.close();
00471                                 }
00472                         } <font class="keywordflow">else</font> {
00473                                 affiliation = curAL.<a class="code" href="classString.html#a76">after</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00474                                 <font class="keywordflow">if</font> (!newchunk) affiliation.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"*"</font>); <font class="comment">// same as chunk AL (no entry specific reference required)</font>
00475                         }
00476                 }
00477                 <font class="keywordflow">return</font> affiliation;
00478         } <font class="keywordflow">else</font> {
00479                 curAL = curAL.<a class="code" href="classString.html#a76">after</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00480                 <font class="keywordflow">if</font> (!newchunk) curAL.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"*"</font>);
00481                 <font class="keywordflow">return</font> curAL;
00482         }
00483 }
</pre></div>    </td>
  </tr>
</table>
<a name="a7" doxytag="tladmin.cc::select_TL_DIL_refs"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> select_TL_DIL_refs </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newchunk</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>newalref</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00161">161</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="dil2al_8hh-source.html#l01242">AAU_ASK</a>, <a class="el" href="dil2al_8hh-source.html#l01240">AAU_NO</a>, <a class="el" href="BigString_8cc-source.html#l00906">String::after</a>(), <a class="el" href="dil2al_8hh-source.html#l01245">ANSI_BOLD_OFF</a>, <a class="el" href="dil2al_8hh-source.html#l01244">ANSI_BOLD_ON</a>, <a class="el" href="dil2al_8hh-source.html#l01247">ANSI_UNDERLINE_OFF</a>, <a class="el" href="dil2al_8hh-source.html#l01246">ANSI_UNDERLINE_ON</a>, <a class="el" href="BigString_8cc-source.html#l00886">String::at</a>(), <a class="el" href="BigString_8cc-source.html#l00896">String::before</a>(), <a class="el" href="utilities_8cc-source.html#l01907">confirmation</a>(), <a class="el" href="utilities_8cc-source.html#l00083">StringList::contains</a>(), <a class="el" href="BigString_8hh-source.html#l01126">String::contains</a>(), <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="utilities_8cc-source.html#l02217">find_line</a>(), <a class="el" href="alcomp_8cc-source.html#l00985">generate_AL</a>(), <a class="el" href="tladmin_8cc-source.html#l00096">get_most_recent_TC_AL</a>(), <a class="el" href="tladmin_8cc-source.html#l00106">get_most_recent_TC_DE</a>(), <a class="el" href="BigString_8hh-source.html#l01234">String::gsub</a>(), <a class="el" href="utilities_8cc-source.html#l02483">HTML_get_href</a>(), <a class="el" href="utilities_8cc-source.html#l02455">HTML_get_table_cell</a>(), <a class="el" href="utilities_8cc-source.html#l02555">HTML_remove_tags</a>(), <a class="el" href="BigString_8hh-source.html#l01093">String::index</a>(), <a class="el" href="BigString_8hh-source.html#l00493">String::length</a>(), <a class="el" href="BigRegex_8cc-source.html#l00111">BigRegex::match_info</a>(), <a class="el" href="BigString_8hh-source.html#l01192">String::matches</a>(), <a class="el" href="BigString_8hh-source.html#l00849">String::prepend</a>(), <a class="el" href="utilities_8cc-source.html#l02074">read_file_into_String</a>(), <a class="el" href="dil2al_8hh-source.html#l01180">RELLISTSDIR</a>, <a class="el" href="utilities_8cc-source.html#l02680">remove_whitespace</a>(), <a class="el" href="BigRegex_8cc-source.html#l00190">BigRegex::search</a>(), <a class="el" href="utilities_8cc-source.html#l01681">Detailed_Items_List::Sort_by_Target_Date</a>(), <a class="el" href="BigRegex_8cc-source.html#l00123">BigRegex::sublen</a>(), <a class="el" href="BigRegex_8cc-source.html#l00118">BigRegex::subpos</a>(), <a class="el" href="utilities_8cc-source.html#l01889">time_stamp_diff</a>(), and <a class="el" href="dil2al_8hh-source.html#l01407">VOUT</a>.
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00485">add_TL_chunk_or_entry</a>().
<p>
<div class="fragment"><pre>00161                                                                        {
00162 <font class="comment">// select DIL reference for new TL chunk or entry</font>
00163 <font class="comment">// tl should provide a pointer to a String containing</font>
00164 <font class="comment">// the most recent section of the Task Log</font>
00165 <font class="comment">// newchunk indicates if a new chunk or a new entry is being prepared</font>
00166 <font class="comment">// if newalref is not "" then use it as AL for default/quick choices</font>
00167 <font class="comment">// return value "*&lt;DIL-ref&gt;"=same as chunk, "!&lt;DIL-ref&gt;"=non-DIL identifying</font>
00168 <font class="comment">// comment, "*"=decision postponed (see variableAL), ""=error</font>
00169 <font class="comment">// when newchunk=true the default is the highest priority item in the current AL</font>
00170 <font class="comment">// when newchunk=true the default is the same as that of the current chunk</font>
00171         <font class="keyword">const</font> <font class="keywordtype">int</font> LLEN = 10240;
00172         <font class="keywordtype">char</font> lbuf[LLEN];
00173         <a class="code" href="classStringList.html">StringList</a> diloptions;
00174         <font class="keywordtype">int</font> numdiloptions = 0;
00175         <a class="code" href="classString.html">String</a> curAL;
00176         <font class="keywordflow">if</font> (newalref==<font class="stringliteral">""</font>) curAL = <a class="code" href="tladmin_8cc.html#a4">get_most_recent_TC_AL</a>(tl); <font class="comment">// obtain current AL from TL</font>
00177         <font class="keywordflow">else</font> {
00178                 <font class="keywordflow">if</font> (newalref[0]==<font class="charliteral">'*'</font>) newalref.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"*"</font>);
00179                 curAL = basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>+newalref;
00180         }
00181         <font class="comment">// obtain default DIL ref for TL entry</font>
00182         <font class="keywordflow">if</font> (!newchunk) { <font class="comment">// chunk DIL ref (or identifying comment) is default</font>
00183                 diloptions[0] = <a class="code" href="tladmin_8cc.html#a5">get_most_recent_TC_DE</a>(tl);
00184                 <font class="keywordflow">if</font> (diloptions[0]==<font class="stringliteral">""</font>) {
00185                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Entry is not in a Task Log chunk in select_TL_DIL_refs()\n"</font>;
00186                         <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00187                 }
00188                 numdiloptions++;
00189         }
00190         <font class="comment">// recompute the AL if the suggested start time for the next</font>
00191         <font class="comment">// TC is significantly earlier than the current time</font>
00192         <a class="code" href="classString.html">String</a> curALstr;
00193         <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(curAL,curALstr)) {
00194                 <a class="code" href="classString.html">String</a> tmpstr, cellcontent;
00195                 <a class="code" href="utilities_8cc.html#a54">HTML_get_table_cell</a>(curALstr,0,tmpstr,cellcontent);
00196                 <a class="code" href="utilities_8cc.html#a62">HTML_remove_tags</a>(cellcontent);
00197                 <a class="code" href="classBigRegex.html">BigRegex</a> alr(<font class="stringliteral">"Day[      ]+\\([0-9]+\\).*suggested[      ]+start[        ]+\\([0-9][0-9]\\):\\([0-9][0-9]\\)"</font>);
00198                 <font class="keywordflow">if</font> (cellcontent.<a class="code" href="classString.html#a26">index</a>(alr)==0) {
00199                         <font class="comment">// get suggested start time for next TC</font>
00200                         tmpstr = cellcontent.<a class="code" href="classString.html#a51">at</a>(alr.<a class="code" href="classBigRegex.html#a5">subpos</a>(1),alr.<a class="code" href="classBigRegex.html#a6">sublen</a>(1))+cellcontent.<a class="code" href="classString.html#a51">at</a>(alr.<a class="code" href="classBigRegex.html#a5">subpos</a>(2),alr.<a class="code" href="classBigRegex.html#a6">sublen</a>(2))+cellcontent.<a class="code" href="classString.html#a51">at</a>(alr.<a class="code" href="classBigRegex.html#a5">subpos</a>(3),alr.<a class="code" href="classBigRegex.html#a6">sublen</a>(3));
00201                         time_t tdiff = <a class="code" href="utilities_8cc.html#a26">time_stamp_diff</a>(tmpstr,curtime); <font class="comment">// positive if curtime is later than suggested time</font>
00202                         <font class="keywordflow">if</font> (tdiff&gt;alsyncslack) { <font class="comment">// recompute the AL</font>
00203                                 <font class="comment">// determine if AL updating should be automatic</font>
00204                                 <font class="comment">// *** Note: A separate configuration variable should be used if alautoupdate</font>
00205                                 <font class="comment">//     should apply only to the recomputation of the AL in stop_TL_chunk()</font>
00206                                 <font class="comment">//     above.</font>
00207                                 <font class="keywordflow">switch</font> (alautoupdate) {
00208                                         <font class="keywordflow">case</font> <a class="code" href="dil2al_8hh.html#a88">AAU_NO</a>:
00209                                                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Warning: AL desynchronized, no automatic recomputation (alautoupdate==AAU_NO)\n"</font>;
00210                                                 <font class="keywordflow">break</font>;
00211                                         <font class="keywordflow">case</font> <a class="code" href="dil2al_8hh.html#a90">AAU_ASK</a>:
00212                                                 <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a28">confirmation</a>(<font class="stringliteral">"AL desynchronized, update now? (y/N) "</font>,<font class="charliteral">'y'</font>)) <font class="keywordflow">break</font>;
00213                                         <font class="keywordflow">default</font>:
00214                                                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Recomputing AL\n"</font>;
00215                                                 <a class="code" href="classDetailed__Items__List.html">Detailed_Items_List</a> dilist;
00216                                                 <a class="code" href="classDIL__entry.html">DIL_entry</a> ** dep = dilist.<a class="code" href="classDetailed__Items__List.html#a4">Sort_by_Target_Date</a>(<font class="keyword">true</font>);
00217                                                 <font class="comment">// *** make this able to request generation of an AL</font>
00218                                                 <font class="comment">//     corresponding to the superior that generated curAL</font>
00219                                                 <font class="keywordflow">if</font> (!<a class="code" href="alcomp_8cc.html#a13">generate_AL</a>(dep)) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to generate AL in select_TL_DIL_refs(), continuing as is\n"</font>;
00220                                                 <font class="keywordflow">else</font> { <font class="comment">// get new version of AL</font>
00221                                                         curALstr = <font class="stringliteral">""</font>;
00222                                                         <a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(curAL,curALstr);
00223                                                 }
00224                                                 <font class="keyword">delete</font>[] dep;
00225                                 }
00226                         }
00227                         <font class="comment">// *** it is possible to add a message here if curtime is a lot</font>
00228                         <font class="comment">//     smaller than the suggested start time of the AL, e.g.</font>
00229                         <font class="comment">//     if all suggested TCs for this AL day have been completed</font>
00230                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"Day row missing at top of AL "</font> &lt;&lt; curAL &lt;&lt; <font class="stringliteral">" in select_TL_DIL_refs(), continuing as is\n"</font>;
00231         }
00232         <font class="comment">// some options from high priority current AL items</font>
00233         <font class="keywordflow">if</font> (curALstr.<a class="code" href="classString.html#a105">length</a>()&gt;0) {
00234                 <font class="keywordtype">int</font> cellindex = 0; <a class="code" href="classString.html">String</a> cellparameters, cellcontent;
00235                 <font class="keywordflow">while</font> ((numdiloptions&lt;6) &amp;&amp; ((cellindex=HTML_get_table_cell(curALstr,cellindex,cellparameters,cellcontent))&gt;=0))
00236                         <font class="keywordflow">if</font> (!cellcontent.<a class="code" href="classString.html#a32">contains</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[     ]+@select_TL_DIL_refs:[         ]+SKIP ROW@[    ]+--[&gt;]"</font>))) { <font class="comment">// skip marked rows</font>
00237                                 diloptions[numdiloptions]=cellcontent;
00238                                 <a class="code" href="classString.html">String</a> idhreftext;
00239                                 <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a58">HTML_get_href</a>(cellcontent,0,cellparameters,idhreftext)&gt;=0) {
00240                                         <font class="comment">// only unique DIL options</font>
00241                                         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;numdiloptions; i++) <font class="keywordflow">if</font> (diloptions[i].<a class="code" href="classStringList.html#a12">contains</a>(idhreftext)) { cellparameters=<font class="stringliteral">""</font>; <font class="keywordflow">break</font>; }
00242                                         <font class="keywordflow">if</font> (cellparameters.<a class="code" href="classString.html#a105">length</a>()&gt;0) {
00243                                                 diloptions[numdiloptions]=cellparameters+<font class="charliteral">':'</font>+cellcontent.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[]]\n?"</font>));
00244                                                 <a class="code" href="utilities_8cc.html#a62">HTML_remove_tags</a>(diloptions[numdiloptions]);
00245                                                 <a class="code" href="utilities_8cc.html#a81">remove_whitespace</a>(diloptions[numdiloptions]);
00246                                                 <font class="keywordflow">if</font> (diloptions[numdiloptions]!=<font class="stringliteral">""</font>) numdiloptions++;
00247                                         }
00248                                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"Missing DIL entry reference in AL "</font> &lt;&lt; curAL &lt;&lt; <font class="stringliteral">" in select_TL_DIL_refs(), continuing\n"</font>;
00249                         }
00250         }
00251         <font class="comment">// some options from recent DIL refs in TL</font>
00252         <a class="code" href="classBigRegex.html">BigRegex</a> r(<font class="stringliteral">"[&lt;]!-- \\(chunk\\|entry\\) Context --[&gt;]\\([^\n][^(]*\\)("</font>);
00253         <font class="keywordtype">int</font> pos = tl.<a class="code" href="classString.html#a105">length</a>(), matchlen;
00254         <font class="keywordflow">while</font> (((pos = r.<a class="code" href="classBigRegex.html#a3">search</a>(tl,pos-1,matchlen,-1))&gt;=0) &amp;&amp; (numdiloptions&lt;10)) {
00255 <font class="preprocessor">#ifdef VERBOSEDEBUG</font>
00256 <font class="preprocessor"></font>                cout &lt;&lt; <font class="stringliteral">"Context...\n"</font>;
00257 <font class="preprocessor">#endif</font>
00258 <font class="preprocessor"></font>                <font class="keywordtype">int</font> subpos;
00259                 <font class="keywordflow">if</font> (r.<a class="code" href="classBigRegex.html#a4">match_info</a>(subpos,matchlen,2)) {
00260                         diloptions[numdiloptions] = tl.<a class="code" href="classString.html#a51">at</a>(subpos,matchlen);
00261 <font class="preprocessor">#ifdef VERBOSEDEBUG</font>
00262 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="stringliteral">"Candidate Context from TL: "</font> &lt;&lt; diloptions[numdiloptions] &lt;&lt; <font class="charliteral">'\n'</font>;
00263 <font class="preprocessor">#endif</font>
00264 <font class="preprocessor"></font>                        <a class="code" href="classString.html">String</a> idhrefname = diloptions[numdiloptions].at(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"#[0-9]+[.][0-9]+"</font>));
00265                         <font class="comment">// only unique DIL options</font>
00266                         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;numdiloptions; i++) <font class="keywordflow">if</font> (diloptions[i].<a class="code" href="classString.html#a32">contains</a>(idhrefname)) { idhrefname=<font class="stringliteral">""</font>; <font class="keywordflow">break</font>; }
00267                         <font class="keywordflow">if</font> (idhrefname!=<font class="stringliteral">""</font>) {
00268                                 diloptions[numdiloptions].<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A [^&gt;]*[Hh][Rr][Ee][Ff][     ]*=[^\"]*\""</font>));
00269                                 diloptions[numdiloptions].<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"\"&gt;"</font>,<font class="stringliteral">":"</font>);
00270                                 diloptions[numdiloptions].<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([&lt;][^&gt;]*[&gt;]\\)?[     ]*("</font>));
00271                                 <font class="keywordflow">if</font> (diloptions[numdiloptions]!=<font class="stringliteral">""</font>) numdiloptions++;
00272                         }
00273                 }
00274         }
00275         <font class="comment">// can enter DIL ids directly, or quick-chooser choice from priority list, or textual comment instead of DIL</font>
00276         <font class="keywordflow">if</font> (askALDILref) {
00277                 <a class="code" href="classString.html">String</a> affiliation = <font class="stringliteral">""</font>;
00278                 <font class="keywordflow">while</font> (affiliation==<font class="stringliteral">""</font>) {
00279                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a93">ANSI_UNDERLINE_ON</a>; <font class="comment">// underline on</font>
00280                         <font class="keywordflow">if</font> (newchunk) cout &lt;&lt; <font class="stringliteral">"\nChunk "</font>; <font class="keywordflow">else</font> cout &lt;&lt; <font class="stringliteral">"\nEntry "</font>;
00281                         cout &lt;&lt; <font class="stringliteral">"DIL reference ID or identifying comment (DIL references generally\npreferred) can include HREFs\n"</font>;
00282                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a94">ANSI_UNDERLINE_OFF</a>; <font class="comment">// underline off</font>
00283                         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=1; i&lt;numdiloptions; i++) cout &lt;&lt; i &lt;&lt; <font class="stringliteral">". "</font> &lt;&lt; diloptions[i] &lt;&lt; <font class="charliteral">'\n'</font>;
00284                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a91">ANSI_BOLD_ON</a>; <font class="comment">// bold on</font>
00285                         cout &lt;&lt; <font class="stringliteral">"\"\"="</font> &lt;&lt; diloptions[0] &lt;&lt; <font class="stringliteral">" DEFAULT,\n\"?\"=browse (e.g. use S to save file info to ~/tmp/dilref for dil2al),\n\"?&amp;\"=fork browser, \"*\"=postpone and get new Active List\n(current AL = "</font>
00286                                 &lt;&lt; curAL.<a class="code" href="classString.html#a76">after</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>) &lt;&lt; <font class="stringliteral">"): "</font>;
00287                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a92">ANSI_BOLD_OFF</a>; <font class="comment">// bold off</font>
00288                         cin.getline(lbuf,LLEN);
00289                         <font class="keywordflow">if</font> (lbuf[0]!=<font class="charliteral">'\0'</font>) {
00290                                 affiliation = lbuf;
00291                                 <font class="keywordflow">if</font> (affiliation.<a class="code" href="classString.html#a42">matches</a>(BRXint)) { <font class="comment">// quick-select menu item</font>
00292                                         <font class="keywordtype">int</font> q = atoi((<font class="keyword">const</font> <font class="keywordtype">char</font> *) affiliation);
00293                                         <font class="keywordflow">if</font> ((q&gt;0) &amp;&amp; (q&lt;numdiloptions)) affiliation = diloptions[q].<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">":"</font>);
00294                                         <font class="keywordflow">else</font> {
00295                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Selection "</font> &lt;&lt; q &lt;&lt; <font class="stringliteral">" is not a predefined DIL reference option\n"</font>;
00296                                                 affiliation = <font class="stringliteral">""</font>;
00297                                         }
00298                                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (affiliation.<a class="code" href="classString.html#a42">matches</a>(BRXdouble)) { <font class="comment">// DIL ID</font>
00299                                         ifstream dbid(idfile);
00300                                         <font class="keywordflow">if</font> (!dbid) {
00301                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read "</font> &lt;&lt; idfile &lt;&lt; <font class="stringliteral">" in select_TL_DIL_ref()\n"</font>;
00302                                                 <font class="keywordflow">return</font> <a class="code" href="classString.html">String</a>(<font class="stringliteral">""</font>);
00303                                         }
00304                                         affiliation.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"#"</font>);
00305 <font class="preprocessor">#ifdef DEBUG</font>
00306 <font class="preprocessor"></font>                                        cout &lt;&lt; <font class="stringliteral">"seeking "</font> &lt;&lt; affiliation &lt;&lt; <font class="charliteral">'\n'</font>;
00307 <font class="preprocessor">#endif</font>
00308 <font class="preprocessor"></font>                                        <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a46">find_line</a>(&amp;dbid,affiliation,lbuf,LLEN)) {
00309                                                 affiliation = lbuf;
00310                                                 affiliation.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[^&lt;]*[&lt;]TD[^&gt;]*[&gt;][&lt;]A[^&gt;]*[Hh][Rr][Ee][Ff]=\""</font>));
00311                                                 affiliation = affiliation.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"\""</font>);
00312 <font class="preprocessor">#ifdef DEBUG</font>
00313 <font class="preprocessor"></font>                                        cout &lt;&lt; <font class="stringliteral">"exists: "</font> &lt;&lt; affiliation &lt;&lt; <font class="charliteral">'\n'</font>;
00314 <font class="preprocessor">#endif</font>
00315 <font class="preprocessor"></font>                                        } <font class="keywordflow">else</font> {
00316                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: DIL reference "</font> &lt;&lt; affiliation &lt;&lt; <font class="stringliteral">" not found in "</font> &lt;&lt; idfile &lt;&lt; <font class="charliteral">'\n'</font>;
00317                                                 affiliation = <font class="stringliteral">""</font>;
00318                                         }
00319                                         dbid.close();
00320                                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (affiliation==<font class="stringliteral">"?"</font>) {
00321                                         <font class="keywordflow">if</font> (system(browser+<font class="stringliteral">" "</font>+curAL)&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to browse in select_TL_DIL_refs(), continuing\n"</font>;
00322                                         affiliation = <font class="stringliteral">""</font>;
00323                                         ifstream drf(dilref);
00324                                         <font class="keywordflow">if</font> (drf) {
00325                                                 <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a46">find_line</a>(&amp;drf,<font class="stringliteral">"Current URL"</font>,lbuf,LLEN)) {
00326                                                         <a class="code" href="classString.html">String</a> urlline = lbuf;
00327                                                         drf.getline(lbuf,LLEN);
00328                                                         <font class="keywordflow">if</font> (lbuf[0]==<font class="charliteral">' '</font>) urlline += lbuf;
00329                                                         urlline.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"Current URL"</font>);
00330                                                         urlline.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"file://"</font>);
00331                                                         urlline.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">" "</font>,<font class="stringliteral">""</font>);
00332                                                         urlline.<a class="code" href="classString.html#a83">del</a>(basedir+<a class="code" href="dil2al_8hh.html#a34">RELLISTSDIR</a>);
00333                                                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a91">ANSI_BOLD_ON</a>; <font class="comment">// bold on</font>
00334                                                         cout &lt;&lt; <font class="stringliteral">"Take `"</font> &lt;&lt; urlline &lt;&lt; <font class="stringliteral">"' as DIL reference ID or identifying comment? (y/N)"</font>;
00335                                                         <font class="keywordflow">if</font> (useansi) cout &lt;&lt; <a class="code" href="dil2al_8hh.html#a92">ANSI_BOLD_OFF</a>; <font class="comment">// bold off</font>
00336                                                         cin.getline(lbuf,LLEN);
00337                                                         <font class="keywordflow">if</font> ((lbuf[0]==<font class="charliteral">'y'</font>) || (lbuf[0]==<font class="charliteral">'Y'</font>)) affiliation=urlline;
00338                                                 }
00339                                                 drf.close();
00340                                                 unlink(dilref);
00341                                         }
00342                                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (affiliation==<font class="stringliteral">"?&amp;"</font>) {
00343                                         <font class="keywordflow">if</font> (system(<font class="stringliteral">"rxvt -e "</font>+browser+<font class="stringliteral">" "</font>+curAL+<font class="stringliteral">" &amp;"</font>)&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to spawn a browser in select_TL_DIL_refs(), continuing\n"</font>;
00344                                         affiliation = <font class="stringliteral">""</font>;
00345                                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (affiliation!=<font class="stringliteral">"*"</font>) affiliation.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"!"</font>); <font class="comment">// else non-DIL identifying comment</font>
00346                         } <font class="keywordflow">else</font> {
00347                                 affiliation=diloptions[0].<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">":"</font>);
00348                                 <font class="keywordflow">if</font> (!newchunk) affiliation.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"*"</font>); <font class="comment">// same as chunk DIL (no entry specific reference required)</font>
00349                         }
00350                 }
00351                 <font class="keywordflow">return</font> affiliation;
00352         } <font class="keywordflow">else</font> {
00353                 diloptions[0]=diloptions[0].<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">":"</font>);
00354                 <font class="keywordflow">if</font> (!newchunk) diloptions[0].<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"*"</font>);
00355                 <font class="keywordflow">return</font> diloptions[0];
00356         }
00357 }
</pre></div>    </td>
  </tr>
</table>
<a name="a6" doxytag="tladmin.cc::stop_TL_chunk"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void stop_TL_chunk </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>tl</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="tladmin_8cc-source.html#l00117">117</a> of file <a class="el" href="tladmin_8cc-source.html">tladmin.cc</a>.
<p>
References <a class="el" href="dil2al_8hh-source.html#l01242">AAU_ASK</a>, <a class="el" href="dil2al_8hh-source.html#l01240">AAU_NO</a>, <a class="el" href="BigString_8cc-source.html#l00906">String::after</a>(), <a class="el" href="BigString_8cc-source.html#l00896">String::before</a>(), <a class="el" href="utilities_8cc-source.html#l01907">confirmation</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="alcomp_8cc-source.html#l00985">generate_AL</a>(), <a class="el" href="tladmin_8cc-source.html#l00096">get_most_recent_TC_AL</a>(), <a class="el" href="tladmin_8cc-source.html#l00106">get_most_recent_TC_DE</a>(), <a class="el" href="BigString_8hh-source.html#l01234">String::gsub</a>(), <a class="el" href="tladmin_8cc-source.html#l00944">locate_most_recent_TL_chunk</a>(), <a class="el" href="BigString_8hh-source.html#l01192">String::matches</a>(), <a class="el" href="alcomp_8cc-source.html#l01256">remove_AL_TC</a>(), <a class="el" href="utilities_8cc-source.html#l01681">Detailed_Items_List::Sort_by_Target_Date</a>(), <a class="el" href="utilities_8cc-source.html#l01889">time_stamp_diff</a>(), <a class="el" href="diladmin_8cc-source.html#l00849">update_DIL_entry_elements</a>(), and <a class="el" href="dil2al_8hh-source.html#l01407">VOUT</a>.
<p>
Referenced by <a class="el" href="tladmin_8cc-source.html#l00485">add_TL_chunk_or_entry</a>(), <a class="el" href="tladmin_8cc-source.html#l00890">add_TL_section</a>(), and <a class="el" href="controller_8cc-source.html#l00006">chunk_controller</a>().
<p>
<div class="fragment"><pre>00117                                 {
00118 <font class="comment">// Mark the completion time of a Task Log chunk if there is one open</font>
00119 <font class="comment">// AL options determine if and how the current AL and closed chunk's</font>
00120 <font class="comment">// DIL entry should be updated, and the corresponding update is done.</font>
00121         <font class="keywordflow">if</font> (tl.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[   ]+chunk End[    ]+--[&gt;][        ]*[&lt;]/TD[&gt;][    ]*[&lt;]/TR[&gt;]"</font>),<font class="stringliteral">"&lt;!-- chunk End --&gt;&lt;I&gt;"</font>+curtime+<font class="stringliteral">"&lt;/I&gt;&lt;/TD&gt;&lt;/TR&gt;"</font>)&lt;=0) <font class="keywordflow">return</font>;
00122         <font class="comment">// determine if AL anc completion ratios should be updated automatically</font>
00123         <font class="keywordflow">if</font> (alautoupdate==<a class="code" href="dil2al_8hh.html#a88">AAU_NO</a>) <font class="keywordflow">return</font>;
00124         <font class="keywordflow">if</font> (alautoupdate==<a class="code" href="dil2al_8hh.html#a90">AAU_ASK</a>) <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a28">confirmation</a>(<font class="stringliteral">"Update AL and completion ratios? (y/N) "</font>,<font class="charliteral">'y'</font>)) <font class="keywordflow">return</font>;
00125         <font class="comment">// obtain AL and DIL information from the most recent chunk</font>
00126         <a class="code" href="classString.html">String</a> chunkid; <font class="keywordtype">int</font> lasttlchunk;
00127         <font class="keywordflow">if</font> ((lasttlchunk = <a class="code" href="tladmin_8cc.html#a11">locate_most_recent_TL_chunk</a>(tl,-1,&amp;chunkid))&gt;=0) {
00128                 <font class="keywordtype">bool</font> recomputeAL = <font class="keyword">false</font>;
00129                 <a class="code" href="classString.html">String</a> curAL = <a class="code" href="tladmin_8cc.html#a4">get_most_recent_TC_AL</a>(tl);
00130                 <a class="code" href="classString.html">String</a> curDE = <a class="code" href="tladmin_8cc.html#a5">get_most_recent_TC_DE</a>(tl);
00131                 <font class="comment">// a proper DIL entry ID is returned in the form:</font>
00132                 <font class="comment">// some-DIL-file.html#XXXXXXXXXXXXXX.Y:DIL-title-and-entry-ID</font>
00133                 curDE = curDE.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">':'</font>); curDE = curDE.<a class="code" href="classString.html#a76">after</a>(<font class="charliteral">'#'</font>);
00134                 <font class="keywordflow">if</font> (curDE.<a class="code" href="classString.html#a42">matches</a>(BRXdouble)) {
00135                         time_t tdiff = <a class="code" href="utilities_8cc.html#a26">time_stamp_diff</a>(chunkid,curtime);
00136 <font class="comment">// *** suggest tdiff, but allow entry of other time, in which</font>
00137 <font class="comment">//     case request if required time and completion status should</font>
00138 <font class="comment">//     be modified directly</font>
00139 <font class="comment">// *** if tdiff &gt; taskchunksize*1.25 recompute AL... this test</font>
00140 <font class="comment">//     may not be necessary, since any significant delay will</font>
00141 <font class="comment">//     cause desynchronization between the updated suggested</font>
00142 <font class="comment">//     start time in the AL and the current time, which causes</font>
00143 <font class="comment">//     recomputation of the AL when a significant difference is</font>
00144 <font class="comment">//     detected in select_TL_DIL_refs()</font>
00145                         <font class="keywordflow">if</font> (!<a class="code" href="diladmin_8cc.html#a13">update_DIL_entry_elements</a>(curDE,0.0,<font class="keyword">false</font>,0.0,<font class="keyword">true</font>,0.0,<font class="keyword">false</font>,tdiff)) recomputeAL = <font class="keyword">true</font>;
00146                         <font class="keywordflow">if</font> (!<a class="code" href="alcomp_8cc.html#a15">remove_AL_TC</a>(curAL,curDE)) recomputeAL = <font class="keyword">true</font>;
00147                 } <font class="keywordflow">else</font> {
00148                         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Completed task chunk was not a DIL entry\n"</font>;
00149                         recomputeAL = <font class="keyword">true</font>;
00150                 }
00151                 <font class="keywordflow">if</font> (recomputeAL) { <font class="comment">// recompute the AL</font>
00152                         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Recomputing AL\n"</font>;
00153                         <a class="code" href="classDetailed__Items__List.html">Detailed_Items_List</a> dilist;
00154                         <a class="code" href="classDIL__entry.html">DIL_entry</a> ** dep = dilist.<a class="code" href="classDetailed__Items__List.html#a4">Sort_by_Target_Date</a>(<font class="keyword">true</font>);
00155                         <font class="keywordflow">if</font> (!<a class="code" href="alcomp_8cc.html#a13">generate_AL</a>(dep)) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to generate AL in stop_TL_chunk(), continuing as is\n"</font>;
00156                         <font class="keyword">delete</font>[] dep;
00157                 }
00158         } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to update AL and DIL entry in stop_TL_chunk(), continuing\n"</font>;
00159 }
</pre></div>    </td>
  </tr>
</table>
<hr><address align="right"><small>Generated on Mon Sep 13 14:53:16 2004 for dil2al by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
