<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ppfilter.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ppfilter.cc</h1><a href="ppfilter_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// tlfilter.cc</font>
00002 <font class="comment">// Randal A. Koene, 20000304</font>
00003 
00004 <font class="preprocessor">#include "<a class="code" href="dil2al_8hh.html">dil2al.hh</a>"</font>
00005 
00006 <font class="comment">//#define DEBUG_PPEXTRACT</font>
00007 
<a name="l00008"></a><a class="code" href="ppfilter_8cc.html#a0">00008</a> <a class="code" href="classString.html">String</a> <a class="code" href="ppfilter_8cc.html#a0">generate_Figures_Directory_entry</a>(<a class="code" href="classString.html">String</a> figid) {
00009         <a class="code" href="classString.html">String</a> figlabel, figtype,<a class="code" href="templates_8defines_8hh.html#a11">res</a>;
00010         figlabel = figid.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'.'</font>,-1);
00011         figtype = figid.<a class="code" href="classString.html#a76">after</a>(<font class="charliteral">'.'</font>,-1);
00012         figid = figlabel; figlabel.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"^.*/"</font>));
00013         figid = <a class="code" href="utilities_8cc.html#a30">relurl</a>(figuresdirectory,figid);
00014         res = <font class="stringliteral">"&lt;LI&gt;&lt;!-- @Begin FIGURE DATA: [fig:"</font>+figlabel+<font class="stringliteral">"] "</font>+figid+<font class="stringliteral">".eps@ --&gt;\n"</font>;
00015         res += <font class="stringliteral">"[&lt;!-- @Figure label@ --&gt;fig:"</font>+figlabel+<font class="stringliteral">"]&lt;BR&gt;\n"</font>;
00016         <font class="keywordflow">if</font> (figtype!=<font class="stringliteral">"eps"</font>) res += <font class="stringliteral">"(*)"</font>;
00017         res += <font class="stringliteral">"Figure: &lt;A HREF=\""</font>+figid+<font class="stringliteral">".eps\"&gt;&lt;!-- @Figure file@ --&gt;"</font>+figid+<font class="stringliteral">".eps&lt;/A&gt;&lt;BR&gt;\n"</font>;
00018         <font class="keywordflow">if</font> (figtype!=<font class="stringliteral">"fig"</font>) res += <font class="stringliteral">"(*)"</font>;
00019         res += <font class="stringliteral">"Source: &lt;A HREF=\""</font>+figid+<font class="stringliteral">".fig\"&gt;&lt;!-- @Figure source@ --&gt;"</font>+figid+<font class="stringliteral">".fig&lt;/A&gt;&lt;BR&gt;\n"</font>;
00020         <font class="keywordflow">if</font> (figtype!=<font class="stringliteral">"ps"</font>) res += <font class="stringliteral">"(*)"</font>;
00021         res += <font class="stringliteral">"PostScript: &lt;A HREF=\""</font>+figid+<font class="stringliteral">".ps\"&gt;&lt;!-- @Figure PostScript@ --&gt;"</font>+figid+<font class="stringliteral">".ps&lt;/A&gt;&lt;BR&gt;\n"</font>;
00022         res += <font class="stringliteral">"Caption: &lt;!-- @Figure caption@ --&gt;&lt;BR&gt;\nPSfrag conversions: &lt;PRE&gt;&lt;!-- @Begin Figure psconversions@ --&gt;\n&lt;!-- @End Figure psconversions@ --&gt;&lt;/PRE&gt;\n"</font>;
00023         res += <font class="stringliteral">"Created with:\n&lt;!-- @End FIGURE DATA@ --&gt;\n\n"</font>;
00024         <font class="keywordflow">return</font> res;
00025 }
00026 
<a name="l00027"></a><a class="code" href="ppfilter_8cc.html#a1">00027</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a1">get_figure_data</a>(<a class="code" href="classString.html">String</a> &amp; figfile, <a class="code" href="classString.html">String</a> &amp; figlabel, <a class="code" href="classString.html">String</a> &amp; figcaption, <a class="code" href="classString.html">String</a> &amp; figintext, <a class="code" href="classString.html">String</a> &amp; psconversions, <a class="code" href="classStringList.html">StringList</a> &amp; srcf, <a class="code" href="classStringList.html">StringList</a> &amp; srcfname, <font class="keywordtype">int</font> &amp; srcfnum) {
00028 <font class="comment">// obtains missing figure data from the Figures Directory</font>
00029 <font class="comment">// this function can be called with data in either figfile or figlabel</font>
00030         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> figintextrx(<font class="stringliteral">"%[  ]*@Begin INTEXT@[ \t\n]*\\(.*\\)%[      ]*@End INTEXT@"</font>);
00031         <font class="keywordtype">int</font> srcidx;
00032         <font class="keywordflow">if</font> ((srcidx = <a class="code" href="utilities_8cc.html#a40">get_file_in_list</a>(figuresdirectory,srcf,srcfname,srcfnum))&lt;0)
00033                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Some figure data may be missing in get_figure_data(), continuing as is\n"</font>;
00034         <font class="keywordflow">else</font> {
00035                 <font class="comment">// find figure data</font>
00036                 <a class="code" href="classString.html">String</a> findid;
00037                 <font class="keywordflow">if</font> (!figfile.<a class="code" href="classString.html#a106">empty</a>()) findid = <a class="code" href="utilities_8cc.html#a30">relurl</a>(figuresdirectory,figfile);
00038                 <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!figlabel.<a class="code" href="classString.html#a106">empty</a>()) findid = figlabel;
00039                 <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No figure file or label, some figure data may be missing in get_figure_data(), continuing as is\n"</font>;
00040                 <font class="keywordflow">if</font> (!findid.<a class="code" href="classString.html#a106">empty</a>()) {
00041                         <font class="keywordtype">int</font> figididx;
00042                         <font class="keywordflow">if</font> ((figididx = srcf[srcidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[    ]@Begin FIGURE DATA:[^@]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(findid)+<font class="stringliteral">"[^@]*@[      ]*--[&gt;]"</font>)))&lt;0) {
00043                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Figure "</font> &lt;&lt; findid &lt;&lt; <font class="stringliteral">" not found in get_figure_data(), continuing as is\n"</font>;
00044                                 <font class="keywordflow">if</font> (!figfile.<a class="code" href="classString.html#a106">empty</a>()) figfile = findid;
00045                                 <font class="keywordflow">if</font> (figlabel.<a class="code" href="classString.html#a106">empty</a>()) {
00046                                         figlabel = figfile.<a class="code" href="classString.html#a76">after</a>(<font class="charliteral">'/'</font>,-1);
00047                                         <font class="keywordflow">if</font> (figlabel.<a class="code" href="classString.html#a106">empty</a>()) figlabel = figfile;
00048                                         <font class="keywordflow">if</font> (figlabel.<a class="code" href="classString.html#a26">index</a>(<font class="charliteral">'.'</font>,-1)&gt;=0) figlabel = figlabel.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'.'</font>,-1);
00049                                         figlabel.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"fig:"</font>);
00050                                 }
00051                         } <font class="keywordflow">else</font> {
00052                                 <font class="keywordtype">int</font> figidend;
00053                                 <font class="keywordflow">if</font> ((figidend = srcf[srcidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[    ]*@End FIGURE DATA@[    ]*--[&gt;]"</font>),figididx))&lt;0)
00054                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Figure "</font> &lt;&lt; findid &lt;&lt; <font class="stringliteral">" End marker missing in get_figure_data(), continuing as is\n"</font>;
00055                                 <font class="keywordflow">else</font> {
00056                                         <a class="code" href="classString.html">String</a> figdata = srcf[srcidx].at(figididx,figidend-figididx);
00057                                         <font class="comment">// get figure label</font>
00058                                         figlabel = figdata.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[         ]*@Figure label@[       ]*--[&gt;][        ]*[^]&lt;  \n]+"</font>));
00059                                         figlabel = figlabel.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[     ]*@Figure label@[       ]*--[&gt;][        ]*"</font>));
00060                                         <font class="comment">// get figure file</font>
00061                                         figfile = figdata.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[  ]*@Figure file@[        ]*--[&gt;][        ]*[^&lt;   \n]+"</font>));
00062                                         figfile = figfile.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[       ]*@Figure file@[        ]*--[&gt;][        ]*"</font>));
00063                                         <font class="keywordtype">int</font> fci = figdata.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[       ]*@Figure caption@[     ]*--[&gt;][        ]*"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>);
00064                                         <font class="comment">// get figure caption</font>
00065                                         figcaption = <font class="stringliteral">""</font>; figintext = <font class="stringliteral">""</font>;
00066                                         <font class="keywordflow">if</font> (fci&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Figure "</font> &lt;&lt; findid &lt;&lt; <font class="stringliteral">" ``@Figure caption@'' marker missing in get_figure_data(), continuing as is\n"</font>;
00067                                         <font class="keywordflow">else</font> {
00068                                                 <font class="keywordtype">int</font> fce = figdata.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;][Bb][Rr][&gt;][ \t\n]*PSfrag"</font>),fci);
00069                                                 <font class="keywordflow">if</font> (fce&lt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Figure "</font> &lt;&lt; findid &lt;&lt; <font class="stringliteral">" ``&lt;BR&gt;\\nPSfrag'' caption end code missing in get_figure_data(), continuing as is\n"</font>;
00070                                                 <font class="keywordflow">else</font> {
00071                                                         figcaption = figdata.<a class="code" href="classString.html#a51">at</a>(fci,fce-fci);
00072                                                         <font class="keywordflow">if</font> (figcaption.<a class="code" href="classString.html#a26">index</a>(figintextrx)&gt;=0) { <font class="comment">// identify ``INTEXT'' figure descriptions</font>
00073                                                                 figintext = <font class="stringliteral">"% @Begin INTEXT@\n"</font> + figcaption.<a class="code" href="classString.html#a82">sub</a>(figintextrx,1) + <font class="stringliteral">"% @End INTEXT@\n"</font>; <font class="comment">// place new markers to ensure line ends</font>
00074                                                                 fci = figintextrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(0); fce = figintextrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(0)+figintextrx.<a class="code" href="classBigRegex.html#a6">sublen</a>(0);
00075                                                                 <font class="keywordflow">if</font> (fci&gt;0) <font class="keywordflow">if</font> (figcaption.<a class="code" href="classString.html#a100">elem</a>(fci-1)==<font class="charliteral">'\n'</font>) fci--;
00076                                                                 <font class="keywordflow">if</font> (fce&lt;figcaption.<a class="code" href="classString.html#a105">length</a>()) <font class="keywordflow">if</font> (figcaption.<a class="code" href="classString.html#a100">elem</a>(fce)==<font class="charliteral">'\n'</font>) fce++;
00077                                                                 figcaption.<a class="code" href="classString.html#a83">del</a>(fci,fce-fci);
00078                                                         }
00079                                                         <font class="comment">// remove troublesome characters from figure caption (cannot use the convert_item_content_to_TeX() function,</font>
00080                                                         <font class="comment">// since content is already assumed to be in TeX format with codes such as $math-stuff$</font>
00081                                                         <font class="keywordflow">if</font> (figcaption.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([^\\]\\)[%&lt;&gt;]"</font>),<font class="stringliteral">"_1X"</font>,<font class="charliteral">'_'</font>)&gt;0) <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Changed special characters in figure caption to `X'\n"</font>;
00082                                                         <font class="keywordflow">if</font> (figcaption.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"^[%&lt;&gt;]"</font>),<font class="stringliteral">"X"</font>)&gt;0) <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Changed special characters in figure caption to `X'\n"</font>;
00083                                                 }
00084                                         }
00085                                         <font class="comment">// get PS conversions</font>
00086                                         <font class="keywordtype">int</font> pscidx;
00087                                         <font class="keywordflow">if</font> ((pscidx = figdata.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[   ]*@Begin Figure psconversions@[         ]*--[&gt;][        ]*"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>))&gt;=0) {
00088                                                 <font class="keywordtype">int</font> pscend;
00089                                                 <font class="keywordflow">if</font> ((pscend = figdata.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[   ]*@End Figure psconversions@[   ]*--[&gt;]"</font>),pscidx))&gt;=0)
00090                                                         psconversions = figdata.<a class="code" href="classString.html#a51">at</a>(pscidx,pscend-pscidx);
00091                                                         <font class="keywordflow">if</font> (psconversions==<font class="stringliteral">"\n"</font>) psconversions = <font class="stringliteral">""</font>;
00092                                         }
00093                                 }
00094                         }
00095                 }
00096         }
00097         <font class="keywordflow">if</font> (figfile.<a class="code" href="classString.html#a106">empty</a>()) figfile = homedir+<font class="stringliteral">"doc/tex/common-eps/placeholder.eps"</font>;
00098         <font class="keywordflow">if</font> (figlabel.<a class="code" href="classString.html#a106">empty</a>()) figlabel = <font class="stringliteral">"fig:unknown"</font>;
00099         <font class="keywordflow">if</font> (figcaption.<a class="code" href="classString.html#a106">empty</a>()) figcaption = <font class="stringliteral">"\\relax"</font>;
00100         <font class="keywordflow">if</font> (psconversions.<a class="code" href="classString.html#a106">empty</a>()) psconversions = <font class="stringliteral">"\\relax"</font>;
00101 }
00102 
<a name="l00103"></a><a class="code" href="ppfilter_8cc.html#a2">00103</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a2">get_Paper_Plans_Section_IDs</a>(<a class="code" href="classStringList.html">StringList</a> &amp; ppsectionids, <a class="code" href="classStringList.html">StringList</a> &amp; ppsectiontitles, <a class="code" href="classStringList.html">StringList</a> &amp; ppsectiontemplates) {
00104 <font class="comment">/* obtain registered IDs of paper Sections as</font>
00105 <font class="comment">   listed in the</font>
00106 <font class="comment">   &lt;A HREF="../../doc/html/lists/paper-plans.html#PST"&gt;</font>
00107 <font class="comment">   Paper Plans</font>
00108 <font class="comment">   &lt;/A&gt; file */</font>
00109         <a class="code" href="classString.html">String</a> ppfstr;
00110         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(paperplansfile,ppfstr)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00111         <font class="keywordtype">int</font> pstidx;
00112         <font class="keywordflow">if</font> ((pstidx = ppfstr.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[      ]+[Nn][Aa][Mm][Ee][     ]*=[    ]*\"PST\""</font>)))&lt;0) {
00113                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find Paper Section Titles in Paper Plans document in get_Paper_Plans_Section_IDs()\n"</font>;
00114                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00115         }
00116         <font class="keywordflow">if</font> ((pstidx = ppfstr.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;UL&gt;"</font>,pstidx))&lt;0) {
00117                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Section IDs list not found in Paper Plans document in get_Paper_Plans_Section_IDs()\n"</font>;
00118                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00119         }
00120         <font class="keywordtype">int</font> pstend = ppfstr.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;/UL&gt;"</font>,pstidx);
00121         <font class="keywordtype">int</font> pstnum = 0;
00122         <a class="code" href="classString.html">String</a> pstid, psttitle, psttemplate;
00123         <font class="keywordflow">while</font> ((pstidx = ppfstr.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;LI&gt;"</font>,pstidx+1))&gt;=0) {
00124                 <font class="keywordflow">if</font> ((<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>) pstidx &lt; (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>) pstend) {
00125                         <font class="keywordflow">if</font> ((pstid = ppfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[[]\\([&lt;][^&gt;]*[&gt;]\\)?[^]]+"</font>),pstidx))!=<font class="stringliteral">""</font>) {
00126                                 pstid.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"["</font>); pstid.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;][^&gt;]*[&gt;]"</font>),<font class="stringliteral">""</font>); pstid.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[  ]+"</font>),<font class="stringliteral">""</font>);
00127                                 <font class="keywordflow">if</font> ((psttitle = ppfstr.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[]][^\n]+"</font>),pstidx))!=<font class="stringliteral">""</font>) {
00128                                         psttitle = psttitle.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[]][        ]*"</font>));
00129                                         psttemplate = psttitle.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[    ]+[^&gt;]*[Hh][Rr][Ee][Ff][        ]*=[    ]*\""</font>));
00130                                         psttemplate = psttemplate.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"\""</font>);
00131                                         <font class="keywordflow">if</font> (psttemplate!=<font class="stringliteral">""</font>) psttemplate = <a class="code" href="utilities_8cc.html#a31">absurl</a>(paperplansfile,psttemplate);
00132                                         psttitle.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;][^&gt;]*[&gt;]"</font>),<font class="stringliteral">""</font>);
00133                                         psttitle.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[        ]*$"</font>));
00134                                         psttitle.<a class="code" href="classString.html#a82">upcase</a>();
00135                                         ppsectionids[pstnum] = pstid;
00136                                         ppsectiontitles[pstnum] = psttitle;
00137                                         ppsectiontemplates[pstnum] = psttemplate;
00138                                         pstnum++;
00139                                 }
00140                         }
00141                 } <font class="keywordflow">else</font> <font class="keywordflow">break</font>;
00142         }
00143         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00144 }
00145 
00146 <font class="comment">// #define DEBUG_DO_NOT_CREATE_NEW_OUTLINE</font>
00147 
<a name="l00148"></a><a class="code" href="ppfilter_8cc.html#a3">00148</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a4">extract_required_item_to_paper</a>(<a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> refurl, <a class="code" href="classNovelty__Marker.html">Novelty_Marker</a> &amp; nm, <a class="code" href="classString.html">String</a> &amp; sectitle, <a class="code" href="classString.html">String</a> &amp; requireditems, <a class="code" href="classString.html">String</a> &amp; pprevtext) {
00149 <font class="comment">// generates output for a Required item with HTML tagged .TeX comments</font>
00150 <font class="comment">// indicating item qualifiers, quantifiers and additional marked text</font>
00151 <font class="comment">// additionally keeps track of a list of required items to be updated</font>
00152 <font class="comment">// in the paper plan and used for AL priority DIL entries</font>
00153 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00154 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'M'</font>; cout.flush();
00155 <font class="preprocessor">#endif</font>
00156 <font class="preprocessor"></font>        <a class="code" href="classString.html">String</a> contextconcat = nm.<a class="code" href="classNovelty__Marker.html#m4">context</a>.<a class="code" href="classStringList.html#a15">concatenate</a>(<font class="stringliteral">", "</font>);
00157         <a class="code" href="classString.html">String</a> impconcat;
00158         <font class="keywordtype">char</font> fc[10];
00159         <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m5">imp</a>) {
00160                 sprintf(fc,<font class="stringliteral">"%4.2f"</font>,nm.<a class="code" href="classNovelty__Marker.html#m5">imp</a>[0]);
00161                 impconcat = fc;
00162                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=1; i&lt;nm.<a class="code" href="classNovelty__Marker.html#m6">impnum</a>; i++) {
00163                         sprintf(fc,<font class="stringliteral">"%4.2f"</font>,nm.<a class="code" href="classNovelty__Marker.html#m5">imp</a>[i]);
00164                         impconcat += <font class="stringliteral">", "</font>; impconcat += fc;
00165                 }
00166         }
00167         <font class="comment">// test if REWRITTEN</font>
00168         <font class="keywordtype">int</font> previdx;
00169         <font class="keywordflow">if</font> ((previdx = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@Begin[       ]+[^@]*REWRITTEN[^@]*[  ]+REQUIRED:[    ]*[[]"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][   ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(contextconcat)+<font class="stringliteral">"[    ]*@"</font>)))&gt;=0) {
00170                 <font class="keywordtype">int</font> prevend;
00171                 <font class="keywordflow">if</font> ((prevend = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@End[         ]+[^@]*REWRITTEN[^@]*[  ]+REQUIRED:[    ]*[[]"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][   ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(contextconcat)+<font class="stringliteral">"[    ]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) {
00172                         ostrtext += pprevtext.<a class="code" href="classString.html#a51">at</a>(previdx,prevend-previdx);
00173                         <font class="keywordflow">if</font> (verbose) { <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"+R"</font>; <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush(); }
00174                         <font class="keywordflow">if</font> ((!askextractconcat) || <a class="code" href="utilities_8cc.html#a28">confirmation</a>(<font class="stringliteral">"Append newly extracted version of REQUIRED ``"</font>+contextconcat+<font class="stringliteral">"''? (y/N) "</font>,<font class="charliteral">'y'</font>)) <font class="keywordflow">return</font>;
00175                         contextconcat += <font class="stringliteral">" (newly extracted version)"</font>;
00176                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End REWRITTEN REQUIRED: [section] concatenated-context@ in extract_required_item_to_paper(), extracting from source\n"</font>;
00177         }
00178         <font class="comment">// include required in outline</font>
00179         ostrtext += <font class="stringliteral">"\n% @Begin REQUIRED: ["</font>+sectitle+<font class="stringliteral">"] "</font>+contextconcat+<font class="stringliteral">"@\n% Context reference: "</font>;
00180         ostrtext += refurl;
00181         <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m5">imp</a>) ostrtext += <font class="stringliteral">"\n% Importance: "</font> + impconcat;
00182         sprintf(fc,<font class="stringliteral">"%4.2f"</font>,nm.<a class="code" href="classNovelty__Marker.html#m7">len</a>);
00183         ostrtext += <font class="stringliteral">"\n% Intended length: "</font>; ostrtext += fc;
00184         ostrtext += <font class="stringliteral">" pages\n\\editnote{REQUIRED: "</font> + contextconcat;
00185         <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m2">marktext</a>!=<font class="stringliteral">""</font>) ostrtext += <font class="stringliteral">" ("</font> + nm.<a class="code" href="classNovelty__Marker.html#m2">marktext</a> + <font class="charliteral">')'</font>;
00186         ostrtext += <font class="stringliteral">"}\n% @End REQUIRED: ["</font>+sectitle+<font class="stringliteral">"] "</font>+contextconcat+<font class="stringliteral">"@\n\n"</font>;
00187         <font class="comment">// collect required items for addition to paper plan</font>
00188         sprintf(fc,<font class="stringliteral">"%5.2f"</font>,nm.<a class="code" href="classNovelty__Marker.html#m7">len</a>);
00189         <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m2">marktext</a>!=<font class="stringliteral">""</font>) contextconcat.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"&lt;I&gt;"</font>+nm.<a class="code" href="classNovelty__Marker.html#m2">marktext</a>+<font class="stringliteral">";&lt;/I&gt; "</font>);
00190         requireditems += <font class="stringliteral">"&lt;LI&gt;["</font>+sectitle+<font class="stringliteral">"] "</font>+contextconcat+<font class="stringliteral">" (imp: "</font>+((impconcat+<font class="stringliteral">", len: "</font>)+fc)+<font class="stringliteral">")\n"</font>;
00191 }
00192 
00193 <font class="comment">// #define _ASK_APPEND_TO_REWRITTEN_OUT_OF_PLACE</font>
00194 
<a name="l00195"></a><a class="code" href="ppfilter_8cc.html#a4">00195</a> <font class="keywordtype">int</font> <a class="code" href="ppfilter_8cc.html#a4">TeX_get_scope</a>(<a class="code" href="classString.html">String</a> &amp; textstr, <font class="keywordtype">int</font> start, <a class="code" href="classString.html">String</a> &amp; scopecontent) {
00196 <font class="comment">// get the text between brackets starting at start</font>
00197 <font class="comment">// returns location after closing bracket or -1 if there is no closing bracket</font>
00198         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> brck1rx(<font class="stringliteral">"[\\{\\}]"</font>); <font class="comment">// \\{ rather than { because of regex-gnu.h/BigRegex.hh setting</font>
00199         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> brck2rx(<font class="stringliteral">"[][]"</font>);
00200         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> brck3rx(<font class="stringliteral">"[()]"</font>);
00201         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> * brckrx;
00202         <font class="keywordtype">char</font> bracket = textstr.<a class="code" href="classString.html#a100">elem</a>(start);
00203         <font class="keywordflow">switch</font> (bracket) {
00204                 <font class="keywordflow">case</font> <font class="charliteral">'{'</font>: brckrx = &amp;brck1rx; <font class="keywordflow">break</font>;
00205                 <font class="keywordflow">case</font> <font class="charliteral">'['</font>: brckrx = &amp;brck2rx; <font class="keywordflow">break</font>;
00206                 <font class="keywordflow">case</font> <font class="charliteral">'('</font>: brckrx = &amp;brck3rx; <font class="keywordflow">break</font>;
00207         }
00208         <font class="keywordtype">int</font> depth = 1, i = start+1;
00209         <font class="keywordflow">while</font> ((depth&gt;0) &amp;&amp; ((i=textstr.<a class="code" href="classString.html#a26">index</a>(*brckrx,i))&gt;=0)) {
00210                 <font class="keywordflow">if</font> (i&gt;0) <font class="keywordflow">if</font> (textstr.<a class="code" href="classString.html#a100">elem</a>(i-1)==<font class="charliteral">'\\'</font>) { i++; <font class="keywordflow">continue</font>; } <font class="comment">// escaped bracket</font>
00211                 <font class="keywordflow">if</font> (textstr.<a class="code" href="classString.html#a100">elem</a>(i)==bracket) depth++; <font class="keywordflow">else</font> depth--;
00212                 i++;
00213         }
00214         <font class="keywordflow">if</font> (i&gt;=0) scopecontent = textstr.<a class="code" href="classString.html#a51">at</a>(start+1,i-(start+2));
00215         <font class="keywordflow">return</font> i;
00216 }
00217 
<a name="l00218"></a><a class="code" href="ppfilter_8cc.html#a5">00218</a> <font class="keywordtype">int</font> <a class="code" href="ppfilter_8cc.html#a5">TeX_get_argument</a>(<a class="code" href="classString.html">String</a> &amp; textstr, <font class="keywordtype">int</font> start, <a class="code" href="classString.html">String</a> &amp; argstr, <font class="keywordtype">char</font> argtype, <font class="keywordtype">int</font> * argstart = NULL) {
00219 <font class="comment">// get argument text between argtype brackets after start</font>
00220 <font class="comment">// returns location after closing bracket or -1 if there is no such argument</font>
00221 <font class="comment">// white space characters may precede the opening bracket</font>
00222         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> nonwsrx(<font class="stringliteral">"[^ \n\t\r\v\f]"</font>);
00223         <font class="keywordflow">if</font> ((start=textstr.<a class="code" href="classString.html#a26">index</a>(nonwsrx,start))&lt;0) <font class="keywordflow">return</font> -1;
00224         <font class="keywordflow">if</font> (textstr.<a class="code" href="classString.html#a100">elem</a>(start)!=argtype) <font class="keywordflow">return</font> -1;
00225         <font class="keywordflow">if</font> (argstart) *argstart = start;
00226         <font class="keywordflow">return</font> <a class="code" href="ppfilter_8cc.html#a4">TeX_get_scope</a>(textstr,start,argstr);
00227 }
00228 
<a name="l00229"></a><a class="code" href="ppfilter_8cc.html#a6">00229</a> <font class="keywordtype">int</font> <a class="code" href="ppfilter_8cc.html#a6">TeX_get_command</a>(<a class="code" href="classString.html">String</a> &amp; textstr, <font class="keywordtype">int</font> start, <a class="code" href="classString.html">String</a> &amp; cmdstr) {
00230 <font class="comment">// get command and arguments text (\command[]{}{}{}{}{}{}{}{}) at start</font>
00231 <font class="comment">// returns location</font>
00232 <font class="comment">// *** if you need function that find commands or other chunks after rather than</font>
00233 <font class="comment">//     at a certain location, in the same manner as the HTML utilities, then</font>
00234 <font class="comment">//     either add a paramter that controls such an option, or create wrapper</font>
00235 <font class="comment">//     functions that search for a chunk and then call these functions</font>
00236         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXcmd(<font class="stringliteral">"\\(\\\\[A-Za-z]+\\).*"</font>); <font class="comment">// TeX command identifier</font>
00237         <font class="keywordflow">if</font> (!textstr.<a class="code" href="classString.html#a42">matches</a>(TeXcmd,start)) <font class="keywordflow">return</font> -1;
00238         <font class="comment">// get command</font>
00239         <font class="keywordtype">int</font> cend = TeXcmd.<a class="code" href="classBigRegex.html#a5">subpos</a>(1)+TeXcmd.<a class="code" href="classBigRegex.html#a6">sublen</a>(1);
00240         <a class="code" href="classString.html">String</a> argstr; <font class="keywordtype">int</font> argstart, j, argsleft = 9;
00241         <font class="comment">// find possible optional argument</font>
00242         <font class="keywordflow">if</font> ((j=<a class="code" href="ppfilter_8cc.html#a5">TeX_get_argument</a>(textstr,cend,argstr,<font class="charliteral">'['</font>))&gt;=0) {
00243                 cend = j; argsleft--;
00244         }
00245         <font class="comment">// find and convert possible mandatory arguments</font>
00246         <font class="keywordflow">while</font> ((argsleft&gt;0) &amp;&amp; ((j=<a class="code" href="ppfilter_8cc.html#a5">TeX_get_argument</a>(textstr,cend,argstr,<font class="charliteral">'{'</font>))&gt;=0)) {
00247                 cend = j; argsleft--;
00248         }
00249         cmdstr = textstr.<a class="code" href="classString.html#a51">at</a>(start,cend-start);
00250         <font class="keywordflow">return</font> cend;
00251 }
00252 
<a name="l00253"></a><a class="code" href="ppfilter_8cc.html#a7">00253</a> <a class="code" href="classString.html">String</a> <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(<a class="code" href="classString.html">String</a> &amp; title) {
00254 <font class="comment">// produces a version of title in proper TeX format from plain text</font>
00255 <font class="comment">// no attempt is made to convert '\', since it is assumed to precede</font>
00256 <font class="comment">// TeX commands that are frequently embedded in notes</font>
00257 <font class="comment">// there are two forms of recognized embedded TeX bracketing:</font>
00258 <font class="comment">// (1) foo\somecommand [text0] {text1} {text2} {text3} bar (with optional space)</font>
00259 <font class="comment">// (2) foo{\somecommand text}bar</font>
00260 <font class="comment">// all other curly brackets and hanging curly brackets are converted</font>
00261         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXchar(<font class="stringliteral">"[#$%&amp;_]"</font>); <font class="comment">// TeX special characters</font>
00262         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXcmdctx(<font class="stringliteral">"[\\{}]"</font>); <font class="comment">// TeX command context indicators</font>
00263         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXcmd(<font class="stringliteral">"\\(\\\\[A-Za-z]+\\).*"</font>); <font class="comment">// TeX command identifier</font>
00264         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXscopecmd(<font class="stringliteral">"{[ \n\t\r\v\f]*\\\\[A-Za-z]+.*"</font>); <font class="comment">// TeX scope limited command identification</font>
00265         <font class="keywordtype">int</font> convertedto = 0, i = 0;
00266         <a class="code" href="classString.html">String</a> convtitle;
00267         <font class="keywordflow">while</font> ((i=title.<a class="code" href="classString.html#a26">index</a>(TeXcmdctx,convertedto))&gt;=0) {
00268                 convtitle += title.<a class="code" href="classString.html#a51">at</a>(convertedto,i-convertedto);
00269                 <font class="keywordflow">switch</font> (title.<a class="code" href="classString.html#a100">elem</a>(i)) {
00270                         <font class="keywordflow">case</font> <font class="charliteral">'\\'</font>: <font class="keywordflow">if</font> (title.<a class="code" href="classString.html#a42">matches</a>(TeXcmd,i)) {
00271                                         <font class="comment">// find and convert command</font>
00272                                         convtitle += title.<a class="code" href="classString.html#a82">sub</a>(TeXcmd,1);
00273                                         convertedto = i + TeXcmd.<a class="code" href="classBigRegex.html#a6">sublen</a>(1);
00274                                         <a class="code" href="classString.html">String</a> argstr; <font class="keywordtype">int</font> argstart, j, argsleft = 9;
00275                                         <font class="comment">// find and convert possible optional argument</font>
00276                                         <font class="keywordflow">if</font> ((j=<a class="code" href="ppfilter_8cc.html#a5">TeX_get_argument</a>(title,convertedto,argstr,<font class="charliteral">'['</font>,&amp;argstart))&gt;=0) {
00277                                                 convtitle += title.<a class="code" href="classString.html#a51">at</a>(convertedto,argstart-convertedto) + <font class="charliteral">'['</font> + <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(argstr) + <font class="charliteral">']'</font>;
00278                                                 convertedto = j; argsleft--;
00279                                         }
00280                                         <font class="comment">// find and convert possible mandatory arguments</font>
00281                                         <font class="keywordflow">while</font> ((argsleft&gt;0) &amp;&amp; ((j=<a class="code" href="ppfilter_8cc.html#a5">TeX_get_argument</a>(title,convertedto,argstr,<font class="charliteral">'{'</font>,&amp;argstart))&gt;=0)) {
00282                                                 convtitle += title.<a class="code" href="classString.html#a51">at</a>(convertedto,argstart-convertedto) + <font class="charliteral">'{'</font> + <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(argstr) + <font class="charliteral">'}'</font>;
00283                                                 convertedto = j; argsleft--;
00284                                         }
00285                                 } <font class="keywordflow">else</font> {
00286                                         convtitle += <font class="stringliteral">"$\\backslash$"</font>; convertedto = i+1;
00287                                 } <font class="keywordflow">break</font>;
00288                         <font class="keywordflow">case</font> <font class="charliteral">'{'</font>: <font class="keywordflow">if</font> (title.<a class="code" href="classString.html#a42">matches</a>(TeXscopecmd,i)) {
00289                                         <a class="code" href="classString.html">String</a> scopecontent;
00290                                         <font class="keywordtype">int</font> j = <a class="code" href="ppfilter_8cc.html#a4">TeX_get_scope</a>(title,i,scopecontent);
00291                                         <font class="keywordflow">if</font> (j&lt;0) {
00292                                                 convtitle += <font class="stringliteral">"\\{"</font>; convertedto = i+1;
00293                                         } <font class="keywordflow">else</font> {
00294                                                 convtitle += <font class="charliteral">'{'</font> + <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(scopecontent) + <font class="charliteral">'}'</font>; convertedto = j;
00295                                         }
00296                                 } <font class="keywordflow">else</font> {
00297                                         convtitle += <font class="stringliteral">"\\{"</font>; convertedto = i+1;
00298                                 } <font class="keywordflow">break</font>;
00299                         <font class="keywordflow">case</font> <font class="charliteral">'}'</font>: convtitle += <font class="stringliteral">"\\}"</font>; convertedto = i+1; <font class="keywordflow">break</font>;
00300                 }
00301         }
00302         convtitle += title.<a class="code" href="classString.html#a70">from</a>(convertedto);
00303         convtitle.<a class="code" href="classString.html#a89">gsub</a>(TeXchar,<font class="stringliteral">"\\_0"</font>,<font class="charliteral">'_'</font>);
00304         <font class="keywordflow">return</font> convtitle;
00305 }
00306 
<a name="l00307"></a><a class="code" href="ppfilter_8cc.html#a8">00307</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a8">TeX_format_corrections</a>(<a class="code" href="classString.html">String</a> &amp; ostrtext, <font class="keywordtype">bool</font> estimate = <font class="keyword">false</font>) {
00308 <font class="comment">// corrections applied to a generated TeX text</font>
00309 <font class="comment">// rather than assuming a plain text source as above, this function assumes</font>
00310 <font class="comment">// a TeX draft</font>
00311         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXerr_refrx(<font class="stringliteral">"\\\\\\\(ref\\|cite\\)\\([{]\\)[^}]*\\([{\\]\\)"</font>);
00312         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXnon_refrx(<font class="stringliteral">"[^-0-9A-Za-z:._+]"</font>);
00313         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXnon_citerx(<font class="stringliteral">"[^-0-9A-Za-z:._+,]"</font>);
00314         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXerr_reflblrx(<font class="stringliteral">"\\\\ref[{]\\([^}]*[^-0-9A-Za-z:._+}][^}]*\\)[}]"</font>);
00315         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXerr_citelblrx(<font class="stringliteral">"\\\\cite[{]\\([^}]*[^-0-9A-Za-z:._+,}][^}]*\\)[}]"</font>);
00316         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> TeXfighererx(<font class="stringliteral">"\\\\[A-za-z]*figurehere"</font>);
00317         <font class="keywordtype">int</font> i,j,k; <a class="code" href="classString.html">String</a> movestr, reststr;
00318         <font class="comment">// a) \ref{ \command[]{}{} } or \ref{ {  } } or \cite{ \command[]{}{} } or \cite{ {  } }</font>
00319         <font class="keywordflow">while</font> ((i=ostrtext.<a class="code" href="classString.html#a26">index</a>(TeXerr_refrx))&gt;=0) { <font class="comment">// iteratively applied to the whole text</font>
00320                 <font class="keywordflow">if</font> ((k=<a class="code" href="ppfilter_8cc.html#a6">TeX_get_command</a>(ostrtext,i,reststr))&gt;=0) {
00321                         <font class="keywordflow">switch</font> (ostrtext.<a class="code" href="classString.html#a100">elem</a>(TeXerr_refrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(3))) {
00322                                 <font class="keywordflow">case</font> <font class="charliteral">'\\'</font>: <font class="comment">// move interfering command after \ref{} or \cite{}</font>
00323                                         <font class="keywordflow">if</font> ((j=<a class="code" href="ppfilter_8cc.html#a6">TeX_get_command</a>(ostrtext,TeXerr_refrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(3),movestr))&gt;=0) {
00324                                                 reststr = ostrtext.<a class="code" href="classString.html#a51">at</a>(j,k-j)+movestr+ostrtext.<a class="code" href="classString.html#a70">from</a>(k);
00325                                                 ostrtext = ostrtext.<a class="code" href="classString.html#a58">before</a>(TeXerr_refrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(3));
00326                                                 ostrtext += reststr;
00327                                                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Moved TeX command out of "</font> &lt;&lt; <a class="code" href="classString.html">String</a>(ostrtext.<a class="code" href="classString.html#a51">at</a>(i,(k-movestr.<a class="code" href="classString.html#a105">length</a>())-i)) &lt;&lt; <font class="charliteral">'\n'</font>;
00328                                         } <font class="keywordflow">else</font> { <font class="comment">// loose `\'</font>
00329                                                 ostrtext[TeXerr_refrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(3)] = <font class="charliteral">'-'</font>;
00330                                                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Changed `\\' to `-' in "</font> &lt;&lt; <a class="code" href="classString.html">String</a>(ostrtext.<a class="code" href="classString.html#a51">at</a>(i,k-i)) &lt;&lt; <font class="charliteral">'\n'</font>;
00331                                         }
00332                                         <font class="keywordflow">break</font>;
00333                                 <font class="keywordflow">case</font> <font class="charliteral">'{'</font>: <font class="comment">// move interfereing scope after \ref{} or \cite{}</font>
00334                                         <font class="keywordflow">if</font> ((j=<a class="code" href="ppfilter_8cc.html#a4">TeX_get_scope</a>(ostrtext,TeXerr_refrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(3),movestr))&gt;=0) {
00335                                                 reststr = ostrtext.<a class="code" href="classString.html#a51">at</a>(j,k-j)+<font class="charliteral">'{'</font>+movestr+<font class="charliteral">'}'</font>+ostrtext.<a class="code" href="classString.html#a70">from</a>(k);
00336                                                 ostrtext = ostrtext.<a class="code" href="classString.html#a58">before</a>(TeXerr_refrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(3));
00337                                                 ostrtext += reststr;
00338                                                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Moved TeX scope out of "</font> &lt;&lt; <a class="code" href="classString.html">String</a>(ostrtext.<a class="code" href="classString.html#a51">at</a>(i,(k-(movestr.<a class="code" href="classString.html#a105">length</a>()+2))-i)) &lt;&lt; <font class="charliteral">'\n'</font>;
00339                                         } <font class="keywordflow">else</font> { <font class="comment">// loose `{'</font>
00340                                                 ostrtext[TeXerr_refrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(3)] = <font class="charliteral">'+'</font>;
00341                                                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Changed `{' to `+' in "</font> &lt;&lt; <a class="code" href="classString.html">String</a>(ostrtext.<a class="code" href="classString.html#a51">at</a>(i,k-i)) &lt;&lt; <font class="charliteral">'\n'</font>;
00342                                         }
00343                                         <font class="keywordflow">break</font>;
00344                         }
00345                 } <font class="keywordflow">else</font> { <font class="comment">// missing `}'</font>
00346                         <font class="keywordflow">if</font> ((j=ostrtext.<a class="code" href="classString.html#a26">index</a>(TeXnon_refrx,TeXerr_refrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(2)+1))&gt;=0) {
00347                                 reststr = ostrtext.<a class="code" href="classString.html#a70">from</a>(j);
00348                                 ostrtext = ostrtext.<a class="code" href="classString.html#a58">before</a>(j);
00349                                 ostrtext += <font class="charliteral">'}'</font> + reststr;
00350                         } <font class="keywordflow">else</font> ostrtext += <font class="charliteral">'}'</font>;
00351                         <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Added missing } for "</font> &lt;&lt; <a class="code" href="classString.html">String</a>(ostrtext.<a class="code" href="classString.html#a51">at</a>(i,j-i)) &lt;&lt; <font class="charliteral">'\n'</font>;
00352                 }
00353         }
00354         <font class="comment">// b) \ref{ non-label-characters }</font>
00355         i = 0;
00356         <font class="keywordflow">while</font> ((i=ostrtext.<a class="code" href="classString.html#a26">index</a>(TeXerr_reflblrx,i))&gt;=0) { <font class="comment">// single pass</font>
00357                 movestr = ostrtext.<a class="code" href="classString.html#a82">sub</a>(TeXerr_reflblrx,1);
00358                 movestr.<a class="code" href="classString.html#a89">gsub</a>(TeXnon_refrx,<font class="stringliteral">"X"</font>);
00359                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Changed non-label characters to `X' in \\ref{"</font> &lt;&lt; movestr &lt;&lt; <font class="stringliteral">"}\n"</font>;
00360                 <font class="keywordflow">if</font> (estimate) { <font class="comment">// attempt to estimate the intended reference label</font>
00361                         j = 0; <a class="code" href="classString.html">String</a> argstr;
00362                         <font class="keywordflow">while</font> ((j=ostrtext.<a class="code" href="classString.html#a26">index</a>(TeXfighererx,<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,j))&gt;=0) {
00363                                 <font class="keywordflow">if</font> ((k=<a class="code" href="ppfilter_8cc.html#a5">TeX_get_argument</a>(ostrtext,j,argstr,<font class="charliteral">'{'</font>))&gt;=0) {
00364                                         <font class="keywordflow">if</font> ((k=<a class="code" href="ppfilter_8cc.html#a5">TeX_get_argument</a>(ostrtext,k,argstr,<font class="charliteral">'{'</font>))&gt;=0) {
00365                                                 <font class="keywordflow">if</font> (movestr.<a class="code" href="classString.html#a42">matches</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"X*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(argstr)+<font class="stringliteral">"X*"</font>))) {
00366                                                         <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Assuming that \\ref{"</font> &lt;&lt; movestr &lt;&lt; <font class="stringliteral">"} actually refers to ``"</font> &lt;&lt; argstr &lt;&lt; <font class="stringliteral">"''\n"</font>;
00367                                                         movestr = argstr;
00368                                                         <font class="keywordflow">break</font>;
00369                                                 }
00370                                                 j = k;
00371                                         }
00372                                 }
00373                         }
00374                         
00375                 }
00376                 ostrtext.<a class="code" href="classString.html#a51">at</a>(TeXerr_reflblrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(1),TeXerr_reflblrx.<a class="code" href="classBigRegex.html#a6">sublen</a>(1)) = movestr;
00377         }
00378         <font class="comment">// c) \cite{ non-label-characters }</font>
00379         <font class="comment">// *** can compare with all known bibliography keys</font>
00380         i = 0;
00381         <font class="keywordflow">while</font> ((i=ostrtext.<a class="code" href="classString.html#a26">index</a>(TeXerr_citelblrx,i))&gt;=0) { <font class="comment">// single pass</font>
00382                 movestr = ostrtext.<a class="code" href="classString.html#a82">sub</a>(TeXerr_citelblrx,1);
00383                 movestr.<a class="code" href="classString.html#a89">gsub</a>(TeXnon_citerx,<font class="stringliteral">"X"</font>);
00384                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: Changed non-label characters to `X' in \\cite{"</font> &lt;&lt; movestr &lt;&lt; <font class="stringliteral">"}\n"</font>;
00385                 ostrtext.<a class="code" href="classString.html#a51">at</a>(TeXerr_citelblrx.<a class="code" href="classBigRegex.html#a5">subpos</a>(1),TeXerr_citelblrx.<a class="code" href="classBigRegex.html#a6">sublen</a>(1)) = movestr;
00386         }
00387 }
00388 
<a name="l00389"></a><a class="code" href="ppfilter_8cc.html#a9">00389</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a5">extract_hierarchy_depth_increase_to_paper</a>(<a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classNovelty__Marker.html">Novelty_Marker</a> &amp; nm, <a class="code" href="classStringList.html">StringList</a> &amp; cc, <a class="code" href="classLongList.html">LongList</a> &amp; ccr, <a class="code" href="classString.html">String</a> &amp; sectitle, <a class="code" href="classStringList.html">StringList</a> &amp; srcf, <a class="code" href="classStringList.html">StringList</a> &amp; srcfname, <font class="keywordtype">int</font> &amp; srcfnum, <a class="code" href="classString.html">String</a> &amp; pprevtext) {
00390 <font class="comment">// generates output for a Topical Context Hierarchy depth increase, suggesting</font>
00391 <font class="comment">// subtopics and indicating the TCH title in .TeX comments</font>
00392         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> shrrx(<font class="stringliteral">"\\(Significance Hierarchy Rank:\\)[       ]*[0-9]+[.][0-9]+"</font>);
00393         <font class="comment">// test if REWRITTEN</font>
00394 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00395 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'N'</font>; cout.flush();
00396 <font class="preprocessor">#endif</font>
00397 <font class="preprocessor"></font>        <font class="keywordtype">int</font> previdx; <a class="code" href="classString.html">String</a> contextconcat = nm.<a class="code" href="classNovelty__Marker.html#m4">context</a>.<a class="code" href="classStringList.html#a15">concatenate</a>(<font class="stringliteral">", "</font>);
00398         <font class="keywordflow">if</font> ((previdx = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@Begin[       ]+[^@]*REWRITTEN[^@]*[  ]+SUBTOPIC:[    ]*[[]depth[^],]*,[      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(contextconcat)+<font class="stringliteral">"[    ]*@"</font>)))&gt;=0) {
00399                 <font class="keywordtype">int</font> prevend, prevheadend;
00400                 <font class="keywordflow">if</font> ((prevend = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@End[         ]+[^@]*REWRITTEN[^@]*[  ]+SUBTOPIC:[    ]*[[]depth[^],]*,[      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(contextconcat)+<font class="stringliteral">"[    ]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) {
00401                         <font class="keywordflow">if</font> (((prevheadend = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[       ]*%[    ]*@[^   ]*SubSection HEADEND[^@]*@[^\n]*"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) &amp;&amp; (prevheadend&lt;prevend)) {
00402                                 ostrtext += pprevtext.<a class="code" href="classString.html#a51">at</a>(previdx,prevheadend-previdx); <font class="comment">// full template head</font>
00403                         } <font class="keywordflow">else</font> {
00404                                 <font class="keywordflow">if</font> (((prevheadend = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">".*\\([^   }]subsection[{][^\n]*\\|[\\]paragraph[{][^\n]*\\|[\\][\\]\\)\n\n"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) &amp;&amp; (prevheadend&lt;prevend)) {
00405                                         ostrtext += pprevtext.<a class="code" href="classString.html#a51">at</a>(previdx,prevheadend-previdx); <font class="comment">// subtopic title</font>
00406                                 } <font class="keywordflow">else</font> {
00407                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No template header or subtopic heading found in extract_hierarchy_depth_increase_to_paper(), extracting from source\n"</font>;
00408                                         prevheadend = -1;
00409                                 }
00410                         }
00411                         <font class="keywordflow">if</font> (prevheadend&gt;=0) {
00412                                 <font class="keywordflow">if</font> (verbose) { <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"+RI"</font>; <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush(); }
00413 <font class="preprocessor">#ifdef _ASK_APPEND_TO_REWRITTEN_OUT_OF_PLACE</font>
00414 <font class="preprocessor"></font>                                <font class="keywordflow">if</font> ((!askextractconcat) || <a class="code" href="utilities_8cc.html#a28">confirmation</a>(<font class="stringliteral">"Append newly extracted version of SUBTOPIC Head ``"</font>+contextconcat+<font class="stringliteral">"''? (y/N) "</font>,<font class="charliteral">'y'</font>)) <font class="keywordflow">return</font>;
00415                                 contextconcat += <font class="stringliteral">" (newly extracted version)"</font>;
00416 <font class="preprocessor">#else</font>
00417 <font class="preprocessor"></font>                                <font class="keywordflow">return</font>;
00418 <font class="preprocessor">#endif</font>
00419 <font class="preprocessor"></font>                        }
00420                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End REWRITTEN SUBTOPIC: [depth n, section] concatenated-context@ in extract_hierarchy_depth_increase_to_paper(), extracting from source\n"</font>;
00421         }
00422         <font class="comment">// place subtopic head</font>
00423         <font class="keywordtype">int</font> templateidx, tidx, tend;
00424         ostrtext += <font class="stringliteral">"\n% @Begin SUBTOPIC: [depth "</font> + (dec(nm.<a class="code" href="classNovelty__Marker.html#m9">hierdepth</a>) + (<font class="stringliteral">", "</font>+sectitle+<font class="stringliteral">"] "</font> + contextconcat + <font class="stringliteral">"@\n"</font>));
00425         <font class="keywordflow">switch</font> (nm.<a class="code" href="classNovelty__Marker.html#m9">hierdepth</a>) {
00426                 <font class="keywordflow">case</font> 0: ostrtext += <font class="stringliteral">"% (Unexpected hierarchy depth at ``\\section'' level.)\n\n"</font>;
00427                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unexpected hierarchy depth at ``\\section'' level in extract_hierarchy_depth_increase_to_paper(), continuing\n"</font>;
00428                                 <font class="keywordflow">break</font>;
00429                 <font class="keywordflow">case</font> 1: 
00430                         <font class="comment">// load template if not already loaded</font>
00431                         <font class="keywordflow">if</font> ((templateidx = <a class="code" href="utilities_8cc.html#a40">get_file_in_list</a>(templatearticlesubsection,srcf,srcfname,srcfnum))&lt;0) {
00432                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"continuing as is\n"</font>;
00433                                 ostrtext += <font class="stringliteral">"\\subsection{"</font> + <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(contextconcat) + <font class="stringliteral">"}\n\n"</font>; <font class="comment">// no template</font>
00434                         } <font class="keywordflow">else</font> {
00435                                 <font class="comment">// fill in estimated significance rank</font>
00436                                 <font class="keywordtype">int</font> shridx = cc.<a class="code" href="classStringList.html#a11">iselement</a>(contextconcat), r = 0;
00437                                 <font class="keywordflow">if</font> (shridx&gt;=0) r = ccr[shridx];
00438                                 <a class="code" href="classString.html">String</a> shrrepl(<font class="stringliteral">"_1 "</font>+<a class="code" href="classString.html">String</a>((<font class="keywordtype">double</font>) r,<font class="stringliteral">"%.1f"</font>));
00439                                 srcf[templateidx].gsub(shrrx,shrrepl,<font class="charliteral">'_'</font>);
00440                                 <font class="comment">// fill in subtopic information</font>
00441                                 tidx = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"%[     ]*@Begin SUBTOPIC:[^@]*@[^\n]*\n"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>);
00442                                 tend = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[\\]subsection[{]"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,tidx);
00443                                 <font class="keywordflow">if</font> ((tidx&lt;0) || (tend&lt;0)) {
00444                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing SUBTOPIC at depth 1, ``"</font> &lt;&lt; contextconcat &lt;&lt; <font class="stringliteral">"'' in extract_hierarchy_depth_increase_to_paper(), continuing as is\n"</font>;
00445                                         ostrtext += <font class="stringliteral">"\\subsection{"</font>;
00446                                 } <font class="keywordflow">else</font> ostrtext += srcf[templateidx].at(tidx,tend-tidx);
00447                                 ostrtext += <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(contextconcat) + <font class="stringliteral">"}\n% --&gt;&lt;H3&gt;"</font>+contextconcat+<font class="stringliteral">"&lt;/H3&gt;&lt;!--\n\n"</font>;
00448                                 tidx = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[}][   ]*\n[   ]*\n"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,tend);
00449                                 tend = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@SubSection HEADEND[^@]*@[^\n]*"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,tidx);
00450                                 <font class="keywordflow">if</font> ((tidx&lt;0) || (tend&lt;0)) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing HEADEND at depth 1, ``"</font> &lt;&lt; contextconcat &lt;&lt; <font class="stringliteral">"'' in extract_hierarchy_depth_increase_to_paper(), continuing as is\n"</font>;
00451                                 <font class="keywordflow">else</font> ostrtext += srcf[templateidx].at(tidx,tend-tidx);
00452                         }
00453                         <font class="keywordflow">break</font>;
00454                 <font class="keywordflow">case</font> 2:
00455                         <font class="comment">// load template if not already loaded</font>
00456                         <font class="keywordflow">if</font> ((templateidx = <a class="code" href="utilities_8cc.html#a40">get_file_in_list</a>(templatearticlesubsubsection,srcf,srcfname,srcfnum))&lt;0) {
00457                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"continuing as is\n"</font>;
00458                                 ostrtext += <font class="stringliteral">"\\subsubsection{"</font> + <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(contextconcat) + <font class="stringliteral">"}\n\n"</font>; <font class="comment">// no template</font>
00459                         } <font class="keywordflow">else</font> {
00460                                 <font class="comment">// fill in estimated significance rank</font>
00461                                 <font class="keywordtype">int</font> shridx = cc.<a class="code" href="classStringList.html#a11">iselement</a>(contextconcat), r = 0;
00462                                 <font class="keywordflow">if</font> (shridx&gt;=0) r = ccr[shridx];
00463                                 <a class="code" href="classString.html">String</a> shrrepl(<font class="stringliteral">"_1 "</font>+<a class="code" href="classString.html">String</a>((<font class="keywordtype">double</font>) r,<font class="stringliteral">"%.1f"</font>));
00464                                 srcf[templateidx].gsub(shrrx,shrrepl,<font class="charliteral">'_'</font>);
00465                                 <font class="comment">// fill in subtopic information</font>
00466                                 tidx = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"%[     ]*@Begin SUBTOPIC:[^@]*@[^\n]*\n"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>);
00467                                 tend = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[\\]subsubsection[{]"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,tidx);
00468                                 <font class="keywordflow">if</font> ((tidx&lt;0) || (tend&lt;0)) {
00469                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing SUBTOPIC at depth 2, ``"</font> &lt;&lt; contextconcat &lt;&lt; <font class="stringliteral">"'' in extract_hierarchy_depth_increase_to_paper(), continuing as is\n"</font>;
00470                                         ostrtext += <font class="stringliteral">"\\subsubsection{"</font>;
00471                                 } <font class="keywordflow">else</font> ostrtext += srcf[templateidx].at(tidx,tend-tidx);
00472                                 ostrtext += <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(contextconcat) + <font class="stringliteral">"}\n% --&gt;&lt;H4&gt;"</font>+contextconcat+<font class="stringliteral">"&lt;/H4&gt;&lt;!--\n\n"</font>;
00473                                 tidx = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[}][   ]*\n[   ]*\n"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,tend);
00474                                 tend = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@SubSubSection HEADEND[^@]*@[^\n]*"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,tidx);
00475                                 <font class="keywordflow">if</font> ((tidx&lt;0) || (tend&lt;0)) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing HEADEND at depth 2, ``"</font> &lt;&lt; contextconcat &lt;&lt; <font class="stringliteral">"'' in extract_hierarchy_depth_increase_to_paper(), continuing as is\n"</font>;
00476                                 <font class="keywordflow">else</font> ostrtext += srcf[templateidx].at(tidx,tend-tidx);
00477                         }
00478                         <font class="keywordflow">break</font>;
00479                 <font class="keywordflow">case</font> 3: ostrtext += <font class="stringliteral">"\\paragraph{"</font> + <a class="code" href="ppfilter_8cc.html#a7">TeX_safe_text</a>(contextconcat) + <font class="stringliteral">"}\n\n"</font>; <font class="keywordflow">break</font>;
00480                 <font class="keywordflow">case</font> 4: ostrtext += <font class="stringliteral">"\\\\\n\n"</font>; <font class="keywordflow">break</font>;
00481                 <font class="keywordflow">default</font>:        ostrtext += <font class="stringliteral">"% (Hierarchy depth exceeds all \\LaTeX subsection levels.)\n\n"</font>;
00482                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Hierarchy depth exceeds all \\LaTeX subsection levels in extract_hierarchy_depth_increase_to_paper(), continuing\n"</font>;
00483         }
00484 }
00485 
<a name="l00486"></a><a class="code" href="ppfilter_8cc.html#a10">00486</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a6">extract_hierarchy_depth_decrease_to_paper</a>(<a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classNovelty__Marker.html">Novelty_Marker</a> &amp; nm, <a class="code" href="classString.html">String</a> &amp; sectitle, <a class="code" href="classStringList.html">StringList</a> &amp; srcf, <a class="code" href="classStringList.html">StringList</a> &amp; srcfname, <font class="keywordtype">int</font> &amp; srcfnum, <a class="code" href="classString.html">String</a> &amp; pprevtext) {
00487 <font class="comment">// generates output for a Topical Context Hierarchy depth decrease, suggesting</font>
00488 <font class="comment">// subtopics and indicating the TCH title in .TeX comments</font>
00489 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00490 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'O'</font>; cout.flush();
00491 <font class="preprocessor">#endif</font>
00492 <font class="preprocessor"></font>        <font class="comment">// get corresponding subtopic context</font>
00493         <a class="code" href="classString.html">String</a> depthstr = dec(nm.<a class="code" href="classNovelty__Marker.html#m9">hierdepth</a>+1); <a class="code" href="classString.html">String</a> subtopicid, contextconcat;
00494         <font class="keywordtype">int</font> ostridx;
00495 <font class="comment">//*** may have to allow for REWRITTEN in front of SUBTOPIC here</font>
00496         <font class="keywordflow">if</font> ((ostridx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[    ]*@Begin SUBTOPIC:[     ]*[[]depth[     ]+"</font>+depthstr+<font class="stringliteral">"[         ]*,[    ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]]"</font>),-1))&lt;0) {
00497                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @Begin SUBTOPIC: [depth n, section] concatenated-context@ in extract_hierarchy_depth_decrease_to_paper(), continuing as is\n"</font>;
00498                 ostrtext += <font class="stringliteral">"\n% @WARNING: Missing @Begin SUBTOPIC: [depth n, section] concatenated-context@\n"</font>;
00499                 <font class="keywordflow">return</font>;
00500         } <font class="keywordflow">else</font> {
00501                 <font class="comment">// get identification string</font>
00502                 subtopicid = ostrtext.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[^@]*@[^@]+@"</font>),ostridx);
00503                 contextconcat = subtopicid.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"@Begin SUBTOPIC:"</font>);
00504                 subtopicid.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@Begin "</font>,<font class="stringliteral">"@End "</font>);
00505                 subtopicid += <font class="stringliteral">"\n\n"</font>;
00506                 contextconcat.<a class="code" href="classString.html#a83">del</a>(<font class="charliteral">'@'</font>);
00507                 contextconcat = contextconcat.<a class="code" href="classString.html#a76">after</a>(<font class="charliteral">']'</font>);
00508                 contextconcat.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"^[  ]*"</font>));
00509         }
00510 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00511 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'P'</font>; cout.flush();
00512 <font class="preprocessor">#endif</font>
00513 <font class="preprocessor"></font>        <font class="comment">// test if REWRITTEN</font>
00514         <font class="keywordtype">int</font> previdx; <font class="comment">//String contextconcat = nm.context.concatenate(", ");</font>
00515         <font class="keywordflow">if</font> ((previdx = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@Begin[       ]+[^@]*REWRITTEN[^@]*[  ]+SUBTOPIC:[    ]*[[]depth[^],]*,[      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(contextconcat)+<font class="stringliteral">"[    ]*@"</font>)))&gt;=0) {
00516                 <font class="keywordtype">int</font> prevend, prevtailbegin;
00517                 <font class="keywordflow">if</font> ((prevend = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@End[         ]+[^@]*REWRITTEN[^@]*[  ]+SUBTOPIC:[    ]*[[]depth[^],]*,[      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(contextconcat)+<font class="stringliteral">"[    ]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) {
00518                         <font class="keywordflow">if</font> (((prevtailbegin = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[^@\n]*@[^   ]*SubSection TAILBEGIN[^@]*@"</font>),previdx))&gt;=0) &amp;&amp; (prevtailbegin&lt;prevend)) {
00519                                 ostrtext += pprevtext.<a class="code" href="classString.html#a51">at</a>(prevtailbegin,prevend-prevtailbegin); <font class="comment">// full template tail</font>
00520                         } <font class="keywordflow">else</font> {
00521                                 <font class="keywordflow">if</font> (((prevtailbegin = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[    ]*@End[         ]+[^@]*REWRITTEN[^@]*[  ]+SUBTOPIC:[    ]*[[]depth[^],]*,[      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(contextconcat)+<font class="stringliteral">"[    ]*@"</font>),previdx))&gt;=0) &amp;&amp; (prevtailbegin&lt;prevend)) {
00522                                         ostrtext += pprevtext.<a class="code" href="classString.html#a51">at</a>(prevtailbegin,prevend-prevtailbegin); <font class="comment">// subtopic end tag</font>
00523                                 } <font class="keywordflow">else</font> {
00524                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No template tail or subtopic end tag found in extract_hierarchy_depth_decrease_to_paper(), extracting from source\n"</font>;
00525                                         prevtailbegin = -1;
00526                                 }
00527                         }
00528                         <font class="keywordflow">if</font> (prevtailbegin&gt;=0) {
00529                                 <font class="keywordflow">if</font> (verbose) { <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"+RD"</font>; <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush(); }
00530 <font class="preprocessor">#ifdef _ASK_APPEND_TO_REWRITTEN_OUT_OF_PLACE</font>
00531 <font class="preprocessor"></font>                                <font class="keywordflow">if</font> ((!askextractconcat) || <a class="code" href="utilities_8cc.html#a28">confirmation</a>(<font class="stringliteral">"Append newly extracted version of SUBTOPIC Tail ``"</font>+contextconcat+<font class="stringliteral">"''? (y/N) "</font>,<font class="charliteral">'y'</font>)) <font class="keywordflow">return</font>;
00532                                 subtopicid = subtopicid.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'@'</font>,-1)+<font class="stringliteral">" (newly extracted version)@\n\n"</font>;
00533 <font class="preprocessor">#else</font>
00534 <font class="preprocessor"></font>                                <font class="keywordflow">return</font>;
00535 <font class="preprocessor">#endif</font>
00536 <font class="preprocessor"></font>                        }
00537                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End REWRITTEN SUBTOPIC: [depth n, section] concatenated-context@ in extract_hierarchy_depth_decrease_to_paper(), extracting from source\n"</font>;
00538         }
00539 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00540 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'Q'</font>; cout.flush();
00541 <font class="preprocessor">#endif</font>
00542 <font class="preprocessor"></font>        <font class="comment">// place subtopic tail</font>
00543         <font class="keywordtype">int</font> templateidx, tidx, tend;
00544         <font class="keywordflow">switch</font> (nm.<a class="code" href="classNovelty__Marker.html#m9">hierdepth</a>+1) {
00545                 <font class="keywordflow">case</font> 0: ostrtext += <font class="stringliteral">"% (Unexpected hierarchy depth at ``\\section'' level.)\n\n"</font>;
00546                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unexpected hierarchy depth at ``\\section'' level in extract_hierarchy_depth_decrease_to_paper(), continuing\n"</font>;
00547                                 <font class="keywordflow">break</font>;
00548                 <font class="keywordflow">case</font> 1: 
00549 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00550 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="charliteral">'R'</font>; cout.flush();
00551 <font class="preprocessor">#endif</font>
00552 <font class="preprocessor"></font>                        <font class="comment">// load template if not already loaded</font>
00553                         <font class="keywordflow">if</font> ((templateidx = <a class="code" href="utilities_8cc.html#a40">get_file_in_list</a>(templatearticlesubsection,srcf,srcfname,srcfnum))&lt;0) {
00554                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"continuing as is\n"</font>; <font class="comment">// no template</font>
00555                         } <font class="keywordflow">else</font> {
00556                                 tidx = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n%[^@\n]*@SubSection TAILBEGIN[^@]*@"</font>));
00557                                 tend = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n%[   ]*@End SUBTOPIC:[^@]*@"</font>),tidx);
00558                                 <font class="keywordflow">if</font> ((tidx&lt;0) || (tend&lt;0)) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing TAILBEGIN at depth 1, ``"</font> &lt;&lt; contextconcat &lt;&lt; <font class="stringliteral">"'' in extract_hierarchy_depth_decrease_to_paper(), continuing as is\n"</font>;
00559                                 <font class="keywordflow">else</font> ostrtext += srcf[templateidx].at(tidx,tend-tidx);
00560                         }
00561                         <font class="keywordflow">break</font>;
00562                 <font class="keywordflow">case</font> 2:
00563 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00564 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="charliteral">'S'</font>; cout.flush();
00565 <font class="preprocessor">#endif</font>
00566 <font class="preprocessor"></font>                        <font class="comment">// load template if not already loaded</font>
00567                         <font class="keywordflow">if</font> ((templateidx = <a class="code" href="utilities_8cc.html#a40">get_file_in_list</a>(templatearticlesubsubsection,srcf,srcfname,srcfnum))&lt;0) {
00568                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"continuing as is\n"</font>; <font class="comment">// no template</font>
00569                         } <font class="keywordflow">else</font> {
00570                                 tidx = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n%[^@\n]*@SubSubSection TAILBEGIN[^@]*@"</font>));
00571                                 tend = srcf[templateidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n%[   ]*@End SUBTOPIC:[^@]*@"</font>),tidx);
00572                                 <font class="keywordflow">if</font> ((tidx&lt;0) || (tend&lt;0)) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing TAILBEGIN at depth 2, ``"</font> &lt;&lt; contextconcat &lt;&lt; <font class="stringliteral">"'' in extract_hierarchy_depth_decrease_to_paper(), continuing as is\n"</font>;
00573                                 <font class="keywordflow">else</font> ostrtext += srcf[templateidx].at(tidx,tend-tidx);
00574                         }
00575                         <font class="keywordflow">break</font>;
00576                 <font class="keywordflow">case</font> 3: <font class="keywordflow">break</font>;
00577                 <font class="keywordflow">case</font> 4: <font class="keywordflow">break</font>;
00578                 <font class="keywordflow">default</font>:        ostrtext += <font class="stringliteral">"% (Hierarchy depth exceeds all \\LaTeX subsection levels.)\n\n"</font>;
00579                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Hierarchy depth exceeds all \\LaTeX subsection levels in extract_hierarchy_depth_decrease_to_paper(), continuing\n"</font>;
00580         }
00581         ostrtext += subtopicid;
00582 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00583 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'T'</font>; cout.flush();
00584 <font class="preprocessor">#endif</font>
00585 <font class="preprocessor"></font>}
00586 
00587 <font class="comment">/* The following functions incorporate rules used to identify and obtain</font>
00588 <font class="comment">   research novelty item content (see &lt;A HREF="../../doc/html/planning/material.html#preparing-results&gt;</font>
00589 <font class="comment">   Paper Plans: preparing results</font>
00590 <font class="comment">   &lt;/A&gt;) */</font>
00591 
<a name="l00592"></a><a class="code" href="ppfilter_8cc.html#a11">00592</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a7">item_content_between_range_tags</a>(<a class="code" href="classNovelty__Marker.html">Novelty_Marker</a> &amp; nm, <font class="keywordtype">int</font> nidx, <a class="code" href="classString.html">String</a> &amp; src, <a class="code" href="classString.html">String</a> &amp; ic) {
00593         <font class="comment">// 1. search for content range tags</font>
00594         <font class="keywordtype">int</font> nstartidx, nendidx;
00595         <font class="keywordflow">if</font> (((nstartidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[   ]*@Begin[       ]+"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(nm.<a class="code" href="classNovelty__Marker.html#m0">id</a>)+<font class="stringliteral">"@[   ]*--[&gt;]"</font>),nidx-src.<a class="code" href="classString.html#a105">length</a>()))&lt;0)
00596          || ((nendidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[     ]*@End[         ]+"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(nm.<a class="code" href="classNovelty__Marker.html#m0">id</a>)+<font class="stringliteral">"@[   ]*--[&gt;]"</font>),nidx))&lt;0)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00597         ic = src.<a class="code" href="classString.html#a51">at</a>(nstartidx,nendidx-nstartidx);
00598         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00599 }
00600 
<a name="l00601"></a><a class="code" href="ppfilter_8cc.html#a12">00601</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a8">item_content_within_TL_chunk</a>(<font class="keywordtype">int</font> nidx, <a class="code" href="classString.html">String</a> &amp; src, <a class="code" href="classString.html">String</a> &amp; ic) {
00602         <font class="comment">// 4. content range when within Task Log chunk</font>
00603         <font class="keywordtype">int</font> nstartidx, nendidx;
00604         <font class="keywordflow">if</font> ((!src.<a class="code" href="classString.html#a32">contains</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TITLE[&gt;]Task Log ([^)]*)[&lt;]/TITLE[&gt;]"</font>)))
00605          || ((nstartidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[   ]*chunk Begin[  ]*--[&gt;]"</font>),nidx-src.<a class="code" href="classString.html#a105">length</a>()))&lt;0)
00606          || ((nendidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[     ]*chunk End[    ]*--[&gt;]"</font>),nidx))&lt;0)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00607         <font class="keywordflow">if</font> ((nstartidx = src.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;P&gt;"</font>,nstartidx))&lt;0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00608         nstartidx+=3;
00609         ic = src.<a class="code" href="classString.html#a51">at</a>(nstartidx,nendidx-nstartidx);
00610         <font class="comment">// remove TL entry headers</font>
00611         ic.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[       ]*entry [^      ]+[     ]*--[&gt;][^\n]*\n"</font>),<font class="stringliteral">""</font>);
00612         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00613 }
00614 
<a name="l00615"></a><a class="code" href="ppfilter_8cc.html#a13">00615</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a9">item_content_within_DIL_entry</a>(<font class="keywordtype">int</font> nidx, <a class="code" href="classString.html">String</a> &amp; src, <a class="code" href="classString.html">String</a> &amp; ic) {
00616         <font class="comment">// 5. content range when within DIL entry</font>
00617         <font class="keywordtype">int</font> nstartidx, nendidx;
00618         <font class="keywordflow">if</font> ((!src.<a class="code" href="classString.html#a32">contains</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[    ]*dil2al:[      ]*DIL begin[    ]*--[&gt;]"</font>)))
00619          || ((nstartidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TR[^&gt;]*[&gt;]"</font>),nidx-src.<a class="code" href="classString.html#a105">length</a>()))&lt;0)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00620         <font class="keywordflow">if</font> ((nstartidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]TD COLSPAN[^&gt;]*[&gt;]"</font>),nstartidx))&lt;0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00621         <font class="keywordflow">if</font> ((nendidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([&lt;]TR[^&gt;]*[&gt;]\\|[&lt;]!--[   ]*dil2al:[      ]*DIL end[      ]*--[&gt;]\\)"</font>),nstartidx))&lt;0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00622         ic = src.<a class="code" href="classString.html#a51">at</a>(nstartidx,nendidx-nstartidx);
00623         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00624 }
00625 
<a name="l00626"></a><a class="code" href="ppfilter_8cc.html#a14">00626</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a10">item_content_within_paragraph</a>(<font class="keywordtype">int</font> nidx, <a class="code" href="classString.html">String</a> &amp; src, <a class="code" href="classString.html">String</a> &amp; ic) {
00627         <font class="comment">// 6. content range between &lt;P&gt;, empty lines, beginning and end of file</font>
00628         <font class="keywordtype">int</font> nstartidx, nendidx;
00629         <font class="keywordflow">if</font> ((nstartidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\(\n\n\\|[&lt;][Pp][&gt;]\\)"</font>),nidx-src.<a class="code" href="classString.html#a105">length</a>()))&gt;=0) {
00630                 <font class="keywordflow">if</font> (src[nstartidx]==<font class="charliteral">'&lt;'</font>) nstartidx+=3;
00631                 <font class="keywordflow">else</font> nstartidx+=2;
00632         } <font class="keywordflow">else</font> nstartidx=0; <font class="comment">// from empty line or beginning</font>
00633         <font class="keywordflow">if</font> ((nendidx = src.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\(\n\n\\|[&lt;][Pp][&gt;]\\)"</font>),nidx))&lt;0) nendidx = src.<a class="code" href="classString.html#a105">length</a>(); <font class="comment">// to empty line or end</font>
00634         ic = src.<a class="code" href="classString.html#a51">at</a>(nstartidx,nendidx-nstartidx);
00635         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00636 }
00637 
<a name="l00638"></a><a class="code" href="ppfilter_8cc.html#a15">00638</a> <font class="keywordtype">int</font> <a class="code" href="ppfilter_8cc.html#a15">Text_find_line_end</a>(<a class="code" href="classString.html">String</a> &amp; textstr, <font class="keywordtype">int</font> start, <font class="keywordtype">char</font> lend = <font class="charliteral">'\n'</font>) {
00639 <font class="comment">// returns next location of lend or string length</font>
00640         <font class="keywordflow">if</font> (start&gt;=textstr.<a class="code" href="classString.html#a105">length</a>()) <font class="keywordflow">return</font> -1;
00641         <font class="keywordtype">int</font> i = textstr.<a class="code" href="classString.html#a26">index</a>(lend,start);
00642         <font class="keywordflow">if</font> (i&gt;=0) <font class="keywordflow">return</font> i;
00643         <font class="keywordflow">return</font> textstr.<a class="code" href="classString.html#a105">length</a>();
00644 }
00645 
<a name="l00646"></a><a class="code" href="ppfilter_8cc.html#a16">00646</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a16">Text_limit_line_length</a>(<a class="code" href="classString.html">String</a> &amp; textstr, <font class="keywordtype">int</font> optlinemax, <font class="keywordtype">int</font> abslinemax, <font class="keywordtype">char</font> lend = <font class="charliteral">'\n'</font>) {
00647 <font class="comment">// limits text lines in textstr using optlinemax as optimal line maximum and</font>
00648 <font class="comment">// abslinemax as absolute line maximum</font>
00649         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> sptabrx(<font class="stringliteral">"[       ]"</font>);
00650         <font class="keywordtype">int</font> i = 0, j, istart; <a class="code" href="classString.html">String</a> itembuf;
00651         istart = optlinemax - 50; <font class="keywordflow">if</font> (istart&lt;0) istart = 0;
00652         <font class="keywordflow">while</font> ((j=<a class="code" href="ppfilter_8cc.html#a15">Text_find_line_end</a>(textstr,i,lend))&gt;=0) {
00653                 <font class="keywordflow">if</font> ((j-i)&gt;optlinemax) {
00654                         <font class="keywordflow">if</font> ((j=textstr.<a class="code" href="classString.html#a26">index</a>(sptabrx,i+istart))&lt;0) {
00655                                 j = i+optlinemax;
00656                                 itembuf = textstr.<a class="code" href="classString.html#a70">from</a>(j); textstr.<a class="code" href="classString.html#a83">del</a>(j,textstr.<a class="code" href="classString.html#a105">length</a>()-j);
00657                                 textstr += lend + itembuf;
00658                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to locate space for line-break, forcing break at column "</font> &lt;&lt; optlinemax &lt;&lt; <font class="stringliteral">" in convert_item_content_to_TeX(), continuing as is\n"</font>;
00659                         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (j&gt;(i+abslinemax)) {
00660                                 j = i+optlinemax;
00661                                 itembuf = textstr.<a class="code" href="classString.html#a70">from</a>(j); textstr.<a class="code" href="classString.html#a83">del</a>(j,textstr.<a class="code" href="classString.html#a105">length</a>()-j);
00662                                 textstr += lend + itembuf;
00663                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Space for line-break too distant, forcing break at column "</font> &lt;&lt; optlinemax &lt;&lt; <font class="stringliteral">" in convert_item_content_to_TeX(), continuing as is\n"</font>;
00664                         } <font class="keywordflow">else</font> {
00665                                 textstr[j] = lend; <font class="comment">// replace rather than insert</font>
00666                                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"TeX Correction: breaking long line at column "</font> &lt;&lt; (j-i) &lt;&lt; <font class="charliteral">'\n'</font>;
00667                         }
00668                 }
00669                 i = j + 1;
00670         }
00671 }
00672 
<a name="l00673"></a><a class="code" href="ppfilter_8cc.html#a17">00673</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a11">convert_item_content_to_TeX</a>(<a class="code" href="classString.html">String</a> &amp; itemcontent) {
00674         <font class="comment">// conversions to TeX (also ensures that lines do not exceed the TeX buffer size)</font>
00675         <font class="comment">//      - remove Novelty Marker tags</font>
00676         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[        ]+[Nn][Aa][Mm][Ee][     ]*=[    ]*\"NOVELTY-[^&gt;]*[&gt;][[][^]]*N[^]]*[]]"</font>),<font class="stringliteral">""</font>);
00677         <font class="comment">//      - identify content hyperlink references</font>
00678         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[        ]+[^&gt;]*[Hh][Rr][Ee][Ff][        ]*=[    ]*\"\\([^\"]+\\)\"[^&gt;]*[&gt;]"</font>),<font class="stringliteral">"@HRef::_1@"</font>,<font class="charliteral">'_'</font>);
00679         <font class="comment">//      - cite, but do not recurse into bibliography references</font>
00680         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([[][^]]*\\)?@HRef::[^@]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(bibindexfilename)+<font class="stringliteral">"#\\([^@]+:[^@]+\\)@\\([^]]*[]]\\)?"</font>),<font class="stringliteral">"\\cite{_2}"</font>,<font class="charliteral">'_'</font>);
00681         <font class="comment">//      - sometimes citations do not contain an HRef, warn if this appears to be the case and apply citation tentatively</font>
00682         <font class="keywordtype">int</font> citeerrnum = itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[[]\\([A-Z]+:[A-Z]+[,A-Z:]*\\)[]]"</font>),<font class="stringliteral">"\\cite{_1}"</font>,<font class="charliteral">'_'</font>);
00683         <font class="keywordflow">if</font> (citeerrnum&gt;0) <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: "</font> &lt;&lt; citeerrnum &lt;&lt; <font class="stringliteral">" apparent citations without HRef encountered in convert_item_content_to_TeX(), continuing\n"</font>;
00684         <font class="comment">//      - convert paragraph and line-break codes</font>
00685         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"\n&lt;P&gt;\n"</font>,<font class="stringliteral">"\n\n"</font>);
00686         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"&lt;P&gt;"</font>,<font class="stringliteral">"\n"</font>);
00687         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([^\n]\\)[\n]?[&lt;][Bb][Rr][&gt;]"</font>),<font class="stringliteral">"_1\\\\"</font>,<font class="charliteral">'_'</font>);
00688 <font class="comment">//*** the following two lines can be removed when Thesis Log has been converted to the Task Log format</font>
00689         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[      ]*entry Begin[  ]*--[&gt;][^]]+[]][        ]*[&lt;]/FONT[&gt;]"</font>),<font class="stringliteral">""</font>);
00690         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[      ]*chunk End[    ]*--[&gt;][        ]*[&lt;][Ii][&gt;][^&lt;]+[&lt;]/[Ii][&gt;]"</font>),<font class="stringliteral">""</font>);
00691 <font class="comment">//*** possibly remove the following conversions</font>
00692         <font class="comment">//      - convert text attribute codes</font>
00693         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]\\([Bb]\\|[Ss][Tt][Rr][Oo][Nn][Gg]\\)[&gt;]"</font>),<font class="stringliteral">"{\\bf "</font>);
00694         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]\\([Ii]\\|[Ee][Mm]\\)[&gt;]"</font>),<font class="stringliteral">"{\\em "</font>);
00695         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]/\\([Bb]\\|[Ss][Tt][Rr][Oo][Nn][Gg]\\|[Ii]\\|[Ee][Mm]\\)[&gt;]"</font>),<font class="stringliteral">"}"</font>);
00696 <font class="comment">//*** possibly remove conversions above</font>
00697         <font class="comment">//      - remove remaining HTML tags</font>
00698         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;][^&gt;]*[&gt;]"</font>),<font class="stringliteral">""</font>);
00699         <font class="comment">//      - convert HTML character codes</font>
00700         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"&amp;lt;"</font>,<font class="stringliteral">"&lt;"</font>);
00701         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"&amp;gt;"</font>,<font class="stringliteral">"&gt;"</font>);
00702         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"&amp;amp;"</font>,<font class="stringliteral">"\\&amp;"</font>);
00703         <font class="comment">//      - escape LaTeX special characters</font>
00704         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([^\\]\\)\\([#&amp;_%]\\)"</font>),<font class="stringliteral">"_1\\_2"</font>,<font class="charliteral">'_'</font>);
00705 <font class="comment">//*** convert GESNlib variable names to GESN convention standard labels as found in nse.label-equivalence.tex</font>
00706 <font class="comment">//*** could do that to the source once instead</font>
00707         <font class="comment">// insure lines are at most around 1000 characters long</font>
00708         <a class="code" href="ppfilter_8cc.html#a16">Text_limit_line_length</a>(itemcontent,1000,1500);
00709 }
00710 
<a name="l00711"></a><a class="code" href="ppfilter_8cc.html#a18">00711</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a18">unconvert_item_content_from_TeX</a>(<a class="code" href="classString.html">String</a> &amp; itemcontent) {
00712         <font class="comment">// conversions from TeX</font>
00713         itemcontent.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[\\]\\([#&amp;_%]\\)"</font>),<font class="stringliteral">"_1"</font>,<font class="charliteral">'_'</font>);
00714 }
00715 
<a name="l00716"></a><a class="code" href="ppfilter_8cc.html#a19">00716</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a19">extraction_put_figure</a>(<a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> * figcaps, <a class="code" href="classString.html">String</a> * figps, <a class="code" href="classString.html">String</a> &amp; figfile, <a class="code" href="classStringList.html">StringList</a> &amp; srcf, <a class="code" href="classStringList.html">StringList</a> &amp; srcfname, <font class="keywordtype">int</font> &amp; srcfnum, <a class="code" href="classString.html">String</a> &amp; poutline) {
00717         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> nonalpharx(<font class="stringliteral">"[^A-Za-z]"</font>);
00718         <a class="code" href="classString.html">String</a> figlabel, figcaption, figintext, psconversions;
00719         figfile = figfile.<a class="code" href="classString.html#a64">through</a>(<font class="charliteral">'.'</font>,-1) + <font class="stringliteral">"eps"</font>; <font class="comment">// use .eps not .fig</font>
00720         <font class="comment">// obtain label, caption and psfrag conversions</font>
00721         <a class="code" href="ppfilter_8pre-blank_8cc.html#a1">get_figure_data</a>(figfile,figlabel,figcaption,figintext,psconversions,srcf,srcfname,srcfnum);
00722         <font class="keywordflow">if</font> (ostrtext.<a class="code" href="classString.html#a32">contains</a>(<font class="charliteral">'{'</font>+figlabel+<font class="charliteral">'}'</font>)) {
00723                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Figure with duplicate label ``"</font> &lt;&lt; figlabel &lt;&lt; <font class="stringliteral">"'' linked to file ``"</font> &lt;&lt; figfile &lt;&lt; <font class="stringliteral">"'' omitted\n"</font>;
00724         } <font class="keywordflow">else</font> { <font class="comment">// include figure</font>
00725 <font class="comment">//*** perhaps use a template here</font>
00726 <font class="comment">//*** intelligently choose type of figure command</font>
00727                 ostrtext += <font class="stringliteral">"\n\\rrfigurehere"</font>;
00728                 <font class="keywordflow">if</font> (!psconversions.<a class="code" href="classString.html#a106">empty</a>()) {
00729                         <font class="keywordflow">if</font> (figps!=NULL) { <font class="comment">// add to FIGURE PSCONVERSIONS section is present</font>
00730                                 <a class="code" href="classString.html">String</a> figpslabel(figlabel);
00731                                 figpslabel.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"fig:"</font>,0); figpslabel.<a class="code" href="classString.html#a89">gsub</a>(nonalpharx,<font class="stringliteral">""</font>); figpslabel.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"\\figps"</font>);
00732                                 <font class="keywordflow">if</font> (psconversions.<a class="code" href="classString.html#a102">lastchar</a>()==<font class="charliteral">'\n'</font>) psconversions.<a class="code" href="classString.html#a83">del</a>((<font class="keywordtype">int</font>) psconversions.<a class="code" href="classString.html#a105">length</a>()-1,1);
00733                                 (*figps) += <font class="stringliteral">"\\newcommand{"</font> + figpslabel + <font class="stringliteral">"}{"</font> + psconversions + <font class="stringliteral">"}\n"</font>;
00734                                 ostrtext += <font class="charliteral">'{'</font>+figpslabel+<font class="charliteral">'}'</font>;
00735                         } <font class="keywordflow">else</font> ostrtext += <font class="charliteral">'{'</font>+psconversions+<font class="charliteral">'}'</font>;
00736                 }
00737                 ostrtext += <font class="charliteral">'{'</font> + figlabel + <font class="stringliteral">"}{"</font> + <a class="code" href="utilities_8cc.html#a30">relurl</a>(poutline,figfile) + <font class="stringliteral">"}{"</font>;
00738                 <font class="keywordflow">if</font> (figcaps!=NULL) { <font class="comment">// add to FIGURE CAPTIONS section is present</font>
00739                         <a class="code" href="classString.html">String</a> figcapslabel(figlabel);
00740                         figcapslabel.<a class="code" href="classString.html#a83">del</a>(<font class="stringliteral">"fig:"</font>,0); figcapslabel.<a class="code" href="classString.html#a89">gsub</a>(nonalpharx,<font class="stringliteral">""</font>); figcapslabel.<a class="code" href="classString.html#a22">prepend</a>(<font class="stringliteral">"\\figcap"</font>);
00741                         <font class="keywordflow">if</font> (figcaption.<a class="code" href="classString.html#a102">lastchar</a>()==<font class="charliteral">'\n'</font>) figcaption.<a class="code" href="classString.html#a83">del</a>((<font class="keywordtype">int</font>) figcaption.<a class="code" href="classString.html#a105">length</a>()-1,1);
00742                         (*figcaps) += <font class="stringliteral">"\\newcommand{"</font> + figcapslabel + <font class="stringliteral">"}{"</font> + figcaption + <font class="stringliteral">"}\n"</font>;
00743                         ostrtext += figcapslabel;
00744                 } <font class="keywordflow">else</font> ostrtext += figcaption;
00745                 ostrtext += <font class="stringliteral">"}{4.2in}{0}\n"</font>+figintext;
00746         }
00747 }
00748 
<a name="l00749"></a><a class="code" href="ppfilter_8cc.html#a20">00749</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a12">extract_recursively</a>(<a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> * figcaps, <a class="code" href="classString.html">String</a> * figps, <a class="code" href="classNovelty__Marker.html">Novelty_Marker</a> &amp; nm, <a class="code" href="classString.html">String</a> &amp; sectitle, <a class="code" href="classStringList.html">StringList</a> &amp; srcf, <a class="code" href="classStringList.html">StringList</a> &amp; srcfname, <font class="keywordtype">int</font> &amp; srcfnum, <font class="keywordtype">int</font> depth, <a class="code" href="classNovelty__Marker__List.html">Novelty_Marker_List</a> &amp; visited, <a class="code" href="classString.html">String</a> &amp; poutline, <a class="code" href="classString.html">String</a> &amp; pprevtext) {
00750 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00751 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'('</font> &lt;&lt; nm.<a class="code" href="classNovelty__Marker.html#m0">id</a> &lt;&lt; <font class="charliteral">')'</font>; cout.flush();
00752 <font class="preprocessor">#endif</font>
00753 <font class="preprocessor"></font>        <font class="comment">// keep track of places already visited to avoid infinite loops</font>
00754         <font class="keywordflow">if</font> (visited.<a class="code" href="classNovelty__Marker__List.html#a9">iselement</a>(nm)&gt;=0) {
00755                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Avoiding repetition of "</font> &lt;&lt; nm.<a class="code" href="classNovelty__Marker.html#m1">source</a> &lt;&lt; <font class="charliteral">'#'</font> &lt;&lt; nm.<a class="code" href="classNovelty__Marker.html#m0">id</a> &lt;&lt; <font class="stringliteral">" in extract_recursively(), continuing as is\n"</font>;
00756                 ostrtext += <font class="stringliteral">"% @WARNING: Repeated recursion into "</font> + nm.<a class="code" href="classNovelty__Marker.html#m1">source</a> + <font class="charliteral">'#'</font> + nm.<a class="code" href="classNovelty__Marker.html#m0">id</a> + <font class="stringliteral">"avoided@\n"</font>;
00757                 <font class="keywordflow">return</font>;
00758         }
00759 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00760 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'A'</font>; cout.flush();
00761 <font class="preprocessor">#endif</font>
00762 <font class="preprocessor"></font>        <font class="keywordtype">int</font> visitedidx = visited.<a class="code" href="classNovelty__Marker__List.html#a8">length</a>();
00763         <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m10">nmtype</a>==<a class="code" href="classNovelty__Marker.html#s8s0">Novelty_Marker::NM_NOVELTY_ITEM</a>) visitedidx--; <font class="comment">// use first list element</font>
00764         visited[visitedidx].source = nm.<a class="code" href="classNovelty__Marker.html#m1">source</a>;
00765         visited[visitedidx].id = nm.<a class="code" href="classNovelty__Marker.html#m0">id</a>;
00766         visited[visitedidx].nmtype = nm.<a class="code" href="classNovelty__Marker.html#m10">nmtype</a>;
00767         <font class="comment">// keep track of depth</font>
00768         depth++;
00769         <font class="keywordflow">if</font> (depth&gt;<a class="code" href="dil2al_8hh.html#a74">MAX_RECURSIVE_PP2PD_EXTRACTION_DEPTH</a>) {
00770                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Maximum extraction recursion depth ("</font> &lt;&lt; <a class="code" href="dil2al_8hh.html#a74">MAX_RECURSIVE_PP2PD_EXTRACTION_DEPTH</a> &lt;&lt; <font class="stringliteral">")exceeded in extract_recursively(), continuing as is\n"</font>;
00771                 ostrtext = ostrtext + <font class="stringliteral">"% @WARNING: Maximum extraction recursion depth ("</font> + dec(<a class="code" href="dil2al_8hh.html#a74">MAX_RECURSIVE_PP2PD_EXTRACTION_DEPTH</a>) + <font class="stringliteral">")exceeded@\n"</font>;
00772                 <font class="keywordflow">return</font>;
00773         }
00774 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00775 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'B'</font>; cout.flush();
00776 <font class="preprocessor">#endif</font>
00777 <font class="preprocessor"></font>        <a class="code" href="classString.html">String</a> srcref = <a class="code" href="utilities_8cc.html#a30">relurl</a>(poutline,nm.<a class="code" href="classNovelty__Marker.html#m1">source</a>)+<font class="charliteral">'#'</font>+nm.<a class="code" href="classNovelty__Marker.html#m0">id</a>;
00778         <font class="comment">// test if REWRITTEN</font>
00779         <font class="keywordtype">int</font> previdx;
00780         <font class="keywordflow">if</font> ((nm.<a class="code" href="classNovelty__Marker.html#m10">nmtype</a>==<a class="code" href="classNovelty__Marker.html#s8s0">Novelty_Marker::NM_NOVELTY_ITEM</a>)
00781          &amp;&amp; ((previdx = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[   ]*%[    ]*@Begin[       ]+[^@]*REWRITTEN[^@]*[  ]+EXTRACTED:[   ]*[[]"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][   ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(srcref)+<font class="stringliteral">"[   ]*@"</font>)))&gt;=0)) {
00782                 <font class="keywordtype">int</font> prevend;
00783                 <font class="keywordflow">if</font> ((prevend = pprevtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[^@\n]*@End[         ]+[^@]*REWRITTEN[^@]*[  ]+EXTRACTED:[   ]*[[]"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[]][   ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(srcref)+<font class="stringliteral">"[   ]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) {
00784                         ostrtext += pprevtext.<a class="code" href="classString.html#a51">at</a>(previdx,prevend-previdx);
00785                         <font class="keywordflow">if</font> (verbose) { <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"+R"</font>; <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush(); }
00786                         <font class="keywordflow">if</font> ((!askextractconcat) || <a class="code" href="utilities_8cc.html#a28">confirmation</a>(<font class="stringliteral">"Append newly extracted version of EXTRACTED ``"</font>+srcref+<font class="stringliteral">"''? (y/N) "</font>,<font class="charliteral">'y'</font>)) <font class="keywordflow">return</font>;
00787                         srcref += <font class="stringliteral">" (newly extracted version)"</font>;
00788                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End REWRITTEN EXTRACTED: [section] source-reference@ in extract_recursively(), extracting from source\n"</font>;
00789         }
00790         <font class="comment">// load source document if not already loaded</font>
00791         <font class="keywordtype">int</font> srcidx;
00792         <font class="keywordflow">if</font> ((srcidx = <a class="code" href="utilities_8cc.html#a40">get_file_in_list</a>(nm.<a class="code" href="classNovelty__Marker.html#m1">source</a>,srcf,srcfname,srcfnum))&lt;0) {
00793                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"continuing as is\n"</font>;
00794                 ostrtext += <font class="stringliteral">"% @WARNING: Recursion was unable to load source document "</font> + nm.<a class="code" href="classNovelty__Marker.html#m1">source</a> + <font class="stringliteral">"@\n"</font>;
00795                 <font class="keywordflow">return</font>;
00796         }
00797 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00798 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'C'</font>; cout.flush();
00799 <font class="preprocessor">#endif</font>
00800 <font class="preprocessor"></font>        <font class="comment">// include content in outline</font>
00801         <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m10">nmtype</a>==<a class="code" href="classNovelty__Marker.html#s8s0">Novelty_Marker::NM_NOVELTY_ITEM</a>) {
00802                 ostrtext += <font class="stringliteral">"\n% @Begin EXTRACTED: ["</font> + sectitle + <font class="stringliteral">"] "</font> + srcref + <font class="stringliteral">"@\n% Context: "</font>;
00803                 ostrtext += nm.<a class="code" href="classNovelty__Marker.html#m4">context</a>.<a class="code" href="classStringList.html#a15">concatenate</a>(<font class="stringliteral">", "</font>) + <font class="stringliteral">"\n% Importance: "</font>;
00804                 <font class="keywordtype">char</font> fc[10];
00805                 <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m5">imp</a>) {
00806                         sprintf(fc,<font class="stringliteral">"%4.2f"</font>,nm.<a class="code" href="classNovelty__Marker.html#m5">imp</a>[0]);
00807                         ostrtext += fc;
00808                         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j=1; j&lt;nm.<a class="code" href="classNovelty__Marker.html#m6">impnum</a>; j++) {
00809                                 sprintf(fc,<font class="stringliteral">"%4.2f"</font>,nm.<a class="code" href="classNovelty__Marker.html#m5">imp</a>[j]);
00810                                 ostrtext += <font class="stringliteral">", "</font>; ostrtext += fc;
00811                         }
00812                 }
00813                 sprintf(fc,<font class="stringliteral">"%4.2f"</font>,nm.<a class="code" href="classNovelty__Marker.html#m7">len</a>);
00814                 ostrtext = ostrtext + <font class="stringliteral">"\n% Intended length: "</font> + fc + <font class="stringliteral">" pages --&gt;\n"</font>;
00815         } <font class="keywordflow">else</font> ostrtext += <font class="stringliteral">"\n% @Begin CONTENT HREF: (depth "</font> + (dec(depth) + (<font class="stringliteral">") "</font> + srcref + <font class="stringliteral">"@\n"</font>));
00816         <font class="keywordtype">int</font> nidx;
00817         <font class="keywordflow">if</font> ((nidx = srcf[srcidx].index(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[  ]+[Nn][Aa][Mm][Ee][     ]*=[    ]*\""</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(nm.<a class="code" href="classNovelty__Marker.html#m0">id</a>)+<font class="charliteral">'"'</font>)))&gt;=0) {
00818 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00819 <font class="preprocessor"></font>                cout &lt;&lt; <font class="charliteral">'D'</font>; cout.flush();
00820 <font class="preprocessor">#endif</font>
00821 <font class="preprocessor"></font>                <font class="comment">// content range detection (independent of file type)</font>
00822 <font class="comment">//*** add remaining rules for content ranges</font>
00823                 <a class="code" href="classString.html">String</a> itemcontent;
00824                 <font class="keywordflow">if</font> (!<a class="code" href="ppfilter_8pre-blank_8cc.html#a7">item_content_between_range_tags</a>(nm,nidx,srcf[srcidx],itemcontent))
00825                  <font class="keywordflow">if</font> (!<a class="code" href="ppfilter_8pre-blank_8cc.html#a8">item_content_within_TL_chunk</a>(nidx,srcf[srcidx],itemcontent))
00826                   <font class="keywordflow">if</font> (!<a class="code" href="ppfilter_8pre-blank_8cc.html#a9">item_content_within_DIL_entry</a>(nidx,srcf[srcidx],itemcontent))
00827                    <a class="code" href="ppfilter_8pre-blank_8cc.html#a10">item_content_within_paragraph</a>(nidx,srcf[srcidx],itemcontent);
00828                 <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m1">source</a>.<a class="code" href="classString.html#a32">contains</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[.][Tt][Ee][Xx]$"</font>))) {
00829                         <font class="comment">// TeX files require no conversion but can contain \input{} references</font>
00830                         <font class="keywordtype">int</font> inputidx = -1;
00831                         <font class="keywordflow">while</font> ((inputidx = itemcontent.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"\\input{"</font>,inputidx+1))&gt;=0) {
00832                                 <a class="code" href="classString.html">String</a> inputref = itemcontent.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[^ }]*"</font>),inputidx+7);
00833                                 inputref = <a class="code" href="utilities_8cc.html#a31">absurl</a>(nm.<a class="code" href="classNovelty__Marker.html#m1">source</a>,inputref);
00834                                 inputref = <a class="code" href="utilities_8cc.html#a30">relurl</a>(poutline,inputref);
00835                                 <a class="code" href="classString.html">String</a> afterinput = itemcontent.<a class="code" href="classString.html#a70">from</a>(<font class="stringliteral">"}"</font>,inputidx+7);
00836                                 itemcontent = itemcontent.<a class="code" href="classString.html#a58">before</a>(inputidx+7) + inputref + afterinput;
00837                         }
00838                 } <font class="keywordflow">else</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a11">convert_item_content_to_TeX</a>(itemcontent);
00839                 <font class="comment">// locate content hyperlink references</font>
00840                 <font class="keywordtype">int</font> istart=0, iend=0; <a class="code" href="classNovelty__Marker.html">Novelty_Marker</a> nmhref;
00841                 <font class="keywordflow">while</font> (iend&lt;itemcontent.<a class="code" href="classString.html#a105">length</a>()) {
00842 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00843 <font class="preprocessor"></font>                        cout &lt;&lt; <font class="charliteral">'E'</font>; cout.flush();
00844 <font class="preprocessor">#endif</font>
00845 <font class="preprocessor"></font>                        <font class="keywordflow">if</font> ((iend = itemcontent.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"@HRef::"</font>,istart))&lt;0) {
00846                                 iend = itemcontent.<a class="code" href="classString.html#a105">length</a>();
00847                                 ostrtext += itemcontent.<a class="code" href="classString.html#a51">at</a>(istart,iend-istart) + <font class="charliteral">'\n'</font>;
00848                         } <font class="keywordflow">else</font> {
00849                                 ostrtext += itemcontent.<a class="code" href="classString.html#a51">at</a>(istart,iend-istart); <font class="comment">//*** could add a `\n` here</font>
00850                                 <font class="comment">// recurse content extraction for @HREF: &lt;document&gt;@ codes</font>
00851 <font class="comment">//*** perhaps recursively extracted content should be placed</font>
00852 <font class="comment">//*** after the following punctuation mark</font>
00853                                 nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a> = itemcontent.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[^@]+"</font>),iend+7);
00854                                 <font class="comment">// convert HRef back to non-TeX format</font>
00855                                 <a class="code" href="ppfilter_8cc.html#a18">unconvert_item_content_from_TeX</a>(nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a>);
00856                                 nmhref.<a class="code" href="classNovelty__Marker.html#m0">id</a> = nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a>.<a class="code" href="classString.html#a76">after</a>(<font class="charliteral">'#'</font>);
00857                                 <font class="keywordflow">if</font> (nmhref.<a class="code" href="classNovelty__Marker.html#m0">id</a>!=<font class="stringliteral">""</font>) nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a> = nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a>.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'#'</font>);
00858                                 nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a> = <a class="code" href="utilities_8cc.html#a31">absurl</a>(srcfname[srcidx],nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a>);
00859                                 <font class="comment">// recognize figures</font>
00860                                 <font class="keywordflow">if</font> (nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a>.<a class="code" href="classString.html#a32">contains</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[.]\\([Ff][Ii][Gg]\\|[Ee]?[Pp][Ss]\\)$"</font>))) {
00861                                         <a class="code" href="ppfilter_8cc.html#a19">extraction_put_figure</a>(ostrtext,figcaps,figps,nmhref.<a class="code" href="classNovelty__Marker.html#m1">source</a>,srcf,srcfname,srcfnum,poutline);
00862                                 } <font class="keywordflow">else</font> {
00863                                         nmhref.<a class="code" href="classNovelty__Marker.html#m10">nmtype</a> = <a class="code" href="classNovelty__Marker.html#s8s7">Novelty_Marker::NM_CONTENT_HREF</a>;
00864                                         <a class="code" href="ppfilter_8pre-blank_8cc.html#a12">extract_recursively</a>(ostrtext,figcaps,figps,nmhref,sectitle,srcf,srcfname,srcfnum,depth,visited,poutline,pprevtext);
00865                                 }
00866                                 <font class="keywordflow">if</font> ((istart = itemcontent.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"@"</font>,iend+1))&lt;0) istart = iend;
00867                                 <font class="keywordflow">else</font> istart++;
00868 <font class="comment">// *** There are some references without ID</font>
00869                         }
00870                 }
00871         } <font class="keywordflow">else</font> {
00872                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: "</font> &lt;&lt; nm.<a class="code" href="classNovelty__Marker.html#m1">source</a> &lt;&lt; <font class="charliteral">'#'</font> &lt;&lt; nm.<a class="code" href="classNovelty__Marker.html#m0">id</a> &lt;&lt; <font class="stringliteral">" not found in extract_paper_plan_to_paper(), continuing as is\n"</font>;
00873                 ostrtext += <font class="stringliteral">"% (Item ID "</font> + nm.<a class="code" href="classNovelty__Marker.html#m0">id</a> + <font class="stringliteral">" not found in content source file "</font> + <a class="code" href="utilities_8cc.html#a30">relurl</a>(poutline,nm.<a class="code" href="classNovelty__Marker.html#m1">source</a>) + <font class="stringliteral">") \n"</font>;
00874         }
00875         <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m10">nmtype</a>==<a class="code" href="classNovelty__Marker.html#s8s0">Novelty_Marker::NM_NOVELTY_ITEM</a>) ostrtext += <font class="stringliteral">"% &lt;!-- @End EXTRACTED: ["</font> + sectitle + <font class="stringliteral">"] "</font> + srcref + <font class="stringliteral">"@\n\n"</font>;
00876         <font class="keywordflow">else</font> ostrtext += <font class="stringliteral">"% @End CONTENT HREF: "</font> + srcref + <font class="stringliteral">"@\n"</font>;
00877 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00878 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'F'</font>; cout.flush();
00879 <font class="preprocessor">#endif</font>
00880 <font class="preprocessor"></font>}
00881 
<a name="l00882"></a><a class="code" href="ppfilter_8cc.html#a21">00882</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a13">extract_novelty_item_to_paper</a>(<a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> * figcaps, <a class="code" href="classString.html">String</a> * figps, <a class="code" href="classNovelty__Marker.html">Novelty_Marker</a> &amp; nm, <a class="code" href="classString.html">String</a> &amp; sectitle, <a class="code" href="classStringList.html">StringList</a> &amp; srcf, <a class="code" href="classStringList.html">StringList</a> &amp; srcfname, <font class="keywordtype">int</font> &amp; srcfnum, <a class="code" href="classString.html">String</a> &amp; poutline, <a class="code" href="classString.html">String</a> &amp; pprevtext) {
00883 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00884 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'G'</font>; cout.flush();
00885 <font class="preprocessor">#endif</font>
00886 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (nm.<a class="code" href="classNovelty__Marker.html#m1">source</a>==<font class="stringliteral">""</font>) {
00887                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing Novelty item source reference for item with text ``"</font> &lt;&lt; nm.<a class="code" href="classNovelty__Marker.html#m2">marktext</a> &lt;&lt; <font class="stringliteral">"'' in extract_paper_plan_to_paper(), continuing as is\n"</font>;
00888                 <font class="keywordflow">return</font>;
00889         }
00890 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
00891 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'H'</font>; cout.flush();
00892 <font class="preprocessor">#endif</font>
00893 <font class="preprocessor"></font>        <a class="code" href="classNovelty__Marker__List.html">Novelty_Marker_List</a> visited;
00894         <a class="code" href="ppfilter_8pre-blank_8cc.html#a12">extract_recursively</a>(ostrtext,figcaps,figps,nm,sectitle,srcf,srcfname,srcfnum,0,visited,poutline,pprevtext);
00895 }
00896 
<a name="l00897"></a><a class="code" href="ppfilter_8cc.html#a22">00897</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a22">include_article_head_template</a>(<a class="code" href="classString.html">String</a> &amp; pout, <a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> &amp; pprevioustext) {
00898 <font class="comment">// detects @Begin REWRITTEN ARTICLE HEAD: specs@</font>
00899         <a class="code" href="classString.html">String</a> templatetext;
00900         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(articleheadtemplate,templatetext)) {
00901                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read "</font> &lt;&lt; articleheadtemplate &lt;&lt; <font class="stringliteral">" in include_article_head_template(), continuing as is\n"</font>;
00902                 <font class="keywordflow">return</font>;
00903         }
00904         <font class="keywordtype">int</font> previdx;
00905         <font class="keywordflow">if</font> ((previdx = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"%[         ]*@Begin[       ]*[^@]*REWRITTEN[^@]*ARTICLE HEAD:[^@]*@"</font>)))&gt;=0) {
00906                 <font class="comment">// copy rewritten from previous</font>
00907                 <font class="keywordtype">int</font> prevend;
00908                 <font class="keywordflow">if</font> ((prevend = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[        ]*%[    ]*@End ARTICLE HEAD[^@]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) {
00909                         ostrtext += pprevioustext.<a class="code" href="classString.html#a51">at</a>(previdx,prevend-previdx);
00910                         <font class="comment">//*** if (askextractconcat) doesn't make a lot of sense here</font>
00911                         <font class="keywordflow">return</font>;
00912                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End ARTICLE HEAD@ in include_article_head_template(), including from template\n"</font>;
00913         }
00914         <font class="comment">// substitute tentative information for known place holders</font>
00915         <a class="code" href="classString.html">String</a> texname(pout.<a class="code" href="classString.html#a76">after</a>(<font class="charliteral">'/'</font>,-1)), texdir(pout.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'/'</font>,-1));
00916         <font class="keywordflow">if</font> (texname.<a class="code" href="classString.html#a105">length</a>()==0) texname = pout;
00917         <font class="keywordflow">if</font> (texname.<a class="code" href="classString.html#a26">index</a>(<font class="charliteral">'.'</font>,-1)&gt;0) texname = texname.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'.'</font>,-1); <font class="comment">// &gt; instead of &gt;= for file names that begin with `.'</font>
00918         <font class="keywordflow">if</font> (texdir.length()==0) texdir = <font class="stringliteral">"/"</font>;
00919         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (texdir.index(<font class="charliteral">'/'</font>,-1)&gt;=0) texdir = texdir.after(<font class="charliteral">'/'</font>,-1);
00920         <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Assuming that "</font> &lt;&lt; texname &lt;&lt; <font class="stringliteral">" is main document and "</font> &lt;&lt; texdir &lt;&lt; <font class="stringliteral">" is its directory\n"</font>;
00921         templatetext.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">" filename.tex"</font>,<font class="charliteral">' '</font>+texname+<font class="stringliteral">".tex"</font>);
00922         templatetext.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"article-tex-directory"</font>,texdir);
00923         templatetext.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"main-doc."</font>,texname+<font class="charliteral">'.'</font>);
00924         templatetext.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@ARTICLE START DATE: date@"</font>,<font class="stringliteral">"@ARTICLE START DATE: "</font>+curtime+<font class="charliteral">'@'</font>);
00925         <font class="comment">// include from template</font>
00926         ostrtext += templatetext;
00927 }
00928 
<a name="l00929"></a><a class="code" href="ppfilter_8cc.html#a23">00929</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a23">include_article_tail_template</a>(<a class="code" href="classString.html">String</a> &amp; pout, <a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> &amp; pprevioustext) {
00930 <font class="comment">// detects @Begin REWRITTEN ARTICLE TAIL: specs@</font>
00931         <a class="code" href="classString.html">String</a> templatetext;
00932         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(articletailtemplate,templatetext)) {
00933                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read "</font> &lt;&lt; articletailtemplate &lt;&lt; <font class="stringliteral">" in include_article_tail_template(), continuing as is\n"</font>;
00934                 <font class="keywordflow">return</font>;
00935         }
00936         <font class="keywordtype">int</font> previdx;
00937         <font class="keywordflow">if</font> ((previdx = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[        ]*%[    ]*@Begin[       ]*[^@]*REWRITTEN[^@]*ARTICLE TAIL[^@]*@"</font>)))&gt;=0) {
00938                 <font class="comment">// copy rewritten from previous</font>
00939                 <font class="keywordtype">int</font> prevend;
00940                 <font class="keywordflow">if</font> ((prevend = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[        ]*%[    ]*@End ARTICLE TAIL[^@]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) {
00941                         ostrtext += pprevioustext.<a class="code" href="classString.html#a51">at</a>(previdx,prevend-previdx);
00942                                 <font class="comment">//*** if (askextractconcat) doesn't make a lot of sense here</font>
00943                         <font class="keywordflow">return</font>;
00944                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End ARTICLE TAIL@ in include_article_tail_template(), including from template\n"</font>;
00945         }
00946         <font class="comment">// substitute tentative information for known place holders</font>
00947         <a class="code" href="classString.html">String</a> texname(pout.<a class="code" href="classString.html#a76">after</a>(<font class="charliteral">'/'</font>,-1)), texdir(pout.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'/'</font>,-1));
00948         templatetext.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"article-tex-directory"</font>,texdir);
00949         templatetext.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"main-doc."</font>,texname+<font class="charliteral">'.'</font>);
00950         texname = <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%c"</font>); texname.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"\n"</font>,<font class="stringliteral">""</font>);
00951         templatetext.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"article-creation-date"</font>,texname);
00952         <font class="comment">// include from template</font>
00953         ostrtext += templatetext;
00954 }
00955 
<a name="l00956"></a><a class="code" href="ppfilter_8cc.html#a24">00956</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a24">include_article_section_head_template</a>(<a class="code" href="classString.html">String</a> &amp; templatefname, <a class="code" href="classString.html">String</a> &amp; templatetext, <a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> &amp; pprevioustext) {
00957 <font class="comment">// detects @Begin REWRITTEN SECTION: SECTION-TITLE@</font>
00958         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(templatefname,templatetext)) {
00959                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read "</font> &lt;&lt; templatefname &lt;&lt; <font class="stringliteral">" in include_article_section_head_template(), continuing as is\n"</font>;
00960                 <font class="keywordflow">return</font>;
00961         }
00962         <a class="code" href="classString.html">String</a> sectitle = templatetext.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"%[  ]*@Begin SECTION:[      ]*[^@]+@"</font>));
00963         sectitle = sectitle.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">":[  ]*"</font>)); sectitle = sectitle.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'@'</font>);
00964         <font class="keywordtype">int</font> previdx;
00965         <font class="keywordflow">if</font> ((previdx = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[        ]*%[    ]*@Begin[       ]*[^@]*REWRITTEN[^@]*SECTION:[  ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[         ]*@"</font>)))&gt;=0) {
00966                 <font class="comment">// copy rewritten from previous</font>
00967                 <font class="keywordtype">int</font> prevend, prevheadend;
00968                 <font class="keywordflow">if</font> ((prevend = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[        ]*%[    ]*@End SECTION:[        ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[         ]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) {
00969                         <font class="keywordflow">if</font> (((prevheadend = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[   ]*%[    ]*@Section HEADEND[^@]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0)  &amp;&amp; (prevheadend&lt;prevend)) {
00970                                 ostrtext += pprevioustext.<a class="code" href="classString.html#a51">at</a>(previdx,prevheadend-previdx);
00971                                 <font class="comment">//*** if (askextractconcat) doesn't make a lot of sense here</font>
00972                                 <font class="keywordflow">return</font>;
00973                         } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @Section HEADEND@ in include_article_section_head_template(), including from template\n"</font>;
00974                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End SECTION "</font> &lt;&lt; sectitle &lt;&lt; <font class="stringliteral">"@ in include_article_section_head_template(), including from template\n"</font>;
00975         }
00976         <font class="comment">// include from template</font>
00977         ostrtext += templatetext.<a class="code" href="classString.html#a64">through</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[  ]*%[    ]*@Section HEADEND[^@]*@"</font>));
00978 }
00979 
<a name="l00980"></a><a class="code" href="ppfilter_8cc.html#a25">00980</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a25">include_article_section_tail_template</a>(<a class="code" href="classString.html">String</a> &amp; templatetext, <a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> &amp; pprevioustext) {
00981 <font class="comment">// detects @Begin REWRITTEN SECTION: SECTION-TITLE@</font>
00982         <a class="code" href="classString.html">String</a> sectitle = templatetext.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"%[  ]*@Begin SECTION:[      ]*[^@]+@"</font>));
00983         sectitle = sectitle.<a class="code" href="classString.html#a76">after</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">":[  ]*"</font>)); sectitle = sectitle.<a class="code" href="classString.html#a58">before</a>(<font class="charliteral">'@'</font>);
00984         <font class="keywordtype">int</font> previdx;
00985         <font class="keywordflow">if</font> ((previdx = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[        ]*%[    ]*@Begin[       ]*[^@]*REWRITTEN[^@]*SECTION:[  ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[         ]*@"</font>)))&gt;=0) {
00986                 <font class="comment">// copy rewritten from previous</font>
00987                 <font class="keywordtype">int</font> prevend;
00988                 <font class="keywordflow">if</font> ((prevend = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[        ]*%[    ]*@End SECTION:[        ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(sectitle)+<font class="stringliteral">"[         ]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,previdx))&gt;=0) {
00989                         <font class="keywordflow">if</font> (((previdx = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[       ]*%[    ]*@Section TAILBEGIN[^@]*@"</font>),previdx))&gt;=0)  &amp;&amp; (previdx&lt;prevend)) {
00990                                 ostrtext += pprevioustext.<a class="code" href="classString.html#a51">at</a>(previdx,prevend-previdx);
00991                                 <font class="comment">//*** if (askextractconcat) doesn't make a lot of sense here</font>
00992                                 <font class="keywordflow">return</font>;
00993                         } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @Section TAILBEGIN@ in include_article_section_tail_template(), including from template\n"</font>;
00994                 } <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End SECTION "</font> &lt;&lt; sectitle &lt;&lt; <font class="stringliteral">"@ in include_article_section_tail_template(), including from template\n"</font>;
00995         }
00996         <font class="comment">// include from template</font>
00997         ostrtext += templatetext.<a class="code" href="classString.html#a70">from</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[    ]*@Section TAILBEGIN[^@]*@"</font>));
00998 }
00999 
<a name="l01000"></a><a class="code" href="ppfilter_8cc.html#a26">01000</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a26">add_protected_text</a>(<font class="keywordtype">int</font> ostridx, <font class="keywordtype">int</font> protidx, <font class="keywordtype">int</font> protend, <a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> &amp; pprevioustext) {
01001         <a class="code" href="classString.html">String</a> ostrtail;
01002         <font class="keywordflow">if</font> (ostridx&lt;0) ostridx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[  ]*%[     ]*@Begin ARTICLE TAIL[^@]*@"</font>),-1);
01003         <font class="keywordflow">if</font> (ostridx&lt;0) {
01004                 ostridx = ostrtext.<a class="code" href="classString.html#a105">length</a>();
01005                 ostrtail = <font class="stringliteral">""</font>;
01006         } <font class="keywordflow">else</font> {
01007                 ostrtail = ostrtext.<a class="code" href="classString.html#a70">from</a>(ostridx);
01008                 ostrtext = ostrtext.<a class="code" href="classString.html#a58">before</a>(ostridx);
01009         }
01010         ostrtext += pprevioustext.<a class="code" href="classString.html#a51">at</a>(protidx,protend-protidx) + ostrtail;
01011 }
01012 
<a name="l01013"></a><a class="code" href="ppfilter_8cc.html#a27">01013</a> <font class="keywordtype">void</font> <a class="code" href="ppfilter_8cc.html#a27">include_protected_text</a>(<a class="code" href="classString.html">String</a> &amp; ostrtext, <a class="code" href="classString.html">String</a> &amp; pprevioustext) {
01014 <font class="comment">// @Begin PROTECTED: [Section,[before,after,topic]]@, @End PROTECTED@</font>
01015         <font class="keywordtype">int</font> protidx, protend = 0;
01016         <font class="keywordflow">while</font> ((protidx = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[    ]*@Begin PROTECTED[^@]*@"</font>),protend))&gt;=0) {
01017                 <font class="keywordflow">if</font> ((protend = pprevioustext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[        ]*%[    ]*@End PROTECTED[^@]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,protidx))&lt;0) {
01018                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: @End PROTECTED@ missing in include_protected_text(), continuing as is\n"</font>;
01019                         protend = protidx+1;
01020                 } <font class="keywordflow">else</font> {
01021                         <a class="code" href="classString.html">String</a> secid = pprevioustext.<a class="code" href="classString.html#a51">at</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[   ]*%[    ]*@Begin PROTECTED[^@]*@"</font>),protidx);
01022                         secid = secid.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"@Begin PROTECTED:"</font>);
01023                         secid = secid.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"@"</font>);
01024                         <a class="code" href="classString.html">String</a> secloc = secid.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">","</font>);
01025                         <font class="keywordflow">if</font> (secloc!=<font class="stringliteral">""</font>) secid = secid.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">","</font>);
01026                         secloc.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[  ]$"</font>)); secloc.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"^[  ]"</font>));
01027                         secid.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[   ]$"</font>)); secid.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"^[   ]"</font>));
01028                         secid.<a class="code" href="classString.html#a82">upcase</a>();
01029                         <font class="keywordtype">int</font> ostridx; <a class="code" href="classString.html">String</a> ostrtail;
01030                         <font class="keywordflow">if</font> (secid!=<font class="stringliteral">""</font>) {
01031                                 <font class="keywordflow">if</font> (secloc==<font class="stringliteral">"before"</font>) { <font class="comment">// before section</font>
01032                                         <font class="keywordflow">if</font> ((ostridx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[    ]*@Begin SECTION:[      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(secid)+<font class="stringliteral">"[    ]*@"</font>)))&lt;0) {
01033                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find section "</font> &lt;&lt; secid &lt;&lt; <font class="stringliteral">" in include_protected_text(), adding to end of document\n"</font>;
01034                                         }
01035                                         <a class="code" href="ppfilter_8cc.html#a26">add_protected_text</a>(ostridx,protidx,protend,ostrtext,pprevioustext);
01036                                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (secloc==<font class="stringliteral">"after"</font>) { <font class="comment">// after section</font>
01037                                         <font class="keywordflow">if</font> ((ostridx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[    ]*@End SECTION:[        ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(secid)+<font class="stringliteral">"[    ]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>))&lt;0) {
01038                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find section "</font> &lt;&lt; secid &lt;&lt; <font class="stringliteral">" in include_protected_text(), adding to end of document\n"</font>;
01039                                         }
01040                                         <a class="code" href="ppfilter_8cc.html#a26">add_protected_text</a>(ostridx,protidx,protend,ostrtext,pprevioustext);
01041                                 } <font class="keywordflow">else</font> { <font class="comment">// in section</font>
01042                                         <font class="keywordflow">if</font> ((secloc==<font class="stringliteral">""</font>) || ((ostridx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[    ]*%[    ]*@Begin SUBTOPIC:[     ]*[[]depth[^,]*,[       ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(secid)+<font class="stringliteral">"[^]]*[]][    ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(secloc)+<font class="stringliteral">"[   ]*@"</font>)))&lt;0)) {
01043                                                 <font class="keywordflow">if</font> ((ostridx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[    ]*@Begin SECTION:[      ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(secid)+<font class="stringliteral">"[    ]*@"</font>)))&gt;=0) {
01044                                                         <font class="keywordflow">if</font> ((ostridx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[     ]*%[    ]*@Section HEADEND[^@]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,ostridx))&lt;0) {
01045                                                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find section ("</font> &lt;&lt; secid &lt;&lt; <font class="stringliteral">") head end in include_protected_text(), adding to end of document\n"</font>;
01046                                                         }
01047                                                 } <font class="keywordflow">else</font> {
01048                                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to find section "</font> &lt;&lt; secid &lt;&lt; <font class="stringliteral">" in include_protected_text(), adding to end of document\n"</font>;
01049                                                 }
01050                                         } <font class="keywordflow">else</font> {
01051                                                 <font class="keywordtype">int</font> subsecend,subheadend;
01052                                                 <font class="keywordflow">if</font> ((subsecend = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[   ]*%[    ]*@End SUBTOPIC:[       ]*[[]depth[^,]*,[       ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(secid)+<font class="stringliteral">"[^]]*[]][    ]*"</font>+<a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(secloc)+<font class="stringliteral">"[   ]*@"</font>),ostridx))&lt;0) {
01053                                                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End SUBTOPIC@ in include_protected_text(), adding to end of document\n"</font>;
01054                                                 } <font class="keywordflow">else</font> {
01055                                                         <font class="keywordflow">if</font> (((subheadend = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n[         ]*%[    ]*@[^@]*SubSection HEADEND[^@]*@"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,ostridx))&gt;=0) &amp;&amp; (subheadend&lt;subsecend)) {
01056                                                                 ostridx = subheadend;
01057                                                         }
01058                                                 }
01059                                         }
01060                                         <a class="code" href="ppfilter_8cc.html#a26">add_protected_text</a>(ostridx,protidx,protend,ostrtext,pprevioustext);
01061                                 }
01062                         } <font class="keywordflow">else</font> { <font class="comment">// add protected text to end of document</font>
01063                                 <a class="code" href="ppfilter_8cc.html#a26">add_protected_text</a>(-1,protidx,protend,ostrtext,pprevioustext);
01064                         }
01065                 }
01066         }
01067 }
01068 
<a name="l01069"></a><a class="code" href="ppfilter_8cc.html#a28">01069</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a14">extract_paper_plan_to_paper</a>(<a class="code" href="classString.html">String</a> ppname, <a class="code" href="classString.html">String</a> pout, <a class="code" href="classString.html">String</a> pprevious) {
01070 <font class="comment">// uses information in a paper plan to generate paper outline and content</font>
01071 <font class="comment">// (see DIL#20000315155709.1)</font>
01072 <font class="comment">// preparation:</font>
01073 <font class="comment">// - a sorted paper plan including required items</font>
01074 <font class="comment">// - an optional previous (version of the) paper, containing</font>
01075 <font class="comment">//   stylistically rewritten items or arbitrary ``protected'' text</font>
01076 <font class="comment">//   for inclusion in the paper draft</font>
01077         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> fighererx(<font class="stringliteral">"[\\][A-Za-z]*figurehere[{]"</font>);
01078         <a class="code" href="classString.html">String</a> pptext, pprevtext, ostrtext, _figcaps, _figps, * figcaps = NULL, * figps = NULL;
01079         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(ppname,pptext)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
01080         <font class="keywordflow">if</font> (pprevious!=<font class="stringliteral">""</font>) <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(pprevious,pprevtext)) <font class="keywordflow">return</font> <font class="keyword">false</font>; <font class="comment">// safe in case new paper draft would overwrite pprevious</font>
01081         ofstream ostr(pout+<font class="stringliteral">".new"</font>);
01082         <font class="keywordflow">if</font> (!ostr) {
01083                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to create "</font> &lt;&lt; pout &lt;&lt; <font class="stringliteral">".new in extract_paper_plan_to_paper()\n"</font>;
01084                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01085         }
01086         <a class="code" href="ppfilter_8cc.html#a22">include_article_head_template</a>(pout,ostrtext,pprevtext);
01087         <font class="comment">// determine if FIGURE CAPTIONS and FIGURE PSCONVERSIONS sections are present</font>
01088         <font class="keywordflow">if</font> (ostrtext.<a class="code" href="classString.html#a32">contains</a>(<font class="stringliteral">"@Begin FIGURE CAPTIONS@"</font>)) figcaps = &amp;_figcaps;
01089         <font class="keywordflow">if</font> (ostrtext.<a class="code" href="classString.html#a32">contains</a>(<font class="stringliteral">"@Begin FIGURE PSCONVERSIONS@"</font>)) figps = &amp;_figps;
01090         <font class="comment">// read all Novelty items from paper plan into list</font>
01091         <a class="code" href="classNovelty__Marker__List.html">Novelty_Marker_List</a> nml; <font class="keywordtype">int</font> nmend = 0, nmnum = 0, hdepth = 0;
01092         <font class="keywordflow">if</font> ((nmend = pptext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]A[       ]*[Nn][Aa][Mm][Ee][     ]*=[    ]*\"tch\""</font>),nmend))&lt;0) {
01093                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No Topical Context Hierarchy found in Paper Plan in extract_paper_plan_to_paper()\n"</font>;
01094                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01095         }
01096 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
01097 <font class="preprocessor"></font>        cout &lt;&lt; <font class="stringliteral">"Paper Plan text length = "</font> &lt;&lt; pptext.<a class="code" href="classString.html#a105">length</a>() &lt;&lt; <font class="stringliteral">" Novelty Markers at positions: "</font>;
01098 <font class="preprocessor">#endif</font>
01099 <font class="preprocessor"></font>        <font class="keywordflow">while</font> ((nmend = nml[nmnum].Get_Novelty_from_Paper_Plan(pptext,nmend,hdepth))&gt;=0) {
01100 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
01101 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (nmnum&gt;0) cout &lt;&lt; <font class="charliteral">','</font>;
01102                 cout &lt;&lt; nmend;
01103 <font class="preprocessor">#endif</font>
01104 <font class="preprocessor"></font>                hdepth = nml[nmnum].hierdepth; <font class="comment">// track Topical Context Hierarchy depth</font>
01105                 <font class="keywordflow">if</font> (hdepth&lt;0) <font class="keywordflow">break</font>;
01106                 <font class="keywordflow">if</font> (nml[nmnum].source!=<font class="stringliteral">""</font>) nml[nmnum].source = <a class="code" href="utilities_8cc.html#a31">absurl</a>(ppname,nml[nmnum].source);
01107 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
01108 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (nml[nmnum].source!=<font class="stringliteral">""</font>) cout &lt;&lt; <font class="charliteral">'('</font> &lt;&lt; nml[nmnum].source &lt;&lt; <font class="charliteral">')'</font>;
01109                 <font class="keywordflow">else</font> cout &lt;&lt; <font class="charliteral">'('</font> &lt;&lt; nml[nmnum].context[0] &lt;&lt; <font class="charliteral">')'</font>;
01110 <font class="preprocessor">#endif</font>
01111 <font class="preprocessor"></font>                nmnum++;
01112         }
01113 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
01114 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'\n'</font>;
01115 <font class="preprocessor">#endif</font>
01116 <font class="preprocessor"></font>        <a class="code" href="classStringList.html">StringList</a> contextconcats; <a class="code" href="classLongList.html">LongList</a> ccranks;
01117         nml.<a class="code" href="classNovelty__Marker__List.html#a10">Get_Context_Ranks</a>(contextconcats,ccranks);
01118         <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; nmnum &lt;&lt; <font class="stringliteral">" Novelty Items, Topic Openings and Closings\n"</font>;
01119         <font class="comment">// read Section IDs</font>
01120         <a class="code" href="classStringList.html">StringList</a> ppsectionids, ppsectiontitles, ppsectiontemplates;
01121         <font class="keywordflow">if</font> (!<a class="code" href="ppfilter_8pre-blank_8cc.html#a2">get_Paper_Plans_Section_IDs</a>(ppsectionids,ppsectiontitles,ppsectiontemplates)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
01122         <font class="comment">// test for unknown section IDs in Novelty Items</font>
01123         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i&lt;nmnum; i++) <font class="keywordflow">if</font> (nml[i].nmtype==<a class="code" href="classNovelty__Marker.html#s8s0">Novelty_Marker::NM_NOVELTY_ITEM</a>)
01124                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> s = 0; s&lt;nml[i].section.<a class="code" href="classNovelty__Marker__List.html#a8">length</a>(); s++) <font class="keywordflow">if</font> (ppsectionids.<a class="code" href="classStringList.html#a11">iselement</a>(nml[i].section[s])&lt;0)
01125                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unknown section type `"</font> &lt;&lt; nml[i].section[s] &lt;&lt; <font class="stringliteral">"' for "</font> &lt;&lt; nml[i].id &lt;&lt; <font class="stringliteral">" in extract_paper_plan_to_paper(), continuing as is\n"</font>;
01126 <font class="comment">//*** generate tentative Abstract, as specified in</font>
01127 <font class="comment">//*** DIL#20000315155709.1</font>
01128 <font class="comment">//*** use information about paper type to modify main template or section templates</font>
01129 <font class="comment">//*** according to background template</font>
01130         <font class="comment">// per section</font>
01131         <font class="keywordtype">int</font> secidx, srcfnum = 0; <a class="code" href="classStringList.html">StringList</a> srcf, srcfname; <a class="code" href="classString.html">String</a> requireditems,sectiontemplate;
01132         <font class="keywordflow">for</font> (secidx=0; secidx&lt;ppsectionids.<a class="code" href="classStringList.html#a10">length</a>(); secidx++) <font class="keywordflow">if</font> (ppsectionids[secidx]!=<font class="stringliteral">"ABS"</font>) {
01133 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
01134 <font class="preprocessor"></font>                cout &lt;&lt; <font class="charliteral">'I'</font>; cout.flush();
01135 <font class="preprocessor">#endif</font>
01136 <font class="preprocessor"></font>                <font class="comment">// get section title</font>
01137                 <a class="code" href="classString.html">String</a> sectitle = ppsectiontitles[secidx];
01138                 sectitle.<a class="code" href="classString.html#a82">upcase</a>();
01139                 <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Generating paper outline section "</font> &lt;&lt; sectitle &lt;&lt; <font class="charliteral">'\n'</font>;
01140                 <a class="code" href="ppfilter_8cc.html#a24">include_article_section_head_template</a>(ppsectiontemplates[secidx],sectiontemplate,ostrtext,pprevtext);
01141                 <font class="comment">// parse items in section</font>
01142                 <a class="code" href="classString.html">String</a> refurl = <a class="code" href="utilities_8cc.html#a30">relurl</a>(pout,ppname);
01143                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;nmnum; i++)
01144 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
01145 <font class="preprocessor"></font>                { cout &lt;&lt; <font class="charliteral">'J'</font>; cout.flush();
01146 <font class="preprocessor">#endif</font>
01147 <font class="preprocessor"></font>                 <font class="keywordflow">if</font> ((nml[i].nmtype==<a class="code" href="classNovelty__Marker.html#s8s1">Novelty_Marker::NM_TCH_DEPTH_INC</a>)
01148                   || (nml[i].nmtype==<a class="code" href="classNovelty__Marker.html#s8s2">Novelty_Marker::NM_TCH_DEPTH_DEC</a>)
01149                   || (nml[i].section.<a class="code" href="classNovelty__Marker__List.html#a9">iselement</a>(ppsectionids[secidx])&gt;=0)) {
01150                         <font class="keywordflow">if</font> (nml[i].nmtype==<a class="code" href="classNovelty__Marker.html#s8s6">Novelty_Marker::NM_REQUIRED_ITEM</a>) <a class="code" href="ppfilter_8pre-blank_8cc.html#a4">extract_required_item_to_paper</a>(ostrtext,refurl,nml[i],sectitle,requireditems,pprevtext);
01151                         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (nml[i].nmtype==<a class="code" href="classNovelty__Marker.html#s8s1">Novelty_Marker::NM_TCH_DEPTH_INC</a>) <a class="code" href="ppfilter_8pre-blank_8cc.html#a5">extract_hierarchy_depth_increase_to_paper</a>(ostrtext,nml[i],contextconcats,ccranks,sectitle,srcf,srcfname,srcfnum,pprevtext);
01152                         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (nml[i].nmtype==<a class="code" href="classNovelty__Marker.html#s8s2">Novelty_Marker::NM_TCH_DEPTH_DEC</a>) <a class="code" href="ppfilter_8pre-blank_8cc.html#a6">extract_hierarchy_depth_decrease_to_paper</a>(ostrtext,nml[i],sectitle,srcf,srcfname,srcfnum,pprevtext);
01153                         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (nml[i].nmtype==<a class="code" href="classNovelty__Marker.html#s8s0">Novelty_Marker::NM_NOVELTY_ITEM</a>) <a class="code" href="ppfilter_8pre-blank_8cc.html#a13">extract_novelty_item_to_paper</a>(ostrtext,figcaps,figps,nml[i],sectitle,srcf,srcfname,srcfnum,pout,pprevtext);
01154                         <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unknown Novelty_Marker::nmtype in extract_paper_plan_to_paper(), continuing as is\n"</font>;
01155                 }
01156                 <font class="comment">// close section</font>
01157 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
01158 <font class="preprocessor"></font>                } cout &lt;&lt; <font class="charliteral">'L'</font>; cout.flush();
01159 <font class="preprocessor">#endif</font>
01160 <font class="preprocessor"></font>                <a class="code" href="ppfilter_8cc.html#a25">include_article_section_tail_template</a>(sectiontemplate,ostrtext,pprevtext);
01161         }
01162 <font class="preprocessor">#ifdef DEBUG_PPEXTRACT</font>
01163 <font class="preprocessor"></font>        cout &lt;&lt; <font class="charliteral">'K'</font>; cout.flush();
01164 <font class="preprocessor">#endif</font>
01165 <font class="preprocessor"></font>        <a class="code" href="ppfilter_8cc.html#a23">include_article_tail_template</a>(pout,ostrtext,pprevtext);
01166         <font class="comment">// add FIGURE CAPTIONS and FIGURE PSCONVERSIONS sections if present</font>
01167         <font class="keywordflow">if</font> (figcaps!=NULL) ostrtext.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"@Begin FIGURE CAPTIONS@[^\n]*\n"</font>),<font class="stringliteral">"@Begin FIGURE CAPTIONS@\n"</font>+_figcaps);
01168         <font class="keywordflow">if</font> (figps!=NULL) ostrtext.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"@Begin FIGURE PSCONVERSIONS@[^\n]*\n"</font>),<font class="stringliteral">"@Begin FIGURE PSCONVERSIONS@\n"</font>+_figps);
01169         <font class="comment">// add \figureloose commands</font>
01170         <font class="keywordtype">int</font> ofigidx;
01171         <font class="keywordflow">if</font> ((ofigidx = ostrtext.<a class="code" href="classString.html#a26">index</a>(fighererx))&gt;=0) {
01172                 <font class="comment">// find loose figures location in outline and copy to there</font>
01173                 <font class="keywordtype">int</font> iloosefigidx, ifigend; <a class="code" href="classString.html">String</a> ostrtail;
01174                 <font class="keywordflow">if</font> (((iloosefigidx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n%[      ]*@Begin FIGURES AT END@"</font>),-1))&gt;=0)
01175                  &amp;&amp; ((ifigend = ostrtext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\n%[   ]*@End FIGURES AT END@[^\n]*\n"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,-1))&gt;=0)) {
01176                         ostrtail = ostrtext.<a class="code" href="classString.html#a70">from</a>(ifigend);
01177                         ostrtext = ostrtext.<a class="code" href="classString.html#a58">before</a>(iloosefigidx);
01178                 } <font class="keywordflow">else</font> {
01179                         <font class="keywordflow">if</font> ((iloosefigidx = ostrtext.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"\\end{document}"</font>,-1))&gt;=0) {
01180                                 ostrtail = ostrtext.<a class="code" href="classString.html#a70">from</a>(iloosefigidx);
01181                                 ostrtext = ostrtext.<a class="code" href="classString.html#a58">before</a>(iloosefigidx);
01182                         } <font class="keywordflow">else</font> {
01183                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No \\end{document} found in outline in extract_paper_plan_to_paper(), continuing as is\n"</font>;
01184                                 ostrtail = <font class="stringliteral">""</font>;
01185                         }
01186                 }
01187                 <font class="comment">// copy \figurehere data to \figureloose commands</font>
01188                 ostrtext += <font class="stringliteral">"\n% @Begin FIGURES AT END@\n\n"</font>;
01189                 <font class="keywordflow">while</font> (ofigidx&gt;=0) {
01190                         <a class="code" href="classString.html">String</a> figdata;
01191                         <font class="keywordflow">if</font> ((ifigend=<a class="code" href="ppfilter_8cc.html#a6">TeX_get_command</a>(ostrtext,ofigidx,figdata))&gt;=0) {
01192                                 figdata.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"^\\([\\][A-Za-z]*\\)figurehere[{]"</font>),<font class="stringliteral">"_1figureloose{"</font>,<font class="charliteral">'_'</font>);
01193                                 ostrtext += figdata + <font class="stringliteral">"\n\n"</font>;
01194                         } <font class="keywordflow">else</font> {
01195                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Incomplete figure command found for "</font> &lt;&lt; ostrtext.<a class="code" href="classString.html#a82">sub</a>(fighererx,0) &lt;&lt; <font class="stringliteral">" in extract_paper_plan_to_paper(), continuing as is\n"</font>;
01196                                 ifigend = ofigidx+1;
01197                         }
01198                         ofigidx = ostrtext.<a class="code" href="classString.html#a26">index</a>(fighererx,ifigend);
01199                 }
01200                 ostrtext += <font class="stringliteral">"% @End FIGURES AT END@\n"</font>+ostrtail;
01201         }
01202         <font class="comment">// include protected text</font>
01203         <a class="code" href="ppfilter_8cc.html#a27">include_protected_text</a>(ostrtext,pprevtext);
01204         <font class="comment">// TeX format corrections, safeguards for TeX compilation</font>
01205         <a class="code" href="ppfilter_8cc.html#a8">TeX_format_corrections</a>(ostrtext,<font class="keyword">true</font>);
01206 <font class="comment">//*** add new Context items to contexts file here (DIL#20010412121145.1)</font>
01207 cerr &lt;&lt; <font class="stringliteral">"Add automatic call to add Context items to contexts file here (DIL#20010412121145.1)...\n"</font>;
01208         ostr &lt;&lt; ostrtext; <font class="comment">// write paper draft file</font>
01209         ostr.close();
01210 <font class="preprocessor">#ifndef DEBUG_DO_NOT_CREATE_NEW_OUTLINE</font>
01211 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a36">backup_and_rename</a>(pout,<font class="stringliteral">"Paper Draft"</font>)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
01212         <font class="comment">// find required items list in paper plan, create if not found</font>
01213         <font class="keywordflow">if</font> (requireditems.<a class="code" href="classString.html#a105">length</a>()&gt;0) {
01214                 <font class="keywordtype">int</font> riidx;
01215                 <font class="keywordflow">if</font> ((riidx = pptext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[     ]*@Begin REQUIRED ITEMS@[       ]*--[&gt;]\n"</font>),<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>))&lt;0) {
01216                         <font class="comment">// create list of required items</font>
01217                         <font class="keywordflow">if</font> ((riidx = pptext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([&lt;][Pp][&gt;][      ]*\n[&lt;][Hh][Rr][&gt;].*\\)?[&lt;]/[Bb][Oo][Dd][Yy][&gt;]"</font>)))&lt;0)
01218                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to create list of required items in extract_paper_plan_to_paper(), continuing as is\n"</font>;
01219                         <font class="keywordflow">else</font> {
01220                                 <a class="code" href="classString.html">String</a> pptextrest = pptext.<a class="code" href="classString.html#a51">at</a>(riidx,pptext.<a class="code" href="classString.html#a105">length</a>()-riidx);
01221                                 pptext = pptext.<a class="code" href="classString.html#a58">before</a>(riidx)
01222                                                 + <font class="stringliteral">"&lt;H2&gt;&lt;A HNAME=\"required-items\"&gt;Required Items&lt;/A&gt;&lt;/H2&gt;\n\n&lt;UL&gt;\n&lt;!-- @Begin REQUIRED ITEMS@ --&gt;\n&lt;!-- @End REQUIRED ITEMS@ --&gt;\n&lt;/UL&gt;\n\n"</font>
01223                                                 + pptextrest;
01224                                 riidx += 92; <font class="comment">// move index to start of &lt;!-- @End REQUIRED ITEMS@ --&gt; tag</font>
01225                         }
01226                 }
01227                 <font class="keywordflow">if</font> (riidx&gt;=0) {
01228                         <font class="comment">// update required items list</font>
01229                         <font class="keywordtype">int</font> riend;
01230                         <font class="keywordflow">if</font> ((riend = pptext.<a class="code" href="classString.html#a26">index</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"[&lt;]!--[     ]*@End REQUIRED ITEMS@[         ]*--[&gt;]"</font>),riidx))&lt;0) {
01231                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing @End REQUIRED ITEMS@ tag in extract_paper_plan_to_paper(), placing tag\n"</font>;
01232                                 <a class="code" href="classString.html">String</a> pptextrest = pptext.<a class="code" href="classString.html#a51">at</a>(riidx,pptext.<a class="code" href="classString.html#a105">length</a>()-riidx);
01233                                 pptext = pptext.<a class="code" href="classString.html#a58">before</a>(riidx) + <font class="stringliteral">"&lt;!-- @End REQUIRED ITEMS@ --&gt;\n"</font> + pptextrest;
01234                                 riend = riidx;
01235                         }
01236                         <a class="code" href="classString.html">String</a> pptextrest = pptext.<a class="code" href="classString.html#a51">at</a>(riend,pptext.<a class="code" href="classString.html#a105">length</a>()-riend);
01237                         pptext = pptext.<a class="code" href="classString.html#a58">before</a>(riidx) + requireditems + pptextrest;
01238                         <font class="comment">// store, backup and rename updated paper plan</font>
01239                         ostr.open(ppname+<font class="stringliteral">".new"</font>);
01240                         <font class="keywordflow">if</font> (!ostr) {
01241                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to create "</font> &lt;&lt; ppname &lt;&lt; <font class="stringliteral">".new to update required items list in extract_paper_plan_to_paper(), continuing as is\n"</font>;
01242                                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01243                         }
01244                         ostr &lt;&lt; pptext;
01245                         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a36">backup_and_rename</a>(ppname,<font class="stringliteral">"Paper Plan"</font>))
01246                                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to update required items list extract_paper_plan_to_paper(), continuing as is\n"</font>;
01247                 }
01248         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"No Required items to list\n"</font>;
01249         <font class="keywordflow">return</font> <font class="keyword">true</font>;
01250 <font class="preprocessor">#endif</font>
01251 <font class="preprocessor"></font>}
01252 
<a name="l01253"></a><a class="code" href="ppfilter_8cc.html#a29">01253</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a15">cmdline_extract_paper_plan_to_paper</a>(<a class="code" href="classString.html">String</a> ppfile) {
01254 <font class="comment">// Commandline interface to extract_paper_plan_to_paper()</font>
01255         <a class="code" href="classString.html">String</a> ppname, poutline, pprevious;
01256         ppname = ppfile.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"+"</font>);
01257         <font class="keywordflow">if</font> (ppname == <font class="stringliteral">""</font>) {
01258                 ppname = ppfile;
01259                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Paper extraction without specific paper outline not yet supported\n"</font>;
01260                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
01261         } <font class="keywordflow">else</font> {
01262                 poutline = ppfile.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"+"</font>);
01263                 <font class="keywordflow">if</font> (poutline == <font class="stringliteral">""</font>) {
01264                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Paper extraction without specific paper outline not yet supported\n"</font>;
01265                         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01266                 } <font class="keywordflow">else</font> {
01267                         pprevious = poutline.<a class="code" href="classString.html#a76">after</a>(<font class="stringliteral">"+"</font>);
01268                         <font class="keywordflow">if</font> (pprevious != <font class="stringliteral">""</font>) {
01269                                 poutline = poutline.<a class="code" href="classString.html#a58">before</a>(<font class="stringliteral">"+"</font>);
01270                                 <font class="keywordflow">if</font> (pprevious[0]!=<font class="charliteral">'/'</font>) pprevious.<a class="code" href="classString.html#a22">prepend</a>(homedir);
01271                         }
01272                         <font class="keywordflow">if</font> (ppfile[0]!=<font class="charliteral">'/'</font>) ppfile.<a class="code" href="classString.html#a22">prepend</a>(homedir);
01273                         <font class="keywordflow">if</font> (poutline[0]!=<font class="charliteral">'/'</font>) poutline.<a class="code" href="classString.html#a22">prepend</a>(homedir);
01274                         <font class="keywordflow">return</font> <a class="code" href="ppfilter_8pre-blank_8cc.html#a14">extract_paper_plan_to_paper</a>(ppname,poutline,pprevious);
01275                 }
01276         }
01277 }
01278 
<a name="l01279"></a><a class="code" href="ppfilter_8cc.html#a30">01279</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8cc.html#a30">Assess_Paper_Correction_Time</a>(<a class="code" href="classString.html">String</a> ppfile) {
01280 <font class="comment">// Obtain quantitative information about guidelines requiring</font>
01281 <font class="comment">// checking to complete the correction of a paper.</font>
01282         <font class="comment">// *** this may be improved by having a class or structure</font>
01283         <font class="comment">//     that reads in lists of guidelines in an outline context</font>
01284         <font class="comment">//     and the text to which they apply</font>
01285         <a class="code" href="classString.html">String</a> pptext;
01286         <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(ppfile,pptext)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
01287         <font class="comment">// prune document head and tail</font>
01288         pptext.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">".*\n[^%]*[\\]begin[{]document[}]"</font>),0);
01289         pptext.<a class="code" href="classString.html#a83">del</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"%[         ]+@Begin[       ]+ARTICLE TAIL@.*"</font>));
01290         <font class="comment">// prune comments</font>
01291         <a class="code" href="classString.html">String</a> checklistid(<font class="stringliteral">"CHL"</font>); checklistid = <a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(<a class="code" href="dil2al_8cc.html#a103">generate_tag</a>(checklistid).through(<font class="charliteral">':'</font>));
01292         checklistid.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">" "</font>,<font class="stringliteral">"[         ]+"</font>);
01293         <a class="code" href="classString.html">String</a> checkmarkid(<font class="stringliteral">"CHM"</font>); checkmarkid = <a class="code" href="utilities_8cc.html#a18">RX_Search_Safe</a>(<a class="code" href="dil2al_8cc.html#a103">generate_tag</a>(checkmarkid).through(<font class="charliteral">':'</font>));
01294         checkmarkid.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">" "</font>,<font class="stringliteral">"[         ]+"</font>);
01295         pptext.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(checklistid),<font class="stringliteral">"@@@Begin CHECKLIST:"</font>);
01296         pptext.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(checkmarkid),<font class="stringliteral">"@@@Begin CHECKMARK:"</font>);
01297         checklistid.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@Begin"</font>,<font class="stringliteral">"@End"</font>);
01298         checkmarkid.<a class="code" href="classString.html#a89">gsub</a>(<font class="stringliteral">"@Begin"</font>,<font class="stringliteral">"@End"</font>);
01299         pptext.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(checklistid),<font class="stringliteral">"@@@End CHECKLIST:"</font>);
01300         pptext.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(checkmarkid),<font class="stringliteral">"@@@End CHECKMARK:"</font>);
01301         pptext.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="classBigRegex.html">BigRegex</a>(<font class="stringliteral">"\\([^\\]\\)%[^\n]*"</font>),<font class="stringliteral">"_1"</font>,<font class="charliteral">'_'</font>);
01302         <font class="keywordtype">int</font> pploc = 0, ppnext, totwc = 0; <a class="code" href="classString.html">String</a> tagtext, contextstr, papercontext;
01303         <font class="keywordflow">while</font> ((pploc=<a class="code" href="utilities_8cc.html#a50">D2A_get_tag</a>(pptext,pploc,<font class="stringliteral">"End CHECKLIST"</font>,tagtext))&gt;=0) {
01304                 <font class="keywordflow">if</font> ((pploc=pptext.<a class="code" href="classString.html#a26">index</a>(<font class="charliteral">'\n'</font>,pploc))&gt;=0) { <font class="comment">// from start of next line</font>
01305                         <font class="comment">// to next tag or end of file</font>
01306                         pploc++;
01307                         <font class="keywordflow">if</font> ((ppnext=pptext.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"@@@Begin CHECKLIST:"</font>,pploc))&gt;=0) {
01308                                 contextstr = pptext.<a class="code" href="classString.html#a51">at</a>(pploc,ppnext-pploc);
01309                                 pploc = ppnext;
01310                         } <font class="keywordflow">else</font> contextstr = pptext.<a class="code" href="classString.html#a70">from</a>(pploc);
01311                         <font class="comment">// count number of words</font>
01312                         <font class="keywordtype">int</font> wc = <a class="code" href="utilities_8cc.html#a17">BigRegex_freq</a>(contextstr,BRXwhite);
01313                         totwc += wc;
01314                         <font class="keywordflow">if</font> (tagtext.<a class="code" href="classString.html#a32">contains</a>(<font class="stringliteral">"Paper"</font>)) papercontext = tagtext;
01315                         <font class="keywordflow">else</font> <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; tagtext &lt;&lt; <font class="stringliteral">": "</font> &lt;&lt; wc &lt;&lt; <font class="stringliteral">" words\n"</font>;
01316                 }
01317         }
01318         <font class="keywordflow">if</font> (totwc&gt;0) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; papercontext &lt;&lt; <font class="stringliteral">": "</font> &lt;&lt; totwc &lt;&lt; <font class="stringliteral">" words\n"</font>;
01319         <font class="keywordflow">return</font> <font class="keyword">true</font>;
01320 }
01321 
<a name="l01322"></a><a class="code" href="ppfilter_8cc.html#a31">01322</a> <font class="keywordtype">bool</font> <a class="code" href="ppfilter_8cc.html#a31">Quantitative_Assessment</a>(<font class="keywordtype">char</font> qatype, <a class="code" href="classString.html">String</a> ppfile) {
01323 <font class="comment">// Carry out quantitative assessments that can aid in tasks,</font>
01324 <font class="comment">// e.g. obtaining statistics about a paper that help in the</font>
01325 <font class="comment">// scheduling of DIL entries with appropriate time requirements.</font>
01326         <font class="keywordflow">switch</font> (qatype) {
01327                 <font class="keywordflow">case</font> <font class="charliteral">'c'</font>: <font class="comment">// assess time required for paper corrections</font>
01328                         <font class="keywordflow">return</font> <a class="code" href="ppfilter_8cc.html#a30">Assess_Paper_Correction_Time</a>(ppfile);
01329                 <font class="keywordflow">default</font>:
01330                         <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unknown assessment request `"</font> &lt;&lt; qatype &lt;&lt; <font class="stringliteral">" in Quantitative_Assessment()\n"</font>;
01331                         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01332         }
01333         <font class="keywordflow">return</font> <font class="keyword">true</font>;
01334 }
</pre></div><hr><address align="right"><small>Generated on Mon Sep 13 14:53:10 2004 for dil2al by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
