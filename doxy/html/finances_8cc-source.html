<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>finances.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>finances.cc</h1><a href="finances_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// finances.cc</font>
00002 <font class="comment">// Randal A. Koene, 20020905</font>
00003 
00004 <font class="preprocessor">#include "<a class="code" href="dil2al_8hh.html">dil2al.hh</a>"</font>
00005 
00006 <font class="comment">/*</font>
00007 <font class="comment">  These functions provide formalizer support for finances planning,</font>
00008 <font class="comment">  administration and accounting.</font>
00009 <font class="comment"></font>
00010 <font class="comment">  See &lt;A HREF="dil2al.hh"&gt;dil2al.hh&lt;/A&gt;.</font>
00011 <font class="comment">*/</font>
00012 
<a name="l00013"></a><a class="code" href="classFinancial__Note.html#a3">00013</a> <font class="keywordtype">int</font> <a class="code" href="classFinancial__Note.html#a3">Financial_Note::get</a>(<a class="code" href="classString.html">String</a> &amp; s, time_t &amp; t, <font class="keywordtype">int</font> sloc = 0) {
00014   <font class="comment">// get a financial note item from a string</font>
00015   <a class="code" href="classBigRegex.html">BigRegex</a> trx(<font class="stringliteral">"[[]\\([^]]+\\)[]]"</font>);
00016   <a class="code" href="classString.html">String</a> tr,trp;
00017   sloc = <a class="code" href="utilities_8cc.html#a55">HTML_get_table_row</a>(s,sloc,trp,tr);
00018   trp.<a class="code" href="classString.html#a82">upcase</a>();
00019   <a class="code" href="classFinancial__Note.html#n3">handled</a> = !trp.<a class="code" href="classString.html#a32">contains</a>(<font class="stringliteral">"BGCOLOR"</font>);
00020   <a class="code" href="classStringList.html">StringList</a> tc; <font class="keywordtype">int</font> tclen = 0;
00021   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j&gt;=0; ) {
00022     j = <a class="code" href="utilities_8cc.html#a54">HTML_get_table_cell</a>(tr,j,trp,tc[tclen]);
00023     <font class="keywordflow">if</font> (j&gt;=0) tclen++;
00024   }
00025   <font class="keywordtype">int</font> i = 0;
00026   <font class="keywordflow">if</font> ((tclen&gt;2) &amp;&amp; (tc[0].index(BRXint)&gt;=0)) {
00027     <font class="comment">// get a new date</font>
00028     <a class="code" href="classString.html">String</a> datestr(tc[0].sub(BRXint,0)+<font class="stringliteral">"0000"</font>);
00029     t = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(datestr.<a class="code" href="classString.html#a58">before</a>(12));
00030     i++;
00031   }
00032   <a class="code" href="classFinancial__Note.html#n0">date</a> = t;
00033   <a class="code" href="classFinancial__Note.html#n4">note</a> = tc[i];
00034   <a class="code" href="classFinancial__Note.html#n1">expense</a> = 0.0;
00035   <font class="keywordtype">int</font> e = -1, l;
00036   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> eend = 0; eend&gt;=0; ) { <font class="comment">// get last double in note (expenses must contain a decimal point)</font>
00037     eend = <a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a26">index</a>(BRXdouble,<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,eend);
00038     <font class="keywordflow">if</font> (eend&gt;=0) <font class="keywordflow">if</font> (<a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a82">sub</a>(BRXdouble,0).<a class="code" href="classString.html#a32">contains</a>(<font class="charliteral">'.'</font>)) { e = BRXdouble.subpos(); l = BRXdouble.sublen(); }
00039   }
00040   <font class="keywordflow">if</font> (e&gt;=0) {
00041     <a class="code" href="classFinancial__Note.html#n1">expense</a> = atof(<a class="code" href="classString.html">String</a>(<a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a51">at</a>(e,l)));
00042     <font class="keywordflow">if</font> (e&gt;0) <font class="keywordflow">if</font> (<a class="code" href="classFinancial__Note.html#n4">note</a>[e-1]==<font class="charliteral">'$'</font>) { e--; l++; }
00043     <a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a83">del</a>(e,l);
00044   }
00045   <font class="keywordflow">if</font> (<a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a26">index</a>(trx)&lt;0) <a class="code" href="classFinancial__Note.html#n2">type</a> = <font class="stringliteral">"unknown"</font>;
00046   <font class="keywordflow">else</font> {
00047     <a class="code" href="classFinancial__Note.html#n2">type</a> = <a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a82">sub</a>(trx,1);
00048     <a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a83">del</a>(trx.<a class="code" href="classBigRegex.html#a5">subpos</a>(),trx.<a class="code" href="classBigRegex.html#a6">sublen</a>());
00049   }
00050   <font class="keywordflow">while</font> ((!<a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a106">empty</a>()) &amp;&amp; (<a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a102">lastchar</a>()==<font class="charliteral">' '</font>)) <a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a83">del</a>((<font class="keywordtype">int</font>) <a class="code" href="classFinancial__Note.html#n4">note</a>.<a class="code" href="classString.html#a105">length</a>()-1,1);
00051   i++;
00052   <font class="keywordflow">if</font> (tclen&gt;i) <a class="code" href="classFinancial__Note.html#n5">comment</a>=tc[i];
00053   <font class="keywordflow">while</font> ((!<a class="code" href="classFinancial__Note.html#n5">comment</a>.<a class="code" href="classString.html#a106">empty</a>()) &amp;&amp; (<a class="code" href="classFinancial__Note.html#n5">comment</a>.<a class="code" href="classString.html#a102">lastchar</a>()==<font class="charliteral">'\n'</font>)) <a class="code" href="classFinancial__Note.html#n5">comment</a>.<a class="code" href="classString.html#a83">del</a>((<font class="keywordtype">int</font>) <a class="code" href="classFinancial__Note.html#n5">comment</a>.<a class="code" href="classString.html#a105">length</a>()-1,1);
00054   <font class="keywordflow">return</font> sloc;
00055 }
00056 
<a name="l00057"></a><a class="code" href="classFinancial__Note.html#a5">00057</a> <font class="keywordtype">void</font> <a class="code" href="classFinancial__Note.html#a5">Financial_Note::link_sorted</a>(<a class="code" href="classPLLRoot.html">PLLRoot&lt;Financial_Note&gt;</a> &amp; r) {
00058   <font class="comment">// link this financial note to r in order sorted by date</font>
00059   <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Note.html">Financial_Note</a>,r.<a class="code" href="classPLLRoot.html#a2">head</a>(),1) {
00060     <font class="keywordflow">if</font> (e-&gt;Date()&gt;<a class="code" href="classFinancial__Note.html#a6">Date</a>()) {
00061       r.<a class="code" href="classPLLRoot.html#a14">insert_before</a>(e,<font class="keyword">this</font>); <font class="comment">// sorted by date</font>
00062       <font class="keywordflow">return</font>;
00063     }
00064   }
00065   r.<a class="code" href="classPLLRoot.html#a8">link_before</a>(<font class="keyword">this</font>); <font class="comment">// append at end</font>
00066 }
00067 
<a name="l00068"></a><a class="code" href="classFinancial__Note.html#a4">00068</a> <a class="code" href="classString.html">String</a> <a class="code" href="classFinancial__Note.html#a4">Financial_Note::put</a>()<font class="keyword"> const </font>{
00069   <font class="keyword">const</font> <a class="code" href="classString.html">String</a> hstr(<font class="stringliteral">" BGCOLOR=\"#FF5F5F\""</font>);
00070   <font class="keyword">const</font> <a class="code" href="classString.html">String</a> nullstr(<font class="stringliteral">""</font>);
00071   <font class="keyword">const</font> <a class="code" href="classString.html">String</a> * rp;
00072   <font class="keywordflow">if</font> (handled) rp=&amp;nullstr; <font class="keywordflow">else</font> rp=&amp;hstr;
00073   <a class="code" href="classString.html">String</a> datecell(<font class="stringliteral">""</font>);
00074   <font class="keywordflow">if</font> ((!<a class="code" href="classPLLHandle.html#a2">Prev</a>()) || ((<a class="code" href="classPLLHandle.html#a2">Prev</a>()-&gt;<a class="code" href="classFinancial__Note.html#a6">Date</a>()!=<a class="code" href="classFinancial__Note.html#a6">Date</a>()))) {
00075     <font class="keywordtype">long</font> notesondate = 1;
00076     <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Note.html">Financial_Note</a>,<a class="code" href="classPLLHandle.html#a1">Next</a>(),<a class="code" href="classFinancial__Note.html#a6">Date</a>()==e-&gt;Date()) notesondate++;
00077     datecell = <a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">" ROWSPAN="</font>+<a class="code" href="classString.html">String</a>(notesondate),<a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m%d"</font>,<a class="code" href="classFinancial__Note.html#a6">Date</a>()),<font class="keyword">true</font>)+<font class="charliteral">'\n'</font>;
00078   }
00079   <font class="keywordflow">return</font> <a class="code" href="utilities_8cc.html#a64">HTML_put_table_row</a>(*rp,datecell+<a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="classFinancial__Note.html#n4">note</a>+<font class="stringliteral">" $"</font>+<a class="code" href="classString.html">String</a>(<a class="code" href="classFinancial__Note.html#n1">expense</a>,<font class="stringliteral">"%.2f"</font>)+<font class="stringliteral">" ["</font>+<a class="code" href="classFinancial__Note.html#n2">type</a>+<font class="charliteral">']'</font>,<font class="keyword">true</font>)+<a class="code" href="utilities_8cc.html#a65">HTML_put_table_cell</a>(<font class="stringliteral">""</font>,<a class="code" href="classFinancial__Note.html#n5">comment</a>,<font class="keyword">true</font>),<font class="keyword">true</font>)+<font class="charliteral">'\n'</font>;
00080 }
00081 
<a name="l00082"></a><a class="code" href="finances_8cc.html#a0">00082</a> <font class="keywordtype">bool</font> <a class="code" href="finances_8cc.html#a0">read_financial_notes_file</a>(<a class="code" href="classPLLRoot.html">PLLRoot&lt;Financial_Note&gt;</a> &amp; fnotes, <a class="code" href="classString.html">String</a> &amp; finnotestop, <a class="code" href="classString.html">String</a> &amp; finnotesend) {
00083   <a class="code" href="classString.html">String</a> finnotesstr;
00084   <font class="comment">// read financial notes file</font>
00085   <font class="keywordflow">if</font> (!<a class="code" href="utilities_8cc.html#a39">read_file_into_String</a>(finnotesfile,finnotesstr)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00086   <font class="comment">// extract financial notes table</font>
00087   <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"Parsing Financial Notes file\n"</font>;
00088   <font class="keywordtype">int</font> i, j;
00089   <font class="keywordflow">if</font> ((i=finnotesstr.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;!-- dil2al: start items --&gt;"</font>,<a class="code" href="classString.html#s2s1">String::SEARCH_END</a>,0))&lt;0) {
00090     <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"formalizer: Missing start of financial notes items table\n"</font>;
00091     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00092   }
00093   <font class="keywordflow">if</font> ((j=finnotesstr.<a class="code" href="classString.html#a26">index</a>(<font class="stringliteral">"&lt;!-- dil2al: end items --&gt;"</font>,0))&lt;0) {
00094     <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"formalizer: Missing end of financial notes items table\n"</font>;
00095     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00096   }
00097   finnotestop = finnotesstr.<a class="code" href="classString.html#a58">before</a>(i)+<font class="charliteral">'\n'</font>;
00098   finnotesend = finnotesstr.<a class="code" href="classString.html#a70">from</a>(j);
00099   finnotesstr.<a class="code" href="classString.html#a83">del</a>(j,finnotesstr.<a class="code" href="classString.html#a105">length</a>()-j);
00100   finnotesstr.<a class="code" href="classString.html#a83">del</a>(0,i); <font class="comment">// finnotesstr contains table</font>
00101   <font class="comment">// extract financial notes items while keeping track of dates and sorting by date</font>
00102   time_t notedate = <a class="code" href="utilities_8cc.html#a19">Time</a>(NULL);
00103   <font class="keywordflow">for</font> (i=0; i&gt;=0; ) {
00104     <a class="code" href="classFinancial__Note.html">Financial_Note</a> * fn = <font class="keyword">new</font> <a class="code" href="classFinancial__Note.html">Financial_Note</a>(finnotesstr,notedate,i);
00105     <font class="keywordflow">if</font> (i&lt;0) <font class="keyword">delete</font> fn;
00106     <font class="keywordflow">else</font> fn-&gt;<a class="code" href="classFinancial__Note.html#a5">link_sorted</a>(fnotes);
00107   }
00108   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00109 }
00110 
<a name="l00111"></a><a class="code" href="finances_8cc.html#a1">00111</a> <font class="keywordtype">bool</font> <a class="code" href="finances_8cc.html#a1">write_financial_notes_file</a>(<a class="code" href="classPLLRoot.html">PLLRoot&lt;Financial_Note&gt;</a> &amp; fnotes, <a class="code" href="classString.html">String</a> &amp; finnotestop, <a class="code" href="classString.html">String</a> &amp; finnotesend) {
00112   <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Note.html">Financial_Note</a>,fnotes.<a class="code" href="classPLLRoot.html#a2">head</a>(),1) finnotestop += e-&gt;put();
00113   finnotestop += finnotesend;
00114   <font class="keywordflow">return</font> <a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(finnotesfile,finnotestop,<font class="stringliteral">"Financial notes"</font>);
00115 }
00116 
<a name="l00117"></a><a class="code" href="finances_8cc.html#a2">00117</a> <font class="keywordtype">bool</font> <a class="code" href="finances_8cc.html#a369">financial_notes</a>() {
00118   <font class="comment">// Edit notes in &lt;A HREF="../../doc/html/financial-notes.html"&gt;financial-notes.html&lt;/A&gt;.</font>
00119   <a class="code" href="classPLLRoot.html">PLLRoot&lt;Financial_Note&gt;</a> fnotes; <a class="code" href="classString.html">String</a> finnotestop, finnotesend;
00120   <font class="keywordflow">if</font> (!<a class="code" href="finances_8cc.html#a0">read_financial_notes_file</a>(fnotes,finnotestop,finnotesend)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00121   <font class="comment">// add new notes (currently just by hand)</font>
00122   <a class="code" href="classFinancial__Note.html">Financial_Note</a> * f;
00123   time_t d; <font class="keywordtype">double</font> e; <font class="keywordtype">bool</font> h; <a class="code" href="classString.html">String</a> dstr(curdate), t, n, c;
00124   <font class="keyword">const</font> <font class="keywordtype">int</font> LLEN = 10240;
00125   <font class="keywordtype">char</font> lbuf[LLEN];
00126   d = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(dstr+<font class="stringliteral">"0000"</font>);
00127   <font class="keywordflow">while</font> (1) {
00128     <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"date ["</font> &lt;&lt; dstr &lt;&lt; <font class="stringliteral">"] (done=exit): "</font>;
00129     cin.getline(lbuf,LLEN); n = lbuf;
00130     <font class="keywordflow">if</font> (!n.<a class="code" href="classString.html#a106">empty</a>()) {
00131       <font class="keywordflow">if</font> (n==<font class="stringliteral">"done"</font>) <font class="keywordflow">break</font>;
00132       dstr = n;
00133       n += <font class="stringliteral">"0000"</font>; n.<a class="code" href="classString.html#a83">del</a>(12,n.<a class="code" href="classString.html#a105">length</a>()-12);
00134       d = <a class="code" href="utilities_8cc.html#a25">time_stamp_time_date</a>(n);
00135     }
00136     <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"expense: "</font>;
00137     cin.getline(lbuf,LLEN);
00138     e = atof(lbuf);
00139     <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"type [variable]: "</font>;
00140     cin.getline(lbuf,LLEN); t = lbuf;
00141     <font class="keywordflow">if</font> (t.<a class="code" href="classString.html#a106">empty</a>()) t = <font class="stringliteral">"variable"</font>;
00142     <font class="keywordflow">if</font> (t==<a class="code" href="classString.html">String</a>(<font class="stringliteral">"variable"</font>)) h = <font class="keyword">true</font>;
00143     <font class="keywordflow">else</font> h = !<a class="code" href="utilities_8cc.html#a28">confirmation</a>(<font class="stringliteral">"handled [n]: "</font>,<font class="charliteral">'y'</font>);
00144     <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"note: "</font>;
00145     cin.getline(lbuf,LLEN); n = lbuf;
00146     <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"comment: "</font>;
00147     cin.getline(lbuf,LLEN); c = lbuf;
00148     f = <font class="keyword">new</font> <a class="code" href="classFinancial__Note.html">Financial_Note</a>(d,e,t,h,n,c);
00149     f-&gt;<a class="code" href="classFinancial__Note.html#a5">link_sorted</a>(fnotes);
00150   }
00151   <font class="comment">// write financial notes file</font>
00152   <font class="keywordflow">return</font> <a class="code" href="finances_8cc.html#a1">write_financial_notes_file</a>(fnotes,finnotestop,finnotesend);
00153 }
00154 
<a name="l00155"></a><a class="code" href="classFinancial__Monthly__SubCategory.html#a2">00155</a> <a class="code" href="classFinancial__Monthly__SubCategory.html">Financial_Monthly_SubCategory</a> * <a class="code" href="classFinancial__Monthly__SubCategory.html#a2">Financial_Monthly_SubCategory::Find_SubCategory</a>(<a class="code" href="classString.html">String</a> s)<font class="keyword"> const </font>{
00156   <font class="keywordflow">if</font> (<a class="code" href="classFinancial__Monthly__SubCategory.html#n0">subcategory</a>==s) <font class="keywordflow">return</font> const_cast&lt;Financial_Monthly_SubCategory *&gt;(this);
00157   <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classFinancial__Monthly__SubCategory.html#a2">Find_SubCategory</a>(s);
00158   <font class="keywordflow">return</font> NULL;
00159 }
00160 
<a name="l00161"></a><a class="code" href="classFinancial__Monthly__Category.html#a2">00161</a> <a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a> * <a class="code" href="classFinancial__Monthly__Category.html#a2">Financial_Monthly_Category::Find_Category</a>(<a class="code" href="classString.html">String</a> c)<font class="keyword"> const </font>{
00162   <font class="keywordflow">if</font> (<a class="code" href="classFinancial__Monthly__Category.html#n0">category</a>==c) <font class="keywordflow">return</font> const_cast&lt;Financial_Monthly_Category *&gt;(this);
00163   <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classFinancial__Monthly__Category.html#a2">Find_Category</a>(c);
00164   <font class="keywordflow">return</font> NULL;
00165 }
00166 
<a name="l00167"></a><a class="code" href="classFinancial__Monthly__Category.html#a4">00167</a> <font class="keywordtype">void</font> <a class="code" href="classFinancial__Monthly__Category.html#a4">Financial_Monthly_Category::Copy_SubCategories</a>(<a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a> * c) {
00168   <font class="keywordflow">if</font> (c==<font class="keyword">this</font>) <font class="keywordflow">return</font>; <font class="comment">// no other category to copy from</font>
00169   <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Monthly__SubCategory.html">Financial_Monthly_SubCategory</a>,c-&gt;<a class="code" href="classFinancial__Monthly__Category.html#m0">subcategories</a>.<a class="code" href="classPLLRoot.html#a2">head</a>(),1) {
00170     <a class="code" href="classFinancial__Monthly__SubCategory.html">Financial_Monthly_SubCategory</a> * fs = <font class="keyword">new</font> <a class="code" href="classFinancial__Monthly__SubCategory.html">Financial_Monthly_SubCategory</a>(e-&gt;SubCategory());
00171     <a class="code" href="classFinancial__Monthly__Category.html#m0">subcategories</a>.<a class="code" href="classPLLRoot.html#a8">link_before</a>(fs);
00172   }
00173 }
00174 
<a name="l00175"></a><a class="code" href="classFinancial__Monthly__Category.html#a5">00175</a> <font class="keywordtype">void</font> <a class="code" href="classFinancial__Monthly__Category.html#a5">Financial_Monthly_Category::add</a>(<a class="code" href="classString.html">String</a> s, <font class="keywordtype">double</font> e, <a class="code" href="classFinancial__Monthly.html">Financial_Monthly</a> &amp; month) {
00176   <font class="comment">// add to result and by subcategory</font>
00177   <a class="code" href="classFinancial__Monthly__Category.html#n1">result</a> += e;
00178   <font class="keywordflow">if</font> (s.<a class="code" href="classString.html#a26">index</a>(BRXidentifier)&lt;0) s = <font class="stringliteral">"general"</font>;
00179   <font class="keywordflow">else</font> s = s.<a class="code" href="classString.html#a82">sub</a>(BRXidentifier,0);
00180   <a class="code" href="classFinancial__Monthly__SubCategory.html">Financial_Monthly_SubCategory</a> * fs = NULL;
00181   <font class="keywordflow">if</font> (<a class="code" href="classFinancial__Monthly__Category.html#m0">subcategories</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) fs = <a class="code" href="classFinancial__Monthly__Category.html#m0">subcategories</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classFinancial__Monthly__SubCategory.html#a2">Find_SubCategory</a>(s);
00182   <font class="keywordflow">if</font> (!fs) { <font class="comment">// add subcategory in this category in all months</font>
00183     <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Monthly.html">Financial_Monthly</a>,month.<a class="code" href="classPLLHandle.html#a3">head</a>(),1) {
00184       <a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a> * fc = e-&gt;categories.head()-&gt;Find_Category(<a class="code" href="classFinancial__Monthly__Category.html#n0">category</a>);
00185       fs = <font class="keyword">new</font> <a class="code" href="classFinancial__Monthly__SubCategory.html">Financial_Monthly_SubCategory</a>(s);
00186       fc-&gt;<a class="code" href="classFinancial__Monthly__Category.html#m0">subcategories</a>.<a class="code" href="classPLLRoot.html#a8">link_before</a>(fs);
00187     }
00188     fs = <a class="code" href="classFinancial__Monthly__Category.html#m0">subcategories</a>.<a class="code" href="classPLLRoot.html#a3">tail</a>(); <font class="comment">// retrieve subcategory in this month and category</font>
00189   }
00190   <font class="comment">// add to subcategory result</font>
00191   fs-&gt;<a class="code" href="classFinancial__Monthly__SubCategory.html#b0">add</a>(e);
00192 }
00193 
<a name="l00194"></a><a class="code" href="classFinancial__Monthly.html#a2">00194</a> <a class="code" href="classFinancial__Monthly.html">Financial_Monthly</a> * <a class="code" href="classFinancial__Monthly.html#a2">Financial_Monthly::Find_Month</a>(<a class="code" href="classString.html">String</a> m)<font class="keyword"> const </font>{
00195   <font class="keywordflow">if</font> (<a class="code" href="classFinancial__Monthly.html#n0">month</a>==m) <font class="keywordflow">return</font> const_cast&lt;Financial_Monthly *&gt;(this);
00196   <font class="keywordflow">if</font> (<a class="code" href="classPLLHandle.html#a1">Next</a>()) <font class="keywordflow">return</font> <a class="code" href="classPLLHandle.html#a1">Next</a>()-&gt;<a class="code" href="classFinancial__Monthly.html#a2">Find_Month</a>(m);
00197   <font class="keywordflow">return</font> NULL;
00198 }
00199 
<a name="l00200"></a><a class="code" href="classFinancial__Monthly.html#a3">00200</a> <font class="keywordtype">void</font> <a class="code" href="classFinancial__Monthly.html#a3">Financial_Monthly::Copy_Categories</a>(<a class="code" href="classFinancial__Monthly.html">Financial_Monthly</a> * h) {
00201   <font class="keywordflow">if</font> (h==<font class="keyword">this</font>) <font class="keywordflow">return</font>; <font class="comment">// no other month to copy from</font>
00202   <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a>,h-&gt;<a class="code" href="classFinancial__Monthly.html#m0">categories</a>.<a class="code" href="classPLLRoot.html#a2">head</a>(),1) {
00203     <a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a> * fc = <font class="keyword">new</font> <a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a>(e-&gt;Category());
00204     <a class="code" href="classFinancial__Monthly.html#m0">categories</a>.<a class="code" href="classPLLRoot.html#a8">link_before</a>(fc);
00205     fc-&gt;<a class="code" href="classFinancial__Monthly__Category.html#a4">Copy_SubCategories</a>(e);
00206   }
00207 }
00208 
<a name="l00209"></a><a class="code" href="classFinancial__Monthly.html#a4">00209</a> <font class="keywordtype">void</font> <a class="code" href="classFinancial__Monthly.html#a4">Financial_Monthly::add</a>(<font class="keyword">const</font> <a class="code" href="classFinancial__Note.html">Financial_Note</a> &amp; fn) {
00210   <font class="comment">// add by category</font>
00211   <a class="code" href="classString.html">String</a> cstr = fn.<a class="code" href="classFinancial__Note.html#a8">Type</a>();
00212   <font class="keywordflow">if</font> (cstr.<a class="code" href="classString.html#a26">index</a>(BRXidentifier)&lt;0) cstr = <font class="stringliteral">"variable"</font>;
00213   <font class="keywordflow">else</font> cstr = cstr.<a class="code" href="classString.html#a82">sub</a>(BRXidentifier,0);
00214   <a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a> * fc = NULL;
00215   <font class="keywordflow">if</font> (<a class="code" href="classFinancial__Monthly.html#m0">categories</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()) fc = <a class="code" href="classFinancial__Monthly.html#m0">categories</a>.<a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classFinancial__Monthly__Category.html#a2">Find_Category</a>(cstr);
00216   <font class="keywordflow">if</font> (!fc) { <font class="comment">// add category in all months</font>
00217     <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Monthly.html">Financial_Monthly</a>,<a class="code" href="classPLLHandle.html#a3">head</a>(),1) {
00218       fc = <font class="keyword">new</font> <a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a>(cstr);
00219       e-&gt;categories.link_before(fc);
00220     }
00221     fc = <a class="code" href="classFinancial__Monthly.html#m0">categories</a>.<a class="code" href="classPLLRoot.html#a3">tail</a>(); <font class="comment">// retrieve category in this month</font>
00222   }
00223   <font class="comment">// add to category result and by subcategory</font>
00224   fc-&gt;<a class="code" href="classFinancial__Monthly__Category.html#a5">add</a>(fn.<a class="code" href="classFinancial__Note.html#a8">Type</a>().<a class="code" href="classString.html#a76">after</a>(<font class="charliteral">','</font>),fn.<a class="code" href="classFinancial__Note.html#a9">Expense</a>(),*<font class="keyword">this</font>);
00225 }
00226 
<a name="l00227"></a><a class="code" href="classFinancial__Monthly__Root.html#a1">00227</a> <font class="keywordtype">void</font> <a class="code" href="classFinancial__Monthly__Root.html#a1">Financial_Monthly_Root::add</a>(<font class="keyword">const</font> <a class="code" href="classFinancial__Note.html">Financial_Note</a> &amp; fn) {
00228   <font class="comment">// add by month</font>
00229   <a class="code" href="classString.html">String</a> mstr = <a class="code" href="utilities_8cc.html#a20">time_stamp</a>(<font class="stringliteral">"%Y%m"</font>,fn.<a class="code" href="classFinancial__Note.html#a6">Date</a>());
00230   <a class="code" href="classFinancial__Monthly.html">Financial_Monthly</a> * fm = NULL;
00231   <font class="keywordflow">if</font> (<a class="code" href="classPLLRoot.html#a2">head</a>()) fm = <a class="code" href="classPLLRoot.html#a2">head</a>()-&gt;<a class="code" href="classFinancial__Monthly.html#a2">Find_Month</a>(mstr);
00232   <font class="keywordflow">if</font> (!fm) { <font class="comment">// add month</font>
00233       fm = <font class="keyword">new</font> <a class="code" href="classFinancial__Monthly.html">Financial_Monthly</a>(mstr);
00234       <a class="code" href="classPLLRoot.html#a8">link_before</a>(fm);
00235       fm-&gt;<a class="code" href="classFinancial__Monthly.html#a3">Copy_Categories</a>(<a class="code" href="classPLLRoot.html#a2">head</a>());
00236   }
00237   <font class="comment">// check for new categories and subcategories</font>
00238   <font class="comment">// add by category and subcategory within month</font>
00239   fm-&gt;<a class="code" href="classFinancial__Monthly.html#a4">add</a>(fn);
00240 }
00241 
<a name="l00242"></a><a class="code" href="classFinancial__Monthly__Root.html#a2">00242</a> <a class="code" href="classString.html">String</a> <a class="code" href="classFinancial__Monthly__Root.html#a2">Financial_Monthly_Root::put_results</a>()<font class="keyword"> const </font>{
00243   <a class="code" href="classString.html">String</a> <a class="code" href="templates_8defines_8hh.html#a11">res</a>;
00244   <a class="code" href="templates_8classic_8hh.html#a2">PLL_LOOP_FORWARD_NESTED</a>(<a class="code" href="classFinancial__Monthly.html">Financial_Monthly</a>,<a class="code" href="classPLLRoot.html#a2">head</a>(),1,m) { <font class="comment">// month</font>
00245     res += <font class="stringliteral">"Month: "</font> + m-&gt;Month() + <font class="charliteral">'\n'</font>;
00246     <a class="code" href="templates_8classic_8hh.html#a2">PLL_LOOP_FORWARD_NESTED</a>(<a class="code" href="classFinancial__Monthly__Category.html">Financial_Monthly_Category</a>,m-&gt;categories.head(),1,c) { <font class="comment">// category</font>
00247       res += <font class="stringliteral">"&lt;TABLE BORDER=1 WIDTH=\"100%\"&gt;\n&lt;TR&gt;"</font>;
00248       <font class="comment">// headings</font>
00249       <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Monthly__SubCategory.html">Financial_Monthly_SubCategory</a>,c-&gt;subcategories.head(),1) { <font class="comment">// subcategory</font>
00250         res += <font class="stringliteral">"&lt;TH&gt;"</font> + e-&gt;SubCategory();
00251       }
00252       res += <font class="stringliteral">"&lt;TH&gt;"</font> + c-&gt;Category() + <font class="stringliteral">"\n&lt;TR&gt;"</font>;
00253       <font class="comment">// results</font>
00254       <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Monthly__SubCategory.html">Financial_Monthly_SubCategory</a>,c-&gt;subcategories.head(),1) { <font class="comment">// subcategory</font>
00255         res += <font class="stringliteral">"&lt;TD&gt;"</font> + <a class="code" href="classString.html">String</a>(e-&gt;Result(),<font class="stringliteral">"%.2f"</font>);
00256       }
00257       res += <font class="stringliteral">"&lt;TH&gt;&lt;B&gt;"</font> + <a class="code" href="classString.html">String</a>(c-&gt;Result(),<font class="stringliteral">"%.2f"</font>) + <font class="stringliteral">"&lt;/B&gt;\n&lt;/TABLE&gt;\n"</font>;
00258     }
00259   }
00260   <font class="keywordflow">return</font> res;
00261 }
00262 
<a name="l00263"></a><a class="code" href="finances_8cc.html#a3">00263</a> <font class="keywordtype">bool</font> <a class="code" href="finances_8cc.html#a370">financial_monthly</a>() {
00264   <font class="comment">// Compute results from &lt;A HREF="../../doc/html/financial-notes.html"&gt;financial-notes.html&lt;/A&gt;.</font>
00265   <a class="code" href="classPLLRoot.html">PLLRoot&lt;Financial_Note&gt;</a> fnotes; <a class="code" href="classString.html">String</a> finnotestop, finnotesend;
00266   <font class="keywordflow">if</font> (!<a class="code" href="finances_8cc.html#a0">read_financial_notes_file</a>(fnotes,finnotestop,finnotesend)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00267   <font class="comment">// compute sums of categorized expenses that have not previously been handled</font>
00268   <a class="code" href="classFinancial__Monthly__Root.html">Financial_Monthly_Root</a> fmonthly;
00269   <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"If you wish to rely on monthly results from the Financial Notes, please\nverify that all non-variable expenses listed in bank statements are\naccounted for in the Financial Notes.\n\n"</font>;
00270   <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classFinancial__Note.html">Financial_Note</a>,fnotes.<a class="code" href="classPLLRoot.html#a2">head</a>(),1) {
00271     <font class="keywordflow">if</font> (!e-&gt;Handled()) fmonthly.<a class="code" href="classFinancial__Monthly__Root.html#a1">add</a>(*e);
00272   }
00273   <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; fmonthly.<a class="code" href="classFinancial__Monthly__Root.html#a2">put_results</a>();
00274 }
</pre></div><hr><address align="right"><small>Generated on Mon Sep 13 14:53:10 2004 for dil2al by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
