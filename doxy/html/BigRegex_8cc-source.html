<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BigRegex.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>BigRegex.cc</h1><a href="BigRegex_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* </font>
00002 <font class="comment">Copyright (C) 1988 Free Software Foundation</font>
00003 <font class="comment">    written by Doug Lea (dl@rocky.oswego.edu)</font>
00004 <font class="comment"></font>
00005 <font class="comment">Modified by Randal A. Koene, 20000228</font>
00006 <font class="comment">    disabled #include &lt;rx.h&gt; due to unreliabilities</font>
00007 <font class="comment">    hacked problem of duplicate functions due to</font>
00008 <font class="comment">    BigString/String and BigRegex/Regex versions</font>
00009 <font class="comment">    POSIX.2 adaptation of Regex (!)</font>
00010 <font class="comment"></font>
00011 <font class="comment">This file is part of the GNU C++ Library.  This library is free</font>
00012 <font class="comment">software; you can redistribute it and/or modify it under the terms of</font>
00013 <font class="comment">the GNU Library General Public License as published by the Free</font>
00014 <font class="comment">Software Foundation; either version 2 of the License, or (at your</font>
00015 <font class="comment">option) any later version.  This library is distributed in the hope</font>
00016 <font class="comment">that it will be useful, but WITHOUT ANY WARRANTY; without even the</font>
00017 <font class="comment">implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</font>
00018 <font class="comment">PURPOSE.  See the GNU Library General Public License for more details.</font>
00019 <font class="comment">You should have received a copy of the GNU Library General Public</font>
00020 <font class="comment">License along with this library; if not, write to the Free Software</font>
00021 <font class="comment">Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</font>
00022 <font class="comment">*/</font>
00023 
00024 <font class="comment">/* </font>
00025 <font class="comment">  BigRegex class implementation</font>
00026 <font class="comment"> */</font>
00027 
00028 <font class="preprocessor">#ifdef __GNUG__</font>
00029 <font class="preprocessor"></font><font class="preprocessor">#pragma implementation</font>
00030 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00031 <font class="preprocessor"></font>
00032 <font class="preprocessor">#include "<a class="code" href="BigRegex_8hh.html">BigRegex.hh</a>"</font>
00033 
00034 <font class="comment">// #define _BIGREGEX_PARANOID_POSIX</font>
00035 
<a name="l00036"></a><a class="code" href="BigRegex_8cc.html#a0">00036</a> <font class="preprocessor">#define USE_FASTER</font>
00037 <font class="preprocessor"></font><font class="preprocessor">#ifdef USE_REGEX_GNU_ALLOC</font>
00038 <font class="preprocessor"></font><font class="preprocessor">        #define TALLOC(n, t) ((t *) malloc ((n) * sizeof (t)))</font>
00039 <font class="preprocessor"></font><font class="preprocessor">        #include &lt;stdlib.h&gt;</font>
00040 <font class="preprocessor">        #define TFREE(p) free(p)</font>
00041 <font class="preprocessor"></font><font class="preprocessor">#else</font>
<a name="l00042"></a><a class="code" href="BigRegex_8cc.html#a1">00042</a> <font class="preprocessor"></font><font class="preprocessor">        #define TALLOC(n, t) new t[n]</font>
<a name="l00043"></a><a class="code" href="BigRegex_8cc.html#a2">00043</a> <font class="preprocessor"></font><font class="preprocessor">        #define TFREE(p) delete[] p</font>
00044 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00045 <font class="preprocessor"></font>
00046 <font class="comment">// #define DEBUG</font>
00047 <font class="preprocessor">#ifdef DEBUG</font>
00048 <font class="preprocessor"></font><font class="preprocessor">        #include &lt;iostream.h&gt;</font>
00049 <font class="preprocessor">        #define DEBUG_OUT(dtxt) cerr &lt;&lt; dtxt; cerr.flush();</font>
00050 <font class="preprocessor"></font><font class="preprocessor">#else</font>
<a name="l00051"></a><a class="code" href="BigRegex_8cc.html#a3">00051</a> <font class="preprocessor"></font><font class="preprocessor">        #define DEBUG_OUT(dtxt)</font>
00052 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00053 <font class="preprocessor"></font>
<a name="l00054"></a><a class="code" href="classBigRegex.html#a1">00054</a> <a class="code" href="classBigRegex.html#a1">BigRegex::~BigRegex</a>() {
00055         <font class="keywordflow">if</font> (re_assigned) <font class="keywordflow">if</font> (*re_assigned) regfree(<a class="code" href="classBigRegex.html#n0">re</a>);
00056         <font class="keyword">delete</font> <a class="code" href="classBigRegex.html#n0">re</a>;
00057         <font class="keyword">delete</font>[] <a class="code" href="classBigRegex.html#n1">rm</a>;
00058         <font class="keyword">delete</font> <a class="code" href="classBigRegex.html#n2">re_assigned</a>;
00059 }
00060 
<a name="l00061"></a><a class="code" href="classBigRegex.html#a0">00061</a> <a class="code" href="classBigRegex.html#a0">BigRegex::BigRegex</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* t, <font class="keywordtype">int</font> fast, <font class="keywordtype">int</font> bufsize, <font class="keyword">const</font> <font class="keywordtype">char</font>* transtable) {
00062         <a class="code" href="classBigRegex.html#n2">re_assigned</a> = <font class="keyword">new</font> <font class="keywordtype">bool</font>;
00063         <font class="keywordflow">if</font> (t==0) *<a class="code" href="classBigRegex.html#n2">re_assigned</a> = <font class="keyword">false</font>; <font class="comment">// zero-length RE</font>
00064         <font class="keywordflow">else</font> {
00065                 <a class="code" href="classBigRegex.html#n0">re</a> = <font class="keyword">new</font> regex_t;
00066 <font class="comment">//*** NOTE: bufsize doesn't really work yet, since it</font>
00067 <font class="comment">//*** is not remembered anywhere and up to</font>
00068 <font class="comment">//*** BIGREGEX_MAX_SUBEXPRESSIONS are filled in searches below</font>
00069                  <font class="keywordflow">if</font> (bufsize&gt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) bufsize = <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>;
00070                 <a class="code" href="classBigRegex.html#n1">rm</a> = <font class="keyword">new</font> regmatch_t[bufsize];
00071                 <font class="keywordtype">int</font> <a class="code" href="templates_8defines_8hh.html#a11">res</a>;
00072 <font class="preprocessor">#ifdef __DIL2AL__</font>
00073 <font class="preprocessor"></font>                <font class="comment">// revert to Basic RE backslashing style as inherited from Regex</font>
00074                 <font class="comment">// this reverses backslashed and non-backslashed meanings for: (){}|</font>
00075                 <font class="keywordtype">char</font> * ttmp;
00076                 <font class="keywordtype">int</font> tlen = 0; <font class="keywordflow">while</font> (t[tlen]) tlen++;
00077                 ttmp = <font class="keyword">new</font> <font class="keywordtype">char</font>[(2*tlen)+1]; <font class="comment">// allocate a character buffer twice as large in case everything has to be escaped with `\'</font>
00078                 <font class="keywordtype">int</font> ttmplen = 0; <font class="keywordtype">int</font> ii;
00079                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;=tlen; i++) {
00080                         ii = i+1;
00081                         <font class="keywordflow">if</font> ((t[i]==<font class="charliteral">'\\'</font>) &amp;&amp; ((t[ii]==<font class="charliteral">'\\'</font>) || (t[ii]==<font class="charliteral">'('</font>) || (t[ii]==<font class="charliteral">')'</font>) || (t[ii]==<font class="charliteral">'{'</font>) || (t[ii]==<font class="charliteral">'}'</font>) || (t[ii]==<font class="charliteral">'|'</font>))) {
00082                                 <font class="keywordflow">if</font> (t[ii]==<font class="charliteral">'\\'</font>) { <font class="comment">// retain escaped backslash</font>
00083                                         ttmp[ttmplen] = <font class="charliteral">'\\'</font>;
00084                                         ttmplen++;
00085                                 }
00086                                 i++; <font class="comment">// skip backslash</font>
00087                         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((t[i]==<font class="charliteral">'('</font>) || (t[i]==<font class="charliteral">')'</font>) || (t[i]==<font class="charliteral">'{'</font>) || (t[i]==<font class="charliteral">'}'</font>) || (t[i]==<font class="charliteral">'|'</font>)) {
00088                                 ttmp[ttmplen] = <font class="charliteral">'\\'</font>; <font class="comment">// add backslash</font>
00089                                 ttmplen++;
00090                         }
00091                         ttmp[ttmplen] = t[i]; <font class="comment">// copy character (possibly after skipping or adding a backslash)</font>
00092                         ttmplen++;
00093                 }
00094                 ttmplen--; <font class="comment">// don't count '\0'</font>
00095                 <a class="code" href="templates_8defines_8hh.html#a11">res</a> = regcomp(<a class="code" href="classBigRegex.html#n0">re</a>,ttmp,REG_EXTENDED);
00096                 <font class="keyword">delete</font>[] ttmp;
00097 <font class="preprocessor">#else</font>
00098 <font class="preprocessor"></font>                <a class="code" href="templates_8defines_8hh.html#a11">res</a> = regcomp(<a class="code" href="classBigRegex.html#n0">re</a>,t,REG_EXTENDED);
00099 <font class="preprocessor">#endif</font>
00100 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (!<a class="code" href="templates_8defines_8hh.html#a11">res</a>) *<a class="code" href="classBigRegex.html#n2">re_assigned</a> = <font class="keyword">true</font>;
00101                 <font class="keywordflow">else</font> {
00102                         *<a class="code" href="classBigRegex.html#n2">re_assigned</a> = <font class="keyword">false</font>;
00103 <font class="preprocessor">#ifdef _BIGREGEX_HAVE_ERROR_HANDLER</font>
00104 <font class="preprocessor"></font>                        <font class="keywordtype">char</font> errbuf[256];
00105                         <font class="keywordflow">if</font> (regerror(<a class="code" href="templates_8defines_8hh.html#a11">res</a>,<a class="code" href="classBigRegex.html#n0">re</a>,errbuf,256)&gt;0) (*lib_error_handler)(<font class="stringliteral">"BigRegex"</font>,errbuf);
00106 <font class="preprocessor">#endif                  </font>
00107 <font class="preprocessor"></font>                }
00108         }
00109 }
00110 
<a name="l00111"></a><a class="code" href="classBigRegex.html#a4">00111</a> <font class="keywordtype">int</font> <a class="code" href="classBigRegex.html#a4">BigRegex::match_info</a>(<font class="keywordtype">int</font>&amp; start, <font class="keywordtype">int</font>&amp; length, <font class="keywordtype">int</font> nth)<font class="keyword"> const </font>{
00112         <font class="keywordflow">if</font> ((unsigned)(nth) &gt;= <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) <font class="keywordflow">return</font> 0;
00113         start = <a class="code" href="classBigRegex.html#n1">rm</a>[nth].rm_so;
00114         length = <a class="code" href="classBigRegex.html#n1">rm</a>[nth].rm_eo - start;
00115         <font class="keywordflow">return</font> start &gt;= 0 &amp;&amp; length &gt;= 0;
00116 }
00117 
<a name="l00118"></a><a class="code" href="classBigRegex.html#a5">00118</a> <font class="keywordtype">int</font> <a class="code" href="classBigRegex.html#a5">BigRegex::subpos</a>(<font class="keywordtype">int</font> nth)<font class="keyword"> const </font>{
00119         <font class="keywordflow">if</font> ((unsigned)(nth) &gt;= <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) <font class="keywordflow">return</font> -1;
00120         <font class="keywordflow">return</font> <a class="code" href="classBigRegex.html#n1">rm</a>[nth].rm_so;
00121 }
00122 
<a name="l00123"></a><a class="code" href="classBigRegex.html#a6">00123</a> <font class="keywordtype">int</font> <a class="code" href="classBigRegex.html#a6">BigRegex::sublen</a>(<font class="keywordtype">int</font> nth)<font class="keyword"> const </font>{
00124         <font class="keywordflow">if</font> ((unsigned)(nth) &gt;= <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) <font class="keywordflow">return</font> -1;
00125         <font class="keywordflow">return</font> <a class="code" href="classBigRegex.html#n1">rm</a>[nth].rm_eo - <a class="code" href="classBigRegex.html#n1">rm</a>[nth].rm_so;
00126 }
00127 
00128 <font class="preprocessor">#ifndef USE_FASTER</font>
00129 <font class="preprocessor"></font>
00130 <font class="keywordtype">int</font> <a class="code" href="classBigRegex.html#a3">BigRegex::search</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* s, <font class="keywordtype">int</font> len, <font class="keywordtype">int</font>&amp; matchlen, <font class="keywordtype">int</font> startpos)<font class="keyword"> const </font>{
00131 <font class="comment">// Returns -1 if no match, otherwise index of match</font>
00132 <font class="comment">// Negative startpos means scan from end (very slow with regular POSIX.2 regex)</font>
00133         <font class="keywordtype">int</font> <a class="code" href="templates_8defines_8hh.html#a11">res</a> = -1;
00134         <font class="keywordtype">char</font> * stmp;
00135         <font class="keywordtype">bool</font> copied = <font class="keyword">true</font>;
00136         <font class="keywordtype">int</font> p = startpos;
00137         <font class="keywordflow">if</font> (startpos&lt;0) {
00138                 p += len; <font class="comment">// start searching at end</font>
00139                 len = p + 1;    <font class="comment">// adjust string to avoid finding matches beyond p when searching backward</font>
00140                 <font class="keywordflow">if</font> (p &lt; 0) <font class="keywordflow">return</font> -1;
00141         }
00142 <font class="preprocessor">#ifndef _BIGREGEX_SAFE_MATCHES</font>
00143 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (s[len]==<font class="charliteral">'\0'</font>) { <font class="comment">// assumes no '\0' prior to s[len]</font>
00144                 copied = <font class="keyword">false</font>;
00145                 stmp = s;
00146         } <font class="keywordflow">else</font>
00147 <font class="preprocessor">#endif</font>
00148 <font class="preprocessor"></font>        stmp = <font class="keyword">new</font> <font class="keywordtype">char</font>[len+1];
00149         <font class="keywordtype">int</font> i;
00150 <font class="preprocessor">#ifdef _BIGREGEX_SAFE_MATCHES</font>
00151 <font class="preprocessor"></font>        <font class="keywordflow">for</font> (i=0; ((i&lt;len) &amp;&amp; (s[i]!=<font class="charliteral">'\0'</font>)); i++) stmp[i]=s[i];
00152 <font class="preprocessor">#else</font>
00153 <font class="preprocessor"></font>        <font class="keywordflow">for</font> (i=0; i&lt;len; i++) stmp[i]=s[i];
00154 <font class="preprocessor">#endif</font>
00155 <font class="preprocessor"></font>        stmp[i]=<font class="charliteral">'\0'</font>;
00156         <font class="keywordflow">while</font> (p&gt;=0) {
00157                 <a class="code" href="templates_8defines_8hh.html#a11">res</a> = regexec(<a class="code" href="classBigRegex.html#n0">re</a>,&amp;stmp[p],(size_t) <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>,(regmatch_t *) <a class="code" href="classBigRegex.html#n1">rm</a>,0);
00158                 <font class="keywordflow">if</font> ((startpos&gt;=0) || (<a class="code" href="templates_8defines_8hh.html#a11">res</a>==0)) <font class="keywordflow">break</font>;
00159                 p--;
00160         }
00161 <font class="preprocessor">#ifndef _BIGREGEX_SAFE_MATCHES</font>
00162 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (copied)
00163 <font class="preprocessor">#endif</font>
00164 <font class="preprocessor"></font>        <font class="keyword">delete</font>[] stmp;
00165         <font class="keywordflow">if</font> (<a class="code" href="templates_8defines_8hh.html#a11">res</a>==0) {
00166                 <font class="keywordflow">if</font> (p&gt;0) { <font class="comment">// adjust rm to the offset p</font>
00167                         <font class="keywordflow">for</font>(i=0; ((i&lt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) &amp;&amp; (<a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so&gt;-1)); i++) {
00168                                 <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so += p;
00169                                 <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_eo += p;
00170                         }
00171                 }
00172 <font class="preprocessor">#if defined(_BIGREGEX_SAFE_MATCHES) &amp;&amp; defined(_BIGREGEX_HAS_RM_SPEP)</font>
00173 <font class="preprocessor"></font>                <font class="comment">// change rm pointers back to original string</font>
00174                 <font class="keywordflow">for</font>(i=0; ((i&lt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) &amp;&amp; (<a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so&gt;-1)); i++) {
00175                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_sp = s + <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so;
00176                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_ep = s + <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_eo;
00177                 }
00178 <font class="preprocessor">#endif</font>
00179 <font class="preprocessor"></font>                matchlen = <a class="code" href="classBigRegex.html#n1">rm</a>[0].rm_eo - <a class="code" href="classBigRegex.html#n1">rm</a>[0].rm_so;
00180                 <font class="keywordflow">return</font> <a class="code" href="classBigRegex.html#n1">rm</a>[0].rm_so; <font class="comment">// start of match</font>
00181         } <font class="keywordflow">else</font> {
00182                 matchlen = 0;
00183                 <font class="keywordflow">if</font> (<a class="code" href="templates_8defines_8hh.html#a11">res</a>==REG_NOMATCH) <font class="keywordflow">return</font> -1;
00184                 <font class="keywordflow">else</font> <font class="keywordflow">return</font> -2; <font class="comment">// internal error</font>
00185         }
00186 }
00187 
00188 <font class="preprocessor">#else</font>
00189 <font class="preprocessor"></font>
<a name="l00190"></a><a class="code" href="classBigRegex.html#a3">00190</a> <font class="keywordtype">int</font> <a class="code" href="classBigRegex.html#a3">BigRegex::search</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* s, <font class="keywordtype">int</font> len, <font class="keywordtype">int</font>&amp; matchlen, <font class="keywordtype">int</font> startpos)<font class="keyword"> const </font>{
00191 <font class="comment">// Returns -1 if no match, otherwise index of match</font>
00192 <font class="comment">// Negative startpos means scan from end (very slow with regular POSIX.2 regex)</font>
00193         <font class="keywordtype">int</font> <a class="code" href="templates_8defines_8hh.html#a11">res</a> = -1;
00194         <font class="keywordtype">char</font> * stmp;
00195         <font class="keywordtype">bool</font> copied = <font class="keyword">true</font>;
00196         <font class="keywordtype">int</font> p = startpos;
00197         <font class="keywordflow">if</font> (startpos&lt;0) {
00198 <a class="code" href="BigRegex_8cc.html#a3">DEBUG_OUT</a>(<font class="charliteral">'~'</font>)
00199                 len += p + 1;   <font class="comment">// start searching at len-abs(startpos)</font>
00200                 <font class="keywordflow">if</font> (len &lt;= 0) <font class="keywordflow">return</font> -1;
00201                 p = 0;
00202         }
00203 <font class="preprocessor">#ifndef _BIGREGEX_SAFE_MATCHES</font>
00204 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (s[len]==<font class="charliteral">'\0'</font>) { <font class="comment">// assumes no '\0' prior to s[len]</font>
00205                 copied = <font class="keyword">false</font>;
00206                 stmp = s;
00207         } <font class="keywordflow">else</font>
00208 <font class="preprocessor">#endif</font>
00209 <font class="preprocessor"></font>        stmp = <font class="keyword">new</font> <font class="keywordtype">char</font>[len+1];
00210         <font class="keywordtype">int</font> i;
00211 <font class="preprocessor">#ifdef _BIGREGEX_SAFE_MATCHES</font>
00212 <font class="preprocessor"></font>        <font class="keywordflow">for</font> (i=0; ((i&lt;len) &amp;&amp; (s[i]!=<font class="charliteral">'\0'</font>)); i++) stmp[i]=s[i];
00213 <font class="preprocessor">#else</font>
00214 <font class="preprocessor"></font>        <font class="keywordflow">for</font> (i=0; i&lt;len; i++) stmp[i]=s[i];
00215 <font class="preprocessor">#endif</font>
00216 <font class="preprocessor"></font>        stmp[i]=<font class="charliteral">'\0'</font>;
00217         <font class="keywordflow">if</font> (startpos&gt;=0) { <font class="comment">// search forward</font>
00218                 <a class="code" href="templates_8defines_8hh.html#a11">res</a> = regexec(<a class="code" href="classBigRegex.html#n0">re</a>,&amp;stmp[p],(size_t) <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>,(regmatch_t *) <a class="code" href="classBigRegex.html#n1">rm</a>,0);
00219         } <font class="keywordflow">else</font> { <font class="comment">// search backward</font>
00220 <font class="preprocessor">#ifdef _BIGREGEX_PARANOID_POSIX</font>
00221 <font class="preprocessor"></font>                <font class="keywordtype">int</font> tmpp = p, tmpres = 0;
00222                 regmatch_t * tmprm = <font class="keyword">new</font> regmatch_t[<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>];
00223                 <a class="code" href="templates_8defines_8hh.html#a11">res</a> = REG_NOMATCH;
00224                 <font class="keywordflow">while</font> ((tmpp&lt;len) &amp;&amp; (tmpres==0)) {
00225                         tmpres = regexec(<a class="code" href="classBigRegex.html#n0">re</a>,&amp;stmp[tmpp],(size_t) <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>,(regmatch_t *) tmprm,0);
00226                         <font class="keywordflow">if</font> (tmpres!=REG_NOMATCH) { <font class="comment">// furthest match found so far</font>
00227                                 <a class="code" href="templates_8defines_8hh.html#a11">res</a> = tmpres;
00228                                 p = tmpp;
00229                                 <font class="keywordflow">for</font> (i=0; i&lt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>; i++) {
00230                                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so = tmprm[i].rm_so;
00231                                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_eo = tmprm[i].rm_eo;
00232 <font class="preprocessor">#if defined(_BIGREGEX_SAFE_MATCHES) &amp;&amp; defined(_BIGREGEX_HAS_RM_SPEP)</font>
00233 <font class="preprocessor"></font>                                        <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_sp = tmprm[i].rm_sp;
00234                                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_ep = tmprm[i].rm_ep;
00235 <font class="preprocessor">#endif</font>
00236 <font class="preprocessor"></font>                                }
00237                                 tmpp=tmprm[0].rm_so+1;  <font class="comment">// try next just after current match index</font>
00238                         }
00239                 }
00240                 <font class="keyword">delete</font>[] tmprm;
00241 <font class="preprocessor">#else</font>
00242 <font class="preprocessor"></font><a class="code" href="BigRegex_8cc.html#a3">DEBUG_OUT</a>(<font class="charliteral">'-'</font>)
00243                 regex_t private_preg;
00244                 <font class="keyword">struct </font><a class="code" href="rxwrappers_8hh.html#a1">re_registers</a> regs;
00245                 private_preg = *<a class="code" href="classBigRegex.html#n0">re</a>;
00246                 private_preg.not_bol = !!(0 &amp; REG_NOTBOL);
00247                 private_preg.not_eol = !!(0 &amp; REG_NOTEOL);
00248                 private_preg.regs_allocated = REGS_FIXED;
00249                 regs.num_regs = <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>;
00250                 regs.start = <a class="code" href="BigRegex_8cc.html#a1">TALLOC</a> (<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>, regoff_t);
00251                 regs.end = <a class="code" href="BigRegex_8cc.html#a1">TALLOC</a> (<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>, regoff_t);
00252                 <font class="keywordflow">if</font> (regs.start == NULL || regs.end == NULL) <font class="keywordflow">return</font> (int) REG_NOMATCH;
00253                 <a class="code" href="templates_8defines_8hh.html#a11">res</a> = re_search (&amp;private_preg, stmp, len, len-1, -(len-1), &amp;regs);
00254              <font class="keywordflow">if</font> (<a class="code" href="templates_8defines_8hh.html#a11">res</a> &gt;= 0) {
00255 <a class="code" href="BigRegex_8cc.html#a3">DEBUG_OUT</a>(<font class="charliteral">'!'</font>)
00256                         <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> r = 0; r &lt; <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>; r++) {
00257                                 <a class="code" href="classBigRegex.html#n1">rm</a>[r].rm_so = regs.start[r];
00258                                 <a class="code" href="classBigRegex.html#n1">rm</a>[r].rm_eo = regs.end[r];
00259                         }
00260                         <a class="code" href="templates_8defines_8hh.html#a11">res</a> = 0;
00261                 } <font class="keywordflow">else</font> <a class="code" href="templates_8defines_8hh.html#a11">res</a> = REG_NOMATCH;
00262                 <a class="code" href="BigRegex_8cc.html#a2">TFREE</a> (regs.start);
00263                 <a class="code" href="BigRegex_8cc.html#a2">TFREE</a> (regs.end);
00264 <font class="preprocessor">#endif</font>
00265 <font class="preprocessor"></font>        }
00266 <font class="preprocessor">#ifndef _BIGREGEX_SAFE_MATCHES</font>
00267 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (copied)
00268 <font class="preprocessor">#endif</font>
00269 <font class="preprocessor"></font>        <font class="keyword">delete</font>[] stmp;
00270         <font class="keywordflow">if</font> (<a class="code" href="templates_8defines_8hh.html#a11">res</a>==0) {
00271                 <font class="keywordflow">if</font> (p&gt;0) { <font class="comment">// adjust rm to the offset p</font>
00272                         <font class="keywordflow">for</font>(i=0; ((i&lt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) &amp;&amp; (<a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so&gt;-1)); i++) {
00273                                 <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so += p;
00274                                 <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_eo += p;
00275                         }
00276                 }
00277 <font class="preprocessor">#if defined(_BIGREGEX_SAFE_MATCHES) &amp;&amp; defined(_BIGREGEX_HAS_RM_SPEP)</font>
00278 <font class="preprocessor"></font>                <font class="comment">// change rm pointers back to original string</font>
00279                 <font class="keywordflow">for</font>(i=0; ((i&lt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) &amp;&amp; (<a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so&gt;-1)); i++) {
00280                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_sp = s + <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so;
00281                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_ep = s + <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_eo;
00282                 }
00283 <font class="preprocessor">#endif</font>
00284 <font class="preprocessor"></font>                matchlen = <a class="code" href="classBigRegex.html#n1">rm</a>[0].rm_eo - <a class="code" href="classBigRegex.html#n1">rm</a>[0].rm_so;
00285                 <font class="keywordflow">return</font> <a class="code" href="classBigRegex.html#n1">rm</a>[0].rm_so; <font class="comment">// start of match</font>
00286         } <font class="keywordflow">else</font> {
00287                 matchlen = 0;
00288                 <font class="keywordflow">if</font> (<a class="code" href="templates_8defines_8hh.html#a11">res</a>==REG_NOMATCH) <font class="keywordflow">return</font> -1;
00289                 <font class="keywordflow">else</font> <font class="keywordflow">return</font> -2; <font class="comment">// internal error</font>
00290         }
00291 }
00292 
00293 <font class="preprocessor">#endif</font>
00294 <font class="preprocessor"></font>
<a name="l00295"></a><a class="code" href="classBigRegex.html#a2">00295</a> <font class="keywordtype">int</font> <a class="code" href="classBigRegex.html#a2">BigRegex::match</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>*s, <font class="keywordtype">int</font> len, <font class="keywordtype">int</font> p)<font class="keyword"> const </font>{
00296         <font class="comment">// negative p is considered an offset from len backwards,</font>
00297         <font class="comment">// but note that the match is still scanned forward</font>
00298         <font class="keywordflow">if</font> (p &lt; 0) {
00299                 len += p + 1; <font class="comment">// point len at len - abs(p) + 1</font>
00300                 <font class="keywordflow">if</font> (len &lt;= 0) <font class="keywordflow">return</font> -1;
00301                 p = 0;
00302         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (p &gt; len) <font class="keywordflow">return</font> -1;
00303         <font class="comment">// match re to (char*) s, from position p to position len</font>
00304         <font class="comment">// store subexpression information</font>
00305         <font class="comment">// return the number of characters matched</font>
00306         <font class="keywordtype">int</font> <a class="code" href="templates_8defines_8hh.html#a11">res</a>;
00307 <font class="preprocessor">#ifndef _BIGREGEX_SAFE_MATCHES</font>
00308 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (s[len]==<font class="charliteral">'\0'</font>) <a class="code" href="templates_8defines_8hh.html#a11">res</a> = regexec(<a class="code" href="classBigRegex.html#n0">re</a>,&amp;s[p],(size_t) <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>,(regmatch_t *) <a class="code" href="classBigRegex.html#n1">rm</a>,0);
00309         <font class="keywordflow">else</font> {
00310 <font class="preprocessor">#endif</font>
00311 <font class="preprocessor"></font>                <font class="keywordtype">char</font> * stmp; <font class="comment">// copy up to len characters</font>
00312                 stmp = <font class="keyword">new</font> <font class="keywordtype">char</font>[len+1];
00313                 <font class="keywordtype">int</font> i;
00314 <font class="preprocessor">#ifdef _BIGREGEX_SAFE_MATCHES</font>
00315 <font class="preprocessor"></font>                <font class="keywordflow">for</font> (i=0; ((i&lt;len) &amp;&amp; (s[i]!=<font class="charliteral">'\0'</font>)); i++) stmp[i]=s[i];
00316 <font class="preprocessor">#else</font>
00317 <font class="preprocessor"></font>                <font class="keywordflow">for</font> (i=0; i&lt;len; i++) stmp[i]=s[i];
00318 <font class="preprocessor">#endif</font>
00319 <font class="preprocessor"></font>                stmp[i]=<font class="charliteral">'\0'</font>;
00320                 <a class="code" href="templates_8defines_8hh.html#a11">res</a> = regexec(<a class="code" href="classBigRegex.html#n0">re</a>,&amp;stmp[p],(size_t) <a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>,(regmatch_t *) <a class="code" href="classBigRegex.html#n1">rm</a>,0);
00321                 <font class="keyword">delete</font>[] stmp;
00322 <font class="preprocessor">#ifndef _BIGREGEX_SAFE_MATCHES</font>
00323 <font class="preprocessor"></font>        }
00324 <font class="preprocessor">#endif</font>
00325 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (<a class="code" href="templates_8defines_8hh.html#a11">res</a>==0) {
00326                 <font class="keywordflow">if</font> (p&gt;0) { <font class="comment">// adjust rm to the offset p</font>
00327                         <font class="keywordflow">for</font>(i=0; ((i&lt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) &amp;&amp; (<a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so&gt;-1)); i++) {
00328                                 <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so += p;
00329                                 <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_eo += p;
00330                         }
00331                 }
00332 <font class="preprocessor">#if defined(_BIGREGEX_SAFE_MATCHES) &amp;&amp; defined(_BIGREGEX_HAS_RM_SPEP)</font>
00333 <font class="preprocessor"></font>                <font class="comment">// change rm pointers back to original string</font>
00334                 <font class="keywordflow">for</font>(i=0; ((i&lt;<a class="code" href="BigRegex_8hh.html#a2">BIGREGEX_MAX_SUBEXPRESSIONS</a>) &amp;&amp; (<a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so&gt;-1)); i++) {
00335                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_sp = s + <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_so;
00336                         <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_ep = s + <a class="code" href="classBigRegex.html#n1">rm</a>[i].rm_eo;
00337                 }
00338 <font class="preprocessor">#endif</font>
00339 <font class="preprocessor"></font>                <font class="keywordflow">return</font> <a class="code" href="classBigRegex.html#n1">rm</a>[0].rm_eo - <a class="code" href="classBigRegex.html#n1">rm</a>[0].rm_so; <font class="comment">// number of characters matched</font>
00340         } <font class="keywordflow">else</font> {
00341                 <font class="keywordflow">if</font> (<a class="code" href="templates_8defines_8hh.html#a11">res</a>==REG_NOMATCH) <font class="keywordflow">return</font> 0;
00342                 <font class="keywordflow">else</font> <font class="keywordflow">return</font> -2; <font class="comment">// internal error</font>
00343         }
00344 }
00345 
<a name="l00346"></a><a class="code" href="classBigRegex.html#a7">00346</a> <font class="keywordtype">int</font> <a class="code" href="classBigRegex.html#a7">BigRegex::OK</a>()<font class="keyword"> const </font>{
00347 <font class="preprocessor">#ifdef _BIGREGEX_HAVE_ERROR_HANDLER</font>
00348 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (re_assigned) <font class="keywordflow">if</font> (!(*re_assigned)) (*lib_error_handler)(<font class="stringliteral">"BigRegex"</font>, <font class="stringliteral">"invariant failure"</font>);
00349 <font class="preprocessor">#endif</font>
00350 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (re_assigned) <font class="keywordflow">return</font> *<a class="code" href="classBigRegex.html#n2">re_assigned</a>;
00351         <font class="keywordflow">else</font> <font class="keywordflow">return</font> 0;
00352 }
00353 
00354 <font class="comment">/*</font>
00355 <font class="comment"> some built-in Regular expressions</font>
00356 <font class="comment">*/</font>
00357 
00358 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> <a class="code" href="BigRegex_8cc.html#a4">BRXwhite</a>(<font class="stringliteral">"[ \n\t\r\v\f]+"</font>, 1);
00359 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> <a class="code" href="BigRegex_8cc.html#a5">BRXint</a>(<font class="stringliteral">"-?[0-9]+"</font>, 1);
00360 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> <a class="code" href="BigRegex_8cc.html#a6">BRXdouble</a>(<font class="stringliteral">"-?\\(\\([0-9]+\\.[0-9]*\\)\\|\\([0-9]+\\)\\|\\(\\.[0-9]+\\)\\)\\([eE][---+]?[0-9]+\\)?"</font>, 1, 200);
00361 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> <a class="code" href="BigRegex_8cc.html#a7">BRXalpha</a>(<font class="stringliteral">"[A-Za-z]+"</font>, 1);
00362 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> <a class="code" href="BigRegex_8cc.html#a8">BRXlowercase</a>(<font class="stringliteral">"[a-z]+"</font>, 1);
00363 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> <a class="code" href="BigRegex_8cc.html#a9">BRXuppercase</a>(<font class="stringliteral">"[A-Z]+"</font>, 1);
00364 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> <a class="code" href="BigRegex_8cc.html#a10">BRXalphanum</a>(<font class="stringliteral">"[0-9A-Za-z]+"</font>, 1);
00365 <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> <a class="code" href="BigRegex_8cc.html#a11">BRXidentifier</a>(<font class="stringliteral">"[A-Za-z_][A-Za-z0-9_]*"</font>, 1);
</pre></div><hr><address align="right"><small>Generated on Mon Sep 13 14:53:08 2004 for dil2al by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
