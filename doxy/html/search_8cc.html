<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>search.cc File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>search.cc File Reference</h1><code>#include "<a class="el" href="dil2al_8hh-source.html">dil2al.hh</a>"</code><br>

<p>
<a href="search_8cc-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="search_8cc.html#a0">generic_remove_name_reference</a> (<a class="el" href="classString.html">String</a> &amp;tpath)</td></tr>
<tr><td nowrap align=right valign=top>long&nbsp;</td><td valign=bottom><a class="el" href="search_8cc.html#a1">search_output</a> (<a class="el" href="classPLLRoot.html">PLLRoot</a>&lt; <a class="el" href="classSearch__Result.html">Search_Result</a> &gt; *sr, <a class="el" href="classString.html">String</a> &amp;<a class="el" href="templates_8defines_8hh.html#a11">res</a>, bool stringoutput=<a class="el" href="templates_8defines_8hh.html#a9">true</a>)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="classString.html">String</a>&nbsp;</td><td valign=bottom><a class="el" href="search_8cc.html#a2">search</a> (<a class="el" href="classStringList.html">StringList</a> &amp;targets, <a class="el" href="classString.html">String</a> searchkey, bool stringoutput=<a class="el" href="templates_8defines_8hh.html#a9">true</a>)</td></tr>
<tr><td nowrap align=right valign=top>unsigned long&nbsp;</td><td valign=bottom><a class="el" href="search_8cc.html#a3">Get_Target_Directory</a> (<a class="el" href="classStringList.html">StringList</a> &amp;targets, unsigned long i, <a class="el" href="classString.html">String</a> dirpath)</td></tr>
<tr><td nowrap align=right valign=top>unsigned long&nbsp;</td><td valign=bottom><a class="el" href="search_8cc.html#a4">Get_Target_Regex</a> (<a class="el" href="classStringList.html">StringList</a> &amp;targets, unsigned long i, <a class="el" href="classString.html">String</a> dirpath)</td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="search_8cc.html#a5">search_cmd</a> (<a class="el" href="classString.html">String</a> grepinfo)</td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="search_8cc.html#a6">search_FORM_cmd</a> (<a class="el" href="classStringList.html">StringList</a> *qlist=NULL)</td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a0" doxytag="search.cc::generic_remove_name_reference"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void generic_remove_name_reference </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>tpath</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="search_8cc-source.html#l00094">94</a> of file <a class="el" href="search_8cc-source.html">search.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="BigString_8hh-source.html#l01093">String::index</a>(), and <a class="el" href="BigString_8hh-source.html#l00493">String::length</a>().
<p>
Referenced by <a class="el" href="search_8cc-source.html#l00316">Search_Target::links</a>(), and <a class="el" href="search_8cc-source.html#l00100">Target_Access::remove_name_reference</a>().
<p>
<div class="fragment"><pre>00094                                                    {
00095         <font class="keywordtype">int</font> nameref = tpath.<a class="code" href="classString.html#a26">index</a>(<font class="charliteral">'#'</font>,-1);
00096         <font class="keywordtype">int</font> fileref = tpath.<a class="code" href="classString.html#a26">index</a>(<font class="charliteral">'/'</font>,-1);
00097         <font class="keywordflow">if</font> ((nameref&gt;=0) &amp;&amp; (nameref&gt;fileref)) tpath.<a class="code" href="classString.html#a83">del</a>(nameref,tpath.<a class="code" href="classString.html#a105">length</a>()-nameref);
00098 }
</pre></div>    </td>
  </tr>
</table>
<a name="a3" doxytag="search.cc::Get_Target_Directory"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> unsigned long Get_Target_Directory </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classStringList.html">StringList</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>targets</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>unsigned long&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>i</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>dirpath</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="search_8cc-source.html#l00470">470</a> of file <a class="el" href="search_8cc-source.html">search.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="utilities_8cc-source.html#l01988">file_is_directory</a>(), <a class="el" href="utilities_8cc-source.html#l01979">file_is_regular_or_symlink</a>(), <a class="el" href="BigString_8hh-source.html#l01086">String::lastchar</a>(), <a class="el" href="dil2al_8hh-source.html#l00113">StringList::length</a>(), <a class="el" href="BigString_8hh-source.html#l00493">String::length</a>(), and <a class="el" href="utilities_8cc-source.html#l00305">Directory_Access::read</a>().
<p>
Referenced by <a class="el" href="search_8cc-source.html#l00501">Get_Target_Regex</a>(), and <a class="el" href="search_8cc-source.html#l00145">Target_Access::make_local_copy_of_directory</a>().
<p>
<div class="fragment"><pre>00470                                                                                           {
00471         <font class="comment">// add filenames from a directory to the list of targets</font>
00472         <font class="comment">// returns the number of targets added</font>
00473         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> num;
00474         <font class="comment">// get directory content</font>
00475         <a class="code" href="classString.html">String</a> t;
00476         <font class="keywordflow">if</font> (dirpath.<a class="code" href="classString.html#a102">lastchar</a>()==<font class="charliteral">'/'</font>) dirpath.<a class="code" href="classString.html#a83">del</a>((<font class="keywordtype">int</font>) (dirpath.<a class="code" href="classString.html#a105">length</a>()-1),1);
00477         <a class="code" href="classDirectory__Access.html">Directory_Access</a> da(dirpath);
00478         num = da.<a class="code" href="classDirectory__Access.html#a1">read</a>(t);
00479         <font class="keywordflow">if</font> (num&lt;0) {
00480                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Unable to read directory "</font> &lt;&lt; dirpath &lt;&lt; <font class="charliteral">'\n'</font>;
00481                 <font class="keywordflow">return</font> 0;
00482         }
00483         t.<a class="code" href="classString.html#a83">del</a>(0,1); <font class="comment">// remove first separator character</font>
00484         <a class="code" href="classStringList.html">StringList</a> df(t,<font class="charliteral">'/'</font>); <a class="code" href="classString.html">String</a> f;
00485         <font class="comment">// add verified files to targets list and adjust num as needed</font>
00486         <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> j = 0; j&lt;(df.<a class="code" href="classStringList.html#a10">length</a>()-1); j++) {
00487                 f = dirpath+<font class="charliteral">'/'</font>+df[j];
00488                 <font class="keywordflow">if</font> (<a class="code" href="utilities_8cc.html#a33">file_is_regular_or_symlink</a>(f)) {
00489                         targets[i] = f;
00490                         i++;
00491                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (followlinks&gt;0) { <font class="comment">// can enable recursive searching of directories</font>
00492                         <font class="keywordflow">if</font> ((<a class="code" href="utilities_8cc.html#a34">file_is_directory</a>(f)) &amp;&amp; (df[j]!=<font class="stringliteral">"."</font>) &amp;&amp; (df[j]!=<font class="stringliteral">".."</font>)) {
00493                                 targets[i] = f;
00494                                 i++;
00495                         } <font class="keywordflow">else</font> num --;
00496                 } <font class="keywordflow">else</font> num--;
00497         }
00498         <font class="keywordflow">return</font> num;
00499 }
</pre></div>    </td>
  </tr>
</table>
<a name="a4" doxytag="search.cc::Get_Target_Regex"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> unsigned long Get_Target_Regex </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classStringList.html">StringList</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>targets</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>unsigned long&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>i</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>dirpath</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="search_8cc-source.html#l00501">501</a> of file <a class="el" href="search_8cc-source.html">search.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00896">String::before</a>(), <a class="el" href="BigString_8hh-source.html#l01126">String::contains</a>(), <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="search_8cc-source.html#l00470">Get_Target_Directory</a>(), <a class="el" href="dil2al_8hh-source.html#l00113">StringList::length</a>(), <a class="el" href="BigString_8hh-source.html#l00493">String::length</a>(), <a class="el" href="BigString_8hh-source.html#l01192">String::matches</a>(), <a class="el" href="BigString_8cc-source.html#l01086">String::sub</a>(), and <a class="el" href="BigRegex_8cc-source.html#l00118">BigRegex::subpos</a>().
<p>
Referenced by <a class="el" href="search_8cc-source.html#l00527">search_cmd</a>().
<p>
<div class="fragment"><pre>00501                                                                                       {
00502         <font class="comment">// add filenames from a directory to the list of targets that match a regex</font>
00503         <font class="comment">// returns the number of targets added</font>
00504         <font class="comment">// the regex is provided as "@regex-pattern@" following the directory, '@' need not be escaped</font>
00505         <a class="code" href="classStringList.html">StringList</a> d;
00506         <a class="code" href="classBigRegex.html">BigRegex</a> trx(<font class="stringliteral">"@[^/]+@$"</font>);
00507         <font class="comment">// get regex</font>
00508         <font class="keywordflow">if</font> (!dirpath.<a class="code" href="classString.html#a32">contains</a>(trx)) {
00509                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: No regex pattern in "</font> &lt;&lt; dirpath &lt;&lt; <font class="stringliteral">" in Get_Target_Regex()\n"</font>;
00510                 <font class="keywordflow">return</font> 0;
00511         }
00512         <a class="code" href="classString.html">String</a> fileregex = dirpath.<a class="code" href="classString.html#a82">sub</a>(trx,0); fileregex.<a class="code" href="classString.html#a83">del</a>(0,1); fileregex.<a class="code" href="classString.html#a83">del</a>((<font class="keywordtype">int</font>) (fileregex.<a class="code" href="classString.html#a105">length</a>()-1),1);
00513         <font class="comment">// get directory content</font>
00514         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> num = <a class="code" href="search_8cc.html#a3">Get_Target_Directory</a>(d,0,dirpath.<a class="code" href="classString.html#a58">before</a>(trx.<a class="code" href="classBigRegex.html#a5">subpos</a>()));
00515         <font class="comment">// add files that match the regex to targets list and ajust num as needed</font>
00516         <a class="code" href="classString.html">String</a> filename; <a class="code" href="classBigRegex.html">BigRegex</a> frx(fileregex);
00517         <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> j = 0; j&lt;d.<a class="code" href="classStringList.html#a10">length</a>(); j++) {
00518                 filename = d[j].from(trx.<a class="code" href="classBigRegex.html#a5">subpos</a>());
00519                 <font class="keywordflow">if</font> (filename.<a class="code" href="classString.html#a42">matches</a>(frx)) {
00520                         targets[i] = d[j];
00521                         i++;
00522                 } <font class="keywordflow">else</font> num--;
00523         }
00524         <font class="keywordflow">return</font> num;
00525 }
</pre></div>    </td>
  </tr>
</table>
<a name="a2" doxytag="search.cc::search"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="classString.html">String</a> search </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classStringList.html">StringList</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>targets</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>searchkey</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>stringoutput</em> = <a class="el" href="templates_8defines_8hh.html#a9">true</a></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="search_8cc-source.html#l00425">425</a> of file <a class="el" href="search_8cc-source.html">search.cc</a>.
<p>
References <a class="el" href="templates_8classic_8hh-source.html#l00104">PLLRoot&lt; PLLType &gt;::clear</a>(), <a class="el" href="templates_8classic_8hh-source.html#l00086">PLLRoot&lt; PLLType &gt;::head</a>(), <a class="el" href="dil2al_8hh-source.html#l00113">StringList::length</a>(), <a class="el" href="templates_8classic_8hh-source.html#l00227">PLLRoot&lt; PLLType &gt;::link_before</a>(), <a class="el" href="templates_8classic_8hh-source.html#l00342">PLL_LOOP_FORWARD</a>, <a class="el" href="templates_8defines_8hh-source.html#l00277">res</a>, <a class="el" href="search_8cc-source.html#l00413">search_output</a>(), and <a class="el" href="utilities_8cc-source.html#l02116">write_file_from_String</a>().
<p>
Referenced by <a class="el" href="search_8cc-source.html#l00527">search_cmd</a>().
<p>
<div class="fragment"><pre>00425                                                                                 {
00426         <font class="comment">// Search the target for searchkey</font>
00427         <font class="comment">// Result output is returned as a string or on VOUT.</font>
00428         <font class="comment">// Returns results as string or a string with the number of results.</font>
00429         <font class="comment">// Note: Directories are conceptually handled in the same manner</font>
00430         <font class="comment">// as HTML pages, but they are read differently and can contain</font>
00431         <font class="comment">// only links to follow for recursive searching.</font>
00432         <font class="comment">// Note: It is quite easy to make alternative search functions using</font>
00433         <font class="comment">// the Search_Target and Search_Result classes.</font>
00434         <font class="comment">// initialize global lists</font>
00435         <font class="keyword">static</font> <a class="code" href="classString.html">String</a> <a class="code" href="templates_8defines_8hh.html#a11">res</a>; <font class="comment">// stored in function, not objects, static to avoid problems with lifetime of object that return value points to</font>
00436         <a class="code" href="classPLLRoot.html">PLLRoot&lt;Search_Result&gt;</a> results;
00437         <a class="code" href="classPLLRoot.html">PLLRoot&lt;Search_Target&gt;</a> globaltargets;
00438         <a class="code" href="classQuick__String__Hash.html">Quick_String_Hash</a> encountered;
00439         <font class="comment">// search target objects for searchkey</font>
00440         <font class="comment">// *** Whether the list of Search_Target objects ever becomes</font>
00441         <font class="comment">//     greater than one depends on whether a followlinks search</font>
00442         <font class="comment">//     is conducted in breadth-first or depth-first fashion.</font>
00443         <a class="code" href="classSearch__Target.html">Search_Target</a> * t; <a class="code" href="classString.html">String</a> progressfile(tareadfile+<font class="stringliteral">"progress"</font>), progress; <font class="keywordtype">long</font> resnum = 0;
00444         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i&lt;targets.<a class="code" href="classStringList.html#a10">length</a>(); i++) <font class="keywordflow">if</font> (!targets[i].empty()) {
00445 <font class="comment">//cerr &lt;&lt; searchkey &lt;&lt; " in " &lt;&lt; targets[i] &lt;&lt; '\n'; cerr.flush();</font>
00446                 t = <font class="keyword">new</font> <a class="code" href="classSearch__Target.html">Search_Target</a>(&amp;results,searchkey,targets[i],followlinks,<font class="keyword">false</font>,&amp;encountered);
00447                 globaltargets.<a class="code" href="classPLLRoot.html#a8">link_before</a>(t);
00448                 <font class="comment">// *** Not quite sure where to put the next lines, in this</font>
00449                 <font class="comment">//     loop or outside it, and how that affects the search</font>
00450                 <font class="comment">//     order if additional targets are added by finding</font>
00451                 <font class="comment">//     links to follow in a breadth-first followlinks search.</font>
00452                 <font class="keywordtype">long</font> i_search = 0;
00453                 <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classSearch__Target.html">Search_Target</a>,globaltargets.<a class="code" href="classPLLRoot.html#a2">head</a>(),1) {
00454                         <font class="keywordflow">if</font> (searchprogressmeter) { <font class="comment">// write a progress meter to a file</font>
00455                                 progress = <a class="code" href="classString.html">String</a>((<font class="keywordtype">long</font>) i)+<font class="charliteral">','</font>+<a class="code" href="classString.html">String</a>(i_search)+<font class="charliteral">':'</font>+e-&gt;Target();
00456                                 <a class="code" href="utilities_8cc.html#a41">write_file_from_String</a>(progressfile,progress,<font class="stringliteral">""</font>,<font class="keyword">true</font>);
00457                                 i_search++;
00458                         }
00459                         e-&gt;search();
00460                         <font class="keywordflow">if</font> (immediatesearchoutput) resnum += <a class="code" href="search_8cc.html#a1">search_output</a>(&amp;results,res,stringoutput);
00461                         <font class="comment">// *** caused problems here: e-&gt;remove(); // frees up space and avoids repeated searches</font>
00462                 }
00463                 globaltargets.<a class="code" href="classPLLRoot.html#a16">clear</a>(); <font class="comment">// frees up space and avoids repeated searches</font>
00464         }
00465         <font class="keywordflow">if</font> (!immediatesearchoutput) resnum = <a class="code" href="search_8cc.html#a1">search_output</a>(&amp;results,res,stringoutput);
00466         <font class="keywordflow">if</font> (!stringoutput) res = <a class="code" href="classString.html">String</a>(resnum);
00467         <font class="keywordflow">return</font> res;
00468 }
</pre></div>    </td>
  </tr>
</table>
<a name="a5" doxytag="search.cc::search_cmd"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> bool search_cmd </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classString.html">String</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>grepinfo</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="search_8cc-source.html#l00527">527</a> of file <a class="el" href="search_8cc-source.html">search.cc</a>.
<p>
References <a class="el" href="BigString_8cc-source.html#l00906">String::after</a>(), <a class="el" href="BigString_8cc-source.html#l00886">String::at</a>(), <a class="el" href="BigString_8cc-source.html#l00896">String::before</a>(), <a class="el" href="utilities_8cc-source.html#l00083">StringList::contains</a>(), <a class="el" href="BigString_8cc-source.html#l00843">String::del</a>(), <a class="el" href="BigString_8hh-source.html#l00494">String::empty</a>(), <a class="el" href="dil2al_8hh-source.html#l01406">EOUT</a>, <a class="el" href="utilities_8cc-source.html#l01988">file_is_directory</a>(), <a class="el" href="search_8cc-source.html#l00501">Get_Target_Regex</a>(), <a class="el" href="BigString_8hh-source.html#l01234">String::gsub</a>(), <a class="el" href="BigString_8hh-source.html#l01093">String::index</a>(), <a class="el" href="BigString_8hh-source.html#l00493">String::length</a>(), <a class="el" href="BigString_8cc-source.html#l01311">replicate</a>(), <a class="el" href="templates_8defines_8hh-source.html#l00277">res</a>, <a class="el" href="search_8cc-source.html#l00425">search</a>(), and <a class="el" href="dil2al_8hh-source.html#l01407">VOUT</a>.
<p>
Referenced by <a class="el" href="dil2al_8cc-source.html#l00655">dil2al_commands</a>(), and <a class="el" href="search_8cc-source.html#l00579">search_FORM_cmd</a>().
<p>
<div class="fragment"><pre>00527                                  {
00528         <font class="comment">// Command line interface to search()</font>
00529         <font class="comment">// Note: For optimal use, wrap the output of this call in a complete framework</font>
00530         <font class="comment">// for an HTML file. It is also possible to direct the error output to another</font>
00531         <font class="comment">// file and to link to that one from the HTML file with the search results.</font>
00532         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> trx(<font class="stringliteral">"@[^/]+@$"</font>);
00533         <font class="keyword">const</font> <a class="code" href="classBigRegex.html">BigRegex</a> rrx(<font class="stringliteral">"\\(^[Hh][Tt][Tt][Pp]:\\|^[Ff][Tt][Pp]:\\)"</font>);
00534         <font class="keywordflow">if</font> (grepinfo.<a class="code" href="classString.html#a106">empty</a>()) {
00535                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing search information in search_cmd()\n"</font>;
00536                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00537         }
00538         <font class="keywordtype">char</font> separator = grepinfo[0];
00539         grepinfo.<a class="code" href="classString.html#a89">gsub</a>(<a class="code" href="BigString_8cc.html#a39">replicate</a>(separator,2),(<font class="keywordtype">char</font>) 255); <font class="comment">// temporarily replace escaped characters</font>
00540         <font class="keywordtype">int</font> keyend = grepinfo.<a class="code" href="classString.html#a26">index</a>(separator,1);
00541         <font class="keywordflow">if</font> (keyend&lt;0) {
00542                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing search key end in search_cmd()\n"</font>;
00543                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00544         }
00545         <font class="keywordflow">if</font> (keyend==1) {
00546                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Zero length search key in search_cmd()\n"</font>;
00547                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00548         }
00549         <font class="keywordflow">if</font> ((keyend+1)&gt;=grepinfo.<a class="code" href="classString.html#a105">length</a>()) {
00550                 <a class="code" href="dil2al_8hh.html#a107">EOUT</a> &lt;&lt; <font class="stringliteral">"dil2al: Missing search target in search_cmd()\n"</font>;
00551                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00552         }
00553         <font class="comment">// put all search targets into a StringList</font>
00554         <a class="code" href="classString.html">String</a> searchkey(grepinfo.<a class="code" href="classString.html#a51">at</a>(1,keyend-1)); searchkey.<a class="code" href="classString.html#a89">gsub</a>((<font class="keywordtype">char</font>) 255,separator); <font class="comment">// restore escaped characters</font>
00555         <a class="code" href="classStringList.html">StringList</a> targets;
00556         grepinfo.<a class="code" href="classString.html#a83">del</a>(0,keyend+1);
00557         <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> i = 0; (!grepinfo.<a class="code" href="classString.html#a106">empty</a>()); i++) {
00558                 <font class="comment">// get next target from command line arguments</font>
00559                 targets[i] = grepinfo.<a class="code" href="classString.html#a58">before</a>(separator);
00560                 <font class="keywordflow">if</font> (targets[i].empty()) targets[i] = grepinfo;
00561                 targets[i].gsub((<font class="keywordtype">char</font>) 255,separator); <font class="comment">// restore escaped characters</font>
00562                 <font class="comment">// interpret target</font>
00563                 <font class="comment">// *** add: tar(gz) and zip archives, archive declarator, file containing target lines, default set</font>
00564                 <font class="keywordflow">if</font> (targets[i].<a class="code" href="classStringList.html#a12">contains</a>(trx)) i = <a class="code" href="search_8cc.html#a4">Get_Target_Regex</a>(targets,i,targets[i]) - 1;
00565                 <font class="comment">// *** does not yet properly handle remote files matching regex pattern or remote files pointing to archives</font>
00566                 <font class="comment">// Now handled within search: else if (file_is_directory(targets[i])) i = Get_Target_Directory(targets,i,targets[i]) - 1;</font>
00567                 <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((!targets[i].<a class="code" href="classStringList.html#a12">contains</a>(rrx)) &amp;&amp; (<a class="code" href="utilities_8cc.html#a34">file_is_directory</a>(targets[i])) &amp;&amp; (followlinks&lt;=0)) { <font class="comment">// follow links one deep into the directory</font>
00568                         followlinks = 1;
00569                         <font class="keywordflow">if</font> (verbose) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"(Setting followlinks=1 to search directory.)\n"</font>;
00570                 }
00571                 grepinfo = grepinfo.<a class="code" href="classString.html#a76">after</a>(separator);
00572         }
00573         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="charliteral">'\n'</font>;
00574         <a class="code" href="classString.html">String</a> <a class="code" href="templates_8defines_8hh.html#a11">res</a> = <a class="code" href="search_8cc.html#a2">search</a>(targets,searchkey,<font class="keyword">false</font>);
00575         <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; <font class="stringliteral">"(Number of search results: &lt;B&gt;"</font> &lt;&lt; res &lt;&lt; <font class="stringliteral">"&lt;/B&gt;)\n&lt;P&gt;\n"</font>;
00576         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00577 }
</pre></div>    </td>
  </tr>
</table>
<a name="a6" doxytag="search.cc::search_FORM_cmd"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> bool search_FORM_cmd </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classStringList.html">StringList</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>qlist</em> = NULL          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="search_8cc-source.html#l00579">579</a> of file <a class="el" href="search_8cc-source.html">search.cc</a>.
<p>
References <a class="el" href="dil2al_8hh-source.html#l00071">DIL2AL_CONDITIONAL_ERROR_RETURN</a>, <a class="el" href="BigString_8hh-source.html#l00494">String::empty</a>(), <a class="el" href="BigString_8hh-source.html#l01234">String::gsub</a>(), <a class="el" href="search_8cc-source.html#l00527">search_cmd</a>(), and <a class="el" href="utilities_8cc-source.html#l02644">URI_unescape</a>().
<p>
Referenced by <a class="el" href="dil2al_8cc-source.html#l00434">Detect_Form_Input</a>().
<p>
<div class="fragment"><pre>00579                                                 {
00580   <font class="comment">// Perform a dil2al regex search with input from an HTML FORM.</font>
00581   <font class="keyword">const</font> <font class="keywordtype">char</font> escapedseparator[3] = {254,254,0};
00582   <font class="keyword">const</font> <font class="keywordtype">char</font> separator = 254;
00583   <font class="keywordflow">if</font> (!qlist) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00584   <a class="code" href="classString.html">String</a> grepinfo(separator);
00585   <font class="keywordtype">int</font> paridx; <a class="code" href="classString.html">String</a> parstr;
00586   <a class="code" href="dil2al_8hh.html#a5">DIL2AL_CONDITIONAL_ERROR_RETURN</a>((paridx=qlist-&gt;<a class="code" href="classStringList.html#a12">contains</a>(<font class="stringliteral">"regex="</font>))&lt;0,<font class="stringliteral">"No regex parameter found in form data in search_FORM_cmd()\n"</font>);
00587   parstr=<a class="code" href="utilities_8cc.html#a79">URI_unescape</a>((*qlist)[paridx].after(<font class="charliteral">'='</font>));
00588   <a class="code" href="dil2al_8hh.html#a5">DIL2AL_CONDITIONAL_ERROR_RETURN</a>(parstr.<a class="code" href="classString.html#a106">empty</a>(),<font class="stringliteral">"Empty regex parameter in search_FORM_cmd()\n"</font>);
00589   parstr.<a class="code" href="classString.html#a89">gsub</a>(separator,escapedseparator);
00590   grepinfo += parstr + separator;
00591   <a class="code" href="dil2al_8hh.html#a5">DIL2AL_CONDITIONAL_ERROR_RETURN</a>((paridx=qlist-&gt;<a class="code" href="classStringList.html#a12">contains</a>(<font class="stringliteral">"targets="</font>))&lt;0,<font class="stringliteral">"No targets parameter found in form data in search_FORM_cmd()\n"</font>);
00592   parstr=<a class="code" href="utilities_8cc.html#a79">URI_unescape</a>((*qlist)[paridx].after(<font class="charliteral">'='</font>));
00593   <a class="code" href="dil2al_8hh.html#a5">DIL2AL_CONDITIONAL_ERROR_RETURN</a>(parstr.<a class="code" href="classString.html#a106">empty</a>(),<font class="stringliteral">"Empty targets parameter in search_FORM_cmd()\n"</font>);
00594   parstr.<a class="code" href="classString.html#a89">gsub</a>(separator,escapedseparator);
00595   parstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="charliteral">'\r'</font>,<font class="stringliteral">""</font>);
00596   parstr.<a class="code" href="classString.html#a89">gsub</a>(<font class="charliteral">'\n'</font>,separator);
00597   grepinfo += parstr;
00598   <font class="keywordflow">return</font> <a class="code" href="search_8cc.html#a5">search_cmd</a>(grepinfo);
00599 }
</pre></div>    </td>
  </tr>
</table>
<a name="a1" doxytag="search.cc::search_output"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> long search_output </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classPLLRoot.html">PLLRoot</a>&lt; <a class="el" href="classSearch__Result.html">Search_Result</a> &gt; *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>sr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="classString.html">String</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>res</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>stringoutput</em> = <a class="el" href="templates_8defines_8hh.html#a9">true</a></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="search_8cc-source.html#l00413">413</a> of file <a class="el" href="search_8cc-source.html">search.cc</a>.
<p>
References <a class="el" href="templates_8classic_8hh-source.html#l00104">PLLRoot&lt; PLLType &gt;::clear</a>(), <a class="el" href="templates_8classic_8hh-source.html#l00086">PLLRoot&lt; PLLType &gt;::head</a>(), <a class="el" href="templates_8classic_8hh-source.html#l00090">PLLRoot&lt; PLLType &gt;::length</a>(), <a class="el" href="templates_8classic_8hh-source.html#l00342">PLL_LOOP_FORWARD</a>, <a class="el" href="templates_8defines_8hh-source.html#l00277">res</a>, and <a class="el" href="dil2al_8hh-source.html#l01407">VOUT</a>.
<p>
Referenced by <a class="el" href="search_8cc-source.html#l00425">search</a>().
<p>
<div class="fragment"><pre>00413                                                                                         {
00414         <font class="comment">// output results</font>
00415         <font class="keywordflow">if</font> (stringoutput) <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classSearch__Result.html">Search_Result</a>,sr-&gt;<a class="code" href="classPLLRoot.html#a2">head</a>(),1) res += e-&gt;HTML_put_text();
00416         <font class="keywordflow">else</font> {
00417                 <a class="code" href="templates_8classic_8hh.html#a1">PLL_LOOP_FORWARD</a>(<a class="code" href="classSearch__Result.html">Search_Result</a>,sr-&gt;<a class="code" href="classPLLRoot.html#a2">head</a>(),1) <a class="code" href="dil2al_8hh.html#a108">VOUT</a> &lt;&lt; e-&gt;HTML_put_text();
00418                 <a class="code" href="dil2al_8hh.html#a108">VOUT</a>.flush();
00419         }
00420         <font class="keywordtype">long</font> num = sr-&gt;<a class="code" href="classPLLRoot.html#a6">length</a>();
00421         sr-&gt;<a class="code" href="classPLLRoot.html#a16">clear</a>();
00422         <font class="keywordflow">return</font> num;
00423 }
</pre></div>    </td>
  </tr>
</table>
<hr><address align="right"><small>Generated on Mon Sep 13 14:53:16 2004 for dil2al by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
